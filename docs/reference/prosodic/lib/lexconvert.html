<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.6.0"/>
    <title>prosodic.lib.lexconvert API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:.75rem center;margin-bottom:1rem;}.pdoc .alert > em{display:none;}.pdoc .alert > *:last-child{margin-bottom:0;}.pdoc .alert.note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .alert.warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .alert.danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../lib.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;prosodic.lib</a>


            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="function" href="#Phonemes">Phonemes</a>
            </li>
            <li>
                    <a class="function" href="#LexFormats">LexFormats</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_try">mainopt_try</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_trymac">mainopt_trymac</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_trymac_uk">mainopt_trymac_uk</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_phones">mainopt_phones</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_ruby">mainopt_ruby</a>
            </li>
            <li>
                    <a class="function" href="#pipeThroughEspeak">pipeThroughEspeak</a>
            </li>
            <li>
                    <a class="function" href="#espeak_version_line">espeak_version_line</a>
            </li>
            <li>
                    <a class="function" href="#writeFormatHeader">writeFormatHeader</a>
            </li>
            <li>
                    <a class="variable" href="#writeFormatHeader_called">writeFormatHeader_called</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_check_variants">mainopt_check_variants</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_check_for_similar_formats">mainopt_check_for_similar_formats</a>
            </li>
            <li>
                    <a class="function" href="#festival_group_stress">festival_group_stress</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_convert">mainopt_convert</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_festival_dictionary_to_espeak">mainopt_festival_dictionary_to_espeak</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_syllables">mainopt_syllables</a>
            </li>
            <li>
                    <a class="function" href="#wordSeparator">wordSeparator</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_phones2phones">mainopt_phones2phones</a>
            </li>
            <li>
                    <a class="function" href="#parseIntoWordsAndClauses">parseIntoWordsAndClauses</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_mac_uk">mainopt_mac_uk</a>
            </li>
            <li>
                    <a class="class" href="#Counter">Counter</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Counter.c">c</a>
                        </li>
                        <li>
                                <a class="variable" href="#Counter.sc">sc</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#other">other</a>
            </li>
            <li>
                    <a class="variable" href="#consonants">consonants</a>
            </li>
            <li>
                    <a class="variable" href="#mainVowels">mainVowels</a>
            </li>
            <li>
                    <a class="function" href="#consonant">consonant</a>
            </li>
            <li>
                    <a class="function" href="#vowel">vowel</a>
            </li>
            <li>
                    <a class="function" href="#opt_vowel">opt_vowel</a>
            </li>
            <li>
                    <a class="function" href="#variant">variant</a>
            </li>
            <li>
                    <a class="function" href="#ifset">ifset</a>
            </li>
            <li>
                    <a class="function" href="#speakjet">speakjet</a>
            </li>
            <li>
                    <a class="function" href="#makeDic">makeDic</a>
            </li>
            <li>
                    <a class="function" href="#makeVariantDic">makeVariantDic</a>
            </li>
            <li>
                    <a class="function" href="#getSetting">getSetting</a>
            </li>
            <li>
                    <a class="function" href="#checkSetting">checkSetting</a>
            </li>
            <li>
                    <a class="function" href="#getBuf">getBuf</a>
            </li>
            <li>
                    <a class="function" href="#make_dictionary">make_dictionary</a>
            </li>
            <li>
                    <a class="variable" href="#warnedAlready">warnedAlready</a>
            </li>
            <li>
                    <a class="function" href="#convert">convert</a>
            </li>
            <li>
                    <a class="function" href="#unicode_preprocess">unicode_preprocess</a>
            </li>
            <li>
                    <a class="function" href="#ascii_braille_to_unicode">ascii_braille_to_unicode</a>
            </li>
            <li>
                    <a class="function" href="#unicode_to_ascii_braille">unicode_to_ascii_braille</a>
            </li>
            <li>
                    <a class="function" href="#hiragana_to_katakana">hiragana_to_katakana</a>
            </li>
            <li>
                    <a class="function" href="#espeak_probably_right_already">espeak_probably_right_already</a>
            </li>
            <li>
                    <a class="function" href="#parse_festival_dict">parse_festival_dict</a>
            </li>
            <li>
                    <a class="class" href="#Message">Message</a>
                            <ul class="memberlist">
                </ul>

            </li>
            <li>
                    <a class="function" href="#convert_system_festival_dictionary_to_espeak">convert_system_festival_dictionary_to_espeak</a>
            </li>
            <li>
                    <a class="function" href="#read_user_lexicon">read_user_lexicon</a>
            </li>
            <li>
                    <a class="function" href="#replHome">replHome</a>
            </li>
            <li>
                    <a class="function" href="#get_macuk_lexicon">get_macuk_lexicon</a>
            </li>
            <li>
                    <a class="function" href="#as_utf8">as_utf8</a>
            </li>
            <li>
                    <a class="function" href="#as_unicode">as_unicode</a>
            </li>
            <li>
                    <a class="function" href="#maybe_bytes">maybe_bytes</a>
            </li>
            <li>
                    <a class="function" href="#as_printable">as_printable</a>
            </li>
            <li>
                    <a class="function" href="#convert_user_lexicon">convert_user_lexicon</a>
            </li>
            <li>
                    <a class="function" href="#bbcMicro_partPhonemeCount">bbcMicro_partPhonemeCount</a>
            </li>
            <li>
                    <a class="function" href="#markup_inline_word">markup_inline_word</a>
            </li>
            <li>
                    <a class="function" href="#markup_doubleTalk_word">markup_doubleTalk_word</a>
            </li>
            <li>
                    <a class="function" href="#markup_bbcMicro_word">markup_bbcMicro_word</a>
            </li>
            <li>
                    <a class="function" href="#sylcount">sylcount</a>
            </li>
            <li>
                    <a class="function" href="#hyphenate">hyphenate</a>
            </li>
            <li>
                    <a class="function" href="#macSayCommand">macSayCommand</a>
            </li>
            <li>
                    <a class="function" href="#stdin_is_terminal">stdin_is_terminal</a>
            </li>
            <li>
                    <a class="function" href="#getInputText">getInputText</a>
            </li>
            <li>
                    <a class="function" href="#my_xreadlines">my_xreadlines</a>
            </li>
            <li>
                    <a class="function" href="#output_clauses">output_clauses</a>
            </li>
            <li>
                    <a class="function" href="#write_bbcmicro_phones">write_bbcmicro_phones</a>
            </li>
            <li>
                    <a class="function" href="#print_bbc_warnings">print_bbc_warnings</a>
            </li>
            <li>
                    <a class="function" href="#bbc_prepDefaultLex">bbc_prepDefaultLex</a>
            </li>
            <li>
                    <a class="function" href="#bbc_appendDefaultLex">bbc_appendDefaultLex</a>
            </li>
            <li>
                    <a class="function" href="#bbcshortest">bbcshortest</a>
            </li>
            <li>
                    <a class="function" href="#bbcKeystrokes">bbcKeystrokes</a>
            </li>
            <li>
                    <a class="function" href="#print_bbclex_instructions">print_bbclex_instructions</a>
            </li>
            <li>
                    <a class="function" href="#mainopt_version">mainopt_version</a>
            </li>
            <li>
                    <a class="function" href="#main">main</a>
            </li>
            <li>
                    <a class="function" href="#catchSignals">catchSignals</a>
            </li>
            <li>
                    <a class="class" href="#MacBritish_System_Lexicon">MacBritish_System_Lexicon</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.__init__">MacBritish_System_Lexicon</a>
                        </li>
                        <li>
                                <a class="variable" href="#MacBritish_System_Lexicon.instances">instances</a>
                        </li>
                        <li>
                                <a class="variable" href="#MacBritish_System_Lexicon.voice">voice</a>
                        </li>
                        <li>
                                <a class="variable" href="#MacBritish_System_Lexicon.filename">filename</a>
                        </li>
                        <li>
                                <a class="variable" href="#MacBritish_System_Lexicon.textToAvoid">textToAvoid</a>
                        </li>
                        <li>
                                <a class="variable" href="#MacBritish_System_Lexicon.restoreDic">restoreDic</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.allWords">allWords</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.allPh">allPh</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.usable_words">usable_words</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.check_redef">check_redef</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.speakPhones">speakPhones</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.readWithLex">readWithLex</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.setMultiple">setMultiple</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.set">set</a>
                        </li>
                        <li>
                                <a class="function" href="#MacBritish_System_Lexicon.close">close</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#stdout_width_unix">stdout_width_unix</a>
            </li>
            <li>
                    <a class="variable" href="#lexFormats">lexFormats</a>
            </li>
            <li>
                    <a class="function" href="#chr">chr</a>
            </li>
            <li>
                    <a class="function" href="#sorted">sorted</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../prosodic.html">prosodic</a><wbr>.<a href="./../lib.html">lib</a><wbr>.lexconvert    </h1>

                        <div class="docstring"><p>lexconvert v0.301 - convert phonemes between different speech synthesizers etc
(c) 2007-19 Silas S. Brown.  License: GPL</p>
</div>

                        <input id="mod-lexconvert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-lexconvert-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">   1</span></a><span class="ch">#!/usr/bin/env python</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">   2</span></a><span class="c1"># May be run with either Python 2 or Python 3</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">   3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">   4</span></a><span class="sd">&quot;&quot;&quot;lexconvert v0.301 - convert phonemes between different speech synthesizers etc</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">   5</span></a><span class="sd">(c) 2007-19 Silas S. Brown.  License: GPL&quot;&quot;&quot;</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">   6</span></a>
</span><span id="L-7"><a href="#L-7"><span class="linenos">   7</span></a><span class="c1"># Run without arguments for usage information</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">   8</span></a>
</span><span id="L-9"><a href="#L-9"><span class="linenos">   9</span></a><span class="c1">#    This program is free software; you can redistribute it and/or modify</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos">  10</span></a><span class="c1">#    it under the terms of the GNU General Public License as published by</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos">  11</span></a><span class="c1">#    the Free Software Foundation; either version 3 of the License, or</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos">  12</span></a><span class="c1">#    (at your option) any later version.</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos">  13</span></a><span class="c1">#</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos">  14</span></a><span class="c1">#    This program is distributed in the hope that it will be useful,</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos">  15</span></a><span class="c1">#    but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos">  16</span></a><span class="c1">#    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos">  17</span></a><span class="c1">#    GNU General Public License for more details.</span>
</span><span id="L-18"><a href="#L-18"><span class="linenos">  18</span></a>
</span><span id="L-19"><a href="#L-19"><span class="linenos">  19</span></a><span class="c1"># Old versions of this code are being kept in the E-GuideDog SVN repository at</span>
</span><span id="L-20"><a href="#L-20"><span class="linenos">  20</span></a><span class="c1"># http://svn.code.sf.net/p/e-guidedog/code/ssb22/lexconvert</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos">  21</span></a><span class="c1"># and on GitHub at https://github.com/ssb22/lexconvert</span>
</span><span id="L-22"><a href="#L-22"><span class="linenos">  22</span></a><span class="c1"># and on GitLab at https://gitlab.com/ssb22/lexconvert</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos">  23</span></a><span class="c1"># and on Bitbucket https://bitbucket.org/ssb22/lexconvert</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos">  24</span></a><span class="c1"># although some early ones are missing.</span>
</span><span id="L-25"><a href="#L-25"><span class="linenos">  25</span></a>
</span><span id="L-26"><a href="#L-26"><span class="linenos">  26</span></a><span class="k">def</span> <span class="nf">Phonemes</span><span class="p">():</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos">  27</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Create phonemes by calling vowel(), consonant(),</span>
</span><span id="L-28"><a href="#L-28"><span class="linenos">  28</span></a><span class="sd">     variant() and other().</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos">  29</span></a><span class="sd">   </span>
</span><span id="L-30"><a href="#L-30"><span class="linenos">  30</span></a><span class="sd">     For the variants, if a particular variant does not</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos">  31</span></a><span class="sd">     exist in the destination format then we will treat it</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos">  32</span></a><span class="sd">     as equivalent to the last non-variant we created.</span>
</span><span id="L-33"><a href="#L-33"><span class="linenos">  33</span></a><span class="sd">  </span>
</span><span id="L-34"><a href="#L-34"><span class="linenos">  34</span></a><span class="sd">     For anything else that does not exist in the</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos">  35</span></a><span class="sd">     destination format, we will first try to break the</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos">  36</span></a><span class="sd">     source&#39;s phoneme into parts (e.g. see the treatment</span>
</span><span id="L-37"><a href="#L-37"><span class="linenos">  37</span></a><span class="sd">     of opt_ol_as_in_gold by eSpeak and bbcmicro), and if</span>
</span><span id="L-38"><a href="#L-38"><span class="linenos">  38</span></a><span class="sd">     that still doesn&#39;t work then we drop a character</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos">  39</span></a><span class="sd">     (warning depending on the source format&#39;s setting of</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos">  40</span></a><span class="sd">     safe_to_drop_characters).  makeDic does however warn</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos">  41</span></a><span class="sd">     about any non-variant consonants, or non-variant</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos">  42</span></a><span class="sd">     vowels that weren&#39;t marked optional, missing from a</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos">  43</span></a><span class="sd">     format. &quot;&quot;&quot;</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos">  44</span></a>   <span class="n">a_as_in_ah</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos">  45</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos">  46</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos">  47</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var4_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos">  48</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var5_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos">  49</span></a>   <span class="n">a_as_in_apple</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos">  50</span></a>   <span class="n">u_as_in_but</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span> <span class="c1"># or the first part of un as in hunt</span>
</span><span id="L-51"><a href="#L-51"><span class="linenos">  51</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_u_as_in_but</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-52"><a href="#L-52"><span class="linenos">  52</span></a>   <span class="n">o_as_in_orange</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos">  53</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_orange</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos">  54</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_o_as_in_orange</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos">  55</span></a>   <span class="n">o_as_in_now</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos">  56</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_now</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos">  57</span></a>   <span class="n">a_as_in_ago</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos">  58</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ago</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos">  59</span></a>   <span class="n">e_as_in_herd</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos">  60</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">ar_as_in_year</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-61"><a href="#L-61"><span class="linenos">  61</span></a>   <span class="n">eye</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-62"><a href="#L-62"><span class="linenos">  62</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_eye</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos">  63</span></a>   <span class="n">b</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos">  64</span></a>   <span class="n">ch</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-65"><a href="#L-65"><span class="linenos">  65</span></a>   <span class="n">d</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos">  66</span></a>   <span class="n">th_as_in_them</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos">  67</span></a>   <span class="n">e_as_in_them</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos">  68</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_e_as_in_them</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos">  69</span></a>   <span class="n">a_as_in_air</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos">  70</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos">  71</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos">  72</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos">  73</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var4_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos">  74</span></a>   <span class="n">a_as_in_ate</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-75"><a href="#L-75"><span class="linenos">  75</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ate</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-76"><a href="#L-76"><span class="linenos">  76</span></a>   <span class="n">f</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos">  77</span></a>   <span class="n">g</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos">  78</span></a>   <span class="n">h</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos">  79</span></a>   <span class="n">i_as_in_it</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos">  80</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_i_as_in_it</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos">  81</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_i_as_in_it</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos">  82</span></a>   <span class="n">ear</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos">  83</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_ear</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos">  84</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_ear</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos">  85</span></a>   <span class="n">e_as_in_eat</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-86"><a href="#L-86"><span class="linenos">  86</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_e_as_in_eat</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos">  87</span></a>   <span class="n">j_as_in_jump</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos">  88</span></a>   <span class="n">k</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos">  89</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">opt_scottish_loch</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos">  90</span></a>   <span class="n">l</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos">  91</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_l</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos">  92</span></a>   <span class="n">m</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos">  93</span></a>   <span class="n">n</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos">  94</span></a>   <span class="n">ng</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos">  95</span></a>   <span class="n">o_as_in_go</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos">  96</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_go</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos">  97</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_o_as_in_go</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos">  98</span></a>   <span class="n">opt_ol_as_in_gold</span> <span class="o">=</span> <span class="n">opt_vowel</span><span class="p">()</span> <span class="c1"># see eSpeak / bbcmicro</span>
</span><span id="L-99"><a href="#L-99"><span class="linenos">  99</span></a>   <span class="n">oy_as_in_toy</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos"> 100</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oy_as_in_toy</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos"> 101</span></a>   <span class="n">p</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos"> 102</span></a>   <span class="n">r</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos"> 103</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_r</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos"> 104</span></a>   <span class="n">s</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos"> 105</span></a>   <span class="n">sh</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos"> 106</span></a>   <span class="n">t</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos"> 107</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_t</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-108"><a href="#L-108"><span class="linenos"> 108</span></a>   <span class="n">th_as_in_think</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos"> 109</span></a>   <span class="n">oor_as_in_poor</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-110"><a href="#L-110"><span class="linenos"> 110</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oor_as_in_poor</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos"> 111</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">opt_u_as_in_pull</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos"> 112</span></a>   <span class="n">opt_ul_as_in_pull</span> <span class="o">=</span> <span class="n">opt_vowel</span><span class="p">()</span> <span class="c1"># see eSpeak / bbcmicro</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos"> 113</span></a>   <span class="n">oo_as_in_food</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-114"><a href="#L-114"><span class="linenos"> 114</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oo_as_in_food</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos"> 115</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_oo_as_in_food</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos"> 116</span></a>   <span class="n">close_to_or</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos"> 117</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-118"><a href="#L-118"><span class="linenos"> 118</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos"> 119</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos"> 120</span></a>   <span class="n">v</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos"> 121</span></a>   <span class="n">w</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos"> 122</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_w</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos"> 123</span></a>   <span class="n">y</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos"> 124</span></a>   <span class="n">z</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos"> 125</span></a>   <span class="n">ge_of_blige_etc</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos"> 126</span></a>   <span class="n">glottal_stop</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-127"><a href="#L-127"><span class="linenos"> 127</span></a>   <span class="n">syllable_separator</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos"> 128</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">primary_stress</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos"> 129</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">secondary_stress</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos"> 130</span></a>   <span class="n">text_sharp</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-131"><a href="#L-131"><span class="linenos"> 131</span></a>   <span class="n">text_underline</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos"> 132</span></a>   <span class="n">text_question</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos"> 133</span></a>   <span class="n">text_exclamation</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos"> 134</span></a>   <span class="n">text_comma</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos"> 135</span></a>   <span class="n">ipa_colon</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="c1"># for catching missed cases</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos"> 136</span></a>   <span class="k">del</span> <span class="n">_</span> <span class="p">;</span> <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos"> 137</span></a>
</span><span id="L-138"><a href="#L-138"><span class="linenos"> 138</span></a><span class="k">def</span> <span class="nf">LexFormats</span><span class="p">():</span>
</span><span id="L-139"><a href="#L-139"><span class="linenos"> 139</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Makes the phoneme conversion tables of each format.</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos"> 140</span></a><span class="sd">     Each table has string to phoneme entries and phoneme</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos"> 141</span></a><span class="sd">     to string entries.  The string to phoneme entries are</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos"> 142</span></a><span class="sd">     used when converting OUT of that format, and the</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos"> 143</span></a><span class="sd">     phoneme to string entries are used when converting IN</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos"> 144</span></a><span class="sd">     (so you can recognise phonemes you don&#39;t support and</span>
</span><span id="L-145"><a href="#L-145"><span class="linenos"> 145</span></a><span class="sd">     convert them to something else).  By default, a tuple</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos"> 146</span></a><span class="sd">     of the form (string,phoneme) will create entries in</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos"> 147</span></a><span class="sd">     BOTH directions; one-directional entries are created</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos"> 148</span></a><span class="sd">     via (string,phoneme,False) or (phoneme,string,False).</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos"> 149</span></a><span class="sd">     The makeDic function checks the keys are unique.</span>
</span><span id="L-150"><a href="#L-150"><span class="linenos"> 150</span></a><span class="sd">     </span>
</span><span id="L-151"><a href="#L-151"><span class="linenos"> 151</span></a><span class="sd">     First parameter is always a description of the</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos"> 152</span></a><span class="sd">     format, then come the phoneme entries as described</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos"> 153</span></a><span class="sd">     above, then any additional settings:</span>
</span><span id="L-154"><a href="#L-154"><span class="linenos"> 154</span></a>
</span><span id="L-155"><a href="#L-155"><span class="linenos"> 155</span></a><span class="sd">       stress_comes_before_vowel (default False means any</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos"> 156</span></a><span class="sd">       stress mark goes AFTER the affected vowel; set to</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos"> 157</span></a><span class="sd">       True if the format requires stress placed before)</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos"> 158</span></a>
</span><span id="L-159"><a href="#L-159"><span class="linenos"> 159</span></a><span class="sd">       word_separator (default same as phoneme_separator)</span>
</span><span id="L-160"><a href="#L-160"><span class="linenos"> 160</span></a><span class="sd">       phoneme_separator (default &quot; &quot;)</span>
</span><span id="L-161"><a href="#L-161"><span class="linenos"> 161</span></a><span class="sd">       clause_separator (default newline)</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos"> 162</span></a>
</span><span id="L-163"><a href="#L-163"><span class="linenos"> 163</span></a><span class="sd">       (For a special case, clause_separator can also be</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos"> 164</span></a><span class="sd">        set to a function.  If that happens, the function</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos"> 165</span></a><span class="sd">        will be called whenever lexconvert needs to output</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos"> 166</span></a><span class="sd">        a list of (lists of words) in this format.  See</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos"> 167</span></a><span class="sd">        bbcmicro for an example function clause_separator)</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos"> 168</span></a>
</span><span id="L-169"><a href="#L-169"><span class="linenos"> 169</span></a><span class="sd">       safe_to_drop_characters (default False, can be a</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos"> 170</span></a><span class="sd">       string of safe characters or True = all; controls</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos"> 171</span></a><span class="sd">       warnings when unrecognised characters are found)</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos"> 172</span></a>
</span><span id="L-173"><a href="#L-173"><span class="linenos"> 173</span></a><span class="sd">       approximate_missing (default False) - if True,</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos"> 174</span></a><span class="sd">       makeDic will attempt to compensate for missing</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos"> 175</span></a><span class="sd">       phonemes by approximating them to others, instead of</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos"> 176</span></a><span class="sd">       warning about them.  This is useful for American codes</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos"> 177</span></a><span class="sd">       that can&#39;t cope with all the British English phonemes.</span>
</span><span id="L-178"><a href="#L-178"><span class="linenos"> 178</span></a><span class="sd">       (Approximation is done automatically anyway in the</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos"> 179</span></a><span class="sd">       case of variant phonemes; approximate_missing adds in</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos"> 180</span></a><span class="sd">       some additional approximations - see comments in code)</span>
</span><span id="L-181"><a href="#L-181"><span class="linenos"> 181</span></a>
</span><span id="L-182"><a href="#L-182"><span class="linenos"> 182</span></a><span class="sd">       cleanup_regexps (default none) - optional list of</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos"> 183</span></a><span class="sd">       (search,replace) regular expressions to &quot;clean up&quot;</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos"> 184</span></a><span class="sd">       after converting each word INTO this format</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos"> 185</span></a><span class="sd">       cleanup_func (default none) - optional special-case</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos"> 186</span></a><span class="sd">       function to pass result through after cleanup_regexps</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos"> 187</span></a>
</span><span id="L-188"><a href="#L-188"><span class="linenos"> 188</span></a><span class="sd">       cvtOut_regexps (default none) - optional list of</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos"> 189</span></a><span class="sd">       (search,replace) regular expressions to &quot;clean up&quot;</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos"> 190</span></a><span class="sd">       before starting to convert OUT of this format</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos"> 191</span></a><span class="sd">       cvtOut_func (default none) - optional special-case</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos"> 192</span></a><span class="sd">       function to pass through before any cvtOut_regexps</span>
</span><span id="L-193"><a href="#L-193"><span class="linenos"> 193</span></a><span class="sd">  </span>
</span><span id="L-194"><a href="#L-194"><span class="linenos"> 194</span></a><span class="sd">       inline_format (default &quot;%s&quot;) the format string for</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos"> 195</span></a><span class="sd">       printing a word with --phones or --phones2phones</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos"> 196</span></a><span class="sd">       (can be used to put markup around each word)</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos"> 197</span></a><span class="sd">       (can also be a function taking the phonetic word</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos"> 198</span></a><span class="sd">        and returning the resulting string, e.g. bbcmicro)</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos"> 199</span></a>
</span><span id="L-200"><a href="#L-200"><span class="linenos"> 200</span></a><span class="sd">       output_is_binary (default False) - True if the output</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos"> 201</span></a><span class="sd">       is almost certainly unsuitable for a terminal; will</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos"> 202</span></a><span class="sd">       cause lexconvert to refuse to print phonemes unless</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos"> 203</span></a><span class="sd">       its standard output is redirected to a file or pipe</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos"> 204</span></a><span class="sd">       (affects the --phones and --phones2phones options)</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos"> 205</span></a>
</span><span id="L-206"><a href="#L-206"><span class="linenos"> 206</span></a><span class="sd">       inline_header (default none) text to print first</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos"> 207</span></a><span class="sd">         when outputting from --phones or --phones2phones</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos"> 208</span></a><span class="sd">       inline_footer (default none) text to print last</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos"> 209</span></a><span class="sd">       inline_oneoff_header (default none) text to print</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos"> 210</span></a><span class="sd">         before inline_header on the first time only</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos"> 211</span></a>
</span><span id="L-212"><a href="#L-212"><span class="linenos"> 212</span></a><span class="sd">       lex_filename - filename of a lexicon file.  If this</span>
</span><span id="L-213"><a href="#L-213"><span class="linenos"> 213</span></a><span class="sd">       is not specified, there is no support for writing a</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos"> 214</span></a><span class="sd">       lexicon in this format: there can still be READ</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos"> 215</span></a><span class="sd">       support if you define lex_read_function to open the</span>
</span><span id="L-216"><a href="#L-216"><span class="linenos"> 216</span></a><span class="sd">       lexicon by itself, but otherwise the format can be</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos"> 217</span></a><span class="sd">       used only with --phones and --phones2phones.</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos"> 218</span></a>
</span><span id="L-219"><a href="#L-219"><span class="linenos"> 219</span></a><span class="sd">       lex_entry_format - format string for writing each</span>
</span><span id="L-220"><a href="#L-220"><span class="linenos"> 220</span></a><span class="sd">       (word, pronunciation) entry to the lexicon file.</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos"> 221</span></a><span class="sd">       This is also needed for lexicon-write support.</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos"> 222</span></a>
</span><span id="L-223"><a href="#L-223"><span class="linenos"> 223</span></a><span class="sd">       lex_header, lex_footer - optional strings to write</span>
</span><span id="L-224"><a href="#L-224"><span class="linenos"> 224</span></a><span class="sd">       at the beginning and at the end of the lexicon file</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos"> 225</span></a><span class="sd">       (can also be functions that take the open file as a</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos"> 226</span></a><span class="sd">        parameter, e.g. for bbcmicro; lex_footer is</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos"> 227</span></a><span class="sd">        allowed to close the file if it needs to do</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos"> 228</span></a><span class="sd">        something with it afterwards)</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos"> 229</span></a>
</span><span id="L-230"><a href="#L-230"><span class="linenos"> 230</span></a><span class="sd">       lex_word_case - optional &quot;upper&quot; or &quot;lower&quot; to</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos"> 231</span></a><span class="sd">       force a particular case for lexicon words (not</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos"> 232</span></a><span class="sd">       pronunciations - they&#39;re determined by the table).</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos"> 233</span></a><span class="sd">       The default is to allow words to be in either case.</span>
</span><span id="L-234"><a href="#L-234"><span class="linenos"> 234</span></a>
</span><span id="L-235"><a href="#L-235"><span class="linenos"> 235</span></a><span class="sd">       lex_type (default &quot;&quot;) - used by the --formats</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos"> 236</span></a><span class="sd">       option when summarising the support for each format</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos"> 237</span></a>
</span><span id="L-238"><a href="#L-238"><span class="linenos"> 238</span></a><span class="sd">       lex_read_function - Python function to READ the</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos"> 239</span></a><span class="sd">       lexicon file and return a (word,phonemes) list.</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos"> 240</span></a><span class="sd">       If this is not specified, there&#39;s no read support</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos"> 241</span></a><span class="sd">       for lexicons in this format (but there can still be</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos"> 242</span></a><span class="sd">       write support - see above - and you can still use</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos"> 243</span></a><span class="sd">       --phones and --phones2phones).  If lex_filename is</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos"> 244</span></a><span class="sd">       specified then this function will be given the open</span>
</span><span id="L-245"><a href="#L-245"><span class="linenos"> 245</span></a><span class="sd">       file as a parameter. &quot;&quot;&quot;</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos"> 246</span></a>  
</span><span id="L-247"><a href="#L-247"><span class="linenos"> 247</span></a>  <span class="n">phonemes</span> <span class="o">=</span> <span class="n">Phonemes</span><span class="p">()</span> <span class="p">;</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">phonemes</span><span class="p">)</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos"> 248</span></a>  <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;festival&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos"> 249</span></a>    <span class="s2">&quot;Festival&#39;s British voice&quot;</span><span class="p">,</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos"> 250</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-251"><a href="#L-251"><span class="linenos"> 251</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos"> 252</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos"> 253</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-254"><a href="#L-254"><span class="linenos"> 254</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos"> 255</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-256"><a href="#L-256"><span class="linenos"> 256</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos"> 257</span></a>    <span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-258"><a href="#L-258"><span class="linenos"> 258</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos"> 259</span></a>    <span class="p">(</span><span class="s1">&#39;@@&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos"> 260</span></a>    <span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos"> 261</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos"> 262</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos"> 263</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos"> 264</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos"> 265</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos"> 266</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;@@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos"> 267</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos"> 268</span></a>    <span class="p">(</span><span class="s1">&#39;ei&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos"> 269</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos"> 270</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos"> 271</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-272"><a href="#L-272"><span class="linenos"> 272</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-273"><a href="#L-273"><span class="linenos"> 273</span></a>    <span class="p">(</span><span class="s1">&#39;i@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos"> 274</span></a>    <span class="p">(</span><span class="s1">&#39;ii&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos"> 275</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos"> 276</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos"> 277</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos"> 278</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos"> 279</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos"> 280</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos"> 281</span></a>    <span class="p">(</span><span class="s1">&#39;ou&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos"> 282</span></a>    <span class="p">(</span><span class="s1">&#39;oi&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos"> 283</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos"> 284</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos"> 285</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos"> 286</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos"> 287</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos"> 288</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos"> 289</span></a>    <span class="p">(</span><span class="s1">&#39;u@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos"> 290</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos"> 291</span></a>    <span class="p">(</span><span class="s1">&#39;uu&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos"> 292</span></a>    <span class="p">(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-293"><a href="#L-293"><span class="linenos"> 293</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos"> 294</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos"> 295</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos"> 296</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-297"><a href="#L-297"><span class="linenos"> 297</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos"> 298</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.festivalrc&quot;</span><span class="p">,</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos"> 299</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;(lex.add.entry &#39;( </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> n </span><span class="si">%s</span><span class="s2">))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos"> 300</span></a>    <span class="n">lex_header</span><span class="o">=</span><span class="s2">&quot;;; -*- mode: lisp -*-</span><span class="se">\n</span><span class="s2">(eval (list voice_default))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-301"><a href="#L-301"><span class="linenos"> 301</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;grep -vi parameter.set &lt; ~/.festivalrc | grep -v &#39;(eval&#39; | sed -e &#39;s/;.*//&#39; -e &#39;s/.lex.add.entry//&#39; -e s/</span><span class="se">\&quot;</span><span class="s2">&#39;</span><span class="se">\&quot;</span><span class="s2">&#39;[(] *</span><span class="se">\&quot;</span><span class="s2">/[</span><span class="se">\&quot;</span><span class="s2">/&#39; -e &#39;s/</span><span class="se">\&quot;</span><span class="s2"> [^ ]* /</span><span class="se">\&quot;</span><span class="s2">,(</span><span class="se">\&quot;</span><span class="s2">/&#39; -e &#39;s/</span><span class="se">\&quot;</span><span class="s2">.*$/&amp;</span><span class="se">\&quot;</span><span class="s2">],/&#39; -e &#39;s/[()]/ /g&#39; -e &#39;s/  */ /g&#39;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">),</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos"> 302</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really? (could instead give a string of known-safe characters)</span>
</span><span id="L-303"><a href="#L-303"><span class="linenos"> 303</span></a>    <span class="n">cleanup_func</span> <span class="o">=</span> <span class="n">festival_group_stress</span><span class="p">,</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos"> 304</span></a>  <span class="p">),</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos"> 305</span></a>
</span><span id="L-306"><a href="#L-306"><span class="linenos"> 306</span></a>  <span class="s2">&quot;example&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos"> 307</span></a>    <span class="s2">&quot;A small built-in example lexicon for testing when you don&#39;t have your full custom lexicon to hand.  Use --convert to write it in one of the other formats and see if a synth can import it.&quot;</span><span class="p">,</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos"> 308</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos"> 309</span></a>       <span class="p">(</span><span class="s2">&quot;Shadrach&quot;</span><span class="p">,</span><span class="s2">&quot;shei1drak&quot;</span><span class="p">),</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos"> 310</span></a>       <span class="p">(</span><span class="s2">&quot;Meshach&quot;</span><span class="p">,</span><span class="s2">&quot;mii1shak&quot;</span><span class="p">),</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos"> 311</span></a>       <span class="p">(</span><span class="s2">&quot;Abednego&quot;</span><span class="p">,</span><span class="s2">&quot;@be1dniigou&quot;</span><span class="p">),</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos"> 312</span></a>    <span class="p">],</span> <span class="n">cleanup_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos"> 313</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lex_entry_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos"> 314</span></a>
</span><span id="L-315"><a href="#L-315"><span class="linenos"> 315</span></a>  <span class="s2">&quot;festival-cmu&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos"> 316</span></a>    <span class="s2">&quot;American CMU version of Festival&quot;</span><span class="p">,</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos"> 317</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos"> 318</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos"> 319</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos"> 320</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos"> 321</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos"> 322</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span> <span class="c1"># TODO: check this one</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos"> 323</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos"> 324</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos"> 325</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos"> 326</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos"> 327</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos"> 328</span></a>    <span class="p">(</span><span class="s1">&#39;hh&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos"> 329</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-330"><a href="#L-330"><span class="linenos"> 330</span></a>    <span class="p">(</span><span class="s1">&#39;ey ah&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos"> 331</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos"> 332</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos"> 333</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos"> 334</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos"> 335</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos"> 336</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos"> 337</span></a>  <span class="p">),</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos"> 338</span></a>
</span><span id="L-339"><a href="#L-339"><span class="linenos"> 339</span></a>  <span class="s2">&quot;espeak&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos"> 340</span></a>    <span class="s2">&quot;eSpeak&#39;s default British voice&quot;</span><span class="p">,</span> <span class="c1"># but eSpeak&#39;s phoneme representation isn&#39;t always that simple, hence the regexps at the end</span>
</span><span id="L-341"><a href="#L-341"><span class="linenos"> 341</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos"> 342</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos"> 343</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-344"><a href="#L-344"><span class="linenos"> 344</span></a>    <span class="c1"># TODO: glottal_stop? (in regional pronunciations etc)</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos"> 345</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos"> 346</span></a>    <span class="p">(</span><span class="s1">&#39;A@&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos"> 347</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos"> 348</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos"> 349</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos"> 350</span></a>    <span class="p">(</span><span class="s1">&#39;a2&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: this is actually an a_as_in_apple variant in espeak; festival @1 is not in mrpa PhoneSet</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos"> 351</span></a>    <span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-352"><a href="#L-352"><span class="linenos"> 352</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos"> 353</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos"> 354</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-355"><a href="#L-355"><span class="linenos"> 355</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos"> 356</span></a>    <span class="p">(</span><span class="s1">&#39;a#&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># (TODO: eSpeak sometimes uses a# in &#39;had&#39; when in a sentence, and this doesn&#39;t always sound good on other synths; might sometimes want to convert it to a_as_in_apple; not sure what contexts would call for this though)</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos"> 357</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos"> 358</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos"> 359</span></a>    <span class="p">(</span><span class="s1">&#39;@2&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos"> 360</span></a>    <span class="p">(</span><span class="s1">&#39;@-&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># (eSpeak @- sounds to me like a shorter version of @, TODO: double-check the relationship between @ and @2 in Festival)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos"> 361</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos"> 362</span></a>    <span class="p">(</span><span class="s1">&#39;aI2&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos"> 363</span></a>    <span class="p">(</span><span class="s1">&#39;aI;&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos"> 364</span></a>    <span class="p">(</span><span class="s1">&#39;aI2;&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos"> 365</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos"> 366</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos"> 367</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos"> 368</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-369"><a href="#L-369"><span class="linenos"> 369</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos"> 370</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos"> 371</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-372"><a href="#L-372"><span class="linenos"> 372</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos"> 373</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos"> 374</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos"> 375</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos"> 376</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos"> 377</span></a>    <span class="p">(</span><span class="s1">&#39;I;&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos"> 378</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos"> 379</span></a>    <span class="p">(</span><span class="s1">&#39;I2&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos"> 380</span></a>    <span class="p">(</span><span class="s1">&#39;I2;&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos"> 381</span></a>    <span class="p">(</span><span class="s1">&#39;i@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos"> 382</span></a>    <span class="p">(</span><span class="s1">&#39;i@3&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos"> 383</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos"> 384</span></a>    <span class="p">(</span><span class="s1">&#39;i:;&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos"> 385</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos"> 386</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos"> 387</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-388"><a href="#L-388"><span class="linenos"> 388</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos"> 389</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos"> 390</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos"> 391</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos"> 392</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos"> 393</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos"> 394</span></a>    <span class="p">(</span><span class="s1">&#39;oUl&#39;</span><span class="p">,</span><span class="n">opt_ol_as_in_gold</span><span class="p">),</span> <span class="c1"># (espeak says &quot;gold&quot; in a slightly &#39;posh&#39; way though) (if dest format doesn&#39;t have opt_ol_as_in_gold, it&#39;ll get o_as_in_go + the l)</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos"> 395</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos"> 396</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos"> 397</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-398"><a href="#L-398"><span class="linenos"> 398</span></a>    <span class="p">(</span><span class="s1">&#39;r-&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos"> 399</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos"> 400</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos"> 401</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos"> 402</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos"> 403</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos"> 404</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-405"><a href="#L-405"><span class="linenos"> 405</span></a>    <span class="p">(</span><span class="s1">&#39;@5&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos"> 406</span></a>    <span class="p">(</span><span class="s1">&#39;Ul&#39;</span><span class="p">,</span><span class="n">opt_ul_as_in_pull</span><span class="p">),</span> <span class="c1"># if dest format doesn&#39;t have this, it&#39;ll get opt_u_as_in_pull from the U, then the l</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos"> 407</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos"> 408</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos"> 409</span></a>    <span class="p">(</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">),</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos"> 410</span></a>    <span class="p">(</span><span class="s1">&#39;o@&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos"> 411</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos"> 412</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos"> 413</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos"> 414</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos"> 415</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos"> 416</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos"> 417</span></a>    <span class="n">lex_filename</span> <span class="o">=</span> <span class="s2">&quot;en_extra&quot;</span><span class="p">,</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos"> 418</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos"> 419</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;//&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos"> 420</span></a>    <span class="n">lex_footer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:(</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)),</span> <span class="c1"># see also a bit of special-case code in mainopt_convert</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos"> 421</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;[[</span><span class="si">%s</span><span class="s2">]]&quot;</span><span class="p">,</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos"> 422</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos"> 423</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos"> 424</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="s2">&quot;_: !&quot;</span><span class="p">,</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos"> 425</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos"> 426</span></a>      <span class="p">(</span><span class="s2">&quot;k&#39;a2n&quot;</span><span class="p">,</span><span class="s2">&quot;k&#39;@n&quot;</span><span class="p">),</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos"> 427</span></a>      <span class="p">(</span><span class="s2">&quot;ka2n&quot;</span><span class="p">,</span><span class="s2">&quot;k@n&quot;</span><span class="p">),</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos"> 428</span></a>      <span class="p">(</span><span class="s2">&quot;gg&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">),</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos"> 429</span></a>      <span class="p">(</span><span class="s2">&quot;@U&quot;</span><span class="p">,</span><span class="s2">&quot;oU&quot;</span><span class="p">),</span> <span class="c1"># (eSpeak uses oU to represent @U; difference is given by its accent parameters)</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos"> 430</span></a>      <span class="p">(</span><span class="s2">&quot;([iU]|([AO]:))@r$&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\1</span><span class="s2">@&quot;</span><span class="p">),</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos"> 431</span></a>      <span class="p">(</span><span class="s2">&quot;([^e])@r&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1_remove_3&quot;</span><span class="p">),(</span><span class="s2">&quot;_remove_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos"> 432</span></a>      <span class="c1"># (r&quot;([^iU]@)l&quot;,r&quot;\1L&quot;) # only in older versions of espeak (not valid in more recent versions)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos"> 433</span></a>      <span class="p">(</span><span class="s2">&quot;rr$&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos"> 434</span></a>      <span class="p">(</span><span class="s2">&quot;3:r$&quot;</span><span class="p">,</span><span class="s2">&quot;3:&quot;</span><span class="p">),</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos"> 435</span></a>      <span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">+&quot;</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),(</span><span class="s2">&quot;^%&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),(</span><span class="s2">&quot;%$&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos"> 436</span></a>      <span class="c1"># TODO: &#39;declared&#39; &amp; &#39;declare&#39; the &#39;r&#39; after the &#39;E&#39; sounds a bit &#39;regional&#39; (but pretty).  but sounds incomplete w/out &#39;r&#39;, and there doesn&#39;t seem to be an E2 or E@</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos"> 437</span></a>      <span class="c1"># TODO: consider adding &#39;g&#39; to words ending in &#39;N&#39; (if want the &#39;g&#39; pronounced in &#39;-ng&#39; words) (however, careful of words like &#39;yankee&#39; where the &#39;g&#39; would be followed by a &#39;k&#39;; this may also be a problem going into the next word)</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos"> 438</span></a>    <span class="p">],</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos"> 439</span></a>     <span class="n">cvtOut_regexps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos"> 440</span></a>       <span class="p">(</span><span class="s2">&quot;e@r$&quot;</span><span class="p">,</span><span class="s2">&quot;e@&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e@r([bdDfghklmnNprsStTvwjzZ])&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;e@\1&quot;</span><span class="p">),</span> <span class="c1"># because the &#39;r&#39; is implicit in other synths (but DO have it if there&#39;s another vowel to follow)</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos"> 441</span></a>     <span class="p">],</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos"> 442</span></a>  <span class="p">),</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos"> 443</span></a>
</span><span id="L-444"><a href="#L-444"><span class="linenos"> 444</span></a>  <span class="s2">&quot;sapi&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos"> 445</span></a>    <span class="s2">&quot;Microsoft Speech API (American English)&quot;</span><span class="p">,</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos"> 446</span></a>    <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos"> 447</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-448"><a href="#L-448"><span class="linenos"> 448</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos"> 449</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos"> 450</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos"> 451</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos"> 452</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos"> 453</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos"> 454</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-455"><a href="#L-455"><span class="linenos"> 455</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos"> 456</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos"> 457</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos"> 458</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos"> 459</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-460"><a href="#L-460"><span class="linenos"> 460</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos"> 461</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos"> 462</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos"> 463</span></a>    <span class="p">(</span><span class="n">a_as_in_ate</span><span class="p">,</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos"> 464</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos"> 465</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos"> 466</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="c1"># Jan suggested &#39;hh&#39;, but I can&#39;t get this to work on Windows XP (TODO: try newer versions of Windows)</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos"> 467</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos"> 468</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos"> 469</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos"> 470</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos"> 471</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos"> 472</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos"> 473</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos"> 474</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-475"><a href="#L-475"><span class="linenos"> 475</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-476"><a href="#L-476"><span class="linenos"> 476</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos"> 477</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos"> 478</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos"> 479</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos"> 480</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos"> 481</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos"> 482</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos"> 483</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos"> 484</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos"> 485</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos"> 486</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos"> 487</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos"> 488</span></a>    <span class="c1"># (&#39;x&#39;,var1_w), # suggested by Jan, but I can&#39;t get this to work on Windows XP (TODO: try newer versions of Windows)</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos"> 489</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos"> 490</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos"> 491</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos"> 492</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos"> 493</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;run-ptts.bat&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos"> 494</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;rem  You have to run this file</span><span class="se">\n</span><span class="s2">rem  with ptts.exe in the same directory</span><span class="se">\n</span><span class="s2">rem  to add these words to the SAPI lexicon</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos"> 495</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s1">&#39;ptts -la </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-496"><a href="#L-496"><span class="linenos"> 496</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s1">&#39;&lt;pron sym=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&#39;</span><span class="p">,</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos"> 497</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos"> 498</span></a>  <span class="p">),</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos"> 499</span></a>
</span><span id="L-500"><a href="#L-500"><span class="linenos"> 500</span></a>  <span class="s2">&quot;cepstral&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-501"><a href="#L-501"><span class="linenos"> 501</span></a>    <span class="s2">&quot;Cepstral&#39;s British English SSML phoneset&quot;</span><span class="p">,</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos"> 502</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos"> 503</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos"> 504</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos"> 505</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-506"><a href="#L-506"><span class="linenos"> 506</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos"> 507</span></a>    <span class="p">(</span><span class="s1">&#39;oa&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-508"><a href="#L-508"><span class="linenos"> 508</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos"> 509</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos"> 510</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos"> 511</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos"> 512</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos"> 513</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos"> 514</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos"> 515</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos"> 516</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos"> 517</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos"> 518</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos"> 519</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos"> 520</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos"> 521</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos"> 522</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos"> 523</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos"> 524</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos"> 525</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos"> 526</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos"> 527</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos"> 528</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos"> 529</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos"> 530</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos"> 531</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos"> 532</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos"> 533</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-534"><a href="#L-534"><span class="linenos"> 534</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos"> 535</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos"> 536</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos"> 537</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos"> 538</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos"> 539</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos"> 540</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos"> 541</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos"> 542</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos"> 543</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos"> 544</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos"> 545</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos"> 546</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;lexicon.txt&quot;</span><span class="p">,</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos"> 547</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos"> 548</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos"> 549</span></a>    <span class="n">lex_word_case</span> <span class="o">=</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos"> 550</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;&lt;phoneme ph=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;p&lt;/phoneme&gt;&quot;</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos"> 551</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos"> 552</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot; 1&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">),(</span><span class="s2">&quot; 0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos"> 553</span></a>  <span class="p">),</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos"> 554</span></a>
</span><span id="L-555"><a href="#L-555"><span class="linenos"> 555</span></a>  <span class="s2">&quot;mac&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos"> 556</span></a>    <span class="s2">&quot;approximation in American English using the [[inpt PHON]] notation of Apple&#39;s US voices&quot;</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos"> 557</span></a>    <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos"> 558</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos"> 559</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos"> 560</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos"> 561</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos"> 562</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos"> 563</span></a>    <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos"> 564</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos"> 565</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-566"><a href="#L-566"><span class="linenos"> 566</span></a>    <span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-567"><a href="#L-567"><span class="linenos"> 567</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: is this really the best approximation?</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos"> 568</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos"> 569</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos"> 570</span></a>    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos"> 571</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos"> 572</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos"> 573</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos"> 574</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos"> 575</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos"> 576</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos"> 577</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos"> 578</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos"> 579</span></a>    <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">),</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos"> 580</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos"> 581</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos"> 582</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos"> 583</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos"> 584</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos"> 585</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos"> 586</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-587"><a href="#L-587"><span class="linenos"> 587</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos"> 588</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos"> 589</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-590"><a href="#L-590"><span class="linenos"> 590</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos"> 591</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-592"><a href="#L-592"><span class="linenos"> 592</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos"> 593</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos"> 594</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos"> 595</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos"> 596</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos"> 597</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos"> 598</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos"> 599</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos"> 600</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos"> 601</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos"> 602</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos"> 603</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos"> 604</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;substitute.sh&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos"> 605</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;substitution script&quot;</span><span class="p">,</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos"> 606</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n\n</span><span class="s2"># I don&#39;t yet know how to add to the Apple US lexicon,</span><span class="se">\n</span><span class="s2"># so here is a &#39;sed&#39; command you can run on your text</span><span class="se">\n</span><span class="s2"># to put the pronunciation inline:</span><span class="se">\n\n</span><span class="s2">sed -E -e :S </span><span class="se">\\\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos"> 607</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot; -e &#39;s/(^|[^A-Za-z])</span><span class="si">%s</span><span class="s2">($|[^A-Za-z[12=])/\1[[inpt PHON]]</span><span class="si">%s</span><span class="s2">[[inpt TEXT]]\2/g&#39;&quot;</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\\\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos"> 608</span></a>    <span class="c1"># but /g is non-overlapping matches and won&#39;t catch 2 words in the lex right next to each other with only one non-alpha in between, so we put :S at start and tS at end to make the whole operation repeat until it hasn&#39;t done any more substitutions (hence also the exclusion of [, 1, 2 or = following a word so it doesn&#39;t try to substitute stuff inside the phonemes; TODO: assert the lexicon does not contain &quot;inpt&quot;, &quot;PHON&quot; or &quot;TEXT&quot;)</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos"> 609</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:(</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; -e tS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s2">&quot;substitute.sh&quot;</span><span class="p">,</span><span class="mi">493</span><span class="p">)),</span> <span class="c1"># 493 = 0755, but no way to specify octal that works on both Python 2.5 and Python 3 (0o works on 2.6+)</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos"> 610</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;[[inpt PHON]]</span><span class="si">%s</span><span class="s2">[[inpt TEXT]]&quot;</span><span class="p">,</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos"> 611</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos"> 612</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos"> 613</span></a>  <span class="p">),</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos"> 614</span></a>
</span><span id="L-615"><a href="#L-615"><span class="linenos"> 615</span></a>  <span class="s2">&quot;mac-uk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos"> 616</span></a>    <span class="s2">&quot;Scansoft/Nuance British voices in Mac OS 10.7+ (system lexicon editing required, see --mac-uk option)&quot;</span><span class="p">,</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos"> 617</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-618"><a href="#L-618"><span class="linenos"> 618</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos"> 619</span></a>    <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos"> 620</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos"> 621</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos"> 622</span></a>    <span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos"> 623</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos"> 624</span></a>    <span class="p">(</span><span class="s1">&#39;A+&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos"> 625</span></a>    <span class="p">(</span><span class="s1">&#39;a&amp;U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos"> 626</span></a>    <span class="p">(</span><span class="s1">&#39;E0&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos"> 627</span></a>    <span class="p">(</span><span class="s1">&#39;a&amp;I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos"> 628</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos"> 629</span></a>    <span class="p">(</span><span class="s1">&#39;t&amp;S&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos"> 630</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos"> 631</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos"> 632</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos"> 633</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos"> 634</span></a>    <span class="p">(</span><span class="s1">&#39;E&amp;$&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos"> 635</span></a>    <span class="p">(</span><span class="s1">&#39;e&amp;I&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos"> 636</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos"> 637</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos"> 638</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos"> 639</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos"> 640</span></a>    <span class="p">(</span><span class="s1">&#39;I&amp;$&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos"> 641</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos"> 642</span></a>    <span class="p">(</span><span class="s1">&#39;d&amp;Z&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos"> 643</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos"> 644</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-645"><a href="#L-645"><span class="linenos"> 645</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-646"><a href="#L-646"><span class="linenos"> 646</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-647"><a href="#L-647"><span class="linenos"> 647</span></a>    <span class="p">(</span><span class="s1">&#39;nK&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-648"><a href="#L-648"><span class="linenos"> 648</span></a>    <span class="p">(</span><span class="s1">&#39;o&amp;U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-649"><a href="#L-649"><span class="linenos"> 649</span></a>    <span class="p">(</span><span class="s1">&#39;O&amp;I&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-650"><a href="#L-650"><span class="linenos"> 650</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-651"><a href="#L-651"><span class="linenos"> 651</span></a>    <span class="p">(</span><span class="s1">&#39;R+&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-652"><a href="#L-652"><span class="linenos"> 652</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-653"><a href="#L-653"><span class="linenos"> 653</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-654"><a href="#L-654"><span class="linenos"> 654</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-655"><a href="#L-655"><span class="linenos"> 655</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-656"><a href="#L-656"><span class="linenos"> 656</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-657"><a href="#L-657"><span class="linenos"> 657</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-658"><a href="#L-658"><span class="linenos"> 658</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-659"><a href="#L-659"><span class="linenos"> 659</span></a>    <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-660"><a href="#L-660"><span class="linenos"> 660</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-661"><a href="#L-661"><span class="linenos"> 661</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-662"><a href="#L-662"><span class="linenos"> 662</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-663"><a href="#L-663"><span class="linenos"> 663</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-664"><a href="#L-664"><span class="linenos"> 664</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-665"><a href="#L-665"><span class="linenos"> 665</span></a>    <span class="c1"># lex_filename not set (mac-uk code does not permanently save the lexicon; see --mac-uk option to read text)</span>
</span><span id="L-666"><a href="#L-666"><span class="linenos"> 666</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:[(</span><span class="n">w</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">usable_words</span><span class="p">()],</span>
</span><span id="L-667"><a href="#L-667"><span class="linenos"> 667</span></a>    <span class="n">inline_oneoff_header</span> <span class="o">=</span> <span class="s2">&quot;(mac-uk phonemes output is for information only; you&#39;ll need the --mac-uk or --trymac-uk options to use it)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-668"><a href="#L-668"><span class="linenos"> 668</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-669"><a href="#L-669"><span class="linenos"> 669</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-670"><a href="#L-670"><span class="linenos"> 670</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-671"><a href="#L-671"><span class="linenos"> 671</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;o\&amp;U\.Ol&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;o\&amp;Ul&#39;</span><span class="p">)],</span>
</span><span id="L-672"><a href="#L-672"><span class="linenos"> 672</span></a>  <span class="p">),</span>
</span><span id="L-673"><a href="#L-673"><span class="linenos"> 673</span></a>
</span><span id="L-674"><a href="#L-674"><span class="linenos"> 674</span></a>  <span class="s2">&quot;x-sampa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-675"><a href="#L-675"><span class="linenos"> 675</span></a>    <span class="s2">&quot;General X-SAMPA notation, contributed by Jan Weiss&quot;</span><span class="p">,</span>
</span><span id="L-676"><a href="#L-676"><span class="linenos"> 676</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-677"><a href="#L-677"><span class="linenos"> 677</span></a>    <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-678"><a href="#L-678"><span class="linenos"> 678</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-679"><a href="#L-679"><span class="linenos"> 679</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-680"><a href="#L-680"><span class="linenos"> 680</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="L-681"><a href="#L-681"><span class="linenos"> 681</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-682"><a href="#L-682"><span class="linenos"> 682</span></a>    <span class="p">(</span><span class="s1">&#39;Ar</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-683"><a href="#L-683"><span class="linenos"> 683</span></a>    <span class="p">(</span><span class="s1">&#39;a:&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-684"><a href="#L-684"><span class="linenos"> 684</span></a>    <span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-685"><a href="#L-685"><span class="linenos"> 685</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-686"><a href="#L-686"><span class="linenos"> 686</span></a>    <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-687"><a href="#L-687"><span class="linenos"> 687</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-688"><a href="#L-688"><span class="linenos"> 688</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-689"><a href="#L-689"><span class="linenos"> 689</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-690"><a href="#L-690"><span class="linenos"> 690</span></a>    <span class="p">(</span><span class="s1">&#39;{O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="L-691"><a href="#L-691"><span class="linenos"> 691</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-692"><a href="#L-692"><span class="linenos"> 692</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-693"><a href="#L-693"><span class="linenos"> 693</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-694"><a href="#L-694"><span class="linenos"> 694</span></a>    <span class="p">(</span><span class="s1">&#39;Ae&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="L-695"><a href="#L-695"><span class="linenos"> 695</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-696"><a href="#L-696"><span class="linenos"> 696</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-697"><a href="#L-697"><span class="linenos"> 697</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-698"><a href="#L-698"><span class="linenos"> 698</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-699"><a href="#L-699"><span class="linenos"> 699</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-700"><a href="#L-700"><span class="linenos"> 700</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="L-701"><a href="#L-701"><span class="linenos"> 701</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-702"><a href="#L-702"><span class="linenos"> 702</span></a>    <span class="p">(</span><span class="s1">&#39;E@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-703"><a href="#L-703"><span class="linenos"> 703</span></a>    <span class="p">(</span><span class="s1">&#39;Er</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="L-704"><a href="#L-704"><span class="linenos"> 704</span></a>    <span class="p">(</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="L-705"><a href="#L-705"><span class="linenos"> 705</span></a>    <span class="p">(</span><span class="s1">&#39;E:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="L-706"><a href="#L-706"><span class="linenos"> 706</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="L-707"><a href="#L-707"><span class="linenos"> 707</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-708"><a href="#L-708"><span class="linenos"> 708</span></a>    <span class="p">(</span><span class="s1">&#39;{I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-709"><a href="#L-709"><span class="linenos"> 709</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-710"><a href="#L-710"><span class="linenos"> 710</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-711"><a href="#L-711"><span class="linenos"> 711</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-712"><a href="#L-712"><span class="linenos"> 712</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-713"><a href="#L-713"><span class="linenos"> 713</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="L-714"><a href="#L-714"><span class="linenos"> 714</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-715"><a href="#L-715"><span class="linenos"> 715</span></a>    <span class="p">(</span><span class="s1">&#39;Ir</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="L-716"><a href="#L-716"><span class="linenos"> 716</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-717"><a href="#L-717"><span class="linenos"> 717</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="L-718"><a href="#L-718"><span class="linenos"> 718</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-719"><a href="#L-719"><span class="linenos"> 719</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-720"><a href="#L-720"><span class="linenos"> 720</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-721"><a href="#L-721"><span class="linenos"> 721</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-722"><a href="#L-722"><span class="linenos"> 722</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-723"><a href="#L-723"><span class="linenos"> 723</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-724"><a href="#L-724"><span class="linenos"> 724</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-725"><a href="#L-725"><span class="linenos"> 725</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-726"><a href="#L-726"><span class="linenos"> 726</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-727"><a href="#L-727"><span class="linenos"> 727</span></a>    <span class="p">(</span><span class="s1">&#39;@}&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-728"><a href="#L-728"><span class="linenos"> 728</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-729"><a href="#L-729"><span class="linenos"> 729</span></a>    <span class="p">(</span><span class="s1">&#39;oI&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-730"><a href="#L-730"><span class="linenos"> 730</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-731"><a href="#L-731"><span class="linenos"> 731</span></a>    <span class="p">(</span><span class="s1">&#39;r</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-732"><a href="#L-732"><span class="linenos"> 732</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-733"><a href="#L-733"><span class="linenos"> 733</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-734"><a href="#L-734"><span class="linenos"> 734</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-735"><a href="#L-735"><span class="linenos"> 735</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-736"><a href="#L-736"><span class="linenos"> 736</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-737"><a href="#L-737"><span class="linenos"> 737</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-738"><a href="#L-738"><span class="linenos"> 738</span></a>    <span class="p">(</span><span class="s1">&#39;Ur</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-739"><a href="#L-739"><span class="linenos"> 739</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-740"><a href="#L-740"><span class="linenos"> 740</span></a>    <span class="p">(</span><span class="s1">&#39;}:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-741"><a href="#L-741"><span class="linenos"> 741</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-742"><a href="#L-742"><span class="linenos"> 742</span></a>    <span class="p">(</span><span class="n">var2_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-743"><a href="#L-743"><span class="linenos"> 743</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-744"><a href="#L-744"><span class="linenos"> 744</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-745"><a href="#L-745"><span class="linenos"> 745</span></a>    <span class="p">(</span><span class="s1">&#39;o:&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="L-746"><a href="#L-746"><span class="linenos"> 746</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-747"><a href="#L-747"><span class="linenos"> 747</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-748"><a href="#L-748"><span class="linenos"> 748</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="L-749"><a href="#L-749"><span class="linenos"> 749</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-750"><a href="#L-750"><span class="linenos"> 750</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-751"><a href="#L-751"><span class="linenos"> 751</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-752"><a href="#L-752"><span class="linenos"> 752</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;acapela.txt&quot;</span><span class="p">,</span>
</span><span id="L-753"><a href="#L-753"><span class="linenos"> 753</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s2">#</span><span class="si">%s</span><span class="se">\t</span><span class="s2">UNKNOWN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># TODO: may be able to convert part-of-speech (NOUN etc) to/from some other formats e.g. Festival</span>
</span><span id="L-754"><a href="#L-754"><span class="linenos"> 754</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">,</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="L-755"><a href="#L-755"><span class="linenos"> 755</span></a>    <span class="c1"># TODO: inline_format ?</span>
</span><span id="L-756"><a href="#L-756"><span class="linenos"> 756</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-757"><a href="#L-757"><span class="linenos"> 757</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-758"><a href="#L-758"><span class="linenos"> 758</span></a>  <span class="p">),</span>
</span><span id="L-759"><a href="#L-759"><span class="linenos"> 759</span></a>  <span class="s2">&quot;vocaloid&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-760"><a href="#L-760"><span class="linenos"> 760</span></a>     <span class="s2">&quot;X-SAMPA phonemes for Yamaha&#39;s Vocaloid singing synthesizer.  Contributed by Lorenzo Gatti, who tested in Vocaloid 4 using two American English voices.&quot;</span><span class="p">,</span>
</span><span id="L-761"><a href="#L-761"><span class="linenos"> 761</span></a>     <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-762"><a href="#L-762"><span class="linenos"> 762</span></a>     <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># not used by Vocaloid</span>
</span><span id="L-763"><a href="#L-763"><span class="linenos"> 763</span></a>     <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-764"><a href="#L-764"><span class="linenos"> 764</span></a>     <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-765"><a href="#L-765"><span class="linenos"> 765</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-766"><a href="#L-766"><span class="linenos"> 766</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-767"><a href="#L-767"><span class="linenos"> 767</span></a>     <span class="p">(</span><span class="n">var5_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-768"><a href="#L-768"><span class="linenos"> 768</span></a>     <span class="p">(</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-769"><a href="#L-769"><span class="linenos"> 769</span></a>     <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-770"><a href="#L-770"><span class="linenos"> 770</span></a>     <span class="p">(</span><span class="n">var2_o_as_in_orange</span><span class="p">,</span> <span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-771"><a href="#L-771"><span class="linenos"> 771</span></a>     <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-772"><a href="#L-772"><span class="linenos"> 772</span></a>     <span class="p">(</span><span class="s1">&#39;@r&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-773"><a href="#L-773"><span class="linenos"> 773</span></a>     <span class="p">(</span><span class="n">var1_eye</span><span class="p">,</span> <span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-774"><a href="#L-774"><span class="linenos"> 774</span></a>     <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-775"><a href="#L-775"><span class="linenos"> 775</span></a>     <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="L-776"><a href="#L-776"><span class="linenos"> 776</span></a>     <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-777"><a href="#L-777"><span class="linenos"> 777</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-778"><a href="#L-778"><span class="linenos"> 778</span></a>     <span class="p">(</span><span class="n">var2_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-779"><a href="#L-779"><span class="linenos"> 779</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-780"><a href="#L-780"><span class="linenos"> 780</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-781"><a href="#L-781"><span class="linenos"> 781</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_ate</span><span class="p">,</span> <span class="s1">&#39;eI&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="L-782"><a href="#L-782"><span class="linenos"> 782</span></a>     <span class="p">(</span><span class="n">var1_i_as_in_it</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-783"><a href="#L-783"><span class="linenos"> 783</span></a>     <span class="p">(</span><span class="n">var1_ear</span><span class="p">,</span> <span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-784"><a href="#L-784"><span class="linenos"> 784</span></a>     <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-785"><a href="#L-785"><span class="linenos"> 785</span></a>     <span class="p">(</span><span class="n">var1_e_as_in_eat</span><span class="p">,</span> <span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-786"><a href="#L-786"><span class="linenos"> 786</span></a>     <span class="p">(</span><span class="n">var2_o_as_in_go</span><span class="p">,</span> <span class="s1">&#39;@U&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="L-787"><a href="#L-787"><span class="linenos"> 787</span></a>     <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-788"><a href="#L-788"><span class="linenos"> 788</span></a>     <span class="p">(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span> <span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-789"><a href="#L-789"><span class="linenos"> 789</span></a>     <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-790"><a href="#L-790"><span class="linenos"> 790</span></a>     <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-791"><a href="#L-791"><span class="linenos"> 791</span></a>     <span class="p">(</span><span class="n">var1_oor_as_in_poor</span><span class="p">,</span> <span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-792"><a href="#L-792"><span class="linenos"> 792</span></a>     <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-793"><a href="#L-793"><span class="linenos"> 793</span></a>     <span class="p">(</span><span class="n">var1_oo_as_in_food</span><span class="p">,</span> <span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-794"><a href="#L-794"><span class="linenos"> 794</span></a>     <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-795"><a href="#L-795"><span class="linenos"> 795</span></a>     <span class="p">(</span><span class="n">var2_close_to_or</span><span class="p">,</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-796"><a href="#L-796"><span class="linenos"> 796</span></a>     <span class="p">(</span><span class="n">var1_w</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="L-797"><a href="#L-797"><span class="linenos"> 797</span></a>     <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;vocaloid.txt&quot;</span><span class="p">,</span>
</span><span id="L-798"><a href="#L-798"><span class="linenos"> 798</span></a>     <span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
</span><span id="L-799"><a href="#L-799"><span class="linenos"> 799</span></a>     <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-800"><a href="#L-800"><span class="linenos"> 800</span></a>  <span class="p">),</span>
</span><span id="L-801"><a href="#L-801"><span class="linenos"> 801</span></a>  <span class="s2">&quot;android-pico&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-802"><a href="#L-802"><span class="linenos"> 802</span></a>    <span class="s1">&#39;X-SAMPA phonemes for the default </span><span class="se">\&quot;</span><span class="s1">Pico</span><span class="se">\&quot;</span><span class="s1"> voice in Android (1.6+, American), wrapped in Java code&#39;</span><span class="p">,</span> <span class="c1"># you could put en-GB instead of en-US, but it must be installed on the phone</span>
</span><span id="L-803"><a href="#L-803"><span class="linenos"> 803</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span> <span class="c1"># won&#39;t sound without the :</span>
</span><span id="L-804"><a href="#L-804"><span class="linenos"> 804</span></a>    <span class="p">(</span><span class="n">var5_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># a: won&#39;t sound</span>
</span><span id="L-805"><a href="#L-805"><span class="linenos"> 805</span></a>    <span class="p">(</span><span class="s1">&#39;@U:&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-806"><a href="#L-806"><span class="linenos"> 806</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span> <span class="c1"># &#39;1&#39; won&#39;t sound</span>
</span><span id="L-807"><a href="#L-807"><span class="linenos"> 807</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="c1"># &#39;i&#39; won&#39;t sound</span>
</span><span id="L-808"><a href="#L-808"><span class="linenos"> 808</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span> <span class="c1"># }: won&#39;t sound</span>
</span><span id="L-809"><a href="#L-809"><span class="linenos"> 809</span></a>    <span class="p">(</span><span class="s1">&#39;a_I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;a_U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;e_I&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;O_I&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span><span class="s1">&#39;O_I&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;o_U&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-810"><a href="#L-810"><span class="linenos"> 810</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">),(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;quot;&#39;</span><span class="p">),(</span><span class="s1">&#39;::&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)],</span>
</span><span id="L-811"><a href="#L-811"><span class="linenos"> 811</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-812"><a href="#L-812"><span class="linenos"> 812</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-813"><a href="#L-813"><span class="linenos"> 813</span></a>    <span class="n">inline_oneoff_header</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;class Speak { public static void speak(android.app.Activity a,String s) { class OnInit implements android.speech.tts.TextToSpeech.OnInitListener { public OnInit(String s) { this.s = s; } public void onInit(int i) { mTts.speak(this.s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private String s; }; if(mTts==null) mTts=new android.speech.tts.TextToSpeech(a,new OnInit(s),&quot;com.svox.pico&quot;); else mTts.speak(s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private static android.speech.tts.TextToSpeech mTts = null; };&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-814"><a href="#L-814"><span class="linenos"> 814</span></a>    <span class="n">inline_header</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Speak.speak(this,&quot;&lt;speak xml:lang=\&quot;en-US\&quot;&gt;&#39;</span><span class="p">,</span>
</span><span id="L-815"><a href="#L-815"><span class="linenos"> 815</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;phoneme alphabet=\&quot;xsampa\&quot; ph=\&quot;</span><span class="si">%s</span><span class="s1">\&quot;/&gt;&#39;</span><span class="p">,</span>
</span><span id="L-816"><a href="#L-816"><span class="linenos"> 816</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.\n&quot;</span><span class="p">,</span> <span class="c1"># note r&quot;\n&quot; != &quot;\n&quot;</span>
</span><span id="L-817"><a href="#L-817"><span class="linenos"> 817</span></a>    <span class="n">inline_footer</span><span class="o">=</span><span class="s1">&#39;&lt;/speak&gt;&quot;);&#39;</span><span class="p">,</span>
</span><span id="L-818"><a href="#L-818"><span class="linenos"> 818</span></a>  <span class="p">),</span>
</span><span id="L-819"><a href="#L-819"><span class="linenos"> 819</span></a>
</span><span id="L-820"><a href="#L-820"><span class="linenos"> 820</span></a>  <span class="s2">&quot;acapela-uk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-821"><a href="#L-821"><span class="linenos"> 821</span></a>    <span class="s1">&#39;Acapela-optimised X-SAMPA for UK English voices (e.g. &quot;Peter&quot;), contributed by Jan Weiss&#39;</span><span class="p">,</span>
</span><span id="L-822"><a href="#L-822"><span class="linenos"> 822</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span> <span class="c1"># copied from &quot;x-sampa&quot;, not tested</span>
</span><span id="L-823"><a href="#L-823"><span class="linenos"> 823</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-824"><a href="#L-824"><span class="linenos"> 824</span></a>    <span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-825"><a href="#L-825"><span class="linenos"> 825</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-826"><a href="#L-826"><span class="linenos"> 826</span></a>    <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-827"><a href="#L-827"><span class="linenos"> 827</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-828"><a href="#L-828"><span class="linenos"> 828</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-829"><a href="#L-829"><span class="linenos"> 829</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-830"><a href="#L-830"><span class="linenos"> 830</span></a>    <span class="p">(</span><span class="s1">&#39;{O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="L-831"><a href="#L-831"><span class="linenos"> 831</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-832"><a href="#L-832"><span class="linenos"> 832</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-833"><a href="#L-833"><span class="linenos"> 833</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-834"><a href="#L-834"><span class="linenos"> 834</span></a>    <span class="p">(</span><span class="s1">&#39;A e&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="L-835"><a href="#L-835"><span class="linenos"> 835</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-836"><a href="#L-836"><span class="linenos"> 836</span></a>    <span class="p">(</span><span class="s1">&#39;t S&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-837"><a href="#L-837"><span class="linenos"> 837</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-838"><a href="#L-838"><span class="linenos"> 838</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-839"><a href="#L-839"><span class="linenos"> 839</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-840"><a href="#L-840"><span class="linenos"> 840</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-841"><a href="#L-841"><span class="linenos"> 841</span></a>    <span class="p">(</span><span class="s1">&#39;e @&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-842"><a href="#L-842"><span class="linenos"> 842</span></a>    <span class="p">(</span><span class="s1">&#39;e r&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="L-843"><a href="#L-843"><span class="linenos"> 843</span></a>    <span class="p">(</span><span class="s1">&#39;e :&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="L-844"><a href="#L-844"><span class="linenos"> 844</span></a>    <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e :&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-845"><a href="#L-845"><span class="linenos"> 845</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-846"><a href="#L-846"><span class="linenos"> 846</span></a>    <span class="p">(</span><span class="s1">&#39;{I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-847"><a href="#L-847"><span class="linenos"> 847</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-848"><a href="#L-848"><span class="linenos"> 848</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-849"><a href="#L-849"><span class="linenos"> 849</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-850"><a href="#L-850"><span class="linenos"> 850</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-851"><a href="#L-851"><span class="linenos"> 851</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="L-852"><a href="#L-852"><span class="linenos"> 852</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-853"><a href="#L-853"><span class="linenos"> 853</span></a>    <span class="p">(</span><span class="s1">&#39;I r&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="L-854"><a href="#L-854"><span class="linenos"> 854</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-855"><a href="#L-855"><span class="linenos"> 855</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="L-856"><a href="#L-856"><span class="linenos"> 856</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-857"><a href="#L-857"><span class="linenos"> 857</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-858"><a href="#L-858"><span class="linenos"> 858</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-859"><a href="#L-859"><span class="linenos"> 859</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-860"><a href="#L-860"><span class="linenos"> 860</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-861"><a href="#L-861"><span class="linenos"> 861</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-862"><a href="#L-862"><span class="linenos"> 862</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-863"><a href="#L-863"><span class="linenos"> 863</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-864"><a href="#L-864"><span class="linenos"> 864</span></a>    <span class="p">(</span><span class="s1">&#39;o U&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-865"><a href="#L-865"><span class="linenos"> 865</span></a>    <span class="p">(</span><span class="s1">&#39;@ }&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-866"><a href="#L-866"><span class="linenos"> 866</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-867"><a href="#L-867"><span class="linenos"> 867</span></a>    <span class="p">(</span><span class="s1">&#39;o I&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-868"><a href="#L-868"><span class="linenos"> 868</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-869"><a href="#L-869"><span class="linenos"> 869</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-870"><a href="#L-870"><span class="linenos"> 870</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-871"><a href="#L-871"><span class="linenos"> 871</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-872"><a href="#L-872"><span class="linenos"> 872</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-873"><a href="#L-873"><span class="linenos"> 873</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-874"><a href="#L-874"><span class="linenos"> 874</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-875"><a href="#L-875"><span class="linenos"> 875</span></a>    <span class="p">(</span><span class="s1">&#39;U r&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-876"><a href="#L-876"><span class="linenos"> 876</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-877"><a href="#L-877"><span class="linenos"> 877</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-878"><a href="#L-878"><span class="linenos"> 878</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-879"><a href="#L-879"><span class="linenos"> 879</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-880"><a href="#L-880"><span class="linenos"> 880</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-881"><a href="#L-881"><span class="linenos"> 881</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-882"><a href="#L-882"><span class="linenos"> 882</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-883"><a href="#L-883"><span class="linenos"> 883</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-884"><a href="#L-884"><span class="linenos"> 884</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-885"><a href="#L-885"><span class="linenos"> 885</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;acapela.txt&quot;</span><span class="p">,</span>
</span><span id="L-886"><a href="#L-886"><span class="linenos"> 886</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s2">#</span><span class="si">%s</span><span class="se">\t</span><span class="s2">UNKNOWN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># TODO: part-of-speech (as above)</span>
</span><span id="L-887"><a href="#L-887"><span class="linenos"> 887</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">,</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="L-888"><a href="#L-888"><span class="linenos"> 888</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Prn=</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-889"><a href="#L-889"><span class="linenos"> 889</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-890"><a href="#L-890"><span class="linenos"> 890</span></a>  <span class="p">),</span>
</span><span id="L-891"><a href="#L-891"><span class="linenos"> 891</span></a>
</span><span id="L-892"><a href="#L-892"><span class="linenos"> 892</span></a>  <span class="s2">&quot;cmu&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-893"><a href="#L-893"><span class="linenos"> 893</span></a>    <span class="s1">&#39;format of the US-English Carnegie Mellon University Pronouncing Dictionary, contributed by Jan Weiss&#39;</span><span class="p">,</span> <span class="c1"># http://www.speech.cs.cmu.edu/cgi-bin/cmudict</span>
</span><span id="L-894"><a href="#L-894"><span class="linenos"> 894</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="L-895"><a href="#L-895"><span class="linenos"> 895</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-896"><a href="#L-896"><span class="linenos"> 896</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-897"><a href="#L-897"><span class="linenos"> 897</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-898"><a href="#L-898"><span class="linenos"> 898</span></a>    <span class="p">(</span><span class="n">var1_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-899"><a href="#L-899"><span class="linenos"> 899</span></a>    <span class="p">(</span><span class="n">ipa_colon</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-900"><a href="#L-900"><span class="linenos"> 900</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-901"><a href="#L-901"><span class="linenos"> 901</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-902"><a href="#L-902"><span class="linenos"> 902</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-903"><a href="#L-903"><span class="linenos"> 903</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-904"><a href="#L-904"><span class="linenos"> 904</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># seems they don&#39;t use AX as festival-cmu does</span>
</span><span id="L-905"><a href="#L-905"><span class="linenos"> 905</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span> <span class="c1"># TODO: check this one</span>
</span><span id="L-906"><a href="#L-906"><span class="linenos"> 906</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-907"><a href="#L-907"><span class="linenos"> 907</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-908"><a href="#L-908"><span class="linenos"> 908</span></a>    <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-909"><a href="#L-909"><span class="linenos"> 909</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-910"><a href="#L-910"><span class="linenos"> 910</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-911"><a href="#L-911"><span class="linenos"> 911</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-912"><a href="#L-912"><span class="linenos"> 912</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-913"><a href="#L-913"><span class="linenos"> 913</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-914"><a href="#L-914"><span class="linenos"> 914</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-915"><a href="#L-915"><span class="linenos"> 915</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-916"><a href="#L-916"><span class="linenos"> 916</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-917"><a href="#L-917"><span class="linenos"> 917</span></a>    <span class="p">(</span><span class="s1">&#39;HH&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-918"><a href="#L-918"><span class="linenos"> 918</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-919"><a href="#L-919"><span class="linenos"> 919</span></a>    <span class="p">(</span><span class="s1">&#39;EY AH&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-920"><a href="#L-920"><span class="linenos"> 920</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-921"><a href="#L-921"><span class="linenos"> 921</span></a>    <span class="p">(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-922"><a href="#L-922"><span class="linenos"> 922</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-923"><a href="#L-923"><span class="linenos"> 923</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-924"><a href="#L-924"><span class="linenos"> 924</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-925"><a href="#L-925"><span class="linenos"> 925</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-926"><a href="#L-926"><span class="linenos"> 926</span></a>    <span class="p">(</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-927"><a href="#L-927"><span class="linenos"> 927</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-928"><a href="#L-928"><span class="linenos"> 928</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-929"><a href="#L-929"><span class="linenos"> 929</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-930"><a href="#L-930"><span class="linenos"> 930</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-931"><a href="#L-931"><span class="linenos"> 931</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-932"><a href="#L-932"><span class="linenos"> 932</span></a>    <span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-933"><a href="#L-933"><span class="linenos"> 933</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-934"><a href="#L-934"><span class="linenos"> 934</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-935"><a href="#L-935"><span class="linenos"> 935</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-936"><a href="#L-936"><span class="linenos"> 936</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-937"><a href="#L-937"><span class="linenos"> 937</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-938"><a href="#L-938"><span class="linenos"> 938</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-939"><a href="#L-939"><span class="linenos"> 939</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-940"><a href="#L-940"><span class="linenos"> 940</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-941"><a href="#L-941"><span class="linenos"> 941</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-942"><a href="#L-942"><span class="linenos"> 942</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-943"><a href="#L-943"><span class="linenos"> 943</span></a>    <span class="c1"># lex_filename not set (does CMU have a lex file?)</span>
</span><span id="L-944"><a href="#L-944"><span class="linenos"> 944</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-945"><a href="#L-945"><span class="linenos"> 945</span></a>  <span class="p">),</span>
</span><span id="L-946"><a href="#L-946"><span class="linenos"> 946</span></a>
</span><span id="L-947"><a href="#L-947"><span class="linenos"> 947</span></a>  <span class="c1"># BEGIN PRE-32bit ERA SYNTHS (TODO: add an attribute to JS-hide them by default in HTML?  what about the SpeakJet which probably isn&#39;t a 32-bit chip but is post 32-bit era?  and then what about the &#39;approximation&#39; formats - kana etc - would they need hiding by default also?  maybe best to just leave it)</span>
</span><span id="L-948"><a href="#L-948"><span class="linenos"> 948</span></a>  <span class="s2">&quot;apollo&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-949"><a href="#L-949"><span class="linenos"> 949</span></a>    <span class="s1">&#39;Dolphin Apollo 2 serial-port and parallel-port hardware synthesizers (in case anybody still uses those)&#39;</span><span class="p">,</span>
</span><span id="L-950"><a href="#L-950"><span class="linenos"> 950</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># I don&#39;t think the Apollo had anything to mark stress; TODO: control the pitch instead like bbcmicro ?</span>
</span><span id="L-951"><a href="#L-951"><span class="linenos"> 951</span></a>    <span class="p">(</span><span class="s1">&#39;_QQ&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># a slight pause</span>
</span><span id="L-952"><a href="#L-952"><span class="linenos"> 952</span></a>    <span class="p">(</span><span class="s1">&#39;_AA&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-953"><a href="#L-953"><span class="linenos"> 953</span></a>    <span class="p">(</span><span class="s1">&#39;_AI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-954"><a href="#L-954"><span class="linenos"> 954</span></a>    <span class="p">(</span><span class="s1">&#39;_AR&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-955"><a href="#L-955"><span class="linenos"> 955</span></a>    <span class="p">(</span><span class="s1">&#39;_AW&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-956"><a href="#L-956"><span class="linenos"> 956</span></a>    <span class="p">(</span><span class="s1">&#39;_A&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-957"><a href="#L-957"><span class="linenos"> 957</span></a>    <span class="p">(</span><span class="s1">&#39;_B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-958"><a href="#L-958"><span class="linenos"> 958</span></a>    <span class="p">(</span><span class="s1">&#39;_CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-959"><a href="#L-959"><span class="linenos"> 959</span></a>    <span class="p">(</span><span class="s1">&#39;_D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-960"><a href="#L-960"><span class="linenos"> 960</span></a>    <span class="p">(</span><span class="s1">&#39;_DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-961"><a href="#L-961"><span class="linenos"> 961</span></a>    <span class="p">(</span><span class="s1">&#39;_EE&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-962"><a href="#L-962"><span class="linenos"> 962</span></a>    <span class="p">(</span><span class="s1">&#39;_EI&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-963"><a href="#L-963"><span class="linenos"> 963</span></a>    <span class="p">(</span><span class="s1">&#39;_ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-964"><a href="#L-964"><span class="linenos"> 964</span></a>    <span class="p">(</span><span class="s1">&#39;_E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-965"><a href="#L-965"><span class="linenos"> 965</span></a>    <span class="p">(</span><span class="s1">&#39;_F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-966"><a href="#L-966"><span class="linenos"> 966</span></a>    <span class="p">(</span><span class="s1">&#39;_G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-967"><a href="#L-967"><span class="linenos"> 967</span></a>    <span class="p">(</span><span class="s1">&#39;_H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-968"><a href="#L-968"><span class="linenos"> 968</span></a>    <span class="p">(</span><span class="s1">&#39;_IA&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-969"><a href="#L-969"><span class="linenos"> 969</span></a>    <span class="p">(</span><span class="s1">&#39;_IE&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-970"><a href="#L-970"><span class="linenos"> 970</span></a>    <span class="p">(</span><span class="s1">&#39;_I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-971"><a href="#L-971"><span class="linenos"> 971</span></a>    <span class="p">(</span><span class="s1">&#39;_J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-972"><a href="#L-972"><span class="linenos"> 972</span></a>    <span class="p">(</span><span class="s1">&#39;_K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-973"><a href="#L-973"><span class="linenos"> 973</span></a>    <span class="p">(</span><span class="s1">&#39;_KK&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># sCHool</span>
</span><span id="L-974"><a href="#L-974"><span class="linenos"> 974</span></a>    <span class="p">(</span><span class="s1">&#39;_L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-975"><a href="#L-975"><span class="linenos"> 975</span></a>    <span class="p">(</span><span class="s1">&#39;_M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-976"><a href="#L-976"><span class="linenos"> 976</span></a>    <span class="p">(</span><span class="s1">&#39;_NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-977"><a href="#L-977"><span class="linenos"> 977</span></a>    <span class="p">(</span><span class="s1">&#39;_N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-978"><a href="#L-978"><span class="linenos"> 978</span></a>    <span class="p">(</span><span class="s1">&#39;_OA&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-979"><a href="#L-979"><span class="linenos"> 979</span></a>    <span class="p">(</span><span class="s1">&#39;_OO&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-980"><a href="#L-980"><span class="linenos"> 980</span></a>    <span class="p">(</span><span class="s1">&#39;_OR&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">),</span>
</span><span id="L-981"><a href="#L-981"><span class="linenos"> 981</span></a>    <span class="p">(</span><span class="s1">&#39;_OW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-982"><a href="#L-982"><span class="linenos"> 982</span></a>    <span class="p">(</span><span class="s1">&#39;_OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-983"><a href="#L-983"><span class="linenos"> 983</span></a>    <span class="p">(</span><span class="s1">&#39;_O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-984"><a href="#L-984"><span class="linenos"> 984</span></a>    <span class="p">(</span><span class="s1">&#39;_P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-985"><a href="#L-985"><span class="linenos"> 985</span></a>    <span class="p">(</span><span class="s1">&#39;_PP&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># sPeech (a stronger P ?)</span>
</span><span id="L-986"><a href="#L-986"><span class="linenos"> 986</span></a>    <span class="c1"># _Q = k w - done by cleanup_regexps below</span>
</span><span id="L-987"><a href="#L-987"><span class="linenos"> 987</span></a>    <span class="p">(</span><span class="s1">&#39;_R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-988"><a href="#L-988"><span class="linenos"> 988</span></a>    <span class="p">(</span><span class="s1">&#39;_SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-989"><a href="#L-989"><span class="linenos"> 989</span></a>    <span class="p">(</span><span class="s1">&#39;_S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-990"><a href="#L-990"><span class="linenos"> 990</span></a>    <span class="p">(</span><span class="s1">&#39;_TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-991"><a href="#L-991"><span class="linenos"> 991</span></a>    <span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;_TT&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-992"><a href="#L-992"><span class="linenos"> 992</span></a>    <span class="p">(</span><span class="s1">&#39;_UU&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-993"><a href="#L-993"><span class="linenos"> 993</span></a>    <span class="p">(</span><span class="s1">&#39;_U&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-994"><a href="#L-994"><span class="linenos"> 994</span></a>    <span class="p">(</span><span class="s1">&#39;_V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-995"><a href="#L-995"><span class="linenos"> 995</span></a>    <span class="p">(</span><span class="s1">&#39;_W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-996"><a href="#L-996"><span class="linenos"> 996</span></a>    <span class="c1"># _X = k s - done by cleanup_regexps below</span>
</span><span id="L-997"><a href="#L-997"><span class="linenos"> 997</span></a>    <span class="p">(</span><span class="s1">&#39;_Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-998"><a href="#L-998"><span class="linenos"> 998</span></a>    <span class="p">(</span><span class="s1">&#39;_ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-999"><a href="#L-999"><span class="linenos"> 999</span></a>    <span class="p">(</span><span class="s1">&#39;_Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1000"><a href="#L-1000"><span class="linenos">1000</span></a>    <span class="c1"># lex_filename not set (the hardware doesn&#39;t have one; HAL has an &quot;exceptions dictionary&quot; but I don&#39;t know much about it)</span>
</span><span id="L-1001"><a href="#L-1001"><span class="linenos">1001</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1002"><a href="#L-1002"><span class="linenos">1002</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1003"><a href="#L-1003"><span class="linenos">1003</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1004"><a href="#L-1004"><span class="linenos">1004</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;_K_W&#39;</span><span class="p">,</span><span class="s1">&#39;_Q&#39;</span><span class="p">),(</span><span class="s1">&#39;_K_S&#39;</span><span class="p">,</span><span class="s1">&#39;_X&#39;</span><span class="p">)],</span>
</span><span id="L-1005"><a href="#L-1005"><span class="linenos">1005</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;_Q&#39;</span><span class="p">,</span><span class="s1">&#39;_K_W&#39;</span><span class="p">),(</span><span class="s1">&#39;_X&#39;</span><span class="p">,</span><span class="s1">&#39;_K_S&#39;</span><span class="p">)],</span>
</span><span id="L-1006"><a href="#L-1006"><span class="linenos">1006</span></a>  <span class="p">),</span>
</span><span id="L-1007"><a href="#L-1007"><span class="linenos">1007</span></a>  <span class="s2">&quot;dectalk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1008"><a href="#L-1008"><span class="linenos">1008</span></a>    <span class="s1">&#39;DECtalk hardware synthesizers (American English)&#39;</span><span class="p">,</span> <span class="c1"># (1984-ish serial port; later ISA cards)</span>
</span><span id="L-1009"><a href="#L-1009"><span class="linenos">1009</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1010"><a href="#L-1010"><span class="linenos">1010</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1011"><a href="#L-1011"><span class="linenos">1011</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1012"><a href="#L-1012"><span class="linenos">1012</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1013"><a href="#L-1013"><span class="linenos">1013</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1014"><a href="#L-1014"><span class="linenos">1014</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span> <span class="c1"># bought</span>
</span><span id="L-1015"><a href="#L-1015"><span class="linenos">1015</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1016"><a href="#L-1016"><span class="linenos">1016</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1017"><a href="#L-1017"><span class="linenos">1017</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1018"><a href="#L-1018"><span class="linenos">1018</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1019"><a href="#L-1019"><span class="linenos">1019</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1020"><a href="#L-1020"><span class="linenos">1020</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1021"><a href="#L-1021"><span class="linenos">1021</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1022"><a href="#L-1022"><span class="linenos">1022</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1023"><a href="#L-1023"><span class="linenos">1023</span></a>    <span class="p">(</span><span class="s1">&#39;el&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># -le of bottle, allophone ?</span>
</span><span id="L-1024"><a href="#L-1024"><span class="linenos">1024</span></a>    <span class="c1"># TODO: en: -on of button (2 phonemes?)</span>
</span><span id="L-1025"><a href="#L-1025"><span class="linenos">1025</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1026"><a href="#L-1026"><span class="linenos">1026</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1027"><a href="#L-1027"><span class="linenos">1027</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1028"><a href="#L-1028"><span class="linenos">1028</span></a>    <span class="p">(</span><span class="s1">&#39;hx&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1029"><a href="#L-1029"><span class="linenos">1029</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ix&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1030"><a href="#L-1030"><span class="linenos">1030</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1031"><a href="#L-1031"><span class="linenos">1031</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1032"><a href="#L-1032"><span class="linenos">1032</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1033"><a href="#L-1033"><span class="linenos">1033</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1034"><a href="#L-1034"><span class="linenos">1034</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1035"><a href="#L-1035"><span class="linenos">1035</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1036"><a href="#L-1036"><span class="linenos">1036</span></a>    <span class="p">(</span><span class="s1">&#39;nx&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1037"><a href="#L-1037"><span class="linenos">1037</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1038"><a href="#L-1038"><span class="linenos">1038</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1039"><a href="#L-1039"><span class="linenos">1039</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1040"><a href="#L-1040"><span class="linenos">1040</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1041"><a href="#L-1041"><span class="linenos">1041</span></a>    <span class="p">(</span><span class="s1">&#39;rr&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1042"><a href="#L-1042"><span class="linenos">1042</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1043"><a href="#L-1043"><span class="linenos">1043</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1044"><a href="#L-1044"><span class="linenos">1044</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1045"><a href="#L-1045"><span class="linenos">1045</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1046"><a href="#L-1046"><span class="linenos">1046</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1047"><a href="#L-1047"><span class="linenos">1047</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1048"><a href="#L-1048"><span class="linenos">1048</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1049"><a href="#L-1049"><span class="linenos">1049</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1050"><a href="#L-1050"><span class="linenos">1050</span></a>    <span class="p">(</span><span class="s1">&#39;yx&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1051"><a href="#L-1051"><span class="linenos">1051</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1052"><a href="#L-1052"><span class="linenos">1052</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1053"><a href="#L-1053"><span class="linenos">1053</span></a>    <span class="p">(</span><span class="s1">&#39;ihr&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span> <span class="c1"># DECtalk makes this from ih + r</span>
</span><span id="L-1054"><a href="#L-1054"><span class="linenos">1054</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1055"><a href="#L-1055"><span class="linenos">1055</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;yxuw&#39;</span><span class="p">,</span><span class="s1">&#39;yu&#39;</span><span class="p">)],</span> <span class="c1"># TODO: other allophones (&quot;x&#39;,False&quot; stuff above)?</span>
</span><span id="L-1056"><a href="#L-1056"><span class="linenos">1056</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;yu&#39;</span><span class="p">,</span><span class="s1">&#39;yxuw&#39;</span><span class="p">)],</span>
</span><span id="L-1057"><a href="#L-1057"><span class="linenos">1057</span></a>    <span class="c1"># lex_filename not set (depends on which model etc)</span>
</span><span id="L-1058"><a href="#L-1058"><span class="linenos">1058</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1059"><a href="#L-1059"><span class="linenos">1059</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1060"><a href="#L-1060"><span class="linenos">1060</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1061"><a href="#L-1061"><span class="linenos">1061</span></a>    <span class="n">inline_header</span><span class="o">=</span><span class="s2">&quot;[:phoneme on]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1062"><a href="#L-1062"><span class="linenos">1062</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
</span><span id="L-1063"><a href="#L-1063"><span class="linenos">1063</span></a>  <span class="p">),</span>
</span><span id="L-1064"><a href="#L-1064"><span class="linenos">1064</span></a>  <span class="s2">&quot;doubletalk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1065"><a href="#L-1065"><span class="linenos">1065</span></a>    <span class="s1">&#39;DoubleTalk PC/LT serial-port hardware synthesizers (American English; assumes DOS driver by default, otherwise set DTALK_COMMAND_CODE to your current command-code binary value, e.g. export DTALK_COMMAND_CODE=1)&#39;</span><span class="p">,</span> <span class="c1"># (1 is the synth&#39;s default; the DOS driver lets you put * instead)</span>
</span><span id="L-1066"><a href="#L-1066"><span class="linenos">1066</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1067"><a href="#L-1067"><span class="linenos">1067</span></a>    <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span> <span class="c1"># TODO: check it doesn&#39;t need a balancing \ afterwards (docs do say it&#39;s a &quot;temporary&quot; change of pitch, but it&#39;s unclear how long a &#39;temporary&#39;)</span>
</span><span id="L-1068"><a href="#L-1068"><span class="linenos">1068</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1069"><a href="#L-1069"><span class="linenos">1069</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone</span>
</span><span id="L-1070"><a href="#L-1070"><span class="linenos">1070</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: is this the best approximation we can do?</span>
</span><span id="L-1071"><a href="#L-1071"><span class="linenos">1071</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1072"><a href="#L-1072"><span class="linenos">1072</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1073"><a href="#L-1073"><span class="linenos">1073</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1074"><a href="#L-1074"><span class="linenos">1074</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1075"><a href="#L-1075"><span class="linenos">1075</span></a>    <span class="p">(</span><span class="s1">&#39;PX&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;TX&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># aspirated allophones</span>
</span><span id="L-1076"><a href="#L-1076"><span class="linenos">1076</span></a>    <span class="p">(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;KX&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># ditto</span>
</span><span id="L-1077"><a href="#L-1077"><span class="linenos">1077</span></a>    <span class="p">(</span><span class="s1">&#39;YY&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1078"><a href="#L-1078"><span class="linenos">1078</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1079"><a href="#L-1079"><span class="linenos">1079</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1080"><a href="#L-1080"><span class="linenos">1080</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1081"><a href="#L-1081"><span class="linenos">1081</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1082"><a href="#L-1082"><span class="linenos">1082</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1083"><a href="#L-1083"><span class="linenos">1083</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1084"><a href="#L-1084"><span class="linenos">1084</span></a>    <span class="p">(</span><span class="s1">&#39;DX&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># an American &quot;d&quot;-like &quot;t&quot;</span>
</span><span id="L-1085"><a href="#L-1085"><span class="linenos">1085</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1086"><a href="#L-1086"><span class="linenos">1086</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1087"><a href="#L-1087"><span class="linenos">1087</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1088"><a href="#L-1088"><span class="linenos">1088</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1089"><a href="#L-1089"><span class="linenos">1089</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1090"><a href="#L-1090"><span class="linenos">1090</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1091"><a href="#L-1091"><span class="linenos">1091</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="n">markup_doubleTalk_word</span><span class="p">,</span>
</span><span id="L-1092"><a href="#L-1092"><span class="linenos">1092</span></a>    <span class="n">format_is_binary</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;DTALK_COMMAND_CODE&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1093"><a href="#L-1093"><span class="linenos">1093</span></a>    <span class="c1"># DoubleTalk does have a loadable &quot;exceptions dictionary&quot; but usually relies on a DOS tool to write it; I don&#39;t have the documentation about it (and don&#39;t know how much RAM is available for it - it&#39;s taken from the input buffer)</span>
</span><span id="L-1094"><a href="#L-1094"><span class="linenos">1094</span></a>  <span class="p">),</span>
</span><span id="L-1095"><a href="#L-1095"><span class="linenos">1095</span></a>  <span class="s2">&quot;keynote&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1096"><a href="#L-1096"><span class="linenos">1096</span></a>    <span class="s1">&#39;Phoneme-read and lexicon-add codes for Keynote Gold hardware synthesizers (American English)&#39;</span><span class="p">,</span> <span class="c1"># ISA, PCMCIA, serial, etc; non-serial models give you an INT 2Fh param to get the address of an API function to call; not sure which software can send these codes directly to it)</span>
</span><span id="L-1097"><a href="#L-1097"><span class="linenos">1097</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1098"><a href="#L-1098"><span class="linenos">1098</span></a>    <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">),(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">),</span>
</span><span id="L-1099"><a href="#L-1099"><span class="linenos">1099</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1100"><a href="#L-1100"><span class="linenos">1100</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1101"><a href="#L-1101"><span class="linenos">1101</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1102"><a href="#L-1102"><span class="linenos">1102</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1103"><a href="#L-1103"><span class="linenos">1103</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1104"><a href="#L-1104"><span class="linenos">1104</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1105"><a href="#L-1105"><span class="linenos">1105</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1106"><a href="#L-1106"><span class="linenos">1106</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1107"><a href="#L-1107"><span class="linenos">1107</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1108"><a href="#L-1108"><span class="linenos">1108</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1109"><a href="#L-1109"><span class="linenos">1109</span></a>    <span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1110"><a href="#L-1110"><span class="linenos">1110</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;Oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1111"><a href="#L-1111"><span class="linenos">1111</span></a>    <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1112"><a href="#L-1112"><span class="linenos">1112</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1113"><a href="#L-1113"><span class="linenos">1113</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="s2">&quot;[p]</span><span class="si">%s</span><span class="s2">[t]&quot;</span><span class="p">,</span>
</span><span id="L-1114"><a href="#L-1114"><span class="linenos">1114</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;keynote.dat&quot;</span><span class="p">,</span> <span class="c1"># you have to somehow get this directly dumped to the card, see comment above</span>
</span><span id="L-1115"><a href="#L-1115"><span class="linenos">1115</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;[x]</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lex_footer</span><span class="o">=</span><span class="s2">&quot;[t]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1116"><a href="#L-1116"><span class="linenos">1116</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># even though it&#39;s &quot;&#39;&quot;</span>
</span><span id="L-1117"><a href="#L-1117"><span class="linenos">1117</span></a>  <span class="p">),</span>
</span><span id="L-1118"><a href="#L-1118"><span class="linenos">1118</span></a>  <span class="s2">&quot;audapter&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-1119"><a href="#L-1119"><span class="linenos">1119</span></a>  <span class="s2">&quot;Audapter Speech System, an old hardware serial/parallel-port synthesizer (American English)&quot;</span><span class="p">,</span> <span class="c1"># 1989 I think.  The phonemes themselves are the same as the Keynote above, but there&#39;s an extra binary byte in the commands and the lex format is stricter.  I haven&#39;t checked but my guess is Audapter came before Keynote.</span>
</span><span id="L-1120"><a href="#L-1120"><span class="linenos">1120</span></a>  <span class="n">inline_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x05</span><span class="s1">[p] </span><span class="si">%s</span><span class="se">\x05</span><span class="s1">[t]&#39;</span><span class="p">,</span>
</span><span id="L-1121"><a href="#L-1121"><span class="linenos">1121</span></a>  <span class="n">format_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1122"><a href="#L-1122"><span class="linenos">1122</span></a>  <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;audapter.dat&quot;</span><span class="p">,</span>
</span><span id="L-1123"><a href="#L-1123"><span class="linenos">1123</span></a>  <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x05</span><span class="s2">[x]</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\x05</span><span class="s2">[t]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lex_footer</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1124"><a href="#L-1124"><span class="linenos">1124</span></a>  <span class="p">),</span>
</span><span id="L-1125"><a href="#L-1125"><span class="linenos">1125</span></a>  <span class="s2">&quot;bbcmicro&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1126"><a href="#L-1126"><span class="linenos">1126</span></a>    <span class="s2">&quot;BBC Micro Speech program from 1985 (see comments in lexconvert.py for more details)&quot;</span><span class="p">,</span>
</span><span id="L-1127"><a href="#L-1127"><span class="linenos">1127</span></a>    <span class="c1"># Speech was written by David J. Hoskins and published by Superior Software.  It took 7.5k of RAM including 3.1k of samples (49 phonemes + 1 for fricatives at 64 bytes each, 4-bit ~5.5kHz), 2.2k of lexicon, and 2.2k of machine code; sounds &quot;retro&quot; by modern standards but quite impressive for the BBC Micro in 1985.  Samples are played by amplitude-modulating the BBC&#39;s tone generator.</span>
</span><span id="L-1128"><a href="#L-1128"><span class="linenos">1128</span></a>    <span class="c1"># If you use an emulator like BeebEm, you&#39;ll need diskimg/Speech.ssd.  This can be made from your original Speech disc, or you might be able to find one but beware of copyright!  Same goes with the ROM images included in BeebEm (you might want to delete ones you didn&#39;t have).  There has been considerable discussion over whether UK copyright law does or should allow &quot;format-shifting&quot; your own legally-purchased media, and I don&#39;t fully understand all the discussion so I don&#39;t want to give advice on it here.  The issue is &quot;format-shifting&quot; your legally-purchased BBC Micro ROM code and Speech disc to emulator images; IF this is all right then I suspect downloading someone else&#39;s copy is arguably allowed as long as you bought it legally &quot;back in the day&quot;, but I&#39;m not a solicitor so I don&#39;t know.</span>
</span><span id="L-1129"><a href="#L-1129"><span class="linenos">1129</span></a>    <span class="c1"># (Incidentally, yes I was the Silas Brown referred to in Beebug 11.1 p.59, 11.9 p.50/11.10 p.47 and 12.10 p.24, and, no, the question in the final issue wasn&#39;t quite how I put it, but all taken in good humour.)</span>
</span><span id="L-1130"><a href="#L-1130"><span class="linenos">1130</span></a>    <span class="c1"># lexconvert&#39;s --phones bbcmicro option creates *SPEAK commands which you can type into the BBC Micro or paste into an emulator, either at the BASIC prompt, or in a listing with line numbers provided by AUTO.  You have to load the Speech program first of course.</span>
</span><span id="L-1131"><a href="#L-1131"><span class="linenos">1131</span></a>    <span class="c1"># To script this on BeebEm, first turn off the Speech disc&#39;s boot option (by turning off File / Disc options / Write protect and entering &quot;*OPT 4,0&quot;; use &quot;*OPT 4,3&quot; if you want it back later; if you prefer to edit the disk image outside of the emulator then change byte 0x106 from 0x33 to 0x03), and then you can do (e.g. on a Mac) open /usr/local/BeebEm3/diskimg/Speech.ssd &amp;&amp; sleep 1 &amp;&amp; (echo &#39;*SPEECH&#39;;python lexconvert.py --phones bbcmicro &quot;Greetings from 19 85&quot;) | pbcopy &amp;&amp; osascript -e &#39;tell application &quot;System Events&quot; to keystroke &quot;v&quot; using command down&#39;</span>
</span><span id="L-1132"><a href="#L-1132"><span class="linenos">1132</span></a>    <span class="c1"># or if you know it&#39;s already loaded: echo &quot;Here is some text&quot; | python lexconvert.py --phones bbcmicro | pbcopy &amp;&amp; osascript -e &#39;tell application &quot;BeebEm3&quot; to activate&#39; &amp;&amp; osascript -e &#39;tell application &quot;System Events&quot; to keystroke &quot;v&quot; using command down&#39;</span>
</span><span id="L-1133"><a href="#L-1133"><span class="linenos">1133</span></a>    <span class="c1"># (unfortunately there doesn&#39;t seem to be a way of doing it without giving the emulator window focus)</span>
</span><span id="L-1134"><a href="#L-1134"><span class="linenos">1134</span></a>    <span class="c1"># If you want to emulate a Master, you might need a *DISK before the *SPEECH (to take it out of ADFS mode).</span>
</span><span id="L-1135"><a href="#L-1135"><span class="linenos">1135</span></a>    <span class="c1"># You can also put Speech into ROM, but this can cause problems: see comments on SP8000 later.</span>
</span><span id="L-1136"><a href="#L-1136"><span class="linenos">1136</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1137"><a href="#L-1137"><span class="linenos">1137</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1138"><a href="#L-1138"><span class="linenos">1138</span></a>    <span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span> <span class="c1"># (these are pitch numbers on the BBC; normal pitch is 6, and lower numbers are higher pitches, so try 5=secondary and 4=primary; 3 sounds less calm)</span>
</span><span id="L-1139"><a href="#L-1139"><span class="linenos">1139</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1140"><a href="#L-1140"><span class="linenos">1140</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1141"><a href="#L-1141"><span class="linenos">1141</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1142"><a href="#L-1142"><span class="linenos">1142</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1143"><a href="#L-1143"><span class="linenos">1143</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1144"><a href="#L-1144"><span class="linenos">1144</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1145"><a href="#L-1145"><span class="linenos">1145</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1146"><a href="#L-1146"><span class="linenos">1146</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1147"><a href="#L-1147"><span class="linenos">1147</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1148"><a href="#L-1148"><span class="linenos">1148</span></a>    <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1149"><a href="#L-1149"><span class="linenos">1149</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1150"><a href="#L-1150"><span class="linenos">1150</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1151"><a href="#L-1151"><span class="linenos">1151</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1152"><a href="#L-1152"><span class="linenos">1152</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1153"><a href="#L-1153"><span class="linenos">1153</span></a>    <span class="p">(</span><span class="s1">&#39;AI&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1154"><a href="#L-1154"><span class="linenos">1154</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1155"><a href="#L-1155"><span class="linenos">1155</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1156"><a href="#L-1156"><span class="linenos">1156</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1157"><a href="#L-1157"><span class="linenos">1157</span></a>    <span class="p">(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1158"><a href="#L-1158"><span class="linenos">1158</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1159"><a href="#L-1159"><span class="linenos">1159</span></a>    <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">),</span> <span class="c1"># (IX sounds to me like a slightly shorter version of IH)</span>
</span><span id="L-1160"><a href="#L-1160"><span class="linenos">1160</span></a>    <span class="p">(</span><span class="s1">&#39;IXAH&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1161"><a href="#L-1161"><span class="linenos">1161</span></a>    <span class="p">(</span><span class="s1">&#39;EER&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># e.g. &#39;hear&#39;, &#39;near&#39; - near enough</span>
</span><span id="L-1162"><a href="#L-1162"><span class="linenos">1162</span></a>    <span class="p">(</span><span class="s1">&#39;EE&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1163"><a href="#L-1163"><span class="linenos">1163</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1164"><a href="#L-1164"><span class="linenos">1164</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1165"><a href="#L-1165"><span class="linenos">1165</span></a>    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># for CT as in &quot;fact&quot;, read out as K+T</span>
</span><span id="L-1166"><a href="#L-1166"><span class="linenos">1166</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1167"><a href="#L-1167"><span class="linenos">1167</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1168"><a href="#L-1168"><span class="linenos">1168</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1169"><a href="#L-1169"><span class="linenos">1169</span></a>    <span class="p">(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1170"><a href="#L-1170"><span class="linenos">1170</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1171"><a href="#L-1171"><span class="linenos">1171</span></a>    <span class="p">(</span><span class="s1">&#39;OL&#39;</span><span class="p">,</span><span class="n">opt_ol_as_in_gold</span><span class="p">),</span> <span class="c1"># (if dest format doesn&#39;t have this, it&#39;ll get o_as_in_orange from the O, then the l)</span>
</span><span id="L-1172"><a href="#L-1172"><span class="linenos">1172</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1173"><a href="#L-1173"><span class="linenos">1173</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1174"><a href="#L-1174"><span class="linenos">1174</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1175"><a href="#L-1175"><span class="linenos">1175</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1176"><a href="#L-1176"><span class="linenos">1176</span></a>    <span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1177"><a href="#L-1177"><span class="linenos">1177</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1178"><a href="#L-1178"><span class="linenos">1178</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1179"><a href="#L-1179"><span class="linenos">1179</span></a>    <span class="p">(</span><span class="s1">&#39;AOR&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1180"><a href="#L-1180"><span class="linenos">1180</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really? (espeak &#39;U&#39; goes to opt_u_as_in_pull, and eSpeak also used U for the o in good, which sounds best with Speech&#39;s default UH4, hence the line below, but where did we get UH-&gt;oor_as_in_poor from?  Low-priority though because how often do you convert OUT of bbcmicro format)</span>
</span><span id="L-1181"><a href="#L-1181"><span class="linenos">1181</span></a>    <span class="p">(</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1182"><a href="#L-1182"><span class="linenos">1182</span></a>    <span class="p">(</span><span class="s1">&#39;/U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1183"><a href="#L-1183"><span class="linenos">1183</span></a>    <span class="p">(</span><span class="s1">&#39;/UL&#39;</span><span class="p">,</span><span class="n">opt_ul_as_in_pull</span><span class="p">),</span> <span class="c1"># if dest format doesn&#39;t have this, it&#39;ll get opt_u_as_in_pull from the /U, then l</span>
</span><span id="L-1184"><a href="#L-1184"><span class="linenos">1184</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1185"><a href="#L-1185"><span class="linenos">1185</span></a>    <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1186"><a href="#L-1186"><span class="linenos">1186</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1187"><a href="#L-1187"><span class="linenos">1187</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1188"><a href="#L-1188"><span class="linenos">1188</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1189"><a href="#L-1189"><span class="linenos">1189</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1190"><a href="#L-1190"><span class="linenos">1190</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1191"><a href="#L-1191"><span class="linenos">1191</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1192"><a href="#L-1192"><span class="linenos">1192</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="s2">&quot;SPEECH.ROM&quot;</span><span class="p">,</span><span class="s2">&quot;BBCLEX&quot;</span><span class="p">),</span>
</span><span id="L-1193"><a href="#L-1193"><span class="linenos">1193</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt; </span><span class="si">%s</span><span class="s2">_&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># (specifying &#39;whole word&#39; for now; remove the space before or the _ after if you want)</span>
</span><span id="L-1194"><a href="#L-1194"><span class="linenos">1194</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">lexfile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)])],</span> <span class="c1"># TODO: this reads back the entries we generate, but is unlikely to work well with the wildcards in the default lexicon that would have been added if SPEECH_DISK was set (c.f. trying to read eSpeak&#39;s en_rules instead of en_extra)</span>
</span><span id="L-1195"><a href="#L-1195"><span class="linenos">1195</span></a>    <span class="n">lex_word_case</span> <span class="o">=</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span>
</span><span id="L-1196"><a href="#L-1196"><span class="linenos">1196</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="n">bbc_prepDefaultLex</span><span class="p">,</span>
</span><span id="L-1197"><a href="#L-1197"><span class="linenos">1197</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="n">bbc_appendDefaultLex</span><span class="p">,</span> <span class="c1"># + &quot;&gt;**&quot;</span>
</span><span id="L-1198"><a href="#L-1198"><span class="linenos">1198</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="n">markup_bbcMicro_word</span><span class="p">,</span>
</span><span id="L-1199"><a href="#L-1199"><span class="linenos">1199</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1200"><a href="#L-1200"><span class="linenos">1200</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="n">write_bbcmicro_phones</span><span class="p">,</span> <span class="c1"># special case</span>
</span><span id="L-1201"><a href="#L-1201"><span class="linenos">1201</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1202"><a href="#L-1202"><span class="linenos">1202</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-1203"><a href="#L-1203"><span class="linenos">1203</span></a>      <span class="p">(</span><span class="s1">&#39;KT&#39;</span><span class="p">,</span><span class="s1">&#39;CT&#39;</span><span class="p">),</span> <span class="c1"># Speech instructions: &quot;CT as in fact&quot;</span>
</span><span id="L-1204"><a href="#L-1204"><span class="linenos">1204</span></a>      <span class="p">(</span><span class="s1">&#39;DYUW&#39;</span><span class="p">,</span><span class="s1">&#39;DUX&#39;</span><span class="p">),</span> <span class="c1"># &quot;DUX as in duke&quot;</span>
</span><span id="L-1205"><a href="#L-1205"><span class="linenos">1205</span></a>      <span class="p">(</span><span class="s1">&#39;AHR$&#39;</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">),</span> <span class="c1"># usually sounds a bit better</span>
</span><span id="L-1206"><a href="#L-1206"><span class="linenos">1206</span></a>    <span class="p">],</span>
</span><span id="L-1207"><a href="#L-1207"><span class="linenos">1207</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;DUX&#39;</span><span class="p">,</span><span class="s1">&#39;DYUW&#39;</span><span class="p">)],</span> <span class="c1"># CT handled above</span>
</span><span id="L-1208"><a href="#L-1208"><span class="linenos">1208</span></a>  <span class="p">),</span>
</span><span id="L-1209"><a href="#L-1209"><span class="linenos">1209</span></a>  <span class="s2">&quot;bbcmicro-cc&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1210"><a href="#L-1210"><span class="linenos">1210</span></a>     <span class="s2">&quot;Computer Concepts Speech ROM which provided phonemes for the BBC Micro&#39;s TMS5220 </span><span class="se">\&quot;</span><span class="s2">speech chip</span><span class="se">\&quot;</span><span class="s2"> add-on (less widely sold than the software-only product)&quot;</span><span class="p">,</span> <span class="c1"># (and harder to run on an emulator.  It wasn&#39;t the only phoneme ROM, e.g. Easytalk Speech Utility ROM by Galaxy, reviewed in Beebug Jan/Feb 1985 (3.8) p.32, expanded on Acorn&#39;s original PHROM with commands like *SAY Y.U:N.I.V.ER.S but we don&#39;t know all the phonemes; there were also some allophone-based hardware boards)</span>
</span><span id="L-1211"><a href="#L-1211"><span class="linenos">1211</span></a>     <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1212"><a href="#L-1212"><span class="linenos">1212</span></a>     <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1213"><a href="#L-1213"><span class="linenos">1213</span></a>     <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1214"><a href="#L-1214"><span class="linenos">1214</span></a>     <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;AR&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1215"><a href="#L-1215"><span class="linenos">1215</span></a>     <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),(</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1216"><a href="#L-1216"><span class="linenos">1216</span></a>     <span class="p">(</span><span class="s1">&#39;OO&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1217"><a href="#L-1217"><span class="linenos">1217</span></a>     <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1218"><a href="#L-1218"><span class="linenos">1218</span></a>     <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;EA&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),(</span><span class="s1">&#39;ea&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1219"><a href="#L-1219"><span class="linenos">1219</span></a>     <span class="p">(</span><span class="s1">&#39;UR&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1220"><a href="#L-1220"><span class="linenos">1220</span></a>     <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1221"><a href="#L-1221"><span class="linenos">1221</span></a>     <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1222"><a href="#L-1222"><span class="linenos">1222</span></a>     <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1223"><a href="#L-1223"><span class="linenos">1223</span></a>     <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1224"><a href="#L-1224"><span class="linenos">1224</span></a>     <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1225"><a href="#L-1225"><span class="linenos">1225</span></a>     <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1226"><a href="#L-1226"><span class="linenos">1226</span></a>     <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1227"><a href="#L-1227"><span class="linenos">1227</span></a>     <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1228"><a href="#L-1228"><span class="linenos">1228</span></a>     <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1229"><a href="#L-1229"><span class="linenos">1229</span></a>     <span class="n">inline_header</span><span class="o">=</span><span class="s2">&quot;*UTTER &lt;1&gt; &quot;</span><span class="p">,</span>
</span><span id="L-1230"><a href="#L-1230"><span class="linenos">1230</span></a>     <span class="n">clause_separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*UTTER &lt;1&gt; &quot;</span><span class="p">,</span> <span class="c1"># TODO: manual does not say what the maximum length is; longest parameter in examples is 80 bytes; should we use inline_format to make each WORD a separate command?</span>
</span><span id="L-1231"><a href="#L-1231"><span class="linenos">1231</span></a>     <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;[*] &#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">),(</span><span class="s1">&#39;[+] &#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">)],</span>
</span><span id="L-1232"><a href="#L-1232"><span class="linenos">1232</span></a>     <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
</span><span id="L-1233"><a href="#L-1233"><span class="linenos">1233</span></a>  <span class="p">),</span>
</span><span id="L-1234"><a href="#L-1234"><span class="linenos">1234</span></a>     
</span><span id="L-1235"><a href="#L-1235"><span class="linenos">1235</span></a>  <span class="s2">&quot;amiga&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1236"><a href="#L-1236"><span class="linenos">1236</span></a>    <span class="s1">&#39;AmigaOS speech synthesizer (American English)&#39;</span><span class="p">,</span> <span class="c1"># shipped with the 1985 Amiga release; developed by SoftVoice Inc</span>
</span><span id="L-1237"><a href="#L-1237"><span class="linenos">1237</span></a>    <span class="c1"># All I had to go by for this was a screenshot on Marcos Miranda&#39;s &quot;blog&quot;.  I once saw this synth demonstrated but never tried it.  My early background was the BBC Micro, not Amigas etc.  But I know some people are keen on Amigas so I might as well include it.</span>
</span><span id="L-1238"><a href="#L-1238"><span class="linenos">1238</span></a>    <span class="c1"># (By the way I think David Hoskins had it harder than SoftVoice.  Yes they were both in 1985, but the Amiga was a new 16-bit machine while the BBC was an older 8-bit one.  See the &quot;sam&quot; format for an even older one though, although probably not written by one person.)</span>
</span><span id="L-1239"><a href="#L-1239"><span class="linenos">1239</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1240"><a href="#L-1240"><span class="linenos">1240</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1241"><a href="#L-1241"><span class="linenos">1241</span></a>    <span class="p">(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1242"><a href="#L-1242"><span class="linenos">1242</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1243"><a href="#L-1243"><span class="linenos">1243</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1244"><a href="#L-1244"><span class="linenos">1244</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1245"><a href="#L-1245"><span class="linenos">1245</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1246"><a href="#L-1246"><span class="linenos">1246</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1247"><a href="#L-1247"><span class="linenos">1247</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1248"><a href="#L-1248"><span class="linenos">1248</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1249"><a href="#L-1249"><span class="linenos">1249</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1250"><a href="#L-1250"><span class="linenos">1250</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1251"><a href="#L-1251"><span class="linenos">1251</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1252"><a href="#L-1252"><span class="linenos">1252</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1253"><a href="#L-1253"><span class="linenos">1253</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1254"><a href="#L-1254"><span class="linenos">1254</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1255"><a href="#L-1255"><span class="linenos">1255</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1256"><a href="#L-1256"><span class="linenos">1256</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1257"><a href="#L-1257"><span class="linenos">1257</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1258"><a href="#L-1258"><span class="linenos">1258</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1259"><a href="#L-1259"><span class="linenos">1259</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1260"><a href="#L-1260"><span class="linenos">1260</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1261"><a href="#L-1261"><span class="linenos">1261</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1262"><a href="#L-1262"><span class="linenos">1262</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1263"><a href="#L-1263"><span class="linenos">1263</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1264"><a href="#L-1264"><span class="linenos">1264</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1265"><a href="#L-1265"><span class="linenos">1265</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1266"><a href="#L-1266"><span class="linenos">1266</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1267"><a href="#L-1267"><span class="linenos">1267</span></a>    <span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1268"><a href="#L-1268"><span class="linenos">1268</span></a>    <span class="c1"># The following consonants were not on the screenshot</span>
</span><span id="L-1269"><a href="#L-1269"><span class="linenos">1269</span></a>    <span class="c1"># (or at least I couldn&#39;t find them) so I&#39;m guessing.</span>
</span><span id="L-1270"><a href="#L-1270"><span class="linenos">1270</span></a>    <span class="c1"># I think this should work given the way the other</span>
</span><span id="L-1271"><a href="#L-1271"><span class="linenos">1271</span></a>    <span class="c1"># consonants work in this table.</span>
</span><span id="L-1272"><a href="#L-1272"><span class="linenos">1272</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1273"><a href="#L-1273"><span class="linenos">1273</span></a>    <span class="c1"># The following vowels were not in the screenshot and</span>
</span><span id="L-1274"><a href="#L-1274"><span class="linenos">1274</span></a>    <span class="c1"># we just have to hope this guess is right - when</span>
</span><span id="L-1275"><a href="#L-1275"><span class="linenos">1275</span></a>    <span class="c1"># someone tries it on an Amiga and says it doesn&#39;t</span>
</span><span id="L-1276"><a href="#L-1276"><span class="linenos">1276</span></a>    <span class="c1"># work, maybe we can update this....</span>
</span><span id="L-1277"><a href="#L-1277"><span class="linenos">1277</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1278"><a href="#L-1278"><span class="linenos">1278</span></a>    <span class="c1"># and these ones we can approximate to ones we already know (given that we&#39;re having to approximate British to an American voice anyway, it can&#39;t hurt TOO much more)</span>
</span><span id="L-1279"><a href="#L-1279"><span class="linenos">1279</span></a>     <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1280"><a href="#L-1280"><span class="linenos">1280</span></a>     <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1281"><a href="#L-1281"><span class="linenos">1281</span></a>     <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1282"><a href="#L-1282"><span class="linenos">1282</span></a>     <span class="p">(</span><span class="n">ear</span><span class="p">,</span><span class="s1">&#39;IYAH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># or try IYER, or there might be a phoneme for it</span>
</span><span id="L-1283"><a href="#L-1283"><span class="linenos">1283</span></a>     <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1284"><a href="#L-1284"><span class="linenos">1284</span></a>     <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1285"><a href="#L-1285"><span class="linenos">1285</span></a>    <span class="c1"># lex_filename not set (I have no idea how the Amiga lexicon worked)</span>
</span><span id="L-1286"><a href="#L-1286"><span class="linenos">1286</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1287"><a href="#L-1287"><span class="linenos">1287</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1288"><a href="#L-1288"><span class="linenos">1288</span></a>  <span class="p">),</span>
</span><span id="L-1289"><a href="#L-1289"><span class="linenos">1289</span></a>  <span class="s2">&quot;sam&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1290"><a href="#L-1290"><span class="linenos">1290</span></a>  <span class="s1">&#39;Software Automatic Mouth (1982 American English synth that ran on C64, Atari 400/800/etc and Apple II/etc)&#39;</span><span class="p">,</span> <span class="c1"># *might* be similar to Macintalk on the 1st Macintosh in 1984</span>
</span><span id="L-1291"><a href="#L-1291"><span class="linenos">1291</span></a>  <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1292"><a href="#L-1292"><span class="linenos">1292</span></a>  <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">),</span>
</span><span id="L-1293"><a href="#L-1293"><span class="linenos">1293</span></a>  <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">),</span>
</span><span id="L-1294"><a href="#L-1294"><span class="linenos">1294</span></a>  <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1295"><a href="#L-1295"><span class="linenos">1295</span></a>  <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1296"><a href="#L-1296"><span class="linenos">1296</span></a>  <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1297"><a href="#L-1297"><span class="linenos">1297</span></a>  <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1298"><a href="#L-1298"><span class="linenos">1298</span></a>  <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1299"><a href="#L-1299"><span class="linenos">1299</span></a>  <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1300"><a href="#L-1300"><span class="linenos">1300</span></a>  <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1301"><a href="#L-1301"><span class="linenos">1301</span></a>  <span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1302"><a href="#L-1302"><span class="linenos">1302</span></a>  <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1303"><a href="#L-1303"><span class="linenos">1303</span></a>  <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1304"><a href="#L-1304"><span class="linenos">1304</span></a>  <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1305"><a href="#L-1305"><span class="linenos">1305</span></a>  <span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="L-1306"><a href="#L-1306"><span class="linenos">1306</span></a>  <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="L-1307"><a href="#L-1307"><span class="linenos">1307</span></a>  <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1308"><a href="#L-1308"><span class="linenos">1308</span></a>  <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1309"><a href="#L-1309"><span class="linenos">1309</span></a>  <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1310"><a href="#L-1310"><span class="linenos">1310</span></a>  <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="L-1311"><a href="#L-1311"><span class="linenos">1311</span></a>  <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1312"><a href="#L-1312"><span class="linenos">1312</span></a>  <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1313"><a href="#L-1313"><span class="linenos">1313</span></a>  <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1314"><a href="#L-1314"><span class="linenos">1314</span></a>  <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1315"><a href="#L-1315"><span class="linenos">1315</span></a>  <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1316"><a href="#L-1316"><span class="linenos">1316</span></a>  <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="L-1317"><a href="#L-1317"><span class="linenos">1317</span></a>  <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1318"><a href="#L-1318"><span class="linenos">1318</span></a>  <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1319"><a href="#L-1319"><span class="linenos">1319</span></a>  <span class="c1"># TODO: inline_format etc similar to bbcmicro?</span>
</span><span id="L-1320"><a href="#L-1320"><span class="linenos">1320</span></a>  <span class="c1"># In Atari BASIC, you set SAM$ to the phonemes and then</span>
</span><span id="L-1321"><a href="#L-1321"><span class="linenos">1321</span></a>  <span class="c1"># do A=USR(8192).  I don&#39;t know about the C64 etc versions.</span>
</span><span id="L-1322"><a href="#L-1322"><span class="linenos">1322</span></a>  <span class="c1"># (max 255 phonemes per string; don&#39;t know max line len.)</span>
</span><span id="L-1323"><a href="#L-1323"><span class="linenos">1323</span></a>  <span class="p">),</span>
</span><span id="L-1324"><a href="#L-1324"><span class="linenos">1324</span></a>  <span class="c1"># END (?) PRE-32bit ERA SYNTHS (but see TODO above re SpeakJet, which is below)</span>
</span><span id="L-1325"><a href="#L-1325"><span class="linenos">1325</span></a>
</span><span id="L-1326"><a href="#L-1326"><span class="linenos">1326</span></a>  <span class="s2">&quot;speakjet&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1327"><a href="#L-1327"><span class="linenos">1327</span></a>    <span class="s1">&#39;Allophone codes for the American English &quot;SpeakJet&quot; speech synthesis chip (the conversion from phonemes to allophones might need tweaking).  Set the SPEAKJET_SYM environment variable to use mnemonics, otherwise numbers are used (set SPEAKJET_BINARY for binary output).&#39;</span><span class="p">,</span>
</span><span id="L-1328"><a href="#L-1328"><span class="linenos">1328</span></a>  <span class="c1"># TODO: might want to do something similar for the older Votrax SC-02 chip, but would need to check how exactly its phoneme interface was exposed to software by the PC cards that used it (Heathkit HV-2000 etc; not sure if any are still in use though)</span>
</span><span id="L-1329"><a href="#L-1329"><span class="linenos">1329</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: instead of having emphasis, the Speakjet has a &#39;faster&#39; code for all NON-emphasized syllables</span>
</span><span id="L-1330"><a href="#L-1330"><span class="linenos">1330</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1331"><a href="#L-1331"><span class="linenos">1331</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="mi">129</span><span class="p">),</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1332"><a href="#L-1332"><span class="linenos">1332</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="mi">130</span><span class="p">),</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1333"><a href="#L-1333"><span class="linenos">1333</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="mi">131</span><span class="p">),</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1334"><a href="#L-1334"><span class="linenos">1334</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="mi">132</span><span class="p">),</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1335"><a href="#L-1335"><span class="linenos">1335</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="mi">133</span><span class="p">),</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1336"><a href="#L-1336"><span class="linenos">1336</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="mi">134</span><span class="p">),</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1337"><a href="#L-1337"><span class="linenos">1337</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="mi">135</span><span class="p">),</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1338"><a href="#L-1338"><span class="linenos">1338</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="mi">136</span><span class="p">),</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1339"><a href="#L-1339"><span class="linenos">1339</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="mi">137</span><span class="p">),</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1340"><a href="#L-1340"><span class="linenos">1340</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="mi">138</span><span class="p">),</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1341"><a href="#L-1341"><span class="linenos">1341</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="mi">139</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1342"><a href="#L-1342"><span class="linenos">1342</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;MM&#39;</span><span class="p">,</span><span class="mi">140</span><span class="p">),</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1343"><a href="#L-1343"><span class="linenos">1343</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span><span class="mi">141</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1344"><a href="#L-1344"><span class="linenos">1344</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span><span class="mi">142</span><span class="p">),</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1345"><a href="#L-1345"><span class="linenos">1345</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NGE&#39;</span><span class="p">,</span><span class="mi">143</span><span class="p">),</span><span class="n">ng</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1346"><a href="#L-1346"><span class="linenos">1346</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NGO&#39;</span><span class="p">,</span><span class="mi">144</span><span class="p">),</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1347"><a href="#L-1347"><span class="linenos">1347</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;LE&#39;</span><span class="p">,</span><span class="mi">145</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1348"><a href="#L-1348"><span class="linenos">1348</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;LO&#39;</span><span class="p">,</span><span class="mi">146</span><span class="p">),</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1349"><a href="#L-1349"><span class="linenos">1349</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;WW&#39;</span><span class="p">,</span><span class="mi">147</span><span class="p">),</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1350"><a href="#L-1350"><span class="linenos">1350</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;RR&#39;</span><span class="p">,</span><span class="mi">148</span><span class="p">),</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1351"><a href="#L-1351"><span class="linenos">1351</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYRR&#39;</span><span class="p">,</span><span class="mi">149</span><span class="p">),</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1352"><a href="#L-1352"><span class="linenos">1352</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EYRR&#39;</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1353"><a href="#L-1353"><span class="linenos">1353</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AXRR&#39;</span><span class="p">,</span><span class="mi">151</span><span class="p">),</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1354"><a href="#L-1354"><span class="linenos">1354</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AWRR&#39;</span><span class="p">,</span><span class="mi">152</span><span class="p">),</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1355"><a href="#L-1355"><span class="linenos">1355</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWRR&#39;</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1356"><a href="#L-1356"><span class="linenos">1356</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EYIY&#39;</span><span class="p">,</span><span class="mi">154</span><span class="p">),</span><span class="n">a_as_in_ate</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1357"><a href="#L-1357"><span class="linenos">1357</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OHIY&#39;</span><span class="p">,</span><span class="mi">155</span><span class="p">),</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1358"><a href="#L-1358"><span class="linenos">1358</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWIY&#39;</span><span class="p">,</span><span class="mi">156</span><span class="p">),</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1359"><a href="#L-1359"><span class="linenos">1359</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OHIH&#39;</span><span class="p">,</span><span class="mi">157</span><span class="p">),</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1360"><a href="#L-1360"><span class="linenos">1360</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYEH&#39;</span><span class="p">,</span><span class="mi">158</span><span class="p">),</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1361"><a href="#L-1361"><span class="linenos">1361</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EHLL&#39;</span><span class="p">,</span><span class="mi">159</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1362"><a href="#L-1362"><span class="linenos">1362</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYUW&#39;</span><span class="p">,</span><span class="mi">160</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1363"><a href="#L-1363"><span class="linenos">1363</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AXUW&#39;</span><span class="p">,</span><span class="mi">161</span><span class="p">),</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1364"><a href="#L-1364"><span class="linenos">1364</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IHUW&#39;</span><span class="p">,</span><span class="mi">162</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1365"><a href="#L-1365"><span class="linenos">1365</span></a>    <span class="c1"># TODO: 163 AYWW = o_as_in_now a_as_in_ago ? handle in cleanup_regexps + cvtOut_regexps ?</span>
</span><span id="L-1366"><a href="#L-1366"><span class="linenos">1366</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWWW&#39;</span><span class="p">,</span><span class="mi">164</span><span class="p">),</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1367"><a href="#L-1367"><span class="linenos">1367</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="mi">165</span><span class="p">),</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1368"><a href="#L-1368"><span class="linenos">1368</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;VV&#39;</span><span class="p">,</span><span class="mi">166</span><span class="p">),</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1369"><a href="#L-1369"><span class="linenos">1369</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ZZ&#39;</span><span class="p">,</span><span class="mi">167</span><span class="p">),</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1370"><a href="#L-1370"><span class="linenos">1370</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="mi">168</span><span class="p">),</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1371"><a href="#L-1371"><span class="linenos">1371</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="mi">169</span><span class="p">),</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1372"><a href="#L-1372"><span class="linenos">1372</span></a>    <span class="c1"># TODO: get cleanup_regexps to clean up some of these according to what&#39;s coming next etc:</span>
</span><span id="L-1373"><a href="#L-1373"><span class="linenos">1373</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;BE&#39;</span><span class="p">,</span><span class="mi">170</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1374"><a href="#L-1374"><span class="linenos">1374</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;BO&#39;</span><span class="p">,</span><span class="mi">171</span><span class="p">),</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1375"><a href="#L-1375"><span class="linenos">1375</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EB&#39;</span><span class="p">,</span><span class="mi">172</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1376"><a href="#L-1376"><span class="linenos">1376</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OB&#39;</span><span class="p">,</span><span class="mi">173</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1377"><a href="#L-1377"><span class="linenos">1377</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DE&#39;</span><span class="p">,</span><span class="mi">174</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1378"><a href="#L-1378"><span class="linenos">1378</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DO&#39;</span><span class="p">,</span><span class="mi">175</span><span class="p">),</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1379"><a href="#L-1379"><span class="linenos">1379</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ED&#39;</span><span class="p">,</span><span class="mi">176</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1380"><a href="#L-1380"><span class="linenos">1380</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OD&#39;</span><span class="p">,</span><span class="mi">177</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1381"><a href="#L-1381"><span class="linenos">1381</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;GE&#39;</span><span class="p">,</span><span class="mi">178</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1382"><a href="#L-1382"><span class="linenos">1382</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;GO&#39;</span><span class="p">,</span><span class="mi">179</span><span class="p">),</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1383"><a href="#L-1383"><span class="linenos">1383</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EG&#39;</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1384"><a href="#L-1384"><span class="linenos">1384</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OG&#39;</span><span class="p">,</span><span class="mi">181</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1385"><a href="#L-1385"><span class="linenos">1385</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="mi">182</span><span class="p">),</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1386"><a href="#L-1386"><span class="linenos">1386</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;HE&#39;</span><span class="p">,</span><span class="mi">183</span><span class="p">),</span><span class="n">h</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1387"><a href="#L-1387"><span class="linenos">1387</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;HO&#39;</span><span class="p">,</span><span class="mi">184</span><span class="p">),</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1388"><a href="#L-1388"><span class="linenos">1388</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="mi">185</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1389"><a href="#L-1389"><span class="linenos">1389</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;FF&#39;</span><span class="p">,</span><span class="mi">186</span><span class="p">),</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1390"><a href="#L-1390"><span class="linenos">1390</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span><span class="mi">187</span><span class="p">),</span><span class="n">s</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1391"><a href="#L-1391"><span class="linenos">1391</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SO&#39;</span><span class="p">,</span><span class="mi">188</span><span class="p">),</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1392"><a href="#L-1392"><span class="linenos">1392</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="mi">189</span><span class="p">),</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1393"><a href="#L-1393"><span class="linenos">1393</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="mi">190</span><span class="p">),</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1394"><a href="#L-1394"><span class="linenos">1394</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TT&#39;</span><span class="p">,</span><span class="mi">191</span><span class="p">),</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1395"><a href="#L-1395"><span class="linenos">1395</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TU&#39;</span><span class="p">,</span><span class="mi">192</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1396"><a href="#L-1396"><span class="linenos">1396</span></a>    <span class="c1"># TODO: 193 TS in cleanup_regexps and cvtOut_regexps</span>
</span><span id="L-1397"><a href="#L-1397"><span class="linenos">1397</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;KE&#39;</span><span class="p">,</span><span class="mi">194</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1398"><a href="#L-1398"><span class="linenos">1398</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;KO&#39;</span><span class="p">,</span><span class="mi">195</span><span class="p">),</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1399"><a href="#L-1399"><span class="linenos">1399</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EK&#39;</span><span class="p">,</span><span class="mi">196</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1400"><a href="#L-1400"><span class="linenos">1400</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span><span class="mi">197</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1401"><a href="#L-1401"><span class="linenos">1401</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span><span class="mi">198</span><span class="p">),</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1402"><a href="#L-1402"><span class="linenos">1402</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;PO&#39;</span><span class="p">,</span><span class="mi">199</span><span class="p">),</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1403"><a href="#L-1403"><span class="linenos">1403</span></a>    <span class="c1"># lex_filename not set (I think the front-end software might have one, but don&#39;t know if it&#39;s accessible; chip itself just takes phonemes)</span>
</span><span id="L-1404"><a href="#L-1404"><span class="linenos">1404</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1405"><a href="#L-1405"><span class="linenos">1405</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="L-1406"><a href="#L-1406"><span class="linenos">1406</span></a>    <span class="n">phoneme_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="L-1407"><a href="#L-1407"><span class="linenos">1407</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># TODO: is there a pause code?</span>
</span><span id="L-1408"><a href="#L-1408"><span class="linenos">1408</span></a>    <span class="n">output_is_binary</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1409"><a href="#L-1409"><span class="linenos">1409</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1410"><a href="#L-1410"><span class="linenos">1410</span></a>  <span class="p">),</span>
</span><span id="L-1411"><a href="#L-1411"><span class="linenos">1411</span></a>
</span><span id="L-1412"><a href="#L-1412"><span class="linenos">1412</span></a>  <span class="s2">&quot;rsynth&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1413"><a href="#L-1413"><span class="linenos">1413</span></a>    <span class="s1">&#39;rsynth text-to-speech C library (American English)&#39;</span><span class="p">,</span> <span class="c1"># TODO: test</span>
</span><span id="L-1414"><a href="#L-1414"><span class="linenos">1414</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: emphasis?</span>
</span><span id="L-1415"><a href="#L-1415"><span class="linenos">1415</span></a>    <span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1416"><a href="#L-1416"><span class="linenos">1416</span></a>    <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1417"><a href="#L-1417"><span class="linenos">1417</span></a>    <span class="p">(</span><span class="s2">&quot;eI&quot;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1418"><a href="#L-1418"><span class="linenos">1418</span></a>    <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1419"><a href="#L-1419"><span class="linenos">1419</span></a>    <span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1420"><a href="#L-1420"><span class="linenos">1420</span></a>    <span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1421"><a href="#L-1421"><span class="linenos">1421</span></a>    <span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1422"><a href="#L-1422"><span class="linenos">1422</span></a>    <span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1423"><a href="#L-1423"><span class="linenos">1423</span></a>    <span class="p">(</span><span class="s2">&quot;oU&quot;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1424"><a href="#L-1424"><span class="linenos">1424</span></a>    <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1425"><a href="#L-1425"><span class="linenos">1425</span></a>    <span class="p">(</span><span class="s2">&quot;u:&quot;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1426"><a href="#L-1426"><span class="linenos">1426</span></a>    <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1427"><a href="#L-1427"><span class="linenos">1427</span></a>    <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1428"><a href="#L-1428"><span class="linenos">1428</span></a>    <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1429"><a href="#L-1429"><span class="linenos">1429</span></a>    <span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1430"><a href="#L-1430"><span class="linenos">1430</span></a>    <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1431"><a href="#L-1431"><span class="linenos">1431</span></a>    <span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1432"><a href="#L-1432"><span class="linenos">1432</span></a>    <span class="p">(</span><span class="s2">&quot;I@&quot;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1433"><a href="#L-1433"><span class="linenos">1433</span></a>    <span class="p">(</span><span class="s2">&quot;e@&quot;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1434"><a href="#L-1434"><span class="linenos">1434</span></a>    <span class="p">(</span><span class="s2">&quot;3:&quot;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1435"><a href="#L-1435"><span class="linenos">1435</span></a>    <span class="p">(</span><span class="s2">&quot;Qr&quot;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1436"><a href="#L-1436"><span class="linenos">1436</span></a>    <span class="p">(</span><span class="s2">&quot;OI&quot;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1437"><a href="#L-1437"><span class="linenos">1437</span></a>    <span class="p">(</span><span class="s2">&quot;aI&quot;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1438"><a href="#L-1438"><span class="linenos">1438</span></a>    <span class="p">(</span><span class="s2">&quot;j&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1439"><a href="#L-1439"><span class="linenos">1439</span></a>    <span class="p">(</span><span class="s2">&quot;U@&quot;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1440"><a href="#L-1440"><span class="linenos">1440</span></a>    <span class="p">(</span><span class="s2">&quot;aU&quot;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1441"><a href="#L-1441"><span class="linenos">1441</span></a>    <span class="p">(</span><span class="s2">&quot;@U&quot;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1442"><a href="#L-1442"><span class="linenos">1442</span></a>    <span class="p">(</span><span class="s2">&quot;dZ&quot;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1443"><a href="#L-1443"><span class="linenos">1443</span></a>    <span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1444"><a href="#L-1444"><span class="linenos">1444</span></a>    <span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1445"><a href="#L-1445"><span class="linenos">1445</span></a>    <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1446"><a href="#L-1446"><span class="linenos">1446</span></a>    <span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1447"><a href="#L-1447"><span class="linenos">1447</span></a>    <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1448"><a href="#L-1448"><span class="linenos">1448</span></a>    <span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1449"><a href="#L-1449"><span class="linenos">1449</span></a>    <span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1450"><a href="#L-1450"><span class="linenos">1450</span></a>    <span class="p">(</span><span class="s2">&quot;tS&quot;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1451"><a href="#L-1451"><span class="linenos">1451</span></a>    <span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1452"><a href="#L-1452"><span class="linenos">1452</span></a>    <span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1453"><a href="#L-1453"><span class="linenos">1453</span></a>    <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1454"><a href="#L-1454"><span class="linenos">1454</span></a>    <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1455"><a href="#L-1455"><span class="linenos">1455</span></a>    <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1456"><a href="#L-1456"><span class="linenos">1456</span></a>    <span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1457"><a href="#L-1457"><span class="linenos">1457</span></a>    <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1458"><a href="#L-1458"><span class="linenos">1458</span></a>    <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1459"><a href="#L-1459"><span class="linenos">1459</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1460"><a href="#L-1460"><span class="linenos">1460</span></a>    <span class="c1"># lex_filename not set (TODO: check what sort of lexicon is used by rsynth&#39;s &quot;say&quot; front-end)</span>
</span><span id="L-1461"><a href="#L-1461"><span class="linenos">1461</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1462"><a href="#L-1462"><span class="linenos">1462</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1463"><a href="#L-1463"><span class="linenos">1463</span></a>  <span class="p">),</span>
</span><span id="L-1464"><a href="#L-1464"><span class="linenos">1464</span></a>
</span><span id="L-1465"><a href="#L-1465"><span class="linenos">1465</span></a>  <span class="s2">&quot;unicode-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1466"><a href="#L-1466"><span class="linenos">1466</span></a>    <span class="s2">&quot;IPA symbols in Unicode, as used by an increasing number of dictionary programs, websites etc&quot;</span><span class="p">,</span>
</span><span id="L-1467"><a href="#L-1467"><span class="linenos">1467</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1468"><a href="#L-1468"><span class="linenos">1468</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1469"><a href="#L-1469"><span class="linenos">1469</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02c8</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1470"><a href="#L-1470"><span class="linenos">1470</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02cc</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1471"><a href="#L-1471"><span class="linenos">1471</span></a>    <span class="c1"># NB the above two are &quot;modifier&quot;, not &quot;combining&quot;,</span>
</span><span id="L-1472"><a href="#L-1472"><span class="linenos">1472</span></a>    <span class="c1"># Unicode characters.  There IS a difference.  If</span>
</span><span id="L-1473"><a href="#L-1473"><span class="linenos">1473</span></a>    <span class="c1"># your software displays them as overprinting the</span>
</span><span id="L-1474"><a href="#L-1474"><span class="linenos">1474</span></a>    <span class="c1"># surrounding letters, you have a bug.</span>
</span><span id="L-1475"><a href="#L-1475"><span class="linenos">1475</span></a>    <span class="c1"># (E.g. WeChat v1.2.2.1 on Mac OS 10.7)</span>
</span><span id="L-1476"><a href="#L-1476"><span class="linenos">1476</span></a>    <span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">text_sharp</span><span class="p">),</span>
</span><span id="L-1477"><a href="#L-1477"><span class="linenos">1477</span></a>    <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">text_underline</span><span class="p">),</span>
</span><span id="L-1478"><a href="#L-1478"><span class="linenos">1478</span></a>    <span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="n">text_question</span><span class="p">),</span>
</span><span id="L-1479"><a href="#L-1479"><span class="linenos">1479</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">text_exclamation</span><span class="p">),</span>
</span><span id="L-1480"><a href="#L-1480"><span class="linenos">1480</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">text_comma</span><span class="p">),</span>
</span><span id="L-1481"><a href="#L-1481"><span class="linenos">1481</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1482"><a href="#L-1482"><span class="linenos">1482</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="L-1483"><a href="#L-1483"><span class="linenos">1483</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1484"><a href="#L-1484"><span class="linenos">1484</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1485"><a href="#L-1485"><span class="linenos">1485</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1486"><a href="#L-1486"><span class="linenos">1486</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1487"><a href="#L-1487"><span class="linenos">1487</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1488"><a href="#L-1488"><span class="linenos">1488</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028c</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1489"><a href="#L-1489"><span class="linenos">1489</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\u1d27</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># 28c sometimes mistakenly written as 1d27</span>
</span><span id="L-1490"><a href="#L-1490"><span class="linenos">1490</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0252</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1491"><a href="#L-1491"><span class="linenos">1491</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1492"><a href="#L-1492"><span class="linenos">1492</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1493"><a href="#L-1493"><span class="linenos">1493</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1494"><a href="#L-1494"><span class="linenos">1494</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="L-1495"><a href="#L-1495"><span class="linenos">1495</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1496"><a href="#L-1496"><span class="linenos">1496</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1497"><a href="#L-1497"><span class="linenos">1497</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1498"><a href="#L-1498"><span class="linenos">1498</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028c\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1499"><a href="#L-1499"><span class="linenos">1499</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">e&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="L-1500"><a href="#L-1500"><span class="linenos">1500</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1501"><a href="#L-1501"><span class="linenos">1501</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;t</span><span class="se">\u0283</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1502"><a href="#L-1502"><span class="linenos">1502</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02a7</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1503"><a href="#L-1503"><span class="linenos">1503</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1504"><a href="#L-1504"><span class="linenos">1504</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xf0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1505"><a href="#L-1505"><span class="linenos">1505</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1506"><a href="#L-1506"><span class="linenos">1506</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="L-1507"><a href="#L-1507"><span class="linenos">1507</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="L-1508"><a href="#L-1508"><span class="linenos">1508</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025c\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1509"><a href="#L-1509"><span class="linenos">1509</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1510"><a href="#L-1510"><span class="linenos">1510</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1511"><a href="#L-1511"><span class="linenos">1511</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1512"><a href="#L-1512"><span class="linenos">1512</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1513"><a href="#L-1513"><span class="linenos">1513</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1514"><a href="#L-1514"><span class="linenos">1514</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1515"><a href="#L-1515"><span class="linenos">1515</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1516"><a href="#L-1516"><span class="linenos">1516</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1517"><a href="#L-1517"><span class="linenos">1517</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0261</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1518"><a href="#L-1518"><span class="linenos">1518</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1519"><a href="#L-1519"><span class="linenos">1519</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1520"><a href="#L-1520"><span class="linenos">1520</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0268</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="L-1521"><a href="#L-1521"><span class="linenos">1521</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1522"><a href="#L-1522"><span class="linenos">1522</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="L-1523"><a href="#L-1523"><span class="linenos">1523</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0279\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="L-1524"><a href="#L-1524"><span class="linenos">1524</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1525"><a href="#L-1525"><span class="linenos">1525</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;i</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1526"><a href="#L-1526"><span class="linenos">1526</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;d</span><span class="se">\u0292</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1527"><a href="#L-1527"><span class="linenos">1527</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02a4</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1528"><a href="#L-1528"><span class="linenos">1528</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1529"><a href="#L-1529"><span class="linenos">1529</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-1530"><a href="#L-1530"><span class="linenos">1530</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1531"><a href="#L-1531"><span class="linenos">1531</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;d</span><span class="se">\u026b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="L-1532"><a href="#L-1532"><span class="linenos">1532</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1533"><a href="#L-1533"><span class="linenos">1533</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1534"><a href="#L-1534"><span class="linenos">1534</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u014b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1535"><a href="#L-1535"><span class="linenos">1535</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1536"><a href="#L-1536"><span class="linenos">1536</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1537"><a href="#L-1537"><span class="linenos">1537</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1538"><a href="#L-1538"><span class="linenos">1538</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u0289</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-1539"><a href="#L-1539"><span class="linenos">1539</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1540"><a href="#L-1540"><span class="linenos">1540</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1541"><a href="#L-1541"><span class="linenos">1541</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1542"><a href="#L-1542"><span class="linenos">1542</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1543"><a href="#L-1543"><span class="linenos">1543</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1544"><a href="#L-1544"><span class="linenos">1544</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1545"><a href="#L-1545"><span class="linenos">1545</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0283</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1546"><a href="#L-1546"><span class="linenos">1546</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1547"><a href="#L-1547"><span class="linenos">1547</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u027e</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="L-1548"><a href="#L-1548"><span class="linenos">1548</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u03b8</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1549"><a href="#L-1549"><span class="linenos">1549</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1550"><a href="#L-1550"><span class="linenos">1550</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1551"><a href="#L-1551"><span class="linenos">1551</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1552"><a href="#L-1552"><span class="linenos">1552</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0289\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1553"><a href="#L-1553"><span class="linenos">1553</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;u</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1554"><a href="#L-1554"><span class="linenos">1554</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1555"><a href="#L-1555"><span class="linenos">1555</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1556"><a href="#L-1556"><span class="linenos">1556</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1557"><a href="#L-1557"><span class="linenos">1557</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="L-1558"><a href="#L-1558"><span class="linenos">1558</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1559"><a href="#L-1559"><span class="linenos">1559</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1560"><a href="#L-1560"><span class="linenos">1560</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="L-1561"><a href="#L-1561"><span class="linenos">1561</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1562"><a href="#L-1562"><span class="linenos">1562</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1563"><a href="#L-1563"><span class="linenos">1563</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0292</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1564"><a href="#L-1564"><span class="linenos">1564</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0294</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="L-1565"><a href="#L-1565"><span class="linenos">1565</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-ipa.html&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-1566"><a href="#L-1566"><span class="linenos">1566</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;HTML&quot;</span><span class="p">,</span>
</span><span id="L-1567"><a href="#L-1567"><span class="linenos">1567</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;mobileoptimized&quot; content=&quot;0&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&#39;</span><span class="p">,</span>
</span><span id="L-1568"><a href="#L-1568"><span class="linenos">1568</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1569"><a href="#L-1569"><span class="linenos">1569</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="s2">&quot;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1570"><a href="#L-1570"><span class="linenos">1570</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1571"><a href="#L-1571"><span class="linenos">1571</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1572"><a href="#L-1572"><span class="linenos">1572</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really? (at least &#39;-&#39; should be safe to drop)</span>
</span><span id="L-1573"><a href="#L-1573"><span class="linenos">1573</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="n">unicode_preprocess</span><span class="p">,</span>
</span><span id="L-1574"><a href="#L-1574"><span class="linenos">1574</span></a>  <span class="p">),</span>
</span><span id="L-1575"><a href="#L-1575"><span class="linenos">1575</span></a>
</span><span id="L-1576"><a href="#L-1576"><span class="linenos">1576</span></a>  <span class="s2">&quot;unicode-ipa-syls&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-1577"><a href="#L-1577"><span class="linenos">1577</span></a>  <span class="s2">&quot;Like unicode-ipa but with syllable separators preserved&quot;</span><span class="p">,</span>
</span><span id="L-1578"><a href="#L-1578"><span class="linenos">1578</span></a>  <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
</span><span id="L-1579"><a href="#L-1579"><span class="linenos">1579</span></a>  <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s2">&quot;\.+&quot;</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)],</span> <span class="c1"># multiple . to one .</span>
</span><span id="L-1580"><a href="#L-1580"><span class="linenos">1580</span></a>  <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="L-1581"><a href="#L-1581"><span class="linenos">1581</span></a>
</span><span id="L-1582"><a href="#L-1582"><span class="linenos">1582</span></a>  <span class="s2">&quot;yinghan&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-1583"><a href="#L-1583"><span class="linenos">1583</span></a>     <span class="s2">&quot;As unicode-ipa but, when converting a user lexicon, generates Python code that reads Wenlin Yinghan dictionary entries and adds IPA bands to matching words&quot;</span><span class="p">,</span>
</span><span id="L-1584"><a href="#L-1584"><span class="linenos">1584</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;yinghan-ipa.py&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-1585"><a href="#L-1585"><span class="linenos">1585</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;Python script&quot;</span><span class="p">,</span>
</span><span id="L-1586"><a href="#L-1586"><span class="linenos">1586</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s1">&#39;#!/usr/bin/env python</span><span class="se">\n</span><span class="s1"># -*- coding: utf-8 -*-</span><span class="se">\n</span><span class="s1"># Works in both Python 2 and Python 3</span><span class="se">\n\n</span><span class="s1">import sys; d={&#39;</span><span class="p">,</span>
</span><span id="L-1587"><a href="#L-1587"><span class="linenos">1587</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s1">&#39;u&quot;</span><span class="si">%s</span><span class="s1">&quot;:u&quot;</span><span class="si">%s</span><span class="s1">&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-1588"><a href="#L-1588"><span class="linenos">1588</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">import re</span><span class="se">\n</span><span class="s2">try: i,o=sys.stdin.buffer,sys.stdout.buffer # Python 3</span><span class="se">\n</span><span class="s2">except AttributeError: i,o=sys.stdin,sys.stdout # Python 2</span><span class="se">\n</span><span class="s2">for k in list(d.keys()): d[k.lower().encode(&#39;utf-8&#39;)]=d[k]</span><span class="se">\n</span><span class="s2">nextIsHead=False</span><span class="se">\n</span><span class="s2">for l in i:</span><span class="se">\n</span><span class="s2"> o.write(l)</span><span class="se">\n</span><span class="s2"> if nextIsHead and l.strip():</span><span class="se">\n</span><span class="s2">  w=l.split()</span><span class="se">\n</span><span class="s2">  if w[0]==u&#39;ehw&#39;.encode(&#39;utf-8&#39;): l=u&#39; &#39;.encode(&#39;utf-8&#39;).join(w[1:])</span><span class="se">\n</span><span class="s2">  k = re.sub(u&#39;</span><span class="se">\\\\</span><span class="s2">([^)]*</span><span class="se">\\\\</span><span class="s2">)$&#39;.encode(&#39;utf-8&#39;),u&#39;&#39;.encode(&#39;utf-8&#39;),l.strip()).strip().lower()</span><span class="se">\n</span><span class="s2">  if k in d: o.write(u&#39;ipa &#39;.encode(&#39;utf-8&#39;)+d[k].encode(&#39;utf-8&#39;)+u&#39;</span><span class="se">\\</span><span class="s2">n&#39;.encode(&#39;utf-8&#39;))</span><span class="se">\n</span><span class="s2"> if l.startswith(u&#39;*** &#39;.encode(&#39;utf-8&#39;)): nextIsHead=True</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># (allow parenthesised explanation after headword when matching)</span>
</span><span id="L-1589"><a href="#L-1589"><span class="linenos">1589</span></a>    <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-1590"><a href="#L-1590"><span class="linenos">1590</span></a>  <span class="p">),</span>
</span><span id="L-1591"><a href="#L-1591"><span class="linenos">1591</span></a>
</span><span id="L-1592"><a href="#L-1592"><span class="linenos">1592</span></a>  <span class="s2">&quot;unicode-rough&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="L-1593"><a href="#L-1593"><span class="linenos">1593</span></a>    <span class="s2">&quot;A non-standard notation that&#39;s reminiscent of unicode-ipa but changed so that more of the characters show in old browsers with incomplete fonts&quot;</span><span class="p">,</span>
</span><span id="L-1594"><a href="#L-1594"><span class="linenos">1594</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1595"><a href="#L-1595"><span class="linenos">1595</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1596"><a href="#L-1596"><span class="linenos">1596</span></a>    <span class="p">(</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1597"><a href="#L-1597"><span class="linenos">1597</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="L-1598"><a href="#L-1598"><span class="linenos">1598</span></a>    <span class="p">(</span><span class="n">var3_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1599"><a href="#L-1599"><span class="linenos">1599</span></a>    <span class="p">(</span><span class="n">var4_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1600"><a href="#L-1600"><span class="linenos">1600</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1601"><a href="#L-1601"><span class="linenos">1601</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259</span><span class="s1">:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1602"><a href="#L-1602"><span class="linenos">1602</span></a>    <span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1603"><a href="#L-1603"><span class="linenos">1603</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1604"><a href="#L-1604"><span class="linenos">1604</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1605"><a href="#L-1605"><span class="linenos">1605</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="L-1606"><a href="#L-1606"><span class="linenos">1606</span></a>     <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1607"><a href="#L-1607"><span class="linenos">1607</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1608"><a href="#L-1608"><span class="linenos">1608</span></a>     <span class="p">(</span><span class="n">var2_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1609"><a href="#L-1609"><span class="linenos">1609</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1610"><a href="#L-1610"><span class="linenos">1610</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1611"><a href="#L-1611"><span class="linenos">1611</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;ei&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1612"><a href="#L-1612"><span class="linenos">1612</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6</span><span class="s1">i&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1613"><a href="#L-1613"><span class="linenos">1613</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1614"><a href="#L-1614"><span class="linenos">1614</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_i_as_in_it</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1615"><a href="#L-1615"><span class="linenos">1615</span></a>    <span class="p">(</span><span class="s1">&#39;eeuh-&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span> <span class="p">(</span><span class="n">var2_ear</span><span class="p">,</span><span class="s1">&#39;eeuh-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1616"><a href="#L-1616"><span class="linenos">1616</span></a>    <span class="p">(</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_e_as_in_eat</span><span class="p">,</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1617"><a href="#L-1617"><span class="linenos">1617</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1618"><a href="#L-1618"><span class="linenos">1618</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1619"><a href="#L-1619"><span class="linenos">1619</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1620"><a href="#L-1620"><span class="linenos">1620</span></a>    <span class="p">(</span><span class="n">var2_o_as_in_go</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># override unicode-ipa</span>
</span><span id="L-1621"><a href="#L-1621"><span class="linenos">1621</span></a>    <span class="p">(</span><span class="n">var1_u_as_in_but</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># ditto (?? &#39;+&#39;?)</span>
</span><span id="L-1622"><a href="#L-1622"><span class="linenos">1622</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1623"><a href="#L-1623"><span class="linenos">1623</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1624"><a href="#L-1624"><span class="linenos">1624</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1625"><a href="#L-1625"><span class="linenos">1625</span></a>    <span class="p">(</span><span class="n">var1_t</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1626"><a href="#L-1626"><span class="linenos">1626</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1627"><a href="#L-1627"><span class="linenos">1627</span></a>    <span class="p">(</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1628"><a href="#L-1628"><span class="linenos">1628</span></a>    <span class="p">(</span><span class="n">var1_oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1629"><a href="#L-1629"><span class="linenos">1629</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1630"><a href="#L-1630"><span class="linenos">1630</span></a>     <span class="p">(</span><span class="n">var1_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1631"><a href="#L-1631"><span class="linenos">1631</span></a>     <span class="p">(</span><span class="n">var2_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1632"><a href="#L-1632"><span class="linenos">1632</span></a>     <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1633"><a href="#L-1633"><span class="linenos">1633</span></a>     <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1634"><a href="#L-1634"><span class="linenos">1634</span></a>     <span class="p">(</span><span class="n">var2_close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1635"><a href="#L-1635"><span class="linenos">1635</span></a>     <span class="p">(</span><span class="n">var1_w</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1636"><a href="#L-1636"><span class="linenos">1636</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1637"><a href="#L-1637"><span class="linenos">1637</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1638"><a href="#L-1638"><span class="linenos">1638</span></a>     <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;-$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)],</span>
</span><span id="L-1639"><a href="#L-1639"><span class="linenos">1639</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-1640"><a href="#L-1640"><span class="linenos">1640</span></a>  <span class="p">),</span>
</span><span id="L-1641"><a href="#L-1641"><span class="linenos">1641</span></a>
</span><span id="L-1642"><a href="#L-1642"><span class="linenos">1642</span></a>  <span class="s2">&quot;braille-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1643"><a href="#L-1643"><span class="linenos">1643</span></a>    <span class="s2">&quot;IPA symbols in Braille (2008 BANA standard).  By default Braille ASCII is output; if you prefer to see the Braille dots via Unicode, set the BRAILLE_UNICODE environment variable.&quot;</span><span class="p">,</span> <span class="c1"># BANA = Braille Authority of North America.  TODO: check if the UK accepted this standard.</span>
</span><span id="L-1644"><a href="#L-1644"><span class="linenos">1644</span></a>    <span class="c1"># TODO: add Unicode IPA signs that aren&#39;t used in English IPA, so we can do a general IPA conversion</span>
</span><span id="L-1645"><a href="#L-1645"><span class="linenos">1645</span></a>    <span class="p">(</span><span class="s1">&#39;_B&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1646"><a href="#L-1646"><span class="linenos">1646</span></a>    <span class="p">(</span><span class="s1">&#39;_2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1647"><a href="#L-1647"><span class="linenos">1647</span></a>    <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1648"><a href="#L-1648"><span class="linenos">1648</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="L-1649"><a href="#L-1649"><span class="linenos">1649</span></a>    <span class="p">(</span><span class="s1">&#39;*3&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1650"><a href="#L-1650"><span class="linenos">1650</span></a>    <span class="p">(</span><span class="s1">&#39;*#&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1651"><a href="#L-1651"><span class="linenos">1651</span></a>    <span class="p">(</span><span class="s1">&#39;A3&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1652"><a href="#L-1652"><span class="linenos">1652</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1653"><a href="#L-1653"><span class="linenos">1653</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1654"><a href="#L-1654"><span class="linenos">1654</span></a>    <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1655"><a href="#L-1655"><span class="linenos">1655</span></a>    <span class="p">(</span><span class="s1">&#39;4*&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1656"><a href="#L-1656"><span class="linenos">1656</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1657"><a href="#L-1657"><span class="linenos">1657</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1658"><a href="#L-1658"><span class="linenos">1658</span></a>    <span class="p">(</span><span class="s1">&#39;A(&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1659"><a href="#L-1659"><span class="linenos">1659</span></a>    <span class="p">(</span><span class="s1">&#39;%&lt;&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="L-1660"><a href="#L-1660"><span class="linenos">1660</span></a>    <span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1661"><a href="#L-1661"><span class="linenos">1661</span></a>    <span class="p">(</span><span class="s1">&#39;53&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1662"><a href="#L-1662"><span class="linenos">1662</span></a>    <span class="p">(</span><span class="s1">&#39;5&quot;R.&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1663"><a href="#L-1663"><span class="linenos">1663</span></a>    <span class="p">(</span><span class="s1">&#39;A/&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1664"><a href="#L-1664"><span class="linenos">1664</span></a>    <span class="p">(</span><span class="s1">&#39;*E&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="L-1665"><a href="#L-1665"><span class="linenos">1665</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1666"><a href="#L-1666"><span class="linenos">1666</span></a>    <span class="p">(</span><span class="s1">&#39;T:&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1667"><a href="#L-1667"><span class="linenos">1667</span></a>    <span class="p">(</span><span class="s1">&#39;T&quot;:.&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1668"><a href="#L-1668"><span class="linenos">1668</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1669"><a href="#L-1669"><span class="linenos">1669</span></a>    <span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1670"><a href="#L-1670"><span class="linenos">1670</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1671"><a href="#L-1671"><span class="linenos">1671</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="L-1672"><a href="#L-1672"><span class="linenos">1672</span></a>    <span class="p">(</span><span class="s1">&#39;4&gt;3&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span> <span class="c1"># (from \u025c\u02d0; TODO: check what happens to \u025d)</span>
</span><span id="L-1673"><a href="#L-1673"><span class="linenos">1673</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;5&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1674"><a href="#L-1674"><span class="linenos">1674</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;#&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1675"><a href="#L-1675"><span class="linenos">1675</span></a>    <span class="p">(</span><span class="s1">&#39;E3&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1676"><a href="#L-1676"><span class="linenos">1676</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;3&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1677"><a href="#L-1677"><span class="linenos">1677</span></a>    <span class="p">(</span><span class="s1">&#39;E5&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1678"><a href="#L-1678"><span class="linenos">1678</span></a>    <span class="p">(</span><span class="s1">&#39;E/&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1679"><a href="#L-1679"><span class="linenos">1679</span></a>    <span class="p">(</span><span class="s1">&#39;%/&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1680"><a href="#L-1680"><span class="linenos">1680</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1681"><a href="#L-1681"><span class="linenos">1681</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1682"><a href="#L-1682"><span class="linenos">1682</span></a>    <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1683"><a href="#L-1683"><span class="linenos">1683</span></a>    <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1684"><a href="#L-1684"><span class="linenos">1684</span></a>    <span class="p">(</span><span class="s1">&#39;0I&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="L-1685"><a href="#L-1685"><span class="linenos">1685</span></a>    <span class="p">(</span><span class="s1">&#39;/5&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1686"><a href="#L-1686"><span class="linenos">1686</span></a>    <span class="p">(</span><span class="s1">&#39;/#&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="L-1687"><a href="#L-1687"><span class="linenos">1687</span></a>    <span class="p">(</span><span class="s1">&#39;/#5&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="L-1688"><a href="#L-1688"><span class="linenos">1688</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1689"><a href="#L-1689"><span class="linenos">1689</span></a>    <span class="p">(</span><span class="s1">&#39;I3&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1690"><a href="#L-1690"><span class="linenos">1690</span></a>    <span class="p">(</span><span class="s1">&#39;D!&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1691"><a href="#L-1691"><span class="linenos">1691</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1692"><a href="#L-1692"><span class="linenos">1692</span></a>    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-1693"><a href="#L-1693"><span class="linenos">1693</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1694"><a href="#L-1694"><span class="linenos">1694</span></a>    <span class="p">(</span><span class="s1">&#39;D6L&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="L-1695"><a href="#L-1695"><span class="linenos">1695</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1696"><a href="#L-1696"><span class="linenos">1696</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1697"><a href="#L-1697"><span class="linenos">1697</span></a>    <span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1698"><a href="#L-1698"><span class="linenos">1698</span></a>    <span class="p">(</span><span class="s1">&#39;5(&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1699"><a href="#L-1699"><span class="linenos">1699</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1700"><a href="#L-1700"><span class="linenos">1700</span></a>    <span class="p">(</span><span class="s1">&#39;O(&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1701"><a href="#L-1701"><span class="linenos">1701</span></a>    <span class="p">(</span><span class="s1">&#39;50U&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-1702"><a href="#L-1702"><span class="linenos">1702</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;/&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1703"><a href="#L-1703"><span class="linenos">1703</span></a>    <span class="p">(</span><span class="s1">&#39;O/&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1704"><a href="#L-1704"><span class="linenos">1704</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1705"><a href="#L-1705"><span class="linenos">1705</span></a>    <span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1706"><a href="#L-1706"><span class="linenos">1706</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1707"><a href="#L-1707"><span class="linenos">1707</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1708"><a href="#L-1708"><span class="linenos">1708</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1709"><a href="#L-1709"><span class="linenos">1709</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1710"><a href="#L-1710"><span class="linenos">1710</span></a>    <span class="p">(</span><span class="s1">&#39;6R&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="L-1711"><a href="#L-1711"><span class="linenos">1711</span></a>    <span class="p">(</span><span class="s1">&#39;.?&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1712"><a href="#L-1712"><span class="linenos">1712</span></a>    <span class="p">(</span><span class="s1">&#39;(5&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1713"><a href="#L-1713"><span class="linenos">1713</span></a>    <span class="p">(</span><span class="s1">&#39;(#&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1714"><a href="#L-1714"><span class="linenos">1714</span></a>    <span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1715"><a href="#L-1715"><span class="linenos">1715</span></a>    <span class="p">(</span><span class="s1">&#39;0U3&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1716"><a href="#L-1716"><span class="linenos">1716</span></a>    <span class="p">(</span><span class="s1">&#39;U3&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1717"><a href="#L-1717"><span class="linenos">1717</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1718"><a href="#L-1718"><span class="linenos">1718</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;3&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1719"><a href="#L-1719"><span class="linenos">1719</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1720"><a href="#L-1720"><span class="linenos">1720</span></a>    <span class="p">(</span><span class="s1">&#39;O3&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="L-1721"><a href="#L-1721"><span class="linenos">1721</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1722"><a href="#L-1722"><span class="linenos">1722</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1723"><a href="#L-1723"><span class="linenos">1723</span></a>    <span class="p">(</span><span class="s1">&#39;6W&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="L-1724"><a href="#L-1724"><span class="linenos">1724</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1725"><a href="#L-1725"><span class="linenos">1725</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1726"><a href="#L-1726"><span class="linenos">1726</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1727"><a href="#L-1727"><span class="linenos">1727</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="L-1728"><a href="#L-1728"><span class="linenos">1728</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;BRAILLE_UNICODE&quot;</span><span class="p">,</span><span class="s2">&quot;words-ipa.txt&quot;</span><span class="p">,</span><span class="s2">&quot;words-ipa.brl&quot;</span><span class="p">),</span> <span class="c1"># write-only for now</span>
</span><span id="L-1729"><a href="#L-1729"><span class="linenos">1729</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
</span><span id="L-1730"><a href="#L-1730"><span class="linenos">1730</span></a>    <span class="c1"># inline_format=&quot;,7%s7&#39;&quot;, # -&gt; do this in cleanup_func so it&#39;s included in BRAILLE_UNICODE if necessary</span>
</span><span id="L-1731"><a href="#L-1731"><span class="linenos">1731</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># ditto with the markers</span>
</span><span id="L-1732"><a href="#L-1732"><span class="linenos">1732</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1733"><a href="#L-1733"><span class="linenos">1733</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1734"><a href="#L-1734"><span class="linenos">1734</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1735"><a href="#L-1735"><span class="linenos">1735</span></a>    <span class="n">cleanup_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;BRAILLE_UNICODE&quot;</span><span class="p">,</span><span class="n">ascii_braille_to_unicode</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)(</span><span class="s2">&quot;,7&quot;</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="s2">&quot;7&#39;&quot;</span><span class="p">),</span>
</span><span id="L-1736"><a href="#L-1736"><span class="linenos">1736</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="n">unicode_to_ascii_braille</span><span class="p">,</span>
</span><span id="L-1737"><a href="#L-1737"><span class="linenos">1737</span></a>  <span class="p">),</span>
</span><span id="L-1738"><a href="#L-1738"><span class="linenos">1738</span></a>  
</span><span id="L-1739"><a href="#L-1739"><span class="linenos">1739</span></a>  <span class="s2">&quot;latex-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1740"><a href="#L-1740"><span class="linenos">1740</span></a>    <span class="s1">&#39;IPA symbols for typesetting in LaTeX using the &quot;tipa&quot; package&#39;</span><span class="p">,</span>
</span><span id="L-1741"><a href="#L-1741"><span class="linenos">1741</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1742"><a href="#L-1742"><span class="linenos">1742</span></a>    <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1743"><a href="#L-1743"><span class="linenos">1743</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textsecstress</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1744"><a href="#L-1744"><span class="linenos">1744</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">#&#39;</span><span class="p">,</span><span class="n">text_sharp</span><span class="p">),</span>
</span><span id="L-1745"><a href="#L-1745"><span class="linenos">1745</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">_&#39;</span><span class="p">,</span><span class="n">text_underline</span><span class="p">),</span>
</span><span id="L-1746"><a href="#L-1746"><span class="linenos">1746</span></a>    <span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="n">text_question</span><span class="p">),</span>
</span><span id="L-1747"><a href="#L-1747"><span class="linenos">1747</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">text_exclamation</span><span class="p">),</span>
</span><span id="L-1748"><a href="#L-1748"><span class="linenos">1748</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">text_comma</span><span class="p">),</span>
</span><span id="L-1749"><a href="#L-1749"><span class="linenos">1749</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1750"><a href="#L-1750"><span class="linenos">1750</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="L-1751"><a href="#L-1751"><span class="linenos">1751</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1752"><a href="#L-1752"><span class="linenos">1752</span></a>    <span class="p">(</span><span class="s1">&#39;A</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1753"><a href="#L-1753"><span class="linenos">1753</span></a>    <span class="p">(</span><span class="s1">&#39;a:&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1754"><a href="#L-1754"><span class="linenos">1754</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1755"><a href="#L-1755"><span class="linenos">1755</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1756"><a href="#L-1756"><span class="linenos">1756</span></a>    <span class="p">(</span><span class="s1">&#39;6&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1757"><a href="#L-1757"><span class="linenos">1757</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1758"><a href="#L-1758"><span class="linenos">1758</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1759"><a href="#L-1759"><span class="linenos">1759</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1760"><a href="#L-1760"><span class="linenos">1760</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="L-1761"><a href="#L-1761"><span class="linenos">1761</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1762"><a href="#L-1762"><span class="linenos">1762</span></a>    <span class="p">(</span><span class="s1">&#39;@:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="L-1763"><a href="#L-1763"><span class="linenos">1763</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textrhookschwa</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="L-1764"><a href="#L-1764"><span class="linenos">1764</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1765"><a href="#L-1765"><span class="linenos">1765</span></a>    <span class="p">(</span><span class="s1">&#39;Ae&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="L-1766"><a href="#L-1766"><span class="linenos">1766</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1767"><a href="#L-1767"><span class="linenos">1767</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1768"><a href="#L-1768"><span class="linenos">1768</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1769"><a href="#L-1769"><span class="linenos">1769</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1770"><a href="#L-1770"><span class="linenos">1770</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1771"><a href="#L-1771"><span class="linenos">1771</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="L-1772"><a href="#L-1772"><span class="linenos">1772</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="L-1773"><a href="#L-1773"><span class="linenos">1773</span></a>    <span class="p">(</span><span class="s1">&#39;E@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="L-1774"><a href="#L-1774"><span class="linenos">1774</span></a>    <span class="p">(</span><span class="s1">&#39;E</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1775"><a href="#L-1775"><span class="linenos">1775</span></a>    <span class="p">(</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1776"><a href="#L-1776"><span class="linenos">1776</span></a>    <span class="p">(</span><span class="s1">&#39;E:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1777"><a href="#L-1777"><span class="linenos">1777</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="L-1778"><a href="#L-1778"><span class="linenos">1778</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1779"><a href="#L-1779"><span class="linenos">1779</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1780"><a href="#L-1780"><span class="linenos">1780</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1781"><a href="#L-1781"><span class="linenos">1781</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1782"><a href="#L-1782"><span class="linenos">1782</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1783"><a href="#L-1783"><span class="linenos">1783</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1784"><a href="#L-1784"><span class="linenos">1784</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="L-1785"><a href="#L-1785"><span class="linenos">1785</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1786"><a href="#L-1786"><span class="linenos">1786</span></a>    <span class="p">(</span><span class="s1">&#39;I</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="L-1787"><a href="#L-1787"><span class="linenos">1787</span></a>    <span class="p">(</span><span class="s1">&#39;I@</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="L-1788"><a href="#L-1788"><span class="linenos">1788</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1789"><a href="#L-1789"><span class="linenos">1789</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1790"><a href="#L-1790"><span class="linenos">1790</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1791"><a href="#L-1791"><span class="linenos">1791</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1792"><a href="#L-1792"><span class="linenos">1792</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="L-1793"><a href="#L-1793"><span class="linenos">1793</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1794"><a href="#L-1794"><span class="linenos">1794</span></a>    <span class="p">(</span><span class="s1">&#39;d</span><span class="se">\\</span><span class="s1">textltilde</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="L-1795"><a href="#L-1795"><span class="linenos">1795</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1796"><a href="#L-1796"><span class="linenos">1796</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1797"><a href="#L-1797"><span class="linenos">1797</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1798"><a href="#L-1798"><span class="linenos">1798</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1799"><a href="#L-1799"><span class="linenos">1799</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1800"><a href="#L-1800"><span class="linenos">1800</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="L-1801"><a href="#L-1801"><span class="linenos">1801</span></a>    <span class="p">(</span><span class="s1">&#39;@0&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="L-1802"><a href="#L-1802"><span class="linenos">1802</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1803"><a href="#L-1803"><span class="linenos">1803</span></a>    <span class="p">(</span><span class="s1">&#39;oI&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1804"><a href="#L-1804"><span class="linenos">1804</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1805"><a href="#L-1805"><span class="linenos">1805</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1806"><a href="#L-1806"><span class="linenos">1806</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1807"><a href="#L-1807"><span class="linenos">1807</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1808"><a href="#L-1808"><span class="linenos">1808</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1809"><a href="#L-1809"><span class="linenos">1809</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1810"><a href="#L-1810"><span class="linenos">1810</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="L-1811"><a href="#L-1811"><span class="linenos">1811</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="L-1812"><a href="#L-1812"><span class="linenos">1812</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1813"><a href="#L-1813"><span class="linenos">1813</span></a>    <span class="p">(</span><span class="s1">&#39;U</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="L-1814"><a href="#L-1814"><span class="linenos">1814</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="L-1815"><a href="#L-1815"><span class="linenos">1815</span></a>    <span class="p">(</span><span class="s1">&#39;0:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1816"><a href="#L-1816"><span class="linenos">1816</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1817"><a href="#L-1817"><span class="linenos">1817</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1818"><a href="#L-1818"><span class="linenos">1818</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1819"><a href="#L-1819"><span class="linenos">1819</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1820"><a href="#L-1820"><span class="linenos">1820</span></a>    <span class="p">(</span><span class="s1">&#39;o:&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="L-1821"><a href="#L-1821"><span class="linenos">1821</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="L-1822"><a href="#L-1822"><span class="linenos">1822</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1823"><a href="#L-1823"><span class="linenos">1823</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textturnw</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="L-1824"><a href="#L-1824"><span class="linenos">1824</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1825"><a href="#L-1825"><span class="linenos">1825</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1826"><a href="#L-1826"><span class="linenos">1826</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="L-1827"><a href="#L-1827"><span class="linenos">1827</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="L-1828"><a href="#L-1828"><span class="linenos">1828</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-ipa.tex&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-1829"><a href="#L-1829"><span class="linenos">1829</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
</span><span id="L-1830"><a href="#L-1830"><span class="linenos">1830</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\documentclass[12pt,a4paper]</span><span class="si">{article}</span><span class="s1"> \usepackage[safe]</span><span class="si">{tipa}</span><span class="s1"> \usepackage</span><span class="si">{longtable}</span><span class="s1"> \begin</span><span class="si">{document}</span><span class="s1"> \begin</span><span class="si">{longtable}{ll}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="L-1831"><a href="#L-1831"><span class="linenos">1831</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &amp; \textipa{</span><span class="si">%s</span><span class="s2">}</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1832"><a href="#L-1832"><span class="linenos">1832</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{longtable}</span><span class="s2">\end</span><span class="si">{document}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1833"><a href="#L-1833"><span class="linenos">1833</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">textipa{</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="p">,</span>
</span><span id="L-1834"><a href="#L-1834"><span class="linenos">1834</span></a>    <span class="n">inline_oneoff_header</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;% In preamble, put \usepackage[safe]</span><span class="si">{tipa}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># (the [safe] part is recommended if you&#39;re mixing with other TeX)</span>
</span><span id="L-1835"><a href="#L-1835"><span class="linenos">1835</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1836"><a href="#L-1836"><span class="linenos">1836</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1837"><a href="#L-1837"><span class="linenos">1837</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1838"><a href="#L-1838"><span class="linenos">1838</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1839"><a href="#L-1839"><span class="linenos">1839</span></a>  <span class="p">),</span>
</span><span id="L-1840"><a href="#L-1840"><span class="linenos">1840</span></a>
</span><span id="L-1841"><a href="#L-1841"><span class="linenos">1841</span></a>  <span class="s2">&quot;pinyin-approx&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1842"><a href="#L-1842"><span class="linenos">1842</span></a>    <span class="s2">&quot;Rough approximation using roughly the spelling rules of Chinese Pinyin (for getting Chinese-only voices to speak some English words - works with some words better than others)&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-1843"><a href="#L-1843"><span class="linenos">1843</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1844"><a href="#L-1844"><span class="linenos">1844</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="L-1845"><a href="#L-1845"><span class="linenos">1845</span></a>    <span class="p">(</span><span class="s1">&#39;a5&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="L-1846"><a href="#L-1846"><span class="linenos">1846</span></a>    <span class="p">(</span><span class="s1">&#39;ya5&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1847"><a href="#L-1847"><span class="linenos">1847</span></a>    <span class="p">(</span><span class="s1">&#39;e5&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="L-1848"><a href="#L-1848"><span class="linenos">1848</span></a>    <span class="p">(</span><span class="s1">&#39;yo5&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1849"><a href="#L-1849"><span class="linenos">1849</span></a>    <span class="p">(</span><span class="s1">&#39;ao5&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="L-1850"><a href="#L-1850"><span class="linenos">1850</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;e5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1851"><a href="#L-1851"><span class="linenos">1851</span></a>    <span class="p">(</span><span class="s1">&#39;ai5&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="L-1852"><a href="#L-1852"><span class="linenos">1852</span></a>    <span class="p">(</span><span class="s1">&#39;bu0&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="L-1853"><a href="#L-1853"><span class="linenos">1853</span></a>    <span class="p">(</span><span class="s1">&#39;che0&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="L-1854"><a href="#L-1854"><span class="linenos">1854</span></a>    <span class="p">(</span><span class="s1">&#39;de0&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="L-1855"><a href="#L-1855"><span class="linenos">1855</span></a>    <span class="p">(</span><span class="s1">&#39;ze0&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="L-1856"><a href="#L-1856"><span class="linenos">1856</span></a>    <span class="p">(</span><span class="s1">&#39;ye5&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1857"><a href="#L-1857"><span class="linenos">1857</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;ye5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1858"><a href="#L-1858"><span class="linenos">1858</span></a>    <span class="p">(</span><span class="s1">&#39;ei5&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="L-1859"><a href="#L-1859"><span class="linenos">1859</span></a>    <span class="p">(</span><span class="s1">&#39;fu0&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1860"><a href="#L-1860"><span class="linenos">1860</span></a>    <span class="p">(</span><span class="s1">&#39;ge0&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1861"><a href="#L-1861"><span class="linenos">1861</span></a>    <span class="p">(</span><span class="s1">&#39;he0&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="L-1862"><a href="#L-1862"><span class="linenos">1862</span></a>    <span class="p">(</span><span class="s1">&#39;yi5&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="L-1863"><a href="#L-1863"><span class="linenos">1863</span></a>    <span class="p">(</span><span class="s1">&#39;yi3re5&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="L-1864"><a href="#L-1864"><span class="linenos">1864</span></a>    <span class="p">(</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="s1">&#39;yi5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1865"><a href="#L-1865"><span class="linenos">1865</span></a>    <span class="p">(</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="L-1866"><a href="#L-1866"><span class="linenos">1866</span></a>    <span class="p">(</span><span class="s1">&#39;ke0&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1867"><a href="#L-1867"><span class="linenos">1867</span></a>    <span class="p">(</span><span class="s1">&#39;le0&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="L-1868"><a href="#L-1868"><span class="linenos">1868</span></a>    <span class="p">(</span><span class="s1">&#39;me0&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1869"><a href="#L-1869"><span class="linenos">1869</span></a>    <span class="p">(</span><span class="s1">&#39;ne0&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1870"><a href="#L-1870"><span class="linenos">1870</span></a>    <span class="p">(</span><span class="s1">&#39;eng0&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1871"><a href="#L-1871"><span class="linenos">1871</span></a>    <span class="p">(</span><span class="s1">&#39;ou5&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="L-1872"><a href="#L-1872"><span class="linenos">1872</span></a>    <span class="p">(</span><span class="s1">&#39;ruo2yi5&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="L-1873"><a href="#L-1873"><span class="linenos">1873</span></a>    <span class="p">(</span><span class="s1">&#39;pu0&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1874"><a href="#L-1874"><span class="linenos">1874</span></a>    <span class="p">(</span><span class="s1">&#39;re0&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="L-1875"><a href="#L-1875"><span class="linenos">1875</span></a>    <span class="p">(</span><span class="s1">&#39;se0&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1876"><a href="#L-1876"><span class="linenos">1876</span></a>    <span class="p">(</span><span class="s1">&#39;she0&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1877"><a href="#L-1877"><span class="linenos">1877</span></a>    <span class="p">(</span><span class="s1">&#39;te0&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1878"><a href="#L-1878"><span class="linenos">1878</span></a>    <span class="p">(</span><span class="n">th_as_in_think</span><span class="p">,</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1879"><a href="#L-1879"><span class="linenos">1879</span></a>    <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;wu5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1880"><a href="#L-1880"><span class="linenos">1880</span></a>    <span class="p">(</span><span class="s1">&#39;yu5&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1881"><a href="#L-1881"><span class="linenos">1881</span></a>    <span class="p">(</span><span class="s1">&#39;huo5&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="L-1882"><a href="#L-1882"><span class="linenos">1882</span></a>    <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;fu0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1883"><a href="#L-1883"><span class="linenos">1883</span></a>    <span class="p">(</span><span class="s1">&#39;wu0&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="L-1884"><a href="#L-1884"><span class="linenos">1884</span></a>    <span class="p">(</span><span class="s1">&#39;yu0&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1885"><a href="#L-1885"><span class="linenos">1885</span></a>    <span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="s1">&#39;ze0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1886"><a href="#L-1886"><span class="linenos">1886</span></a>    <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1887"><a href="#L-1887"><span class="linenos">1887</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="L-1888"><a href="#L-1888"><span class="linenos">1888</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-pinyin-approx.txt&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="L-1889"><a href="#L-1889"><span class="linenos">1889</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="L-1890"><a href="#L-1890"><span class="linenos">1890</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;Pinyin approxmations (very approximate!)</span><span class="se">\n</span><span class="s2">----------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1891"><a href="#L-1891"><span class="linenos">1891</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ~= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1892"><a href="#L-1892"><span class="linenos">1892</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1893"><a href="#L-1893"><span class="linenos">1893</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="L-1894"><a href="#L-1894"><span class="linenos">1894</span></a>      <span class="p">(</span><span class="s2">&quot;te0ye&quot;</span><span class="p">,</span><span class="s2">&quot;tie&quot;</span><span class="p">),</span>
</span><span id="L-1895"><a href="#L-1895"><span class="linenos">1895</span></a>      <span class="p">(</span><span class="s2">&quot;e0e5&quot;</span><span class="p">,</span><span class="s2">&quot;e5&quot;</span><span class="p">),(</span><span class="s2">&quot;([^aeiou][uo])0e(5)&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1\2&quot;</span><span class="p">),</span>
</span><span id="L-1896"><a href="#L-1896"><span class="linenos">1896</span></a>      <span class="p">(</span><span class="s2">&quot;yu0y&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">),</span>
</span><span id="L-1897"><a href="#L-1897"><span class="linenos">1897</span></a>      <span class="p">(</span><span class="s2">&quot;wu0yo5&quot;</span><span class="p">,</span><span class="s2">&quot;wo5&quot;</span><span class="p">),</span>
</span><span id="L-1898"><a href="#L-1898"><span class="linenos">1898</span></a>      <span class="p">(</span><span class="s2">&quot;([bdfghklmnpwz])[euo]0ei&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ei&quot;</span><span class="p">),</span>
</span><span id="L-1899"><a href="#L-1899"><span class="linenos">1899</span></a>      <span class="p">(</span><span class="s2">&quot;([bdghklmnpstwz])[euo]0ai&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ai&quot;</span><span class="p">),</span>
</span><span id="L-1900"><a href="#L-1900"><span class="linenos">1900</span></a>      <span class="p">(</span><span class="s2">&quot;([ghklmnpstyz])[euo]0ya&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1a&quot;</span><span class="p">),(</span><span class="s2">&quot;([ghklmnpstz])a([0-5]*)ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1an\2&quot;</span><span class="p">),</span>
</span><span id="L-1901"><a href="#L-1901"><span class="linenos">1901</span></a>      <span class="p">(</span><span class="s2">&quot;([bdfghklmnpstwyz])[euo]0a([1-5])&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1a\2&quot;</span><span class="p">),</span>
</span><span id="L-1902"><a href="#L-1902"><span class="linenos">1902</span></a>      <span class="p">(</span><span class="s2">&quot;([bdjlmnpt])[euo]0yi&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1i&quot;</span><span class="p">),(</span><span class="s2">&quot;([bjlmnp])i([1-5]*)ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1in\2&quot;</span><span class="p">),</span>
</span><span id="L-1903"><a href="#L-1903"><span class="linenos">1903</span></a>      <span class="p">(</span><span class="s2">&quot;([zs])he0ei&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1hei&quot;</span><span class="p">),</span>
</span><span id="L-1904"><a href="#L-1904"><span class="linenos">1904</span></a>      <span class="p">(</span><span class="s2">&quot;([dfghklmnprstyz])[euo]0ou&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ou&quot;</span><span class="p">),</span>
</span><span id="L-1905"><a href="#L-1905"><span class="linenos">1905</span></a>      <span class="p">(</span><span class="s2">&quot;([dghklnrst])[euo]0huo&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1uo&quot;</span><span class="p">),</span>
</span><span id="L-1906"><a href="#L-1906"><span class="linenos">1906</span></a>      <span class="p">(</span><span class="s2">&quot;([bfpm])[euo]0huo&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1o&quot;</span><span class="p">),</span>
</span><span id="L-1907"><a href="#L-1907"><span class="linenos">1907</span></a>      <span class="p">(</span><span class="s2">&quot;([bdghklmnprstyz])[euo]0ao&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ao&quot;</span><span class="p">),</span>
</span><span id="L-1908"><a href="#L-1908"><span class="linenos">1908</span></a>      <span class="p">(</span><span class="s2">&quot;([zcs])h[eu]0ao&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1hao&quot;</span><span class="p">),</span>
</span><span id="L-1909"><a href="#L-1909"><span class="linenos">1909</span></a>      <span class="p">(</span><span class="s2">&quot;re0r&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>
</span><span id="L-1910"><a href="#L-1910"><span class="linenos">1910</span></a>      <span class="p">(</span><span class="s2">&quot;zhe0ne0&quot;</span><span class="p">,</span><span class="s2">&quot;zhun5&quot;</span><span class="p">),</span>
</span><span id="L-1911"><a href="#L-1911"><span class="linenos">1911</span></a>      <span class="p">(</span><span class="s2">&quot;54&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">),</span>
</span><span id="L-1912"><a href="#L-1912"><span class="linenos">1912</span></a>      <span class="p">(</span><span class="s2">&quot;52&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">),</span>
</span><span id="L-1913"><a href="#L-1913"><span class="linenos">1913</span></a>      <span class="p">(</span><span class="s2">&quot;([bdjlmnpty])i([1-9])eng0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ing\2&quot;</span><span class="p">),</span>
</span><span id="L-1914"><a href="#L-1914"><span class="linenos">1914</span></a>      <span class="p">(</span><span class="s2">&quot;ya([1-9])eng0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yang\1&quot;</span><span class="p">),</span>
</span><span id="L-1915"><a href="#L-1915"><span class="linenos">1915</span></a>      <span class="p">(</span><span class="s2">&quot;ya([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;an\1&quot;</span><span class="p">),</span>
</span><span id="L-1916"><a href="#L-1916"><span class="linenos">1916</span></a>      <span class="p">(</span><span class="s2">&quot;ye([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yan\1&quot;</span><span class="p">),(</span><span class="s2">&quot;([wr])[eu]0yan&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1en&quot;</span><span class="p">),</span>
</span><span id="L-1917"><a href="#L-1917"><span class="linenos">1917</span></a>      <span class="p">(</span><span class="s2">&quot;yi([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yin\1&quot;</span><span class="p">),</span>
</span><span id="L-1918"><a href="#L-1918"><span class="linenos">1918</span></a>      
</span><span id="L-1919"><a href="#L-1919"><span class="linenos">1919</span></a>      <span class="p">(</span><span class="s2">&quot;yu0&quot;</span><span class="p">,</span><span class="s2">&quot;yu5&quot;</span><span class="p">),(</span><span class="s2">&quot;eng0&quot;</span><span class="p">,</span><span class="s2">&quot;eng5&quot;</span><span class="p">),</span> <span class="c1"># they won&#39;t work unvoiced anyway</span>
</span><span id="L-1920"><a href="#L-1920"><span class="linenos">1920</span></a>      <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">),</span> <span class="c1"># comment out if the synth supports &#39;tone 0 for unvoiced&#39;</span>
</span><span id="L-1921"><a href="#L-1921"><span class="linenos">1921</span></a>      <span class="c1">#(&quot;[euo]0&quot;,&quot;0&quot;), # comment in if it expects consonants only when doing that</span>
</span><span id="L-1922"><a href="#L-1922"><span class="linenos">1922</span></a>    <span class="p">],</span>
</span><span id="L-1923"><a href="#L-1923"><span class="linenos">1923</span></a>  <span class="p">),</span>
</span><span id="L-1924"><a href="#L-1924"><span class="linenos">1924</span></a>
</span><span id="L-1925"><a href="#L-1925"><span class="linenos">1925</span></a>  <span class="s2">&quot;kana-approx&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-1926"><a href="#L-1926"><span class="linenos">1926</span></a>  <span class="s2">&quot;Rough approximation using kana (for getting Japanese computer voices to speak some English words - works with some words better than others).  Set KANA_TYPE environment variable to hiragana or katakana (which can affect the sounds of some voices); default is hiragana&quot;</span><span class="p">,</span> <span class="c1"># for example on Mac OS 10.7+ (with Japanese voice installed in System Preferences) try PHONES_PIPE_COMMAND=&#39;say -v Kyoko&#39; (this voice has a built-in converter from English as well, but lexconvert --phones kana-approx can work better with some complex words, although the built-in converter does seem to have access to slightly more phonemes and can therefore produce words like &quot;to&quot; better).  Default is hiragana because I find hiragana easier to read than katakana, although the Kyoko voice does seem to be able to say &#39;v&#39; a little better when using kata.  Mac OS 10.7+&#39;s Korean voices (Yuna and Narae) can also read kana, and you could try doing a makeVariantDic and adding in some Korean jamo letters for them (you&#39;d be pushed to represent everything in jamo but kana+jamo seems more hopeful in theory), but again some words work better than others (not all phonetic combinations are supported and some words aren&#39;t clear at all).</span>
</span><span id="L-1927"><a href="#L-1927"><span class="linenos">1927</span></a>    <span class="c1"># This kana-approx format is &#39;write-only&#39; for now (see comment in cleanup_regexps re possible reversal)</span>
</span><span id="L-1928"><a href="#L-1928"><span class="linenos">1928</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="L-1929"><a href="#L-1929"><span class="linenos">1929</span></a>    <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;KANA_MORE_EMPH&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># set KANA_MORE_EMPH environment variable if you want to try doubling the secondary-stressed vowels as well (doesn&#39;t always work very well; if it did, I&#39;d put this line in a makeVariantDic called kana-approx-moreEmph or something)</span>
</span><span id="L-1930"><a href="#L-1930"><span class="linenos">1930</span></a>    <span class="c1"># The following Unicode codepoints are hiragana; KANA_TYPE is handled by cleanup_func below</span>
</span><span id="L-1931"><a href="#L-1931"><span class="linenos">1931</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="L-1932"><a href="#L-1932"><span class="linenos">1932</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="L-1933"><a href="#L-1933"><span class="linenos">1933</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="L-1934"><a href="#L-1934"><span class="linenos">1934</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="L-1935"><a href="#L-1935"><span class="linenos">1935</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="L-1936"><a href="#L-1936"><span class="linenos">1936</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span> <span class="c1"># ai</span>
</span><span id="L-1937"><a href="#L-1937"><span class="linenos">1937</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span> <span class="c1"># ao</span>
</span><span id="L-1938"><a href="#L-1938"><span class="linenos">1938</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span> <span class="c1"># ei</span>
</span><span id="L-1939"><a href="#L-1939"><span class="linenos">1939</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span> <span class="c1"># oi</span>
</span><span id="L-1940"><a href="#L-1940"><span class="linenos">1940</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span> <span class="c1"># ou</span>
</span><span id="L-1941"><a href="#L-1941"><span class="linenos">1941</span></a>    <span class="p">(</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1942"><a href="#L-1942"><span class="linenos">1942</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: \u3042, \u304a or \u3046 depending on the word?</span>
</span><span id="L-1943"><a href="#L-1943"><span class="linenos">1943</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1944"><a href="#L-1944"><span class="linenos">1944</span></a>    <span class="p">(</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1945"><a href="#L-1945"><span class="linenos">1945</span></a>    <span class="p">(</span><span class="n">u_as_in_but</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1946"><a href="#L-1946"><span class="linenos">1946</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1947"><a href="#L-1947"><span class="linenos">1947</span></a>    <span class="p">(</span><span class="n">ear</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1948"><a href="#L-1948"><span class="linenos">1948</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1949"><a href="#L-1949"><span class="linenos">1949</span></a>    <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1950"><a href="#L-1950"><span class="linenos">1950</span></a>    <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="L-1951"><a href="#L-1951"><span class="linenos">1951</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3076</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="c1"># bu (with vowel replacements later)</span>
</span><span id="L-1952"><a href="#L-1952"><span class="linenos">1952</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3061\u3047</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span> <span class="c1"># chu (ditto)</span>
</span><span id="L-1953"><a href="#L-1953"><span class="linenos">1953</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3065</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="c1"># du (and so on)</span>
</span><span id="L-1954"><a href="#L-1954"><span class="linenos">1954</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span> <span class="p">(</span><span class="n">th_as_in_them</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1955"><a href="#L-1955"><span class="linenos">1955</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3075</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="L-1956"><a href="#L-1956"><span class="linenos">1956</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="L-1957"><a href="#L-1957"><span class="linenos">1957</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u306f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="c1"># ha (as hu == fu)</span>
</span><span id="L-1958"><a href="#L-1958"><span class="linenos">1958</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3058\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span> <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3058\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1959"><a href="#L-1959"><span class="linenos">1959</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="L-1960"><a href="#L-1960"><span class="linenos">1960</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308b</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="L-1961"><a href="#L-1961"><span class="linenos">1961</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3080</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="L-1962"><a href="#L-1962"><span class="linenos">1962</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u306c</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="L-1963"><a href="#L-1963"><span class="linenos">1963</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3093\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="L-1964"><a href="#L-1964"><span class="linenos">1964</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3077</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="L-1965"><a href="#L-1965"><span class="linenos">1965</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3059</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="L-1966"><a href="#L-1966"><span class="linenos">1966</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3057\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="L-1967"><a href="#L-1967"><span class="linenos">1967</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3064</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="L-1968"><a href="#L-1968"><span class="linenos">1968</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="c1"># use &#39;wa&#39; (as &#39;wu&#39; == &#39;u&#39;)</span>
</span><span id="L-1969"><a href="#L-1969"><span class="linenos">1969</span></a>    <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;KANA_V_AS_W&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308f</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3094</span><span class="s1">&#39;</span><span class="p">),</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: document KANA_V_AS_W variable.  Is vu always supported? (it doesn&#39;t seem to show up in all fonts)</span>
</span><span id="L-1970"><a href="#L-1970"><span class="linenos">1970</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3086</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="L-1971"><a href="#L-1971"><span class="linenos">1971</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u305a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="L-1972"><a href="#L-1972"><span class="linenos">1972</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-kana-approx.txt&quot;</span><span class="p">,</span>
</span><span id="L-1973"><a href="#L-1973"><span class="linenos">1973</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="L-1974"><a href="#L-1974"><span class="linenos">1974</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;Kana approxmations (very approximate!)</span><span class="se">\n</span><span class="s2">--------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1975"><a href="#L-1975"><span class="linenos">1975</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ~= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="L-1976"><a href="#L-1976"><span class="linenos">1976</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="L-1977"><a href="#L-1977"><span class="linenos">1977</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3002\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="L-1978"><a href="#L-1978"><span class="linenos">1978</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c</span><span class="s2">$&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3093\u30fc</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># TODO: or u&quot;\u3093\u3093&quot; ?</span>
</span><span id="L-1979"><a href="#L-1979"><span class="linenos">1979</span></a>       <span class="c1"># now the vowel replacements (bu+a -&gt; ba, etc) (in most cases these can be reversed into cvtOut_regexps if you want to use the kana-approx table to convert hiragana into approximate English phonemes (plus add a (u&quot;\u3093\u30fc*&quot;,u&quot;\u306c&quot;) and perhaps de-doubling rules to convert back to emphasis) but the result is unlikely to be any good)</span>
</span><span id="L-1980"><a href="#L-1980"><span class="linenos">1980</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3070</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3073</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3079</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1981"><a href="#L-1981"><span class="linenos">1981</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1982"><a href="#L-1982"><span class="linenos">1982</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3060</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3062</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3067</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3069</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1983"><a href="#L-1983"><span class="linenos">1983</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3043\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3087</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1984"><a href="#L-1984"><span class="linenos">1984</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3041</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3049</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1985"><a href="#L-1985"><span class="linenos">1985</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3072</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3078</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1986"><a href="#L-1986"><span class="linenos">1986</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3052</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3054</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1987"><a href="#L-1987"><span class="linenos">1987</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1988"><a href="#L-1988"><span class="linenos">1988</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3051</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3053</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1989"><a href="#L-1989"><span class="linenos">1989</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3089</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1990"><a href="#L-1990"><span class="linenos">1990</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307f</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3081</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3082</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1991"><a href="#L-1991"><span class="linenos">1991</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1992"><a href="#L-1992"><span class="linenos">1992</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3071</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3074</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1993"><a href="#L-1993"><span class="linenos">1993</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3055</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1994"><a href="#L-1994"><span class="linenos">1994</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1995"><a href="#L-1995"><span class="linenos">1995</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305f</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3068</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1996"><a href="#L-1996"><span class="linenos">1996</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3084</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3044\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3088</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1997"><a href="#L-1997"><span class="linenos">1997</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3056</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1998"><a href="#L-1998"><span class="linenos">1998</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3092</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="L-1999"><a href="#L-1999"><span class="linenos">1999</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u3043\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u3043\u3065</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># sounds a bit better for words like &#39;with&#39;</span>
</span><span id="L-2000"><a href="#L-2000"><span class="linenos">2000</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3085\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3085</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># and &#39;the&#39; (especially with a_as_in_ago mapping to u&#39;\u3046\u304a&#39;; it&#39;s hard to get a convincing &#39;the&#39; though, especially in isolation)</span>
</span><span id="L-2001"><a href="#L-2001"><span class="linenos">2001</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># gugu -&gt; gu, sometimes comes up with &#39;gl-&#39; combinations</span>
</span><span id="L-2002"><a href="#L-2002"><span class="linenos">2002</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc\u30fc</span><span class="s1">+&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># in case we put 30fc in the table AND a stress mark has been applied to it</span>
</span><span id="L-2003"><a href="#L-2003"><span class="linenos">2003</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;^(.)$&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">1</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># lengthen any word that ends up as a single kana (otherwise can be clipped badly)</span>
</span><span id="L-2004"><a href="#L-2004"><span class="linenos">2004</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;^([</span><span class="se">\u3042\u3070\u3060\u304c\u304b\u3089\u307e\u306a\u3071\u3055\u305f\u3084\u3056\u308f</span><span class="s1">]</span><span class="se">\u3044</span><span class="s1">)$&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">1</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># ditto for -ai (TODO: -ao might need lengthening sometimes?? depends on context.  -ei, -oi, -ou seem OK)</span>
</span><span id="L-2005"><a href="#L-2005"><span class="linenos">2005</span></a>    <span class="p">],</span>
</span><span id="L-2006"><a href="#L-2006"><span class="linenos">2006</span></a>    <span class="n">cleanup_func</span> <span class="o">=</span> <span class="n">hiragana_to_katakana</span>
</span><span id="L-2007"><a href="#L-2007"><span class="linenos">2007</span></a>  <span class="p">),</span>
</span><span id="L-2008"><a href="#L-2008"><span class="linenos">2008</span></a>  <span class="s2">&quot;names&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="L-2009"><a href="#L-2009"><span class="linenos">2009</span></a>    <span class="s2">&quot;Lexconvert internal phoneme names (sometimes useful with the --phones option while developing new formats)&quot;</span><span class="p">,</span>
</span><span id="L-2010"><a href="#L-2010"><span class="linenos">2010</span></a>     <span class="o">*</span><span class="p">[(</span><span class="n">phName</span><span class="p">,</span><span class="n">phVal</span><span class="p">)</span> <span class="k">for</span> <span class="n">phName</span><span class="p">,</span><span class="n">phVal</span> <span class="ow">in</span> <span class="n">phonemes</span><span class="o">.</span><span class="n">items</span><span class="p">()])}</span>
</span><span id="L-2011"><a href="#L-2011"><span class="linenos">2011</span></a>
</span><span id="L-2012"><a href="#L-2012"><span class="linenos">2012</span></a><span class="c1"># The mainopt_...() functions are the main options</span>
</span><span id="L-2013"><a href="#L-2013"><span class="linenos">2013</span></a><span class="c1"># (if you implement a new one, main() will detect it);</span>
</span><span id="L-2014"><a href="#L-2014"><span class="linenos">2014</span></a><span class="c1"># 1st line of doc string should be parameter summary</span>
</span><span id="L-2015"><a href="#L-2015"><span class="linenos">2015</span></a><span class="c1"># (start the doc string with \n if no parameters); if 1st</span>
</span><span id="L-2016"><a href="#L-2016"><span class="linenos">2016</span></a><span class="c1"># character of doc string is * then this function is put</span>
</span><span id="L-2017"><a href="#L-2017"><span class="linenos">2017</span></a><span class="c1"># among the first in the help (otherwise alphabetically).</span>
</span><span id="L-2018"><a href="#L-2018"><span class="linenos">2018</span></a><span class="c1"># If function returns a string, that&#39;s taken to be a</span>
</span><span id="L-2019"><a href="#L-2019"><span class="linenos">2019</span></a><span class="c1"># message to be printed with error exit.  Same if it raises</span>
</span><span id="L-2020"><a href="#L-2020"><span class="linenos">2020</span></a><span class="c1"># an exception of type Message.</span>
</span><span id="L-2021"><a href="#L-2021"><span class="linenos">2021</span></a>
</span><span id="L-2022"><a href="#L-2022"><span class="linenos">2022</span></a><span class="k">def</span> <span class="nf">mainopt_try</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2023"><a href="#L-2023"><span class="linenos">2023</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="L-2024"><a href="#L-2024"><span class="linenos">2024</span></a><span class="sd">Convert input from &lt;format&gt; into eSpeak and try it out.</span>
</span><span id="L-2025"><a href="#L-2025"><span class="linenos">2025</span></a><span class="sd">(Requires the &#39;espeak&#39; command.)</span>
</span><span id="L-2026"><a href="#L-2026"><span class="linenos">2026</span></a><span class="sd">E.g.: python lexconvert.py --try festival h @0 l ou1</span>
</span><span id="L-2027"><a href="#L-2027"><span class="linenos">2027</span></a><span class="sd"> or: python lexconvert.py --try unicode-ipa &#39;\\u02c8\\u0279\\u026adn\\u0329&#39; (for Unicode put &#39;\\uNNNN&#39; or UTF-8)&quot;&quot;&quot;</span>
</span><span id="L-2028"><a href="#L-2028"><span class="linenos">2028</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2029"><a href="#L-2029"><span class="linenos">2029</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2030"><a href="#L-2030"><span class="linenos">2030</span></a>   <span class="k">for</span> <span class="n">phones</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="L-2031"><a href="#L-2031"><span class="linenos">2031</span></a>      <span class="n">espeak</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">phones</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;espeak&#39;</span><span class="p">)</span>
</span><span id="L-2032"><a href="#L-2032"><span class="linenos">2032</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -x&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2033"><a href="#L-2033"><span class="linenos">2033</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">espeak</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="c1"># separate process each item for more responsiveness from the console (sending &#39;maybe&#39; to getInputText means won&#39;t lose efficiency if not read from console)</span>
</span><span id="L-2034"><a href="#L-2034"><span class="linenos">2034</span></a>
</span><span id="L-2035"><a href="#L-2035"><span class="linenos">2035</span></a><span class="k">def</span> <span class="nf">mainopt_trymac</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2036"><a href="#L-2036"><span class="linenos">2036</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="L-2037"><a href="#L-2037"><span class="linenos">2037</span></a><span class="sd">Convert phonemes from &lt;format&gt; into Mac and try it using the Mac OS &#39;say&#39; command&quot;&quot;&quot;</span>
</span><span id="L-2038"><a href="#L-2038"><span class="linenos">2038</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2039"><a href="#L-2039"><span class="linenos">2039</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2040"><a href="#L-2040"><span class="linenos">2040</span></a>   <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="L-2041"><a href="#L-2041"><span class="linenos">2041</span></a>      <span class="n">mac</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
</span><span id="L-2042"><a href="#L-2042"><span class="linenos">2042</span></a>      <span class="n">toSay</span> <span class="o">=</span> <span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;mac&quot;</span><span class="p">,</span><span class="n">mac</span><span class="p">)</span>
</span><span id="L-2043"><a href="#L-2043"><span class="linenos">2043</span></a>      <span class="nb">print</span><span class="p">(</span><span class="n">as_printable</span><span class="p">(</span><span class="n">toSay</span><span class="p">))</span>
</span><span id="L-2044"><a href="#L-2044"><span class="linenos">2044</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v Vicki&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2045"><a href="#L-2045"><span class="linenos">2045</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">toSay</span><span class="p">)</span> <span class="c1"># Need to specify a voice because the default voice might not be able to take Apple phonemes.  Vicki has been available since 10.3, as has the &#39;say&#39; command (previous versions need osascript, see Gradint&#39;s code)</span>
</span><span id="L-2046"><a href="#L-2046"><span class="linenos">2046</span></a>
</span><span id="L-2047"><a href="#L-2047"><span class="linenos">2047</span></a><span class="k">def</span> <span class="nf">mainopt_trymac_uk</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2048"><a href="#L-2048"><span class="linenos">2048</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="L-2049"><a href="#L-2049"><span class="linenos">2049</span></a><span class="sd">Convert phonemes from &lt;format&gt; and try it with Mac OS British voices (see --mac-uk for details)&quot;&quot;&quot;</span>
</span><span id="L-2050"><a href="#L-2050"><span class="linenos">2050</span></a>   <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;--trymac-uk has not been tested with Python 3, I don&#39;t want to risk messing up your system files, please use Python 2&quot;</span>
</span><span id="L-2051"><a href="#L-2051"><span class="linenos">2051</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2052"><a href="#L-2052"><span class="linenos">2052</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2053"><a href="#L-2053"><span class="linenos">2053</span></a>   <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="L-2054"><a href="#L-2054"><span class="linenos">2054</span></a>     <span class="n">macuk</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;mac-uk&#39;</span><span class="p">)</span>
</span><span id="L-2055"><a href="#L-2055"><span class="linenos">2055</span></a>     <span class="n">m</span> <span class="o">=</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span>
</span><span id="L-2056"><a href="#L-2056"><span class="linenos">2056</span></a>     <span class="k">try</span><span class="p">:</span>
</span><span id="L-2057"><a href="#L-2057"><span class="linenos">2057</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">speakPhones</span><span class="p">(</span><span class="n">macuk</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="L-2058"><a href="#L-2058"><span class="linenos">2058</span></a>      <span class="k">finally</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2059"><a href="#L-2059"><span class="linenos">2059</span></a>     <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="L-2060"><a href="#L-2060"><span class="linenos">2060</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interrupted</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2061"><a href="#L-2061"><span class="linenos">2061</span></a>
</span><span id="L-2062"><a href="#L-2062"><span class="linenos">2062</span></a><span class="k">def</span> <span class="nf">mainopt_phones</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2063"><a href="#L-2063"><span class="linenos">2063</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;words&gt;]</span>
</span><span id="L-2064"><a href="#L-2064"><span class="linenos">2064</span></a><span class="sd">Use eSpeak to convert text to phonemes, and then convert the phonemes to format &#39;format&#39;.</span>
</span><span id="L-2065"><a href="#L-2065"><span class="linenos">2065</span></a><span class="sd">E.g.: python lexconvert.py --phones unicode-ipa This is a test sentence.</span>
</span><span id="L-2066"><a href="#L-2066"><span class="linenos">2066</span></a><span class="sd">Set environment variable PHONES_PIPE_COMMAND to an additional command to which to write the phones as well as standard output.  (If standard input is a terminal then this will be done separately after each line.)</span>
</span><span id="L-2067"><a href="#L-2067"><span class="linenos">2067</span></a><span class="sd">(Some commercial speech synthesizers do not work well when driven entirely from phonemes, because their internal format is different and is optimised for normal text.)</span>
</span><span id="L-2068"><a href="#L-2068"><span class="linenos">2068</span></a><span class="sd">Set format to &#39;all&#39; if you want to see the phonemes in ALL supported formats.&quot;&quot;&quot;</span>
</span><span id="L-2069"><a href="#L-2069"><span class="linenos">2069</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2070"><a href="#L-2070"><span class="linenos">2070</span></a>   <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The &#39;example&#39; format cannot be used with --phones; try --convert, or did you mean --phones festival&quot;</span> <span class="c1"># could allow example anyway as it&#39;s basically Festival, but save confusion as eSpeak might not generate the same phonemes if our example words haven&#39;t been installed in the system&#39;s eSpeak.  (Still allow it to be used in --try etc though.)</span>
</span><span id="L-2071"><a href="#L-2071"><span class="linenos">2071</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2072"><a href="#L-2072"><span class="linenos">2072</span></a>   <span class="n">hadOneoff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2073"><a href="#L-2073"><span class="linenos">2073</span></a>   <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="L-2074"><a href="#L-2074"><span class="linenos">2074</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)))</span> <span class="c1"># (remove any 2032 and b7 pronunciation marks before passing to eSpeak)</span>
</span><span id="L-2075"><a href="#L-2075"><span class="linenos">2075</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="L-2076"><a href="#L-2076"><span class="linenos">2076</span></a>    <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</span><span id="L-2077"><a href="#L-2077"><span class="linenos">2077</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="nb">format</span><span class="p">]</span>
</span><span id="L-2078"><a href="#L-2078"><span class="linenos">2078</span></a>    <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
</span><span id="L-2079"><a href="#L-2079"><span class="linenos">2079</span></a>       <span class="k">def</span> <span class="nf">out</span><span class="p">(</span><span class="n">doOneoff</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-2080"><a href="#L-2080"><span class="linenos">2080</span></a>          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">writeFormatHeader</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="L-2081"><a href="#L-2081"><span class="linenos">2081</span></a>          <span class="k">if</span> <span class="n">doOneoff</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_oneoff_header&quot;</span><span class="p">)))</span>
</span><span id="L-2082"><a href="#L-2082"><span class="linenos">2082</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_header&quot;</span><span class="p">)))</span>
</span><span id="L-2083"><a href="#L-2083"><span class="linenos">2083</span></a>          <span class="n">output_clauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">response</span><span class="p">),</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="nb">format</span><span class="p">))</span>
</span><span id="L-2084"><a href="#L-2084"><span class="linenos">2084</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_footer&quot;</span><span class="p">)))</span>
</span><span id="L-2085"><a href="#L-2085"><span class="linenos">2085</span></a>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2086"><a href="#L-2086"><span class="linenos">2086</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># in case it&#39;s being piped</span>
</span><span id="L-2087"><a href="#L-2087"><span class="linenos">2087</span></a>       <span class="n">out</span><span class="p">(</span><span class="ow">not</span> <span class="n">hadOneoff</span><span class="p">)</span> <span class="p">;</span> <span class="n">hadOneoff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2088"><a href="#L-2088"><span class="linenos">2088</span></a>       <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PHONES_PIPE_COMMAND&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-2089"><a href="#L-2089"><span class="linenos">2089</span></a>          <span class="n">o</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PHONES_PIPE_COMMAND&quot;</span><span class="p">],</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-2090"><a href="#L-2090"><span class="linenos">2090</span></a>          <span class="n">out</span><span class="p">()</span>
</span><span id="L-2091"><a href="#L-2091"><span class="linenos">2091</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">o</span>
</span><span id="L-2092"><a href="#L-2092"><span class="linenos">2092</span></a>
</span><span id="L-2093"><a href="#L-2093"><span class="linenos">2093</span></a><span class="k">def</span> <span class="nf">mainopt_ruby</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2094"><a href="#L-2094"><span class="linenos">2094</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;words&gt;]</span>
</span><span id="L-2095"><a href="#L-2095"><span class="linenos">2095</span></a><span class="sd">Like --phones but outputs the result as HTML RUBY markup, with each word&#39;s pronunciation symbols placed above the corresponding English word.</span>
</span><span id="L-2096"><a href="#L-2096"><span class="linenos">2096</span></a><span class="sd">E.g.: python lexconvert.py --ruby unicode-ipa This is a test sentence.</span>
</span><span id="L-2097"><a href="#L-2097"><span class="linenos">2097</span></a><span class="sd">This option is made more complicated by the fact that different versions of eSpeak may space the phoneme output differently, for example when handling numbers; if your eSpeak version is not recognised then all numbers are unannotated. Anyway you are advised not to rely on this option working with the new development NG versions of eSpeak. If the version you have behaves unexpectedly, words and phonemes output might lose synchronisation. However this option is believed to be stable when used with simple text and the original eSpeak.</span>
</span><span id="L-2098"><a href="#L-2098"><span class="linenos">2098</span></a><span class="sd">You can optionally set the RUBY_GRADINT_CGI environment variable to the URL of an instance of Gradint Web Edition to generate audio links for each word.  If doing this in a Web Adjuster filter, see comments in the lexconvert source for setup details.&quot;&quot;&quot;</span>
</span><span id="L-2099"><a href="#L-2099"><span class="linenos">2099</span></a>   <span class="c1"># htmlFilter with --htmlText of course.  Set separator to two newlines and copy the generated &#39;h5a&#39; function (from a manual run or the lexconvert source) into Adjuster&#39;s headAppend option (but don&#39;t expect HTML5 audio to work from Adjuster&#39;s submitBookmarklet option; pronunciation links will take you off the page if it doesn&#39;t).</span>
</span><span id="L-2100"><a href="#L-2100"><span class="linenos">2100</span></a>   <span class="c1"># Use double newlines as single newlines are used in the h5a script; adding that script via bookmarklet doesn&#39;t always run it</span>
</span><span id="L-2101"><a href="#L-2101"><span class="linenos">2101</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2102"><a href="#L-2102"><span class="linenos">2102</span></a>   <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The &#39;example&#39; format cannot be used with --ruby; did you mean festival?&quot;</span> <span class="c1"># as above</span>
</span><span id="L-2103"><a href="#L-2103"><span class="linenos">2103</span></a>   <span class="k">elif</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The --phones all option cannot be used with --ruby&quot;</span> <span class="c1"># (well you could implement it if you want but the resulting ruby would be quite unwieldy)</span>
</span><span id="L-2104"><a href="#L-2104"><span class="linenos">2104</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2105"><a href="#L-2105"><span class="linenos">2105</span></a>   <span class="n">text</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2019</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00a0</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</span><span id="L-2106"><a href="#L-2106"><span class="linenos">2106</span></a>   <span class="c1"># eSpeak&#39;s basic idea of an alphabetical word (most versions?) -</span>
</span><span id="L-2107"><a href="#L-2107"><span class="linenos">2107</span></a>   <span class="n">wordRegexps</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;(?:[A-Z]+[&#39;?-])*(?:(?:(?&lt;![A-z.])(?:[A-z]\.)+[A-z](?![A-z.]))|[A-Z]+[a-z](?![A-z])|[A-Z][A-Z]+(?![a-z][A-z])|[A-Z]?(?:[a-z][&#39;?-]?)+|[A-Z])&quot;</span><span class="p">]</span>
</span><span id="L-2108"><a href="#L-2108"><span class="linenos">2108</span></a>   <span class="c1"># A dot, when not part of an elipses, followed by a letter is pronounced &quot;dot&quot;, and two of them are pronounced &quot;dot dot&quot;:</span>
</span><span id="L-2109"><a href="#L-2109"><span class="linenos">2109</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;!\.\.)\.(?=[A-z])|(?&lt;!\.)\.(?=\.[A-z])&quot;</span><span class="p">)</span>
</span><span id="L-2110"><a href="#L-2110"><span class="linenos">2110</span></a>   <span class="c1"># ! followed by a letter is pronounced &quot;exclamation&quot;, and .! is &quot;dotexclamation&quot;; @ symbols similarly; copyright</span>
</span><span id="L-2111"><a href="#L-2111"><span class="linenos">2111</span></a>   <span class="n">atEtc</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;(?:[@!:]|</span><span class="se">\u00a9</span><span class="s2">)*&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2112"><a href="#L-2112"><span class="linenos">2112</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?[!@]+(?=[A-z])|(?&lt;![A-z])@&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">atEtc</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;(?![A-z])|&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0xa9</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">atEtc</span><span class="p">)</span>
</span><span id="L-2113"><a href="#L-2113"><span class="linenos">2113</span></a>   <span class="c1"># : between numbers if NOT followed by 2 digits:</span>
</span><span id="L-2114"><a href="#L-2114"><span class="linenos">2114</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![A-z]):(?![A-z]|[0-9][0-9])&quot;</span><span class="p">)</span>
</span><span id="L-2115"><a href="#L-2115"><span class="linenos">2115</span></a>   <span class="c1"># - between numbers</span>
</span><span id="L-2116"><a href="#L-2116"><span class="linenos">2116</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9])-(?=[0-9])&quot;</span><span class="p">)</span>
</span><span id="L-2117"><a href="#L-2117"><span class="linenos">2117</span></a>   <span class="c1"># TODO: if you paste in (e.g.) CJK characters, eSpeak will say &quot;symbol-symbol-symbol&quot; etc, but this is not accounted for by the above regexp so it&#39;ll go onto following words.</span>
</span><span id="L-2118"><a href="#L-2118"><span class="linenos">2118</span></a>   <span class="n">vLine</span> <span class="o">=</span> <span class="n">espeak_version_line</span><span class="p">()</span>
</span><span id="L-2119"><a href="#L-2119"><span class="linenos">2119</span></a>   <span class="k">if</span> <span class="s2">&quot;1.45.&quot;</span> <span class="ow">in</span> <span class="n">vLine</span><span class="p">:</span>
</span><span id="L-2120"><a href="#L-2120"><span class="linenos">2120</span></a>      <span class="c1"># This seems to work in eSpeak 1.45:</span>
</span><span id="L-2121"><a href="#L-2121"><span class="linenos">2121</span></a>      <span class="c1"># (TODO: test leading 0s &amp; leading decimal)</span>
</span><span id="L-2122"><a href="#L-2122"><span class="linenos">2122</span></a>      <span class="c1"># a number of 4 digits or less (with any number of digits after the decimal point) is grouped as 1 word:</span>
</span><span id="L-2123"><a href="#L-2123"><span class="linenos">2123</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])[0-9]{1,4}(?:\.[0-9]+)?(?!,?[0-9])&quot;</span><span class="p">)</span>
</span><span id="L-2124"><a href="#L-2124"><span class="linenos">2124</span></a>      <span class="c1"># and a number of 1 to 3 digits with any number of 000 or ,000 groups, with optional decimal point followed by any number of digits, OR when placed before an integer number of 3-digit groups, is grouped as 1 word:</span>
</span><span id="L-2125"><a href="#L-2125"><span class="linenos">2125</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[0-9]{1,3}(?:,?000)*(?:\.[0-9]+)?,?(?=(?:,?[0-9]{3,3})*,?(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="L-2126"><a href="#L-2126"><span class="linenos">2126</span></a>      <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="L-2127"><a href="#L-2127"><span class="linenos">2127</span></a>   <span class="k">elif</span> <span class="s2">&quot;1.48.&quot;</span> <span class="ow">in</span> <span class="n">vLine</span><span class="p">:</span>
</span><span id="L-2128"><a href="#L-2128"><span class="linenos">2128</span></a>      <span class="c1"># In eSpeak 1.48 the groups are smaller.</span>
</span><span id="L-2129"><a href="#L-2129"><span class="linenos">2129</span></a>      <span class="c1"># Decimal point and everything after it = individual</span>
</span><span id="L-2130"><a href="#L-2130"><span class="linenos">2130</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9])\.(?=[0-9])&quot;</span><span class="p">)</span>
</span><span id="L-2131"><a href="#L-2131"><span class="linenos">2131</span></a>      <span class="k">for</span> <span class="n">places</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span> <span class="c1"># TODO: really want unbounded, but (?&lt;=...) is fixed-length</span>
</span><span id="L-2132"><a href="#L-2132"><span class="linenos">2132</span></a>         <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9]\.&quot;</span><span class="o">+</span><span class="s2">&quot;[0-9]&quot;</span><span class="o">*</span><span class="n">places</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;)[0-9]&quot;</span><span class="p">)</span>
</span><span id="L-2133"><a href="#L-2133"><span class="linenos">2133</span></a>      <span class="c1"># Number with a leading dot grouped as 1 word:</span>
</span><span id="L-2134"><a href="#L-2134"><span class="linenos">2134</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])\.[0-9]+&quot;</span><span class="p">)</span>
</span><span id="L-2135"><a href="#L-2135"><span class="linenos">2135</span></a>      <span class="c1"># TODO: leading 0s (0000048 goes to 0 000 048)</span>
</span><span id="L-2136"><a href="#L-2136"><span class="linenos">2136</span></a>      <span class="c1"># For normal numbers:</span>
</span><span id="L-2137"><a href="#L-2137"><span class="linenos">2137</span></a>      <span class="c1"># A null string w. 3 or 6 digits to go and digits b4 shld match for &#39;thousand&#39;, &#39;million&#39; (unless 3+ digits are leading 0s, or fewer than 3 leading 0s and whole thing begins with a 0, or it&#39;s part of a decimal expansion, in which case different rules apply, but (?&lt;=...) must be fixed-length, so we need another one of these awful loops) :</span>
</span><span id="L-2138"><a href="#L-2138"><span class="linenos">2138</span></a>      <span class="k">for</span> <span class="n">prevDigits</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="L-2139"><a href="#L-2139"><span class="linenos">2139</span></a>         <span class="k">for</span> <span class="n">beforeThat</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;^&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;[^.0-9,]&quot;</span><span class="p">]:</span> <span class="c1"># beginning of string, or something OTHER than a decimal point / num</span>
</span><span id="L-2140"><a href="#L-2140"><span class="linenos">2140</span></a>            <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=&quot;</span><span class="o">+</span><span class="n">beforeThat</span><span class="o">+</span><span class="s2">&quot;[1-9]&quot;</span><span class="o">+</span><span class="s2">&quot;[0-9,]&quot;</span><span class="o">*</span><span class="n">prevDigits</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;)(?&lt;!,)(?&lt;!000)(?# empty string )(?=(?:,?(?:[0-9]{3,3}))+(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="L-2141"><a href="#L-2141"><span class="linenos">2141</span></a>      <span class="c1"># 1-9 (not 0) with 2, 5 or 8 etc digits to go = &quot;N-hundred-and&quot; :</span>
</span><span id="L-2142"><a href="#L-2142"><span class="linenos">2142</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[1-9](?=[0-9][0-9](?:,?(?:[0-9]{3,3}))*(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="L-2143"><a href="#L-2143"><span class="linenos">2143</span></a>      <span class="c1"># + 0 with 2 digits to go when preceded by digits = &quot;and&quot;, as long as followed by at least one non-0:</span>
</span><span id="L-2144"><a href="#L-2144"><span class="linenos">2144</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9,])0(?=(?:[0-9][1-9]|[1-9][0-9])(?:[^0-9,]|$))&quot;</span><span class="p">)</span>
</span><span id="L-2145"><a href="#L-2145"><span class="linenos">2145</span></a>      <span class="c1"># 1 or 2 digits with 0,3,6.. to go = &quot;seventy-six&quot; or whatever, as long as they&#39;re not both 0 :</span>
</span><span id="L-2146"><a href="#L-2146"><span class="linenos">2146</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:0[1-9]|[1-9][0-9]?)(?=(?:,?(?:[0-9]{3,3}))*(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="L-2147"><a href="#L-2147"><span class="linenos">2147</span></a>      <span class="c1"># 0 by itself (not preceded by digits) = &quot;nought&quot; :</span>
</span><span id="L-2148"><a href="#L-2148"><span class="linenos">2148</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])0(?=[^0-9]|$)&quot;</span><span class="p">)</span>
</span><span id="L-2149"><a href="#L-2149"><span class="linenos">2149</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])(?:of|on|in|that|with|for|was) (?:the|a)(?= )&quot;</span><span class="p">)</span>
</span><span id="L-2150"><a href="#L-2150"><span class="linenos">2150</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?:Of|On|In|That|With|For|Was) (?:the|a)(?= )&quot;</span><span class="p">)</span>
</span><span id="L-2151"><a href="#L-2151"><span class="linenos">2151</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])not a(?= )&quot;</span><span class="p">)</span>
</span><span id="L-2152"><a href="#L-2152"><span class="linenos">2152</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])(?:some|that) one(?= )&quot;</span><span class="p">)</span>
</span><span id="L-2153"><a href="#L-2153"><span class="linenos">2153</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?:Some|That) one(?= )&quot;</span><span class="p">)</span>
</span><span id="L-2154"><a href="#L-2154"><span class="linenos">2154</span></a>      <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="L-2155"><a href="#L-2155"><span class="linenos">2155</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">text2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?[0-9]+&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="c1"># unknown eSpeak version: don&#39;t annotate the numbers</span>
</span><span id="L-2156"><a href="#L-2156"><span class="linenos">2156</span></a>   <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
</span><span id="L-2157"><a href="#L-2157"><span class="linenos">2157</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="L-2158"><a href="#L-2158"><span class="linenos">2158</span></a>   <span class="n">gradint_cgi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RUBY_GRADINT_CGI&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2159"><a href="#L-2159"><span class="linenos">2159</span></a>   <span class="k">if</span> <span class="n">gradint_cgi</span><span class="p">:</span>
</span><span id="L-2160"><a href="#L-2160"><span class="linenos">2160</span></a>      <span class="n">linkStart</span><span class="p">,</span><span class="n">linkEnd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">gradint_cgi</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;?js=[[&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%25&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%26&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">))</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;]]&amp;jsl=en&quot; onclick=&quot;return h5a(this);&quot;&gt;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span>
</span><span id="L-2161"><a href="#L-2161"><span class="linenos">2161</span></a>      <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;script&gt;&lt;!-- // HTML5-audio function</span>
</span><span id="L-2162"><a href="#L-2162"><span class="linenos">2162</span></a><span class="s2">function h5a(link) {</span>
</span><span id="L-2163"><a href="#L-2163"><span class="linenos">2163</span></a><span class="s2"> if (document.createElement) {</span>
</span><span id="L-2164"><a href="#L-2164"><span class="linenos">2164</span></a><span class="s2">   var ae = document.createElement(&#39;audio&#39;);</span>
</span><span id="L-2165"><a href="#L-2165"><span class="linenos">2165</span></a><span class="s2">   if (ae.canPlayType &amp;&amp; function(s){return s!=&quot;&quot; &amp;&amp; s!=&quot;no&quot;}(ae.canPlayType(&#39;audio/mpeg&#39;))) {</span>
</span><span id="L-2166"><a href="#L-2166"><span class="linenos">2166</span></a><span class="s2">     ae.setAttribute(&#39;src&#39;, link.href);</span>
</span><span id="L-2167"><a href="#L-2167"><span class="linenos">2167</span></a><span class="s2">     ae.play(); return false;</span>
</span><span id="L-2168"><a href="#L-2168"><span class="linenos">2168</span></a><span class="s2">   } else if (ae.canPlayType &amp;&amp; function(s){return s!=&quot;&quot; &amp;&amp; s!=&quot;no&quot;}(ae.canPlayType(&#39;audio/ogg&#39;))) {</span>
</span><span id="L-2169"><a href="#L-2169"><span class="linenos">2169</span></a><span class="s2">     ae.setAttribute(&#39;src&#39;, link.href+&quot;&amp;filetype=ogg&quot;);</span>
</span><span id="L-2170"><a href="#L-2170"><span class="linenos">2170</span></a><span class="s2">     ae.play(); return false; }</span>
</span><span id="L-2171"><a href="#L-2171"><span class="linenos">2171</span></a><span class="s2"> } return true; }</span>
</span><span id="L-2172"><a href="#L-2172"><span class="linenos">2172</span></a><span class="s2">//--&gt;&lt;/script&gt;&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2173"><a href="#L-2173"><span class="linenos">2173</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">linkStart</span><span class="p">,</span><span class="n">linkEnd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2174"><a href="#L-2174"><span class="linenos">2174</span></a>   <span class="n">rubyList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2175"><a href="#L-2175"><span class="linenos">2175</span></a>   <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
</span><span id="L-2176"><a href="#L-2176"><span class="linenos">2176</span></a>      <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">:</span>
</span><span id="L-2177"><a href="#L-2177"><span class="linenos">2177</span></a>         <span class="n">converted</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="nb">format</span><span class="p">)</span>
</span><span id="L-2178"><a href="#L-2178"><span class="linenos">2178</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">converted</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># e.g. a lone _:_:</span>
</span><span id="L-2179"><a href="#L-2179"><span class="linenos">2179</span></a>         <span class="n">m</span> <span class="o">=</span> <span class="n">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">converted</span><span class="p">)</span>
</span><span id="L-2180"><a href="#L-2180"><span class="linenos">2180</span></a>         <span class="n">rubyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linkStart</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">))</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">linkEnd</span><span class="p">,</span><span class="n">w</span><span class="p">))</span>
</span><span id="L-2181"><a href="#L-2181"><span class="linenos">2181</span></a>   <span class="n">rubyList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># so can pop() left-to-right order</span>
</span><span id="L-2182"><a href="#L-2182"><span class="linenos">2182</span></a>   <span class="c1"># Write out re.sub ourselves, because (1) some versions of the library (e.g. on 2.7.12) try to do some things in-place, and we&#39;re using previous-context regexps that aren&#39;t compatible with previous things having been already &lt;ruby&gt;&#39;ified, and (2) if we match a 0-length string, re.finditer won&#39;t ALSO return a non-0 length match starting in the same place, and we want both (so we&#39;re using wordRegexps as a list rather than an | expression)</span>
</span><span id="L-2183"><a href="#L-2183"><span class="linenos">2183</span></a>   <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2184"><a href="#L-2184"><span class="linenos">2184</span></a>   <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># if True, will add ruby title=(index of the regexp that matched)</span>
</span><span id="L-2185"><a href="#L-2185"><span class="linenos">2185</span></a>   <span class="n">debugCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2186"><a href="#L-2186"><span class="linenos">2186</span></a>   <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wordRegexps</span><span class="p">:</span>
</span><span id="L-2187"><a href="#L-2187"><span class="linenos">2187</span></a>      <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">text</span><span class="p">):</span>
</span><span id="L-2188"><a href="#L-2188"><span class="linenos">2188</span></a>         <span class="n">matches</span><span class="p">[(</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">())]</span> <span class="o">=</span> <span class="n">debugCount</span>
</span><span id="L-2189"><a href="#L-2189"><span class="linenos">2189</span></a>      <span class="n">debugCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2190"><a href="#L-2190"><span class="linenos">2190</span></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2191"><a href="#L-2191"><span class="linenos">2191</span></a>   <span class="k">def</span> <span class="nf">cmpFunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
</span><span id="L-2192"><a href="#L-2192"><span class="linenos">2192</span></a>      <span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">e1</span><span class="p">),(</span><span class="n">s2</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
</span><span id="L-2193"><a href="#L-2193"><span class="linenos">2193</span></a>      <span class="k">if</span> <span class="n">s1</span><span class="o">&lt;</span><span class="n">s2</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2194"><a href="#L-2194"><span class="linenos">2194</span></a>      <span class="k">if</span> <span class="n">s1</span><span class="o">&gt;</span><span class="n">s2</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-2195"><a href="#L-2195"><span class="linenos">2195</span></a>      <span class="k">if</span> <span class="n">e1</span><span class="o">&gt;</span><span class="n">e2</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="L-2196"><a href="#L-2196"><span class="linenos">2196</span></a>      <span class="k">if</span> <span class="n">e1</span><span class="o">&lt;</span><span class="n">e2</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-2197"><a href="#L-2197"><span class="linenos">2197</span></a>      <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-2198"><a href="#L-2198"><span class="linenos">2198</span></a>   <span class="k">for</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">matches</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">cmpFunc</span><span class="p">):</span>
</span><span id="L-2199"><a href="#L-2199"><span class="linenos">2199</span></a>      <span class="k">if</span> <span class="n">start</span><span class="o">&lt;</span><span class="n">i</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># overlap??</span>
</span><span id="L-2200"><a href="#L-2200"><span class="linenos">2200</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span id="L-2201"><a href="#L-2201"><span class="linenos">2201</span></a>      <span class="k">if</span> <span class="n">start</span><span class="o">==</span><span class="n">end</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;&amp;nbsp;&quot;</span>
</span><span id="L-2202"><a href="#L-2202"><span class="linenos">2202</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">))</span>
</span><span id="L-2203"><a href="#L-2203"><span class="linenos">2203</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">rubyList</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="L-2204"><a href="#L-2204"><span class="linenos">2204</span></a>      <span class="k">except</span><span class="p">:</span> <span class="n">rt</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span> <span class="c1"># we&#39;ve lost synchronisation</span>
</span><span id="L-2205"><a href="#L-2205"><span class="linenos">2205</span></a>      <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; title=&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">matches</span><span class="p">[(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)]))</span>
</span><span id="L-2206"><a href="#L-2206"><span class="linenos">2206</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2207"><a href="#L-2207"><span class="linenos">2207</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;ruby&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt;&lt;rb&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rb&gt;&lt;rt&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">rt</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rt&gt;&lt;/ruby&gt;&quot;</span><span class="p">))</span>
</span><span id="L-2208"><a href="#L-2208"><span class="linenos">2208</span></a>      <span class="n">i</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="L-2209"><a href="#L-2209"><span class="linenos">2209</span></a>   <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="L-2210"><a href="#L-2210"><span class="linenos">2210</span></a>   <span class="k">while</span> <span class="n">rubyList</span><span class="p">:</span> <span class="c1"># oops, lost synchronisation the other way (TODO: show this per-paragraph? but don&#39;t call eSpeak too many times if processing many short paragraphs)</span>
</span><span id="L-2211"><a href="#L-2211"><span class="linenos">2211</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;ruby&gt;&lt;rb&gt;ERROR&lt;/rb&gt;&lt;rt&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">rubyList</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rt&gt;&lt;/ruby&gt;&quot;</span><span class="p">))</span>
</span><span id="L-2212"><a href="#L-2212"><span class="linenos">2212</span></a>   <span class="n">out</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="L-2213"><a href="#L-2213"><span class="linenos">2213</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)):</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2214"><a href="#L-2214"><span class="linenos">2214</span></a>   <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span><span id="L-2215"><a href="#L-2215"><span class="linenos">2215</span></a>
</span><span id="L-2216"><a href="#L-2216"><span class="linenos">2216</span></a><span class="k">def</span> <span class="nf">pipeThroughEspeak</span><span class="p">(</span><span class="n">inpt</span><span class="p">):</span>
</span><span id="L-2217"><a href="#L-2217"><span class="linenos">2217</span></a>   <span class="s2">&quot;Writes inpt to espeak -q -x (in chunks if necessary) and returns the result&quot;</span>
</span><span id="L-2218"><a href="#L-2218"><span class="linenos">2218</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span>
</span><span id="L-2219"><a href="#L-2219"><span class="linenos">2219</span></a>   <span class="n">bufsize</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># careful not to set this too big, as the OS might limit it (TODO can we check?)</span>
</span><span id="L-2220"><a href="#L-2220"><span class="linenos">2220</span></a>   <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2221"><a href="#L-2221"><span class="linenos">2221</span></a>   <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">bufsize</span><span class="p">:</span>
</span><span id="L-2222"><a href="#L-2222"><span class="linenos">2222</span></a>      <span class="n">splitAt</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bufsize</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-2223"><a href="#L-2223"><span class="linenos">2223</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">splitAt</span><span class="p">:</span> <span class="c1"># no newline, try to split on space</span>
</span><span id="L-2224"><a href="#L-2224"><span class="linenos">2224</span></a>         <span class="n">splitAt</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bufsize</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-2225"><a href="#L-2225"><span class="linenos">2225</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">splitAt</span><span class="p">:</span>
</span><span id="L-2226"><a href="#L-2226"><span class="linenos">2226</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note: had to split eSpeak input and couldn&#39;t find a newline or space to do it on</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2227"><a href="#L-2227"><span class="linenos">2227</span></a>            <span class="n">splitAt</span> <span class="o">=</span> <span class="n">bufsize</span>
</span><span id="L-2228"><a href="#L-2228"><span class="linenos">2228</span></a>      <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">inpt</span><span class="p">[:</span><span class="n">splitAt</span><span class="p">])</span>
</span><span id="L-2229"><a href="#L-2229"><span class="linenos">2229</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;command&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="L-2230"><a href="#L-2230"><span class="linenos">2230</span></a>      <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="p">;</span> <span class="n">inpt</span><span class="o">=</span><span class="n">inpt</span><span class="p">[</span><span class="n">splitAt</span><span class="p">:]</span>
</span><span id="L-2231"><a href="#L-2231"><span class="linenos">2231</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s2">&quot;espeak -q -x&quot;</span><span class="p">,</span><span class="n">bufsize</span><span class="o">=</span><span class="n">bufsize</span><span class="p">)</span> <span class="c1"># Python 2</span>
</span><span id="L-2232"><a href="#L-2232"><span class="linenos">2232</span></a>   <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># Python 3</span>
</span><span id="L-2233"><a href="#L-2233"><span class="linenos">2233</span></a>      <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="L-2234"><a href="#L-2234"><span class="linenos">2234</span></a>      <span class="n">proc</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;espeak&#39;</span><span class="p">,</span><span class="s1">&#39;-q&#39;</span><span class="p">,</span><span class="s1">&#39;-x&#39;</span><span class="p">],</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="L-2235"><a href="#L-2235"><span class="linenos">2235</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span>
</span><span id="L-2236"><a href="#L-2236"><span class="linenos">2236</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2237"><a href="#L-2237"><span class="linenos">2237</span></a>   <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
</span><span id="L-2238"><a href="#L-2238"><span class="linenos">2238</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span> <span class="p">;</span> <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2239"><a href="#L-2239"><span class="linenos">2239</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-2240"><a href="#L-2240"><span class="linenos">2240</span></a>   <span class="k">else</span><span class="p">:</span> <span class="c1"># Python 3</span>
</span><span id="L-2241"><a href="#L-2241"><span class="linenos">2241</span></a>      <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span>
</span><span id="L-2242"><a href="#L-2242"><span class="linenos">2242</span></a>      <span class="n">out</span><span class="p">,</span><span class="n">err</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="L-2243"><a href="#L-2243"><span class="linenos">2243</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2244"><a href="#L-2244"><span class="linenos">2244</span></a>      <span class="k">if</span> <span class="n">out</span><span class="p">:</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">out</span>
</span><span id="L-2245"><a href="#L-2245"><span class="linenos">2245</span></a>      <span class="k">if</span> <span class="n">err</span><span class="p">:</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">err</span>
</span><span id="L-2246"><a href="#L-2246"><span class="linenos">2246</span></a>   <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span>
</span><span id="L-2247"><a href="#L-2247"><span class="linenos">2247</span></a>
</span><span id="L-2248"><a href="#L-2248"><span class="linenos">2248</span></a><span class="k">def</span> <span class="nf">espeak_version_line</span><span class="p">():</span> <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -h 2&gt;&amp;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2249"><a href="#L-2249"><span class="linenos">2249</span></a>
</span><span id="L-2250"><a href="#L-2250"><span class="linenos">2250</span></a><span class="k">def</span> <span class="nf">writeFormatHeader</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
</span><span id="L-2251"><a href="#L-2251"><span class="linenos">2251</span></a>   <span class="s2">&quot;Writes a header for &#39;format&#39; when outputting in all formats.  Assumes the output MIGHT end up being more than one line.&quot;</span>
</span><span id="L-2252"><a href="#L-2252"><span class="linenos">2252</span></a>   <span class="k">global</span> <span class="n">writeFormatHeader_called</span>
</span><span id="L-2253"><a href="#L-2253"><span class="linenos">2253</span></a>   <span class="k">if</span> <span class="n">writeFormatHeader_called</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2254"><a href="#L-2254"><span class="linenos">2254</span></a>   <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="L-2255"><a href="#L-2255"><span class="linenos">2255</span></a>   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span>
</span><span id="L-2256"><a href="#L-2256"><span class="linenos">2256</span></a>   <span class="n">writeFormatHeader_called</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2257"><a href="#L-2257"><span class="linenos">2257</span></a><span class="n">writeFormatHeader_called</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2258"><a href="#L-2258"><span class="linenos">2258</span></a>
</span><span id="L-2259"><a href="#L-2259"><span class="linenos">2259</span></a><span class="k">def</span> <span class="nf">mainopt_check_variants</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2260"><a href="#L-2260"><span class="linenos">2260</span></a>   <span class="c1"># undocumented (won&#39;t appear in help text)</span>
</span><span id="L-2261"><a href="#L-2261"><span class="linenos">2261</span></a>   <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2262"><a href="#L-2262"><span class="linenos">2262</span></a>   <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">[</span><span class="s1">&#39;espeak&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2263"><a href="#L-2263"><span class="linenos">2263</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
</span><span id="L-2264"><a href="#L-2264"><span class="linenos">2264</span></a>         <span class="n">intV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-2265"><a href="#L-2265"><span class="linenos">2265</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">intV</span> <span class="ow">in</span> <span class="n">consonants</span><span class="p">:</span>
</span><span id="L-2266"><a href="#L-2266"><span class="linenos">2266</span></a>            <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">intV</span><span class="p">,[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-2267"><a href="#L-2267"><span class="linenos">2267</span></a>   <span class="n">i</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-2268"><a href="#L-2268"><span class="linenos">2268</span></a>   <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
</span><span id="L-2269"><a href="#L-2269"><span class="linenos">2269</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-2270"><a href="#L-2270"><span class="linenos">2270</span></a>      <span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-2271"><a href="#L-2271"><span class="linenos">2271</span></a>      <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-2272"><a href="#L-2272"><span class="linenos">2272</span></a>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Group &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span><span id="L-2273"><a href="#L-2273"><span class="linenos">2273</span></a>         <span class="n">es</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -x&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2274"><a href="#L-2274"><span class="linenos">2274</span></a>         <span class="n">getBuf</span><span class="p">(</span><span class="n">es</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
</span><span id="L-2275"><a href="#L-2275"><span class="linenos">2275</span></a>         <span class="k">del</span> <span class="n">es</span>
</span><span id="L-2276"><a href="#L-2276"><span class="linenos">2276</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Again? 1/0: &quot;</span><span class="p">))):</span> <span class="k">break</span>
</span><span id="L-2277"><a href="#L-2277"><span class="linenos">2277</span></a>
</span><span id="L-2278"><a href="#L-2278"><span class="linenos">2278</span></a><span class="k">def</span> <span class="nf">mainopt_check_for_similar_formats</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2279"><a href="#L-2279"><span class="linenos">2279</span></a>   <span class="c1"># undocumented (won&#39;t appear in help text)</span>
</span><span id="L-2280"><a href="#L-2280"><span class="linenos">2280</span></a>   <span class="n">items</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2281"><a href="#L-2281"><span class="linenos">2281</span></a>   <span class="k">while</span> <span class="n">items</span><span class="p">:</span>
</span><span id="L-2282"><a href="#L-2282"><span class="linenos">2282</span></a>      <span class="n">k1</span><span class="p">,</span><span class="n">dic1</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2283"><a href="#L-2283"><span class="linenos">2283</span></a>      <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">dic2</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="L-2284"><a href="#L-2284"><span class="linenos">2284</span></a>         <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2285"><a href="#L-2285"><span class="linenos">2285</span></a>         <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">vv</span> <span class="ow">in</span> <span class="n">dic1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2286"><a href="#L-2286"><span class="linenos">2286</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-2287"><a href="#L-2287"><span class="linenos">2287</span></a>            <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="n">syllable_separator</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-2288"><a href="#L-2288"><span class="linenos">2288</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">dic2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="s2">&quot;!&quot;</span><span class="o">+</span><span class="n">vv</span><span class="p">)</span><span class="o">==</span><span class="n">vv</span><span class="p">:</span> <span class="n">diff</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2289"><a href="#L-2289"><span class="linenos">2289</span></a>         <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">diff</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">))</span>
</span><span id="L-2290"><a href="#L-2290"><span class="linenos">2290</span></a>      <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-2291"><a href="#L-2291"><span class="linenos">2291</span></a>   <span class="n">r</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="p">;</span> <span class="n">had</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2292"><a href="#L-2292"><span class="linenos">2292</span></a>   <span class="k">for</span> <span class="n">diffs</span><span class="p">,</span><span class="n">format1</span><span class="p">,</span><span class="n">format2</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
</span><span id="L-2293"><a href="#L-2293"><span class="linenos">2293</span></a>      <span class="k">if</span> <span class="n">format1</span> <span class="ow">in</span> <span class="n">had</span> <span class="ow">and</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">had</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-2294"><a href="#L-2294"><span class="linenos">2294</span></a>      <span class="n">had</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">format1</span><span class="p">)</span> <span class="p">;</span> <span class="n">had</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span>
</span><span id="L-2295"><a href="#L-2295"><span class="linenos">2295</span></a>      <span class="k">if</span> <span class="s2">&quot;names&quot;</span> <span class="ow">in</span> <span class="n">had</span><span class="p">:</span> <span class="k">break</span>
</span><span id="L-2296"><a href="#L-2296"><span class="linenos">2296</span></a>      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; phoneme differences between &quot;</span><span class="o">+</span><span class="n">format1</span><span class="o">+</span><span class="s2">&quot; and &quot;</span><span class="o">+</span><span class="n">format2</span><span class="p">)</span>
</span><span id="L-2297"><a href="#L-2297"><span class="linenos">2297</span></a>
</span><span id="L-2298"><a href="#L-2298"><span class="linenos">2298</span></a><span class="k">def</span> <span class="nf">festival_group_stress</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2299"><a href="#L-2299"><span class="linenos">2299</span></a>   <span class="s2">&quot;Special-case cleanup_func for the Festival format&quot;</span>
</span><span id="L-2300"><a href="#L-2300"><span class="linenos">2300</span></a>   <span class="c1"># TODO: do we ever need to add extra consonants to the</span>
</span><span id="L-2301"><a href="#L-2301"><span class="linenos">2301</span></a>   <span class="c1"># previous group instead of the next group?  (not sure</span>
</span><span id="L-2302"><a href="#L-2302"><span class="linenos">2302</span></a>   <span class="c1"># what difference it makes to the synthesis, but it</span>
</span><span id="L-2303"><a href="#L-2303"><span class="linenos">2303</span></a>   <span class="c1"># might make the entry a bit more readable)</span>
</span><span id="L-2304"><a href="#L-2304"><span class="linenos">2304</span></a>   <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">thisGroup</span> <span class="o">=</span> <span class="p">[[],</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span> <span class="c1"># phon,stress,complete</span>
</span><span id="L-2305"><a href="#L-2305"><span class="linenos">2305</span></a>   <span class="k">for</span> <span class="n">phon</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="L-2306"><a href="#L-2306"><span class="linenos">2306</span></a>      <span class="k">if</span> <span class="n">phon</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="L-2307"><a href="#L-2307"><span class="linenos">2307</span></a>         <span class="k">if</span> <span class="n">groups</span> <span class="ow">and</span> <span class="n">phon</span> <span class="o">&gt;=</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="L-2308"><a href="#L-2308"><span class="linenos">2308</span></a>            <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">phon</span>
</span><span id="L-2309"><a href="#L-2309"><span class="linenos">2309</span></a>         <span class="k">continue</span>
</span><span id="L-2310"><a href="#L-2310"><span class="linenos">2310</span></a>      <span class="n">thisGroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phon</span><span class="p">)</span>
</span><span id="L-2311"><a href="#L-2311"><span class="linenos">2311</span></a>      <span class="k">if</span> <span class="n">phon</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;aeiou@&#39;</span><span class="p">:</span>
</span><span id="L-2312"><a href="#L-2312"><span class="linenos">2312</span></a>         <span class="n">thisGroup</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-2313"><a href="#L-2313"><span class="linenos">2313</span></a>         <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
</span><span id="L-2314"><a href="#L-2314"><span class="linenos">2314</span></a>         <span class="n">thisGroup</span> <span class="o">=</span> <span class="p">[[],</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span>
</span><span id="L-2315"><a href="#L-2315"><span class="linenos">2315</span></a>   <span class="k">if</span> <span class="n">thisGroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
</span><span id="L-2316"><a href="#L-2316"><span class="linenos">2316</span></a>   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="L-2317"><a href="#L-2317"><span class="linenos">2317</span></a>      <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2318"><a href="#L-2318"><span class="linenos">2318</span></a>      <span class="k">del</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2319"><a href="#L-2319"><span class="linenos">2319</span></a>   <span class="k">return</span> <span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s2">&quot;((&quot;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
</span><span id="L-2320"><a href="#L-2320"><span class="linenos">2320</span></a>
</span><span id="L-2321"><a href="#L-2321"><span class="linenos">2321</span></a><span class="k">def</span> <span class="nf">mainopt_convert</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2322"><a href="#L-2322"><span class="linenos">2322</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;from-format&gt; &lt;to-format&gt;</span>
</span><span id="L-2323"><a href="#L-2323"><span class="linenos">2323</span></a><span class="sd">Convert a user lexicon (generally from its default filename; if this cannot be found then lexconvert will tell you what it should be).</span>
</span><span id="L-2324"><a href="#L-2324"><span class="linenos">2324</span></a><span class="sd">E.g.: python lexconvert.py --convert festival cepstral&quot;&quot;&quot;</span>
</span><span id="L-2325"><a href="#L-2325"><span class="linenos">2325</span></a>   <span class="n">fromFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2326"><a href="#L-2326"><span class="linenos">2326</span></a>   <span class="n">toFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2327"><a href="#L-2327"><span class="linenos">2327</span></a>   <span class="k">if</span> <span class="n">fromFormat</span><span class="o">==</span><span class="n">toFormat</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot convert a lexicon to its own format (that could result in it being truncated)&quot;</span>
</span><span id="L-2328"><a href="#L-2328"><span class="linenos">2328</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot permanently save a Mac-UK lexicon; please use the --mac-uk option to read text&quot;</span>
</span><span id="L-2329"><a href="#L-2329"><span class="linenos">2329</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot overwrite the built-in example lexicon&quot;</span>
</span><span id="L-2330"><a href="#L-2330"><span class="linenos">2330</span></a>   <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">]:</span>
</span><span id="L-2331"><a href="#L-2331"><span class="linenos">2331</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2332"><a href="#L-2332"><span class="linenos">2332</span></a>   <span class="k">try</span><span class="p">:</span>
</span><span id="L-2333"><a href="#L-2333"><span class="linenos">2333</span></a>      <span class="n">fname</span><span class="o">=</span><span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span>
</span><span id="L-2334"><a href="#L-2334"><span class="linenos">2334</span></a>      <span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">)</span> <span class="c1"># convert_user_lexicon will need this</span>
</span><span id="L-2335"><a href="#L-2335"><span class="linenos">2335</span></a>   <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2336"><a href="#L-2336"><span class="linenos">2336</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Write support for lexicons of format &#39;</span><span class="si">%s</span><span class="s2">&#39; not yet implemented (need at least lex_filename and lex_entry_format); try using --phones or --phones2phones options instead&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toFormat</span><span class="p">,)</span>
</span><span id="L-2337"><a href="#L-2337"><span class="linenos">2337</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;espeak&quot;</span><span class="p">:</span>
</span><span id="L-2338"><a href="#L-2338"><span class="linenos">2338</span></a>      <span class="k">assert</span> <span class="n">fname</span><span class="o">==</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span> <span class="s2">&quot;If you changed eSpeak&#39;s lex_filename in the table you also need to change the code below&quot;</span>
</span><span id="L-2339"><a href="#L-2339"><span class="linenos">2339</span></a>      <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;mv en_extra en_extra~ &amp;&amp; (grep </span><span class="se">\&quot;</span><span class="s2"> // </span><span class="se">\&quot;</span><span class="s2"> en_extra~ || true) &gt; en_extra&quot;</span><span class="p">):</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning: en_extra not found, making a new one</span><span class="se">\n</span><span class="s2">(espeak compile will probably fail in this directory)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># otherwise keep the commented entries, so can incrementally update the user lexicon only</span>
</span><span id="L-2340"><a href="#L-2340"><span class="linenos">2340</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2341"><a href="#L-2341"><span class="linenos">2341</span></a>   <span class="k">else</span><span class="p">:</span>
</span><span id="L-2342"><a href="#L-2342"><span class="linenos">2342</span></a>      <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2343"><a href="#L-2343"><span class="linenos">2343</span></a>      <span class="k">try</span><span class="p">:</span>
</span><span id="L-2344"><a href="#L-2344"><span class="linenos">2344</span></a>         <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2345"><a href="#L-2345"><span class="linenos">2345</span></a>         <span class="n">l</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-2346"><a href="#L-2346"><span class="linenos">2346</span></a>         <span class="k">del</span> <span class="n">f</span>
</span><span id="L-2347"><a href="#L-2347"><span class="linenos">2347</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-2348"><a href="#L-2348"><span class="linenos">2348</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">l</span><span class="p">,</span> <span class="s2">&quot;File &quot;</span><span class="o">+</span><span class="n">replHome</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; already exists and is not empty; are you sure you want to overwrite it?  (Delete it first if so)&quot;</span> <span class="c1"># (if you run with python -O then this is ignored, as are some other checks so be careful)</span>
</span><span id="L-2349"><a href="#L-2349"><span class="linenos">2349</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2350"><a href="#L-2350"><span class="linenos">2350</span></a>   <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Writing </span><span class="si">%s</span><span class="s2"> lexicon entries to </span><span class="si">%s</span><span class="s2"> file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>
</span><span id="L-2351"><a href="#L-2351"><span class="linenos">2351</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">convert_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="L-2352"><a href="#L-2352"><span class="linenos">2352</span></a>   <span class="k">except</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="L-2353"><a href="#L-2353"><span class="linenos">2353</span></a>     <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; - error, deleting &quot;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
</span><span id="L-2354"><a href="#L-2354"><span class="linenos">2354</span></a>     <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">;</span> <span class="k">raise</span>
</span><span id="L-2355"><a href="#L-2355"><span class="linenos">2355</span></a>
</span><span id="L-2356"><a href="#L-2356"><span class="linenos">2356</span></a><span class="k">def</span> <span class="nf">mainopt_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2357"><a href="#L-2357"><span class="linenos">2357</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;&lt;location&gt;</span>
</span><span id="L-2358"><a href="#L-2358"><span class="linenos">2358</span></a><span class="sd">Convert the Festival Oxford Advanced Learners Dictionary (OALD) pronunciation lexicon to eSpeak.</span>
</span><span id="L-2359"><a href="#L-2359"><span class="linenos">2359</span></a><span class="sd">You need to specify the location of the OALD file in &lt;location&gt;,</span>
</span><span id="L-2360"><a href="#L-2360"><span class="linenos">2360</span></a><span class="sd">e.g. for Debian festlex-oald package: python lexconvert.py --festival-dictionary-to-espeak /usr/share/festival/dicts/oald/all.scm</span>
</span><span id="L-2361"><a href="#L-2361"><span class="linenos">2361</span></a><span class="sd">or if you can&#39;t install the Debian package, try downloading http://ftp.debian.org/debian/pool/non-free/f/festlex-oald/festlex-oald_1.4.0.orig.tar.gz, unpack it into /tmp, and do: python lexconvert.py --festival-dictionary-to-espeak /tmp/festival/lib/dicts/oald/oald-0.4.out</span>
</span><span id="L-2362"><a href="#L-2362"><span class="linenos">2362</span></a><span class="sd">In all cases you need to cd to the eSpeak source directory before running this.  en_extra will be overwritten.  Converter will also read your ~/.festivalrc if it exists.  (You can later incrementally update from ~/.festivalrc using the --convert option; the entries from the system dictionary will not be overwritten in this case.)  Specify --without-check to bypass checking the existing eSpeak pronunciation for OALD entries (much faster, but makes a larger file and in some cases compromises the pronunciation quality).&quot;&quot;&quot;</span>
</span><span id="L-2363"><a href="#L-2363"><span class="linenos">2363</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">festival_location</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2364"><a href="#L-2364"><span class="linenos">2364</span></a>   <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: --festival-dictionary-to-espeak must be followed by the location of the festival OALD file (see help text)&quot;</span>
</span><span id="L-2365"><a href="#L-2365"><span class="linenos">2365</span></a>   <span class="k">try</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2366"><a href="#L-2366"><span class="linenos">2366</span></a>   <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: The specified OALD location &#39;&quot;</span><span class="o">+</span><span class="n">festival_location</span><span class="o">+</span><span class="s2">&quot;&#39; could not be opened&quot;</span>
</span><span id="L-2367"><a href="#L-2367"><span class="linenos">2367</span></a>   <span class="k">try</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_list&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2368"><a href="#L-2368"><span class="linenos">2368</span></a>   <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: en_list could not be opened (did you remember to cd to the eSpeak dictsource directory first?&quot;</span>
</span><span id="L-2369"><a href="#L-2369"><span class="linenos">2369</span></a>   <span class="n">convert_system_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span><span class="ow">not</span> <span class="s1">&#39;--without-check&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">,</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;test -e ~/.festivalrc&quot;</span><span class="p">))</span>
</span><span id="L-2370"><a href="#L-2370"><span class="linenos">2370</span></a>
</span><span id="L-2371"><a href="#L-2371"><span class="linenos">2371</span></a><span class="k">def</span> <span class="nf">mainopt_syllables</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2372"><a href="#L-2372"><span class="linenos">2372</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;[&lt;words&gt;]</span>
</span><span id="L-2373"><a href="#L-2373"><span class="linenos">2373</span></a><span class="sd">Attempt to break &#39;words&#39; into syllables for music lyrics (uses espeak to determine how many syllables are needed)&quot;&quot;&quot;</span>
</span><span id="L-2374"><a href="#L-2374"><span class="linenos">2374</span></a>   <span class="c1"># As explained on mainopt_ruby&#39;s help text, espeak -x output can&#39;t be relied on to always put a space between every input word.  Rather than try to guess what espeak is going to do, here we simply put a newline after every input word instead.  This might affect eSpeak&#39;s output (so not recommended for mainopt_ruby), but it should be OK for just counting the syllables.  (Also, the assumption that the input words have been taken from song lyrics usefully rules out certain awkward punctuation cases.)</span>
</span><span id="L-2375"><a href="#L-2375"><span class="linenos">2375</span></a>   <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;word(s)&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="L-2376"><a href="#L-2376"><span class="linenos">2376</span></a>      <span class="n">words</span><span class="o">=</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="L-2377"><a href="#L-2377"><span class="linenos">2377</span></a>      <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
</span><span id="L-2378"><a href="#L-2378"><span class="linenos">2378</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="L-2379"><a href="#L-2379"><span class="linenos">2379</span></a>      <span class="n">rrr</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-2380"><a href="#L-2380"><span class="linenos">2380</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">hyphenate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">sylcount</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="s2">&quot;example&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="n">rrr</span><span class="p">))]))</span>
</span><span id="L-2381"><a href="#L-2381"><span class="linenos">2381</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># in case piped</span>
</span><span id="L-2382"><a href="#L-2382"><span class="linenos">2382</span></a>
</span><span id="L-2383"><a href="#L-2383"><span class="linenos">2383</span></a><span class="k">def</span> <span class="nf">wordSeparator</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
</span><span id="L-2384"><a href="#L-2384"><span class="linenos">2384</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Returns the effective word separator of format (remembering that it defaults to same as phoneme_separator&quot;&quot;&quot;</span>
</span><span id="L-2385"><a href="#L-2385"><span class="linenos">2385</span></a>   <span class="k">return</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;word_separator&quot;</span><span class="p">,</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;phoneme_separator&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
</span><span id="L-2386"><a href="#L-2386"><span class="linenos">2386</span></a>
</span><span id="L-2387"><a href="#L-2387"><span class="linenos">2387</span></a><span class="k">def</span> <span class="nf">mainopt_phones2phones</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2388"><a href="#L-2388"><span class="linenos">2388</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format1&gt; &lt;format2&gt; [&lt;phonemes in format1&gt;]</span>
</span><span id="L-2389"><a href="#L-2389"><span class="linenos">2389</span></a><span class="sd">Perform a one-off conversion of phonemes from format1 to format2 (format2 can be &#39;all&#39; if you want)&quot;&quot;&quot;</span> <span class="c1"># If format1 is &#39;example&#39; and you don&#39;t specify phonemes, we take the words from the example lexicon.  But don&#39;t say that in the help string because it might confuse the issue about phonemes being optional on the command line and prompted for if not specified and stdin is not piped in all formats other than &#39;example&#39;.</span>
</span><span id="L-2390"><a href="#L-2390"><span class="linenos">2390</span></a>   <span class="n">format1</span><span class="p">,</span><span class="n">format2</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2391"><a href="#L-2391"><span class="linenos">2391</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">format1</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">format1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2392"><a href="#L-2392"><span class="linenos">2392</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">lexFormats</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">format2</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2393"><a href="#L-2393"><span class="linenos">2393</span></a>   <span class="k">if</span> <span class="n">format1</span><span class="o">==</span><span class="s2">&quot;example&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">:</span>
</span><span id="L-2394"><a href="#L-2394"><span class="linenos">2394</span></a>     <span class="k">if</span> <span class="n">stdin_is_terminal</span><span class="p">():</span> <span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="L-2395"><a href="#L-2395"><span class="linenos">2395</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">txt</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># and it might still be &quot;&quot;</span>
</span><span id="L-2396"><a href="#L-2396"><span class="linenos">2396</span></a>     <span class="k">if</span> <span class="n">txt</span><span class="p">:</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="n">format1</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span>
</span><span id="L-2397"><a href="#L-2397"><span class="linenos">2397</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span><span class="o">=</span><span class="p">[[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getSetting</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="s1">&#39;lex_read_function&#39;</span><span class="p">)()]</span>
</span><span id="L-2398"><a href="#L-2398"><span class="linenos">2398</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span> <span class="o">=</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="n">format1</span><span class="p">,</span><span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="n">format1</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">))</span>
</span><span id="L-2399"><a href="#L-2399"><span class="linenos">2399</span></a>   <span class="k">if</span> <span class="n">format2</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</span><span id="L-2400"><a href="#L-2400"><span class="linenos">2400</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">format2</span><span class="p">]</span>
</span><span id="L-2401"><a href="#L-2401"><span class="linenos">2401</span></a>   <span class="k">for</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
</span><span id="L-2402"><a href="#L-2402"><span class="linenos">2402</span></a>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">writeFormatHeader</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span>
</span><span id="L-2403"><a href="#L-2403"><span class="linenos">2403</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="s2">&quot;inline_header&quot;</span><span class="p">)))</span>
</span><span id="L-2404"><a href="#L-2404"><span class="linenos">2404</span></a>     <span class="n">output_clauses</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">clauses</span><span class="p">,</span><span class="n">format1</span><span class="p">,</span><span class="n">format2</span><span class="p">))</span>
</span><span id="L-2405"><a href="#L-2405"><span class="linenos">2405</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="s2">&quot;inline_footer&quot;</span><span class="p">)))</span> <span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2406"><a href="#L-2406"><span class="linenos">2406</span></a>
</span><span id="L-2407"><a href="#L-2407"><span class="linenos">2407</span></a><span class="k">def</span> <span class="nf">parseIntoWordsAndClauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">phones</span><span class="p">):</span>
</span><span id="L-2408"><a href="#L-2408"><span class="linenos">2408</span></a>   <span class="s2">&quot;Returns list of clauses, each of which is a list of words, assuming &#39;phones&#39; are in format &#39;format&#39;&quot;</span>
</span><span id="L-2409"><a href="#L-2409"><span class="linenos">2409</span></a>   <span class="n">wordSep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;word_separator&quot;</span><span class="p">)</span> <span class="c1"># don&#39;t use wordSeparator() here - we&#39;re splitting, not joining, so we don&#39;t want it to default to phoneme_separator</span>
</span><span id="L-2410"><a href="#L-2410"><span class="linenos">2410</span></a>   <span class="n">clauseSep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;clause_separator&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2411"><a href="#L-2411"><span class="linenos">2411</span></a>   <span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">sep</span><span class="p">):</span>
</span><span id="L-2412"><a href="#L-2412"><span class="linenos">2412</span></a>      <span class="k">if</span> <span class="n">sep</span><span class="o">==</span><span class="s2">&quot; &quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span> <span class="c1"># &quot; &quot; means ANY whitespace (TODO: document this?)</span>
</span><span id="L-2413"><a href="#L-2413"><span class="linenos">2413</span></a>      <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span><span class="n">phones</span><span class="p">)</span>
</span><span id="L-2414"><a href="#L-2414"><span class="linenos">2414</span></a>   <span class="k">if</span> <span class="n">clauseSep</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clauseSep</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span>
</span><span id="L-2415"><a href="#L-2415"><span class="linenos">2415</span></a>      <span class="n">clauses</span> <span class="o">=</span> <span class="n">phones</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">clauseSep</span><span class="p">))</span>
</span><span id="L-2416"><a href="#L-2416"><span class="linenos">2416</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span> <span class="o">=</span> <span class="p">[</span><span class="n">phones</span><span class="p">]</span>
</span><span id="L-2417"><a href="#L-2417"><span class="linenos">2417</span></a>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clauses</span><span class="p">)):</span>
</span><span id="L-2418"><a href="#L-2418"><span class="linenos">2418</span></a>      <span class="k">if</span> <span class="n">wordSep</span><span class="p">:</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">wordSep</span><span class="p">))</span>
</span><span id="L-2419"><a href="#L-2419"><span class="linenos">2419</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="L-2420"><a href="#L-2420"><span class="linenos">2420</span></a>      <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="L-2421"><a href="#L-2421"><span class="linenos">2421</span></a>   <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="n">clauses</span><span class="p">))</span>
</span><span id="L-2422"><a href="#L-2422"><span class="linenos">2422</span></a>
</span><span id="L-2423"><a href="#L-2423"><span class="linenos">2423</span></a><span class="k">def</span> <span class="nf">mainopt_mac_uk</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2424"><a href="#L-2424"><span class="linenos">2424</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;&lt;from-format&gt; [&lt;text&gt;]</span>
</span><span id="L-2425"><a href="#L-2425"><span class="linenos">2425</span></a><span class="sd">Speak text in Mac OS 10.7+ British voices while using a lexicon converted in from &lt;from-format&gt;. As these voices do not have user-modifiable lexicons, lexconvert must binary-patch your system&#39;s master lexicon; this is at your own risk! (Superuser privileges are needed the first time. A backup of the system file is made, and all changes are restored on normal exit but if you force-quit then you might need to restore the backup manually. Text speaking needs to be under lexconvert&#39;s control because it usually has to change the input words to make them fit the available space in the binary lexicon.) By default the Daniel voice is used; Emily or Serena can be selected by setting the MACUK_VOICE environment variable.&quot;&quot;&quot;</span>
</span><span id="L-2426"><a href="#L-2426"><span class="linenos">2426</span></a>   <span class="c1"># If you have xterm etc, then text will also be printed, with words from the altered lexicon underlined.</span>
</span><span id="L-2427"><a href="#L-2427"><span class="linenos">2427</span></a>   <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;--mac-uk has not been tested with Python 3, I don&#39;t want to risk messing up your system files, please use Python 2&quot;</span>
</span><span id="L-2428"><a href="#L-2428"><span class="linenos">2428</span></a>   <span class="n">fromFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2429"><a href="#L-2429"><span class="linenos">2429</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">fromFormat</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="L-2430"><a href="#L-2430"><span class="linenos">2430</span></a>   <span class="n">lex</span> <span class="o">=</span> <span class="n">get_macuk_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span>
</span><span id="L-2431"><a href="#L-2431"><span class="linenos">2431</span></a>   <span class="k">try</span><span class="p">:</span>
</span><span id="L-2432"><a href="#L-2432"><span class="linenos">2432</span></a>      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="kc">True</span><span class="p">):</span>
</span><span id="L-2433"><a href="#L-2433"><span class="linenos">2433</span></a>         <span class="n">m</span> <span class="o">=</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span>
</span><span id="L-2434"><a href="#L-2434"><span class="linenos">2434</span></a>         <span class="k">try</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">readWithLex</span><span class="p">(</span><span class="n">lex</span><span class="p">)</span>
</span><span id="L-2435"><a href="#L-2435"><span class="linenos">2435</span></a>         <span class="k">finally</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2436"><a href="#L-2436"><span class="linenos">2436</span></a>   <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="L-2437"><a href="#L-2437"><span class="linenos">2437</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interrupted</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2438"><a href="#L-2438"><span class="linenos">2438</span></a>
</span><span id="L-2439"><a href="#L-2439"><span class="linenos">2439</span></a><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-2440"><a href="#L-2440"><span class="linenos">2440</span></a>    <span class="s2">&quot;A simple class with two static members, count and subcount, for use by the consonant(), vowel() and other() functions&quot;</span>
</span><span id="L-2441"><a href="#L-2441"><span class="linenos">2441</span></a>    <span class="n">c</span><span class="o">=</span><span class="n">sc</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-2442"><a href="#L-2442"><span class="linenos">2442</span></a><span class="k">def</span> <span class="nf">other</span><span class="p">():</span>
</span><span id="L-2443"><a href="#L-2443"><span class="linenos">2443</span></a>    <span class="s2">&quot;Used by Phonemes() when creating something that is neither a vowel nor a consonant, e.g. a stress mark&quot;</span>
</span><span id="L-2444"><a href="#L-2444"><span class="linenos">2444</span></a>    <span class="n">Counter</span><span class="o">.</span><span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="k">return</span> <span class="n">Counter</span><span class="o">.</span><span class="n">c</span>
</span><span id="L-2445"><a href="#L-2445"><span class="linenos">2445</span></a><span class="n">consonants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span> <span class="p">;</span> <span class="n">mainVowels</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2446"><a href="#L-2446"><span class="linenos">2446</span></a><span class="k">def</span> <span class="nf">consonant</span><span class="p">():</span>
</span><span id="L-2447"><a href="#L-2447"><span class="linenos">2447</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a consonant&quot;</span>
</span><span id="L-2448"><a href="#L-2448"><span class="linenos">2448</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="p">;</span> <span class="n">consonants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">r</span>
</span><span id="L-2449"><a href="#L-2449"><span class="linenos">2449</span></a><span class="k">def</span> <span class="nf">vowel</span><span class="p">():</span>
</span><span id="L-2450"><a href="#L-2450"><span class="linenos">2450</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a vowel&quot;</span>
</span><span id="L-2451"><a href="#L-2451"><span class="linenos">2451</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="p">;</span> <span class="n">mainVowels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">r</span>
</span><span id="L-2452"><a href="#L-2452"><span class="linenos">2452</span></a><span class="k">def</span> <span class="nf">opt_vowel</span><span class="p">():</span>
</span><span id="L-2453"><a href="#L-2453"><span class="linenos">2453</span></a>    <span class="s2">&quot;Used by Phonemes() when creating an optional vowel (one that has no warning issued if some format doesn&#39;t support it)&quot;</span>
</span><span id="L-2454"><a href="#L-2454"><span class="linenos">2454</span></a>    <span class="k">return</span> <span class="n">other</span><span class="p">()</span>
</span><span id="L-2455"><a href="#L-2455"><span class="linenos">2455</span></a><span class="k">def</span> <span class="nf">variant</span><span class="p">():</span>
</span><span id="L-2456"><a href="#L-2456"><span class="linenos">2456</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a variant of the just-defined vowel/consonant/etc&quot;</span>
</span><span id="L-2457"><a href="#L-2457"><span class="linenos">2457</span></a>    <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2458"><a href="#L-2458"><span class="linenos">2458</span></a>    <span class="k">while</span> <span class="nb">str</span><span class="p">(</span><span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">):</span> <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2459"><a href="#L-2459"><span class="linenos">2459</span></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Counter</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="p">))</span>
</span><span id="L-2460"><a href="#L-2460"><span class="linenos">2460</span></a>    <span class="c1"># the 0 is so we can say _, name = variant()</span>
</span><span id="L-2461"><a href="#L-2461"><span class="linenos">2461</span></a>    <span class="c1"># so as to get some extra indentation</span>
</span><span id="L-2462"><a href="#L-2462"><span class="linenos">2462</span></a>
</span><span id="L-2463"><a href="#L-2463"><span class="linenos">2463</span></a><span class="k">def</span> <span class="nf">ifset</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-2464"><a href="#L-2464"><span class="linenos">2464</span></a>   <span class="s2">&quot;Checks the environment variable var; if it is set (non-empty), return a, otherwise return b.  Used in LexFormats to create tables with variations set by the environment.&quot;</span>
</span><span id="L-2465"><a href="#L-2465"><span class="linenos">2465</span></a>   <span class="kn">import</span> <span class="nn">os</span>
</span><span id="L-2466"><a href="#L-2466"><span class="linenos">2466</span></a>   <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span>
</span><span id="L-2467"><a href="#L-2467"><span class="linenos">2467</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">b</span>
</span><span id="L-2468"><a href="#L-2468"><span class="linenos">2468</span></a>
</span><span id="L-2469"><a href="#L-2469"><span class="linenos">2469</span></a><span class="k">def</span> <span class="nf">speakjet</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="n">opcode</span><span class="p">):</span>
</span><span id="L-2470"><a href="#L-2470"><span class="linenos">2470</span></a>   <span class="s2">&quot;Special-case function for the Speakjet table&quot;</span>
</span><span id="L-2471"><a href="#L-2471"><span class="linenos">2471</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">opcode</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span>
</span><span id="L-2472"><a href="#L-2472"><span class="linenos">2472</span></a>   <span class="k">if</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-2473"><a href="#L-2473"><span class="linenos">2473</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_SYM&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Cannot set both SPEAKJET_SYM and SPEAKJET_BINARY&quot;</span>
</span><span id="L-2474"><a href="#L-2474"><span class="linenos">2474</span></a>      <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">opcode</span><span class="p">)</span>
</span><span id="L-2475"><a href="#L-2475"><span class="linenos">2475</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_SYM&#39;</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">opcode</span><span class="p">))</span>
</span><span id="L-2476"><a href="#L-2476"><span class="linenos">2476</span></a>
</span><span id="L-2477"><a href="#L-2477"><span class="linenos">2477</span></a><span class="k">def</span> <span class="nf">makeDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2478"><a href="#L-2478"><span class="linenos">2478</span></a>    <span class="s2">&quot;Make a dictionary with a doc string, default-bidirectional mappings and extra settings; see LexFormats for how this is used.&quot;</span>
</span><span id="L-2479"><a href="#L-2479"><span class="linenos">2479</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;doc must be a string&quot;</span>
</span><span id="L-2480"><a href="#L-2480"><span class="linenos">2480</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">duplicates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2481"><a href="#L-2481"><span class="linenos">2481</span></a>    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="L-2482"><a href="#L-2482"><span class="linenos">2482</span></a>        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-2483"><a href="#L-2483"><span class="linenos">2483</span></a>        <span class="n">k</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="L-2484"><a href="#L-2484"><span class="linenos">2484</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="L-2485"><a href="#L-2485"><span class="linenos">2485</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2486"><a href="#L-2486"><span class="linenos">2486</span></a>        <span class="k">assert</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]),</span> <span class="s2">&quot;Wrong types &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (did you forget a _, before calling variant() or something?)&quot;</span>
</span><span id="L-2487"><a href="#L-2487"><span class="linenos">2487</span></a>        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-2488"><a href="#L-2488"><span class="linenos">2488</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-2489"><a href="#L-2489"><span class="linenos">2489</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="n">bidir</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2490"><a href="#L-2490"><span class="linenos">2490</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">bidir</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-2491"><a href="#L-2491"><span class="linenos">2491</span></a>        <span class="k">if</span> <span class="n">bidir</span><span class="p">:</span>
</span><span id="L-2492"><a href="#L-2492"><span class="linenos">2492</span></a>            <span class="c1"># (k,v,True) = both (k,v) and (v,k)</span>
</span><span id="L-2493"><a href="#L-2493"><span class="linenos">2493</span></a>            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="L-2494"><a href="#L-2494"><span class="linenos">2494</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="L-2495"><a href="#L-2495"><span class="linenos">2495</span></a>    <span class="k">assert</span> <span class="ow">not</span> <span class="n">duplicates</span><span class="p">,</span> <span class="s2">&quot; Duplicate key(s) in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">repr</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; (=&quot;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="n">dup</span><span class="p">))</span> <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)))</span><span class="o">+</span><span class="s2">&quot;. Did you forget a ,False to suppress bidirectional mapping?&quot;</span> <span class="c1"># by the way, Python does not detect duplicate keys in {...} notation - it just lets you overwrite</span>
</span><span id="L-2496"><a href="#L-2496"><span class="linenos">2496</span></a>    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">consonants</span><span class="p">)</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">mainVowels</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>
</span><span id="L-2497"><a href="#L-2497"><span class="linenos">2497</span></a>    <span class="c1"># did_approx = False</span>
</span><span id="L-2498"><a href="#L-2498"><span class="linenos">2498</span></a>    <span class="k">if</span> <span class="n">missing</span> <span class="ow">and</span> <span class="s1">&#39;approximate_missing&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-2499"><a href="#L-2499"><span class="linenos">2499</span></a>      <span class="k">for</span> <span class="n">miss</span><span class="p">,</span><span class="n">approxTo</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-2500"><a href="#L-2500"><span class="linenos">2500</span></a>          <span class="c1"># TODO: put this table somewhere else?</span>
</span><span id="L-2501"><a href="#L-2501"><span class="linenos">2501</span></a>          <span class="c1"># (If the thing on the right is just 1 item, we could make the thing on the left a variant of it.  But that might not be a good idea unless they&#39;re really very close, since if it&#39;s a variant then the substitution is done without warning even if approximate_missing is not set.)</span>
</span><span id="L-2502"><a href="#L-2502"><span class="linenos">2502</span></a>          <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span> <span class="p">[</span><span class="n">u_as_in_but</span><span class="p">]),</span>
</span><span id="L-2503"><a href="#L-2503"><span class="linenos">2503</span></a>          <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span> <span class="p">[</span><span class="n">e_as_in_them</span><span class="p">,</span><span class="n">r</span><span class="p">]),</span>
</span><span id="L-2504"><a href="#L-2504"><span class="linenos">2504</span></a>          <span class="p">(</span><span class="n">ear</span><span class="p">,</span> <span class="p">[</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">]),</span>
</span><span id="L-2505"><a href="#L-2505"><span class="linenos">2505</span></a>          <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span> <span class="p">[</span><span class="n">close_to_or</span><span class="p">]),</span> <span class="c1"># TODO: ,r?</span>
</span><span id="L-2506"><a href="#L-2506"><span class="linenos">2506</span></a>          <span class="p">(</span><span class="n">a_as_in_ah</span><span class="p">,[</span><span class="n">a_as_in_apple</span><span class="p">]),</span> <span class="c1"># this seems to be missing in some American voices (DecTalk, Keynote, SAM); TODO: is this the best approximation we can do?</span>
</span><span id="L-2507"><a href="#L-2507"><span class="linenos">2507</span></a>          <span class="p">]:</span>
</span><span id="L-2508"><a href="#L-2508"><span class="linenos">2508</span></a>        <span class="k">if</span> <span class="n">miss</span> <span class="ow">in</span> <span class="n">missing</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">approxTo</span><span class="p">):</span>
</span><span id="L-2509"><a href="#L-2509"><span class="linenos">2509</span></a>          <span class="n">d</span><span class="p">[</span><span class="n">miss</span><span class="p">]</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phoneme_separator&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">d</span><span class="p">[</span><span class="n">approxTo</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">approxTo</span><span class="p">)</span>
</span><span id="L-2510"><a href="#L-2510"><span class="linenos">2510</span></a>          <span class="c1"># did_approx = True</span>
</span><span id="L-2511"><a href="#L-2511"><span class="linenos">2511</span></a>          <span class="n">missing</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">miss</span><span class="p">)</span>
</span><span id="L-2512"><a href="#L-2512"><span class="linenos">2512</span></a>    <span class="c1"># if did_approx: doc=&quot;(approx.) &quot;+doc # and see also the code in makeVariantDic.  Commenting out because this is misleading: the formats where we didn&#39;t do a did_approx might also contain approximations of some kind.  Incidentally there are some British English voices that need approximate_missing (e.g. Apollo 2)</span>
</span><span id="L-2513"><a href="#L-2513"><span class="linenos">2513</span></a>    <span class="n">d</span><span class="p">[(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">doc</span>
</span><span id="L-2514"><a href="#L-2514"><span class="linenos">2514</span></a>    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
</span><span id="L-2515"><a href="#L-2515"><span class="linenos">2515</span></a>       <span class="kn">import</span> <span class="nn">sys</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING: Some non-optional vowels/consonants are missing from &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The following are missing: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2516"><a href="#L-2516"><span class="linenos">2516</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">d</span><span class="p">[(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="L-2517"><a href="#L-2517"><span class="linenos">2517</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;cleanup_regexps&#39;</span><span class="p">),[]))</span><span class="o">==</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;cleanup_regexps must be a list&quot;</span> <span class="c1"># not one tuple</span>
</span><span id="L-2518"><a href="#L-2518"><span class="linenos">2518</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;cvtOut_regexps&#39;</span><span class="p">),[]))</span><span class="o">==</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;cvtOut_regexps must be a list&quot;</span> <span class="c1"># not one tuple</span>
</span><span id="L-2519"><a href="#L-2519"><span class="linenos">2519</span></a>    <span class="n">wsep</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;word_separator&#39;</span><span class="p">),</span><span class="kc">None</span><span class="p">)</span>
</span><span id="L-2520"><a href="#L-2520"><span class="linenos">2520</span></a>    <span class="n">psep</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;phoneme_separator&#39;</span><span class="p">),</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-2521"><a href="#L-2521"><span class="linenos">2521</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">wsep</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="k">assert</span> <span class="ow">not</span> <span class="n">wsep</span> <span class="ow">in</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;word_separator duplicates with a key in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="L-2522"><a href="#L-2522"><span class="linenos">2522</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">psep</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="k">assert</span> <span class="ow">not</span> <span class="n">psep</span> <span class="ow">in</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;phoneme_separator duplicates with a key (did you forget to change the default, or to add a ,False somewhere?) in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="L-2523"><a href="#L-2523"><span class="linenos">2523</span></a>    <span class="k">global</span> <span class="n">lastDictionaryMade</span> <span class="p">;</span> <span class="n">lastDictionaryMade</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="L-2524"><a href="#L-2524"><span class="linenos">2524</span></a>    <span class="k">return</span> <span class="n">d</span>
</span><span id="L-2525"><a href="#L-2525"><span class="linenos">2525</span></a><span class="k">def</span> <span class="nf">makeVariantDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="L-2526"><a href="#L-2526"><span class="linenos">2526</span></a>    <span class="s2">&quot;Like makeDic but create a new &#39;variant&#39; version of the last-made dictionary, modifying some phonemes and settings (and giving it a new doc string) but keeping everything else the same.  Any list settings (e.g. cleanup_regexps) are ADDED to by the variant; other settings and phonemes are REPLACED if they are specified in the variant.  If you don&#39;t want subsequent variants to inherit the changes made by this variant, add noInherit=True to the keyword args.&quot;</span>
</span><span id="L-2527"><a href="#L-2527"><span class="linenos">2527</span></a>    <span class="k">global</span> <span class="n">lastDictionaryMade</span>
</span><span id="L-2528"><a href="#L-2528"><span class="linenos">2528</span></a>    <span class="n">ldmOld</span> <span class="o">=</span> <span class="n">lastDictionaryMade</span>
</span><span id="L-2529"><a href="#L-2529"><span class="linenos">2529</span></a>    <span class="n">toUpdate</span> <span class="o">=</span> <span class="n">lastDictionaryMade</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="L-2530"><a href="#L-2530"><span class="linenos">2530</span></a>    <span class="k">global</span> <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span>
</span><span id="L-2531"><a href="#L-2531"><span class="linenos">2531</span></a>    <span class="n">oldV</span><span class="p">,</span><span class="n">oldC</span> <span class="o">=</span> <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span>
</span><span id="L-2532"><a href="#L-2532"><span class="linenos">2532</span></a>    <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c1"># so makeDic doesn&#39;t complain if some vowels/consonants are missing</span>
</span><span id="L-2533"><a href="#L-2533"><span class="linenos">2533</span></a>    <span class="k">if</span> <span class="s1">&#39;noInherit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="L-2534"><a href="#L-2534"><span class="linenos">2534</span></a>       <span class="n">noInherit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noInherit&#39;</span><span class="p">]</span>
</span><span id="L-2535"><a href="#L-2535"><span class="linenos">2535</span></a>       <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noInherit&#39;</span><span class="p">]</span>
</span><span id="L-2536"><a href="#L-2536"><span class="linenos">2536</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">noInherit</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2537"><a href="#L-2537"><span class="linenos">2537</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">makeDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="L-2538"><a href="#L-2538"><span class="linenos">2538</span></a>    <span class="k">if</span> <span class="n">noInherit</span><span class="p">:</span> <span class="n">lastDictionaryMade</span> <span class="o">=</span> <span class="n">ldmOld</span>
</span><span id="L-2539"><a href="#L-2539"><span class="linenos">2539</span></a>    <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span> <span class="o">=</span> <span class="n">oldV</span><span class="p">,</span><span class="n">oldC</span>
</span><span id="L-2540"><a href="#L-2540"><span class="linenos">2540</span></a>    <span class="c1"># if toUpdate[(&quot;settings&quot;,&quot;doc&quot;)].startswith(&quot;(approx.) &quot;) and not d[(&quot;settings&quot;,&quot;doc&quot;)].startswith(&quot;(approx.) &quot;): d[(&quot;settings&quot;,&quot;doc&quot;)]=&quot;(approx.) &quot;+d[(&quot;settings&quot;,&quot;doc&quot;)] # TODO: always?</span>
</span><span id="L-2541"><a href="#L-2541"><span class="linenos">2541</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">toUpdate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2542"><a href="#L-2542"><span class="linenos">2542</span></a>       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-2543"><a href="#L-2543"><span class="linenos">2543</span></a>    <span class="n">toUpdate</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">toUpdate</span>
</span><span id="L-2544"><a href="#L-2544"><span class="linenos">2544</span></a><span class="k">def</span> <span class="nf">getSetting</span><span class="p">(</span><span class="n">formatName</span><span class="p">,</span><span class="n">settingName</span><span class="p">):</span>
</span><span id="L-2545"><a href="#L-2545"><span class="linenos">2545</span></a>  <span class="s2">&quot;Gets a setting from lexFormats, exception if not there&quot;</span>
</span><span id="L-2546"><a href="#L-2546"><span class="linenos">2546</span></a>  <span class="k">return</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">formatName</span><span class="p">][(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">settingName</span><span class="p">)]</span>
</span><span id="L-2547"><a href="#L-2547"><span class="linenos">2547</span></a><span class="k">def</span> <span class="nf">checkSetting</span><span class="p">(</span><span class="n">formatName</span><span class="p">,</span><span class="n">settingName</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-2548"><a href="#L-2548"><span class="linenos">2548</span></a>  <span class="s2">&quot;Gets a setting from lexFormats, default if not there&quot;</span>
</span><span id="L-2549"><a href="#L-2549"><span class="linenos">2549</span></a>  <span class="k">return</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">formatName</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">settingName</span><span class="p">),</span><span class="n">default</span><span class="p">)</span>
</span><span id="L-2550"><a href="#L-2550"><span class="linenos">2550</span></a>
</span><span id="L-2551"><a href="#L-2551"><span class="linenos">2551</span></a><span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">re</span><span class="o">,</span><span class="nn">os</span>
</span><span id="L-2552"><a href="#L-2552"><span class="linenos">2552</span></a><span class="k">try</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">subprocess</span> <span class="kn">import</span> <span class="n">getoutput</span>
</span><span id="L-2553"><a href="#L-2553"><span class="linenos">2553</span></a><span class="k">except</span><span class="p">:</span> <span class="kn">from</span> <span class="nn">commands</span> <span class="kn">import</span> <span class="n">getoutput</span> <span class="c1"># Python 2</span>
</span><span id="L-2554"><a href="#L-2554"><span class="linenos">2554</span></a><span class="k">try</span><span class="p">:</span> <span class="nb">bytes</span> <span class="c1"># Python 3 and newer Python 2</span>
</span><span id="L-2555"><a href="#L-2555"><span class="linenos">2555</span></a><span class="k">except</span><span class="p">:</span> <span class="nb">bytes</span> <span class="o">=</span> <span class="nb">str</span> <span class="c1"># older Python 2</span>
</span><span id="L-2556"><a href="#L-2556"><span class="linenos">2556</span></a><span class="k">try</span><span class="p">:</span> <span class="n">unicode</span> <span class="c1"># Python 2</span>
</span><span id="L-2557"><a href="#L-2557"><span class="linenos">2557</span></a><span class="k">except</span><span class="p">:</span> <span class="c1"># Python 3</span>
</span><span id="L-2558"><a href="#L-2558"><span class="linenos">2558</span></a>   <span class="n">unicode</span><span class="p">,</span><span class="n">unichr</span><span class="p">,</span><span class="n">xrange</span> <span class="o">=</span> <span class="nb">str</span><span class="p">,</span><span class="nb">chr</span><span class="p">,</span><span class="nb">range</span>
</span><span id="L-2559"><a href="#L-2559"><span class="linenos">2559</span></a>   <span class="k">def</span> <span class="nf">chr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
</span><span id="L-2560"><a href="#L-2560"><span class="linenos">2560</span></a>   <span class="n">_builtin_sorted</span> <span class="o">=</span> <span class="nb">sorted</span>
</span><span id="L-2561"><a href="#L-2561"><span class="linenos">2561</span></a>   <span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">cmp_to_key</span>
</span><span id="L-2562"><a href="#L-2562"><span class="linenos">2562</span></a>   <span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">theCmp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-2563"><a href="#L-2563"><span class="linenos">2563</span></a>      <span class="k">if</span> <span class="n">theCmp</span><span class="p">:</span>
</span><span id="L-2564"><a href="#L-2564"><span class="linenos">2564</span></a>         <span class="k">return</span> <span class="n">_builtin_sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">theCmp</span><span class="p">))</span>
</span><span id="L-2565"><a href="#L-2565"><span class="linenos">2565</span></a>      <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">_builtin_sorted</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span><span id="L-2566"><a href="#L-2566"><span class="linenos">2566</span></a>   <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;lexconvert cannot run on Python 3.4 due to lack of byte-string percent formatting (PEP 461).  Please use Python 3.5+ or stick with Python 2.&quot;</span>
</span><span id="L-2567"><a href="#L-2567"><span class="linenos">2567</span></a><span class="k">def</span> <span class="nf">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span id="L-2568"><a href="#L-2568"><span class="linenos">2568</span></a>   <span class="s2">&quot;Return a buffer to which bytes may be written, for Python 2 and 3 compatibility&quot;</span>
</span><span id="L-2569"><a href="#L-2569"><span class="linenos">2569</span></a>   <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">buffer</span> <span class="c1"># Python 3</span>
</span><span id="L-2570"><a href="#L-2570"><span class="linenos">2570</span></a>   <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">return</span> <span class="n">f</span> <span class="c1"># Python 2</span>
</span><span id="L-2571"><a href="#L-2571"><span class="linenos">2571</span></a>
</span><span id="L-2572"><a href="#L-2572"><span class="linenos">2572</span></a><span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">,</span><span class="n">cached_dict</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
</span><span id="L-2573"><a href="#L-2573"><span class="linenos">2573</span></a><span class="k">def</span> <span class="nf">make_dictionary</span><span class="p">(</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">):</span>
</span><span id="L-2574"><a href="#L-2574"><span class="linenos">2574</span></a>    <span class="s2">&quot;Uses lexFormats to make a mapping dictionary from a particular source format to a particular dest format, and also sets module variables for that particular conversion (TODO: put those module vars into an object in case someone wants to use this code in a multithreaded server)&quot;</span>
</span><span id="L-2575"><a href="#L-2575"><span class="linenos">2575</span></a>    <span class="k">global</span> <span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">,</span><span class="n">cached_dict</span>
</span><span id="L-2576"><a href="#L-2576"><span class="linenos">2576</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">):</span> <span class="k">return</span> <span class="n">cached_dict</span>
</span><span id="L-2577"><a href="#L-2577"><span class="linenos">2577</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">sourceName</span><span class="p">]</span>
</span><span id="L-2578"><a href="#L-2578"><span class="linenos">2578</span></a>    <span class="n">dest</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">destName</span><span class="p">]</span>
</span><span id="L-2579"><a href="#L-2579"><span class="linenos">2579</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2580"><a href="#L-2580"><span class="linenos">2580</span></a>    <span class="k">global</span> <span class="n">dest_consonants</span> <span class="p">;</span> <span class="n">dest_consonants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2581"><a href="#L-2581"><span class="linenos">2581</span></a>    <span class="k">global</span> <span class="n">dest_syllable_sep</span> <span class="p">;</span> <span class="n">dest_syllable_sep</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2582"><a href="#L-2582"><span class="linenos">2582</span></a>    <span class="k">global</span> <span class="n">implicit_vowel_before_NL</span>
</span><span id="L-2583"><a href="#L-2583"><span class="linenos">2583</span></a>    <span class="n">implicit_vowel_before_NL</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2584"><a href="#L-2584"><span class="linenos">2584</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-2585"><a href="#L-2585"><span class="linenos">2585</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># settings</span>
</span><span id="L-2586"><a href="#L-2586"><span class="linenos">2586</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># (num-&gt;string entries are for converting IN to source; we want the string-&gt;num entries for converting out)</span>
</span><span id="L-2587"><a href="#L-2587"><span class="linenos">2587</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1"># (try the main version of a variant)</span>
</span><span id="L-2588"><a href="#L-2588"><span class="linenos">2588</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># (haven&#39;t got it - will have to ignore or break into parts)</span>
</span><span id="L-2589"><a href="#L-2589"><span class="linenos">2589</span></a>      <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span>
</span><span id="L-2590"><a href="#L-2590"><span class="linenos">2590</span></a>      <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
</span><span id="L-2591"><a href="#L-2591"><span class="linenos">2591</span></a>      <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">consonants</span><span class="p">:</span> <span class="n">dest_consonants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="L-2592"><a href="#L-2592"><span class="linenos">2592</span></a>      <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="n">e_as_in_herd</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">implicit_vowel_before_NL</span> <span class="ow">or</span> <span class="n">v</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span> <span class="c1"># TODO: or u_as_in_but ?  used by festival and some other synths before words ending &#39;n&#39; or &#39;l&#39; (see usage of implicit_vowel_before_NL later)</span>
</span><span id="L-2593"><a href="#L-2593"><span class="linenos">2593</span></a>        <span class="n">implicit_vowel_before_NL</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-2594"><a href="#L-2594"><span class="linenos">2594</span></a>      <span class="n">d</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-2595"><a href="#L-2595"><span class="linenos">2595</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="L-2596"><a href="#L-2596"><span class="linenos">2596</span></a>      <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-2597"><a href="#L-2597"><span class="linenos">2597</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2598"><a href="#L-2598"><span class="linenos">2598</span></a>       <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span> <span class="n">d</span><span class="p">,</span><span class="n">dest_consonants</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="nb">set</span><span class="p">(</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">)</span> <span class="c1"># Python 2: if ANY dest are Unicode, make them ALL Unicode</span>
</span><span id="L-2599"><a href="#L-2599"><span class="linenos">2599</span></a>    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span><span class="n">dest_consonants</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="nb">set</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">)</span> <span class="c1"># ... or make them ALL byte-strings if some were binary and not readable as UTF-8</span>
</span><span id="L-2600"><a href="#L-2600"><span class="linenos">2600</span></a>    <span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">,</span><span class="n">cached_dict</span><span class="o">=</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">,</span><span class="n">d</span>
</span><span id="L-2601"><a href="#L-2601"><span class="linenos">2601</span></a>    <span class="k">return</span> <span class="n">d</span>
</span><span id="L-2602"><a href="#L-2602"><span class="linenos">2602</span></a>
</span><span id="L-2603"><a href="#L-2603"><span class="linenos">2603</span></a><span class="n">warnedAlready</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="L-2604"><a href="#L-2604"><span class="linenos">2604</span></a><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">):</span>
</span><span id="L-2605"><a href="#L-2605"><span class="linenos">2605</span></a>    <span class="s2">&quot;Convert pronunc from source to dest.  pronunc can be a string or a list; if a list then we&#39;ll recurse on each of the list elements and return a new list (this is meant for batch-converting clauses etc)&quot;</span>
</span><span id="L-2606"><a href="#L-2606"><span class="linenos">2606</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">,</span><span class="nb">list</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2607"><a href="#L-2607"><span class="linenos">2607</span></a>    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="n">dest</span><span class="p">:</span> <span class="k">return</span> <span class="n">pronunc</span> <span class="c1"># essential for --try experimentation with codes not yet supported by lexconvert</span>
</span><span id="L-2608"><a href="#L-2608"><span class="linenos">2608</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">convert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="p">]</span>
</span><span id="L-2609"><a href="#L-2609"><span class="linenos">2609</span></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s1">&#39;cvtOut_func&#39;</span><span class="p">)</span>
</span><span id="L-2610"><a href="#L-2610"><span class="linenos">2610</span></a>    <span class="k">if</span> <span class="n">func</span><span class="p">:</span> <span class="n">pronunc</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2611"><a href="#L-2611"><span class="linenos">2611</span></a>    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s1">&#39;cvtOut_regexps&#39;</span><span class="p">):</span>
</span><span id="L-2612"><a href="#L-2612"><span class="linenos">2612</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2613"><a href="#L-2613"><span class="linenos">2613</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">toAddAfter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2614"><a href="#L-2614"><span class="linenos">2614</span></a>    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">make_dictionary</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">)</span>
</span><span id="L-2615"><a href="#L-2615"><span class="linenos">2615</span></a>    <span class="n">maxLen</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="L-2616"><a href="#L-2616"><span class="linenos">2616</span></a>    <span class="n">debugInfo</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="L-2617"><a href="#L-2617"><span class="linenos">2617</span></a>    <span class="n">separator</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;phoneme_separator&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="L-2618"><a href="#L-2618"><span class="linenos">2618</span></a>    <span class="n">safe_to_drop</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;safe_to_drop_characters&quot;</span><span class="p">)</span>
</span><span id="L-2619"><a href="#L-2619"><span class="linenos">2619</span></a>    <span class="k">while</span> <span class="n">pronunc</span><span class="p">:</span>
</span><span id="L-2620"><a href="#L-2620"><span class="linenos">2620</span></a>        <span class="k">for</span> <span class="n">lettersToTry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxLen</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="L-2621"><a href="#L-2621"><span class="linenos">2621</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">lettersToTry</span><span class="p">:</span>
</span><span id="L-2622"><a href="#L-2622"><span class="linenos">2622</span></a>              <span class="k">if</span> <span class="n">safe_to_drop</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-2623"><a href="#L-2623"><span class="linenos">2623</span></a>              <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">safe_to_drop</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="n">safe_to_drop</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span><span class="n">debugInfo</span><span class="p">)</span> <span class="ow">in</span> <span class="n">warnedAlready</span><span class="p">:</span>
</span><span id="L-2624"><a href="#L-2624"><span class="linenos">2624</span></a>                 <span class="n">warnedAlready</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span><span class="n">debugInfo</span><span class="p">))</span>
</span><span id="L-2625"><a href="#L-2625"><span class="linenos">2625</span></a>               <span class="c1">#   sys.stderr.write(&quot;Warning: ignoring &quot;+source+&quot; character &quot;+repr(pronunc[:1])+debugInfo+&quot; (unsupported in &quot;+dest+&quot;)\n&quot;)</span>
</span><span id="L-2626"><a href="#L-2626"><span class="linenos">2626</span></a>              <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># ignore</span>
</span><span id="L-2627"><a href="#L-2627"><span class="linenos">2627</span></a>            <span class="k">elif</span> <span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
</span><span id="L-2628"><a href="#L-2628"><span class="linenos">2628</span></a>                <span class="n">debugInfo</span><span class="o">=</span><span class="s2">&quot; after &quot;</span><span class="o">+</span><span class="n">as_printable</span><span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">])</span>
</span><span id="L-2629"><a href="#L-2629"><span class="linenos">2629</span></a>                <span class="n">toAdd</span><span class="o">=</span><span class="n">dictionary</span><span class="p">[</span><span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">]]</span>
</span><span id="L-2630"><a href="#L-2630"><span class="linenos">2630</span></a>                <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="L-2631"><a href="#L-2631"><span class="linenos">2631</span></a>                <span class="n">isStressMark</span><span class="o">=</span><span class="p">(</span><span class="n">toAdd</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">)])</span>
</span><span id="L-2632"><a href="#L-2632"><span class="linenos">2632</span></a>                <span class="k">if</span> <span class="n">toAdd</span><span class="o">==</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">):</span> <span class="k">pass</span>
</span><span id="L-2633"><a href="#L-2633"><span class="linenos">2633</span></a>                <span class="k">elif</span> <span class="n">isStressMark</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span>
</span><span id="L-2634"><a href="#L-2634"><span class="linenos">2634</span></a>                    <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span> <span class="n">toAdd</span><span class="p">,</span> <span class="n">toAddAfter</span> <span class="o">=</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">),</span><span class="n">toAdd</span> <span class="c1"># move stress marks from before vowel to after</span>
</span><span id="L-2635"><a href="#L-2635"><span class="linenos">2635</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="c1"># stress is already after, but:</span>
</span><span id="L-2636"><a href="#L-2636"><span class="linenos">2636</span></a>                        <span class="c1"># With Cepstral synth (and kana-approx), stress mark should be placed EXACTLY after the vowel and not any later.  Might as well do this for others also.</span>
</span><span id="L-2637"><a href="#L-2637"><span class="linenos">2637</span></a>                        <span class="n">r</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span><span id="L-2638"><a href="#L-2638"><span class="linenos">2638</span></a>                        <span class="k">while</span> <span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;*added&quot;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">])):</span> <span class="n">r</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># (if that raises IndexError then the input had a stress mark before any vowel) (&quot;*added&quot; condition is there so that implicit vowels don&#39;t get the stress)</span>
</span><span id="L-2639"><a href="#L-2639"><span class="linenos">2639</span></a>                        <span class="n">ret</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span> <span class="p">;</span> <span class="n">toAdd</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="L-2640"><a href="#L-2640"><span class="linenos">2640</span></a>                <span class="k">elif</span> <span class="n">isStressMark</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span> <span class="c1"># it&#39;s a stress mark that should be moved from after the vowel to before it</span>
</span><span id="L-2641"><a href="#L-2641"><span class="linenos">2641</span></a>                    <span class="n">i</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="L-2642"><a href="#L-2642"><span class="linenos">2642</span></a>                    <span class="k">while</span> <span class="n">i</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;*added&quot;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))):</span> <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="L-2643"><a href="#L-2643"><span class="linenos">2643</span></a>                    <span class="k">if</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">-=</span><span class="mi">1</span>
</span><span id="L-2644"><a href="#L-2644"><span class="linenos">2644</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="L-2645"><a href="#L-2645"><span class="linenos">2645</span></a>                    <span class="k">if</span> <span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">dest_syllable_sep</span><span class="p">,</span><span class="n">toAdd</span><span class="p">))</span> <span class="c1"># (TODO: this assumes stress marks are at end of syllable rather than immediately after vowel; correct for Festival; check others; probably a harmless assumption though; mac-uk is better with syllable separators although espeak basically ignores them)</span>
</span><span id="L-2646"><a href="#L-2646"><span class="linenos">2646</span></a>                    <span class="n">toAdd</span> <span class="o">=</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="L-2647"><a href="#L-2647"><span class="linenos">2647</span></a>                <span class="c1"># attempt to sort out the festival dictionary&#39;s (and other&#39;s) implicit_vowel_before_NL</span>
</span><span id="L-2648"><a href="#L-2648"><span class="linenos">2648</span></a>                <span class="k">elif</span> <span class="n">implicit_vowel_before_NL</span> <span class="ow">and</span> <span class="n">ret</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)]</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">implicit_vowel_before_NL</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">))</span>
</span><span id="L-2649"><a href="#L-2649"><span class="linenos">2649</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAdd</span><span class="o">==</span><span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="k">del</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2650"><a href="#L-2650"><span class="linenos">2650</span></a>                <span class="k">if</span> <span class="n">toAdd</span><span class="p">:</span>
</span><span id="L-2651"><a href="#L-2651"><span class="linenos">2651</span></a>                    <span class="c1"># Add it, but if toAdd is multiple phonemes, try to put toAddAfter after the FIRST phoneme</span>
</span><span id="L-2652"><a href="#L-2652"><span class="linenos">2652</span></a>                    <span class="k">if</span> <span class="n">separator</span><span class="p">:</span> <span class="n">toAddList</span><span class="o">=</span><span class="n">toAdd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
</span><span id="L-2653"><a href="#L-2653"><span class="linenos">2653</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="n">toAddList</span> <span class="o">=</span> <span class="p">[</span><span class="n">toAdd</span><span class="p">]</span> <span class="c1"># TODO: won&#39;t work for formats that don&#39;t have a phoneme separator (doesn&#39;t really matter for eSpeak though)</span>
</span><span id="L-2654"><a href="#L-2654"><span class="linenos">2654</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-2655"><a href="#L-2655"><span class="linenos">2655</span></a>                    <span class="k">if</span> <span class="n">toAddAfter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAddList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">:</span>
</span><span id="L-2656"><a href="#L-2656"><span class="linenos">2656</span></a>                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddAfter</span><span class="p">)</span>
</span><span id="L-2657"><a href="#L-2657"><span class="linenos">2657</span></a>                        <span class="n">toAddAfter</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-2658"><a href="#L-2658"><span class="linenos">2658</span></a>                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">toAddList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-2659"><a href="#L-2659"><span class="linenos">2659</span></a>                <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="n">lettersToTry</span><span class="p">:]</span>
</span><span id="L-2660"><a href="#L-2660"><span class="linenos">2660</span></a>                <span class="k">break</span>
</span><span id="L-2661"><a href="#L-2661"><span class="linenos">2661</span></a>    <span class="k">if</span> <span class="n">toAddAfter</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddAfter</span><span class="p">)</span>
</span><span id="L-2662"><a href="#L-2662"><span class="linenos">2662</span></a>    <span class="k">if</span> <span class="n">ret</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="k">del</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># spurious syllable separator at end</span>
</span><span id="L-2663"><a href="#L-2663"><span class="linenos">2663</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span> <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2664"><a href="#L-2664"><span class="linenos">2664</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">ret</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="L-2665"><a href="#L-2665"><span class="linenos">2665</span></a>    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;cleanup_regexps&#39;</span><span class="p">):</span>
</span><span id="L-2666"><a href="#L-2666"><span class="linenos">2666</span></a>      <span class="n">ret</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ret</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">ret</span><span class="p">),</span><span class="n">ret</span><span class="p">)</span>
</span><span id="L-2667"><a href="#L-2667"><span class="linenos">2667</span></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;cleanup_func&#39;</span><span class="p">)</span>
</span><span id="L-2668"><a href="#L-2668"><span class="linenos">2668</span></a>    <span class="k">if</span> <span class="n">func</span><span class="p">:</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="L-2669"><a href="#L-2669"><span class="linenos">2669</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ret</span>
</span><span id="L-2670"><a href="#L-2670"><span class="linenos">2670</span></a>
</span><span id="L-2671"><a href="#L-2671"><span class="linenos">2671</span></a><span class="k">def</span> <span class="nf">unicode_preprocess</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2672"><a href="#L-2672"><span class="linenos">2672</span></a>   <span class="s2">&quot;Special-case cvtOut_func for unicode-ipa: tries to catch </span><span class="se">\\</span><span class="s2">uNNNN etc&quot;</span>
</span><span id="L-2673"><a href="#L-2673"><span class="linenos">2673</span></a>   <span class="k">if</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">u&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pronunc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="p">:</span> <span class="c1"># maybe \uNNNN copied from Gecko on X11, can just evaluate it to get the unicode</span>
</span><span id="L-2674"><a href="#L-2674"><span class="linenos">2674</span></a>      <span class="c1"># (NB make sure to quote the \&#39;s if pasing in on the command line)</span>
</span><span id="L-2675"><a href="#L-2675"><span class="linenos">2675</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">pronunc</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;u&quot;&#39;</span><span class="o">+</span><span class="n">pronunc</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="L-2676"><a href="#L-2676"><span class="linenos">2676</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-2677"><a href="#L-2677"><span class="linenos">2677</span></a>   <span class="k">else</span><span class="p">:</span> <span class="c1"># see if it makes sense as utf-8</span>
</span><span id="L-2678"><a href="#L-2678"><span class="linenos">2678</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">pronunc</span> <span class="o">=</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2679"><a href="#L-2679"><span class="linenos">2679</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-2680"><a href="#L-2680"><span class="linenos">2680</span></a>   <span class="k">return</span> <span class="n">pronunc</span>
</span><span id="L-2681"><a href="#L-2681"><span class="linenos">2681</span></a>
</span><span id="L-2682"><a href="#L-2682"><span class="linenos">2682</span></a><span class="k">def</span> <span class="nf">ascii_braille_to_unicode</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
</span><span id="L-2683"><a href="#L-2683"><span class="linenos">2683</span></a>  <span class="s2">&quot;Special-case cleanup_func for braille-ipa (set by braille-ipa if BRAILLE_UNICODE is set).  Converts Braille ASCII to Unicode dot patterns.&quot;</span>
</span><span id="L-2684"><a href="#L-2684"><span class="linenos">2684</span></a>  <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot; A1B&#39;K2L@CIF/MSP</span><span class="se">\&quot;</span><span class="s2">E3H9O6R^DJG&gt;NTQ,*5&lt;-U8V.%[$+X!&amp;;:4</span><span class="se">\\</span><span class="s2">0Z7(_?W]#Y)=&quot;</span><span class="p">),[</span><span class="n">unichr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x2800</span><span class="p">,</span><span class="mh">0x2840</span><span class="p">)]))</span>
</span><span id="L-2685"><a href="#L-2685"><span class="linenos">2685</span></a>  <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span id="L-2686"><a href="#L-2686"><span class="linenos">2686</span></a><span class="k">def</span> <span class="nf">unicode_to_ascii_braille</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
</span><span id="L-2687"><a href="#L-2687"><span class="linenos">2687</span></a>  <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">unichr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x2800</span><span class="p">,</span><span class="mh">0x2840</span><span class="p">)],</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot; A1B&#39;K2L@CIF/MSP</span><span class="se">\&quot;</span><span class="s2">E3H9O6R^DJG&gt;NTQ,*5&lt;-U8V.%[$+X!&amp;;:4</span><span class="se">\\</span><span class="s2">0Z7(_?W]#Y)=&quot;</span><span class="p">)))</span>
</span><span id="L-2688"><a href="#L-2688"><span class="linenos">2688</span></a>  <span class="n">r</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
</span><span id="L-2689"><a href="#L-2689"><span class="linenos">2689</span></a>  <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;,7&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;7&#39;&quot;</span><span class="p">):</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2690"><a href="#L-2690"><span class="linenos">2690</span></a>  <span class="k">return</span> <span class="n">r</span>
</span><span id="L-2691"><a href="#L-2691"><span class="linenos">2691</span></a>
</span><span id="L-2692"><a href="#L-2692"><span class="linenos">2692</span></a><span class="k">def</span> <span class="nf">hiragana_to_katakana</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
</span><span id="L-2693"><a href="#L-2693"><span class="linenos">2693</span></a>   <span class="s2">&quot;Special-case cleanup_func for kana-approx; converts all hiragana characters in unicode string &#39;u&#39; into katakana if KANA_TYPE is set to anything beginning with a &#39;k&#39;&quot;</span>
</span><span id="L-2694"><a href="#L-2694"><span class="linenos">2694</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span>
</span><span id="L-2695"><a href="#L-2695"><span class="linenos">2695</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KANA_TYPE&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">u</span>
</span><span id="L-2696"><a href="#L-2696"><span class="linenos">2696</span></a>   <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-2697"><a href="#L-2697"><span class="linenos">2697</span></a>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)):</span>
</span><span id="L-2698"><a href="#L-2698"><span class="linenos">2698</span></a>      <span class="k">if</span> <span class="mh">0x3041</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mh">0x3096</span><span class="p">:</span>
</span><span id="L-2699"><a href="#L-2699"><span class="linenos">2699</span></a>         <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">unichr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="mh">0x60</span><span class="p">)</span>
</span><span id="L-2700"><a href="#L-2700"><span class="linenos">2700</span></a>   <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="L-2701"><a href="#L-2701"><span class="linenos">2701</span></a>
</span><span id="L-2702"><a href="#L-2702"><span class="linenos">2702</span></a><span class="k">def</span> <span class="nf">espeak_probably_right_already</span><span class="p">(</span><span class="n">existing_pronunc</span><span class="p">,</span><span class="n">new_pronunc</span><span class="p">):</span>
</span><span id="L-2703"><a href="#L-2703"><span class="linenos">2703</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Used by convert_system_festival_dictionary_to_espeak to compare a &quot;new&quot; pronunciation with eSpeak&#39;s existing pronunciation.  As the transcription from OALD to eSpeak is only approximate, it could be that our new pronunciation is not identical to the existing one but the existing one is actually correct; try to detect when this happens by checking if the pronunciations are the same after some simplifications.&quot;&quot;&quot;</span>
</span><span id="L-2704"><a href="#L-2704"><span class="linenos">2704</span></a>    <span class="k">if</span> <span class="n">existing_pronunc</span><span class="o">==</span><span class="n">new_pronunc</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span><span id="L-2705"><a href="#L-2705"><span class="linenos">2705</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span> <span class="k">return</span> \
</span><span id="L-2706"><a href="#L-2706"><span class="linenos">2706</span></a>        <span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2707"><a href="#L-2707"><span class="linenos">2707</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;a2&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2708"><a href="#L-2708"><span class="linenos">2708</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2709"><a href="#L-2709"><span class="linenos">2709</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2710"><a href="#L-2710"><span class="linenos">2710</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2711"><a href="#L-2711"><span class="linenos">2711</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2712"><a href="#L-2712"><span class="linenos">2712</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2713"><a href="#L-2713"><span class="linenos">2713</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2714"><a href="#L-2714"><span class="linenos">2714</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;aa&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2715"><a href="#L-2715"><span class="linenos">2715</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2716"><a href="#L-2716"><span class="linenos">2716</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2717"><a href="#L-2717"><span class="linenos">2717</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;o@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="L-2718"><a href="#L-2718"><span class="linenos">2718</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;r-&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span>
</span><span id="L-2719"><a href="#L-2719"><span class="linenos">2719</span></a>    <span class="c1"># TODO: rewrite @ to 3 whenever not followed by a vowel?</span>
</span><span id="L-2720"><a href="#L-2720"><span class="linenos">2720</span></a>    <span class="k">if</span> <span class="n">as_printable</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">existing_pronunc</span><span class="p">))</span><span class="o">==</span><span class="n">as_printable</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">new_pronunc</span><span class="p">)):</span> <span class="k">return</span> <span class="kc">True</span> <span class="c1"># almost the same, and festival @/a2 etc seems to be a bit ambiguous so leave it alone</span>
</span><span id="L-2721"><a href="#L-2721"><span class="linenos">2721</span></a>
</span><span id="L-2722"><a href="#L-2722"><span class="linenos">2722</span></a><span class="k">def</span> <span class="nf">parse_festival_dict</span><span class="p">(</span><span class="n">festival_location</span><span class="p">):</span>
</span><span id="L-2723"><a href="#L-2723"><span class="linenos">2723</span></a>    <span class="s2">&quot;For OALD; yields word,part-of-speech,pronunciation&quot;</span>
</span><span id="L-2724"><a href="#L-2724"><span class="linenos">2724</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2725"><a href="#L-2725"><span class="linenos">2725</span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
</span><span id="L-2726"><a href="#L-2726"><span class="linenos">2726</span></a>        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="L-2727"><a href="#L-2727"><span class="linenos">2727</span></a>        <span class="k">if</span> <span class="s2">&quot;((pos&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;((pos&quot;</span><span class="p">)]</span>
</span><span id="L-2728"><a href="#L-2728"><span class="linenos">2728</span></a>        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;( &quot;&#39;</span><span class="p">):</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</span><span id="L-2729"><a href="#L-2729"><span class="linenos">2729</span></a>        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-2730"><a href="#L-2730"><span class="linenos">2730</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="L-2731"><a href="#L-2731"><span class="linenos">2731</span></a>            <span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pronunc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-2732"><a href="#L-2732"><span class="linenos">2732</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># malformed line</span>
</span><span id="L-2733"><a href="#L-2733"><span class="linenos">2733</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;nil&#39;</span><span class="p">,</span><span class="s1">&#39;prp&#39;</span><span class="p">,</span><span class="s1">&#39;uh&#39;</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># two or more words</span>
</span><span id="L-2734"><a href="#L-2734"><span class="linenos">2734</span></a>        <span class="k">yield</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2735"><a href="#L-2735"><span class="linenos">2735</span></a>
</span><span id="L-2736"><a href="#L-2736"><span class="linenos">2736</span></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</span><span id="L-2737"><a href="#L-2737"><span class="linenos">2737</span></a><span class="k">def</span> <span class="nf">convert_system_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span><span class="n">check_existing_pronunciation</span><span class="p">,</span><span class="n">add_user_dictionary_also</span><span class="p">):</span>
</span><span id="L-2738"><a href="#L-2738"><span class="linenos">2738</span></a>    <span class="s2">&quot;See mainopt_festival_dictionary_to_espeak&quot;</span>
</span><span id="L-2739"><a href="#L-2739"><span class="linenos">2739</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;mv en_extra en_extra~&quot;</span><span class="p">)</span> <span class="c1"># start with blank &#39;extra&#39; dictionary</span>
</span><span id="L-2740"><a href="#L-2740"><span class="linenos">2740</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span> <span class="c1"># so that the pronunciation we&#39;re checking against is not influenced by a previous version of en_extra</span>
</span><span id="L-2741"><a href="#L-2741"><span class="linenos">2741</span></a>    <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2742"><a href="#L-2742"><span class="linenos">2742</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Reading dictionary lists&quot;</span><span class="p">)</span>
</span><span id="L-2743"><a href="#L-2743"><span class="linenos">2743</span></a>    <span class="n">wordDic</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">ambiguous</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2744"><a href="#L-2744"><span class="linenos">2744</span></a>    <span class="n">el</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_list&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2745"><a href="#L-2745"><span class="linenos">2745</span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-z]* *\$&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">),</span><span class="n">getBuf</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))):</span> <span class="n">ambiguous</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">ambiguous</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)]</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># this stops the code below from overriding anything already in espeak&#39;s en_list.  If taking out then you need to think carefully about words like &quot;a&quot;, &quot;the&quot; etc.</span>
</span><span id="L-2746"><a href="#L-2746"><span class="linenos">2746</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">pronunc</span> <span class="ow">in</span> <span class="n">parse_festival_dict</span><span class="p">(</span><span class="n">festival_location</span><span class="p">):</span>
</span><span id="L-2747"><a href="#L-2747"><span class="linenos">2747</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;i@ 0 @ 0&quot;</span><span class="p">,</span><span class="s2">&quot;ii ou 2 &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;i@ 0 u 0&quot;</span><span class="p">,</span><span class="s2">&quot;ii ou &quot;</span><span class="p">)</span> <span class="c1"># (hack for OALD&#39;s &quot;radio&quot;/&quot;video&quot;/&quot;stereo&quot;/&quot;embryo&quot; etc)</span>
</span><span id="L-2748"><a href="#L-2748"><span class="linenos">2748</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># 0&#39;s not necessary, and OALD sometimes puts them in wrong places, confusing the converter</span>
</span><span id="L-2749"><a href="#L-2749"><span class="linenos">2749</span></a>        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mosquitoes&#39;</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># OALD bug (TODO: any others?)</span>
</span><span id="L-2750"><a href="#L-2750"><span class="linenos">2750</span></a>        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wordDic</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">==</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
</span><span id="L-2751"><a href="#L-2751"><span class="linenos">2751</span></a>            <span class="n">ambiguous</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-2752"><a href="#L-2752"><span class="linenos">2752</span></a>            <span class="k">del</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="c1"># better not go there</span>
</span><span id="L-2753"><a href="#L-2753"><span class="linenos">2753</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ambiguous</span><span class="p">:</span>
</span><span id="L-2754"><a href="#L-2754"><span class="linenos">2754</span></a>            <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pronunc</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="L-2755"><a href="#L-2755"><span class="linenos">2755</span></a>    <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2756"><a href="#L-2756"><span class="linenos">2756</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="L-2757"><a href="#L-2757"><span class="linenos">2757</span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Checking existing pronunciation&quot;</span><span class="p">)</span>
</span><span id="L-2758"><a href="#L-2758"><span class="linenos">2758</span></a>        <span class="n">proc</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -q -x -v en-rp &gt; /tmp/.pronunc 2&gt;&amp;1&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2759"><a href="#L-2759"><span class="linenos">2759</span></a>        <span class="n">wList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2760"><a href="#L-2760"><span class="linenos">2760</span></a>    <span class="n">progressCount</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">oldPercent</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="L-2761"><a href="#L-2761"><span class="linenos">2761</span></a>    <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wordDic</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="L-2762"><a href="#L-2762"><span class="linenos">2762</span></a>    <span class="c1"># Make sure it&#39;s NOT sorted, to ensure eSpeak doesn&#39;t</span>
</span><span id="L-2763"><a href="#L-2763"><span class="linenos">2763</span></a>    <span class="c1"># cache pronunciation of previous word when add suffix</span>
</span><span id="L-2764"><a href="#L-2764"><span class="linenos">2764</span></a>    <span class="c1"># (which can subtly change eSpeak&#39;s pronunciation in</span>
</span><span id="L-2765"><a href="#L-2765"><span class="linenos">2765</span></a>    <span class="c1"># some versions of eSpeak, leading to</span>
</span><span id="L-2766"><a href="#L-2766"><span class="linenos">2766</span></a>    <span class="c1"># Python 2/3 differences as Python 3 sorts by default) :</span>
</span><span id="L-2767"><a href="#L-2767"><span class="linenos">2767</span></a>    <span class="n">itemList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-2768"><a href="#L-2768"><span class="linenos">2768</span></a>    <span class="n">i0</span><span class="p">,</span><span class="n">i1</span> <span class="o">=</span> <span class="n">itemList</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="n">itemList</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>
</span><span id="L-2769"><a href="#L-2769"><span class="linenos">2769</span></a>    <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2770"><a href="#L-2770"><span class="linenos">2770</span></a>    <span class="k">while</span> <span class="n">i0</span> <span class="ow">or</span> <span class="n">i1</span><span class="p">:</span>
</span><span id="L-2771"><a href="#L-2771"><span class="linenos">2771</span></a>       <span class="k">if</span> <span class="n">i0</span><span class="p">:</span> <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i0</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span id="L-2772"><a href="#L-2772"><span class="linenos">2772</span></a>       <span class="k">if</span> <span class="n">i1</span><span class="p">:</span> <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i1</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span id="L-2773"><a href="#L-2773"><span class="linenos">2773</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itemList</span><span class="p">:</span>
</span><span id="L-2774"><a href="#L-2774"><span class="linenos">2774</span></a>        <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="L-2775"><a href="#L-2775"><span class="linenos">2775</span></a>            <span class="n">percent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">progressCount</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">wordDic</span><span class="p">))</span>
</span><span id="L-2776"><a href="#L-2776"><span class="linenos">2776</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">percent</span><span class="o">==</span><span class="n">oldPercent</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;%</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2777"><a href="#L-2777"><span class="linenos">2777</span></a>            <span class="n">oldPercent</span><span class="o">=</span><span class="n">percent</span>
</span><span id="L-2778"><a href="#L-2778"><span class="linenos">2778</span></a>            <span class="n">progressCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2779"><a href="#L-2779"><span class="linenos">2779</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[A-Za-z]*$&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">):</span> <span class="c1"># (some versions of eSpeak also OK with &quot;-&quot;, but not all)</span>
</span><span id="L-2780"><a href="#L-2780"><span class="linenos">2780</span></a>            <span class="c1"># contains special characters - better not go there</span>
</span><span id="L-2781"><a href="#L-2781"><span class="linenos">2781</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="L-2782"><a href="#L-2782"><span class="linenos">2782</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;plaque&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">word</span> <span class="ow">in</span> <span class="s2">&quot;friday saturday sunday tuesday thursday yesterday&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="L-2783"><a href="#L-2783"><span class="linenos">2783</span></a>            <span class="c1"># hack to accept eSpeak&#39;s pl&#39;ak instead of pl&#39;A:k - order was reversed in the March 2009 draft</span>
</span><span id="L-2784"><a href="#L-2784"><span class="linenos">2784</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="L-2785"><a href="#L-2785"><span class="linenos">2785</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;s&quot;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">wordDic</span><span class="p">:</span>
</span><span id="L-2786"><a href="#L-2786"><span class="linenos">2786</span></a>            <span class="c1"># unnecessary plural (espeak will pick up on them anyway)</span>
</span><span id="L-2787"><a href="#L-2787"><span class="linenos">2787</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="L-2788"><a href="#L-2788"><span class="linenos">2788</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;quarter&quot;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span> <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="c1"># don&#39;t like festival&#39;s pronunciation of those (TODO: also &#39;memorial&#39; why start with [m&#39;I])</span>
</span><span id="L-2789"><a href="#L-2789"><span class="linenos">2789</span></a>        <span class="k">elif</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="L-2790"><a href="#L-2790"><span class="linenos">2790</span></a>            <span class="n">getBuf</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-2791"><a href="#L-2791"><span class="linenos">2791</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># so the progress indicator works</span>
</span><span id="L-2792"><a href="#L-2792"><span class="linenos">2792</span></a>            <span class="n">wList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="L-2793"><a href="#L-2793"><span class="linenos">2793</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="L-2794"><a href="#L-2794"><span class="linenos">2794</span></a>        <span class="n">proc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2795"><a href="#L-2795"><span class="linenos">2795</span></a>        <span class="n">oldPronDic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-2796"><a href="#L-2796"><span class="linenos">2796</span></a>        <span class="n">tp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/.pronunc&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2797"><a href="#L-2797"><span class="linenos">2797</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wList</span><span class="p">,</span><span class="n">getBuf</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span> <span class="n">oldPronDic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="L-2798"><a href="#L-2798"><span class="linenos">2798</span></a>    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">toDel</span><span class="p">:</span> <span class="k">del</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="L-2799"><a href="#L-2799"><span class="linenos">2799</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Doing the conversion&quot;</span><span class="p">)</span>
</span><span id="L-2800"><a href="#L-2800"><span class="linenos">2800</span></a>    <span class="n">lines_output</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2801"><a href="#L-2801"><span class="linenos">2801</span></a>    <span class="n">total_lines</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2802"><a href="#L-2802"><span class="linenos">2802</span></a>    <span class="n">not_output_because_ok</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2803"><a href="#L-2803"><span class="linenos">2803</span></a>    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wordDic</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="p">;</span> <span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># necessary because of the hacks below which check for the presence of truncated versions of the word (want to have decided whether or not to output those truncated versions before reaching the hacks)</span>
</span><span id="L-2804"><a href="#L-2804"><span class="linenos">2804</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="L-2805"><a href="#L-2805"><span class="linenos">2805</span></a>        <span class="n">total_lines</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2806"><a href="#L-2806"><span class="linenos">2806</span></a>        <span class="n">new_e_pronunc</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="s2">&quot;festival&quot;</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">)</span>
</span><span id="L-2807"><a href="#L-2807"><span class="linenos">2807</span></a>        <span class="k">if</span> <span class="n">new_e_pronunc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span> <span class="n">new_e_pronunc</span><span class="o">=</span><span class="n">new_e_pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># if 2 primary accents then make the first one a secondary (except on hyphenated words)</span>
</span><span id="L-2808"><a href="#L-2808"><span class="linenos">2808</span></a>        <span class="c1"># TODO if not en-rp? - if (word.endswith(&quot;y&quot;) or word.endswith(&quot;ie&quot;)) and new_e_pronunc.endswith(&quot;i:&quot;): new_e_pronunc=new_e_pronunc[:-2]+&quot;I&quot;</span>
</span><span id="L-2809"><a href="#L-2809"><span class="linenos">2809</span></a>        <span class="n">unrelated_word</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="L-2810"><a href="#L-2810"><span class="linenos">2810</span></a>        <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="n">oldPronDic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-2811"><a href="#L-2811"><span class="linenos">2811</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-2812"><a href="#L-2812"><span class="linenos">2812</span></a>        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;e&#39;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">wordDic</span><span class="p">:</span> <span class="n">unrelated_word</span><span class="p">,</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;&quot;</span> <span class="c1"># hack: if word ends with &#39;e&#39; and dropping the &#39;e&#39; leaves a valid word that&#39;s also in the dictionary, we DON&#39;T want to drop this word on the grounds that espeak already gets it right, because if we do then adding &#39;s&#39; to this word may cause espeak to add &#39;s&#39; to the OTHER word (&#39;-es&#39; rule).</span>
</span><span id="L-2813"><a href="#L-2813"><span class="linenos">2813</span></a>        <span class="k">if</span> <span class="n">espeak_probably_right_already</span><span class="p">(</span><span class="n">espeakPronunc</span><span class="p">,</span><span class="n">new_e_pronunc</span><span class="p">):</span>
</span><span id="L-2814"><a href="#L-2814"><span class="linenos">2814</span></a>            <span class="n">not_output_because_ok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="L-2815"><a href="#L-2815"><span class="linenos">2815</span></a>            <span class="k">continue</span>
</span><span id="L-2816"><a href="#L-2816"><span class="linenos">2816</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">unrelated_word</span><span class="p">:</span> <span class="n">lines_output</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2817"><a href="#L-2817"><span class="linenos">2817</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">new_e_pronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; // from Festival&#39;s (&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">))</span>
</span><span id="L-2818"><a href="#L-2818"><span class="linenos">2818</span></a>        <span class="k">if</span> <span class="n">espeakPronunc</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;, not [[&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">espeakPronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;]]&quot;</span><span class="p">))</span>
</span><span id="L-2819"><a href="#L-2819"><span class="linenos">2819</span></a>        <span class="k">elif</span> <span class="n">unrelated_word</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; (here to stop espeak&#39;s affix rules getting confused by Festival&#39;s </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">unrelated_word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">))</span>
</span><span id="L-2820"><a href="#L-2820"><span class="linenos">2820</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-2821"><a href="#L-2821"><span class="linenos">2821</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Corrected(?) </span><span class="si">%d</span><span class="s2"> entries out of </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lines_output</span><span class="p">,</span><span class="n">total_lines</span><span class="p">))</span>
</span><span id="L-2822"><a href="#L-2822"><span class="linenos">2822</span></a>    <span class="k">if</span> <span class="n">add_user_dictionary_also</span><span class="p">:</span> <span class="n">convert_user_lexicon</span><span class="p">(</span><span class="s2">&quot;festival&quot;</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="L-2823"><a href="#L-2823"><span class="linenos">2823</span></a>    <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2824"><a href="#L-2824"><span class="linenos">2824</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span>
</span><span id="L-2825"><a href="#L-2825"><span class="linenos">2825</span></a>    <span class="k">if</span> <span class="n">not_output_because_ok</span><span class="p">:</span>
</span><span id="L-2826"><a href="#L-2826"><span class="linenos">2826</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Checking for unwanted side-effects of those corrections&quot;</span><span class="p">)</span> <span class="c1"># e.g. terrible as Terr + ible, inducing as in+Duce+ing</span>
</span><span id="L-2827"><a href="#L-2827"><span class="linenos">2827</span></a>      <span class="n">proc</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -q -x -v en-rp &gt; /tmp/.pronunc 2&gt;&amp;1&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="L-2828"><a href="#L-2828"><span class="linenos">2828</span></a>      <span class="n">progressCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2829"><a href="#L-2829"><span class="linenos">2829</span></a>      <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">not_output_because_ok</span><span class="p">:</span>
</span><span id="L-2830"><a href="#L-2830"><span class="linenos">2830</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="p">;</span> <span class="n">proc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2831"><a href="#L-2831"><span class="linenos">2831</span></a>          <span class="n">percent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">progressCount</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">not_output_because_ok</span><span class="p">))</span>
</span><span id="L-2832"><a href="#L-2832"><span class="linenos">2832</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">percent</span><span class="o">==</span><span class="n">oldPercent</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;%</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-2833"><a href="#L-2833"><span class="linenos">2833</span></a>          <span class="n">oldPercent</span> <span class="o">=</span> <span class="n">percent</span>
</span><span id="L-2834"><a href="#L-2834"><span class="linenos">2834</span></a>          <span class="n">progressCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2835"><a href="#L-2835"><span class="linenos">2835</span></a>      <span class="n">proc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2836"><a href="#L-2836"><span class="linenos">2836</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># append to it</span>
</span><span id="L-2837"><a href="#L-2837"><span class="linenos">2837</span></a>      <span class="n">tp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/.pronunc&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2838"><a href="#L-2838"><span class="linenos">2838</span></a>      <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pronunc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">not_output_because_ok</span><span class="p">,</span><span class="n">getBuf</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span>
</span><span id="L-2839"><a href="#L-2839"><span class="linenos">2839</span></a>        <span class="n">pronunc</span> <span class="o">=</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="L-2840"><a href="#L-2840"><span class="linenos">2840</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pronunc</span><span class="o">==</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">espeak_probably_right_already</span><span class="p">(</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">],</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2841"><a href="#L-2841"><span class="linenos">2841</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; // (undo affix-side-effect from previous words that gave </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">pronunc</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="L-2842"><a href="#L-2842"><span class="linenos">2842</span></a>      <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-2843"><a href="#L-2843"><span class="linenos">2843</span></a>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span>
</span><span id="L-2844"><a href="#L-2844"><span class="linenos">2844</span></a>    <span class="k">return</span> <span class="n">not_output_because_ok</span>
</span><span id="L-2845"><a href="#L-2845"><span class="linenos">2845</span></a>
</span><span id="L-2846"><a href="#L-2846"><span class="linenos">2846</span></a><span class="k">def</span> <span class="nf">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">):</span>
</span><span id="L-2847"><a href="#L-2847"><span class="linenos">2847</span></a>    <span class="s2">&quot;Calls the appropriate lex_read_function, opening lex_filename first if supplied&quot;</span>
</span><span id="L-2848"><a href="#L-2848"><span class="linenos">2848</span></a>    <span class="n">readFunction</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;lex_read_function&quot;</span><span class="p">)</span>
</span><span id="L-2849"><a href="#L-2849"><span class="linenos">2849</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">readFunction</span><span class="p">:</span> <span class="k">raise</span> <span class="n">Message</span><span class="p">(</span><span class="s2">&quot;Reading from &#39;</span><span class="si">%s</span><span class="s2">&#39; lexicon file not yet implemented (no lex_read_function); try using --phones or --phones2phones options instead&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fromFormat</span><span class="p">,))</span>
</span><span id="L-2850"><a href="#L-2850"><span class="linenos">2850</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="L-2851"><a href="#L-2851"><span class="linenos">2851</span></a>       <span class="n">lexFilename</span> <span class="o">=</span> <span class="n">getSetting</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span>
</span><span id="L-2852"><a href="#L-2852"><span class="linenos">2852</span></a>       <span class="k">if</span> <span class="n">lexFilename</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="n">lexfile</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># e.g. the example lexicon</span>
</span><span id="L-2853"><a href="#L-2853"><span class="linenos">2853</span></a>       <span class="k">else</span><span class="p">:</span>
</span><span id="L-2854"><a href="#L-2854"><span class="linenos">2854</span></a>          <span class="n">lexfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lexFilename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2855"><a href="#L-2855"><span class="linenos">2855</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LEXCONVERT_OMIT_READING_FROM&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Reading from &quot;</span><span class="o">+</span><span class="n">lexFilename</span><span class="p">)</span> <span class="c1"># TODO: document LEXCONVERT_OMIT_READING_FROM (might be useful for the --mac-uk option)</span>
</span><span id="L-2856"><a href="#L-2856"><span class="linenos">2856</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">lexfile</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># lex_read_function without lex_filename is allowed, if the read function can take null param and fetch the lexicon itself</span>
</span><span id="L-2857"><a href="#L-2857"><span class="linenos">2857</span></a>    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">Message</span><span class="p">(</span><span class="n">fromFormat</span><span class="o">+</span><span class="s2">&quot;&#39;s lexicon is expected to be in a file called &quot;</span><span class="o">+</span><span class="n">replHome</span><span class="p">(</span><span class="n">lexFilename</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; which could not be read - please fix and try again&quot;</span><span class="p">)</span>
</span><span id="L-2858"><a href="#L-2858"><span class="linenos">2858</span></a>    <span class="k">return</span> <span class="n">readFunction</span><span class="p">(</span><span class="n">lexfile</span><span class="p">)</span>
</span><span id="L-2859"><a href="#L-2859"><span class="linenos">2859</span></a>
</span><span id="L-2860"><a href="#L-2860"><span class="linenos">2860</span></a><span class="k">def</span> <span class="nf">replHome</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
</span><span id="L-2861"><a href="#L-2861"><span class="linenos">2861</span></a>   <span class="s2">&quot;Format fname for printing, substituting ~ for HOME if appropriate&quot;</span>
</span><span id="L-2862"><a href="#L-2862"><span class="linenos">2862</span></a>   <span class="n">h</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-2863"><a href="#L-2863"><span class="linenos">2863</span></a>   <span class="k">if</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="L-2864"><a href="#L-2864"><span class="linenos">2864</span></a>      <span class="k">return</span> <span class="s2">&quot;~&quot;</span><span class="o">+</span><span class="n">fname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">):]</span>
</span><span id="L-2865"><a href="#L-2865"><span class="linenos">2865</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">fname</span>
</span><span id="L-2866"><a href="#L-2866"><span class="linenos">2866</span></a>    
</span><span id="L-2867"><a href="#L-2867"><span class="linenos">2867</span></a><span class="k">def</span> <span class="nf">get_macuk_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">):</span>
</span><span id="L-2868"><a href="#L-2868"><span class="linenos">2868</span></a>    <span class="s2">&quot;Converts lexicon from fromFormat and returns a list suitable for MacBritish_System_Lexicon&#39;s readWithLex&quot;</span>
</span><span id="L-2869"><a href="#L-2869"><span class="linenos">2869</span></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="n">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)]</span>
</span><span id="L-2870"><a href="#L-2870"><span class="linenos">2870</span></a>
</span><span id="L-2871"><a href="#L-2871"><span class="linenos">2871</span></a><span class="k">def</span> <span class="nf">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-2872"><a href="#L-2872"><span class="linenos">2872</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2873"><a href="#L-2873"><span class="linenos">2873</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="L-2874"><a href="#L-2874"><span class="linenos">2874</span></a><span class="k">def</span> <span class="nf">as_unicode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-2875"><a href="#L-2875"><span class="linenos">2875</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="L-2876"><a href="#L-2876"><span class="linenos">2876</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2877"><a href="#L-2877"><span class="linenos">2877</span></a><span class="k">def</span> <span class="nf">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-2878"><a href="#L-2878"><span class="linenos">2878</span></a>   <span class="s2">&quot;Python 2/3 compatibility: convert s to bytes if i is bytes&quot;</span>
</span><span id="L-2879"><a href="#L-2879"><span class="linenos">2879</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="L-2880"><a href="#L-2880"><span class="linenos">2880</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-2881"><a href="#L-2881"><span class="linenos">2881</span></a><span class="k">def</span> <span class="nf">as_printable</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="L-2882"><a href="#L-2882"><span class="linenos">2882</span></a>   <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="L-2883"><a href="#L-2883"><span class="linenos">2883</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-2884"><a href="#L-2884"><span class="linenos">2884</span></a>
</span><span id="L-2885"><a href="#L-2885"><span class="linenos">2885</span></a><span class="k">def</span> <span class="nf">convert_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="L-2886"><a href="#L-2886"><span class="linenos">2886</span></a>    <span class="s2">&quot;See mainopt_convert&quot;</span>
</span><span id="L-2887"><a href="#L-2887"><span class="linenos">2887</span></a>    <span class="n">lex</span> <span class="o">=</span> <span class="n">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span>
</span><span id="L-2888"><a href="#L-2888"><span class="linenos">2888</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_header&quot;</span><span class="p">)</span>
</span><span id="L-2889"><a href="#L-2889"><span class="linenos">2889</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lex_header</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">lex_header</span><span class="p">))</span>
</span><span id="L-2890"><a href="#L-2890"><span class="linenos">2890</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">lex_header</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="L-2891"><a href="#L-2891"><span class="linenos">2891</span></a>    <span class="n">entryFormat</span><span class="o">=</span><span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">)</span>
</span><span id="L-2892"><a href="#L-2892"><span class="linenos">2892</span></a>    <span class="n">wordCase</span><span class="o">=</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_word_case&quot;</span><span class="p">)</span>
</span><span id="L-2893"><a href="#L-2893"><span class="linenos">2893</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="n">lex</span><span class="p">:</span>
</span><span id="L-2894"><a href="#L-2894"><span class="linenos">2894</span></a>        <span class="n">pronunc</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">))</span>
</span><span id="L-2895"><a href="#L-2895"><span class="linenos">2895</span></a>        <span class="k">if</span> <span class="n">wordCase</span><span class="o">==</span><span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="L-2896"><a href="#L-2896"><span class="linenos">2896</span></a>        <span class="k">elif</span> <span class="n">wordCase</span><span class="o">==</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-2897"><a href="#L-2897"><span class="linenos">2897</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">entryFormat</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)))</span> <span class="c1"># will work in Python 3.6, but not in Python 3.4 (e.g. on jessie) which cannot do % on byte-strings</span>
</span><span id="L-2898"><a href="#L-2898"><span class="linenos">2898</span></a>    <span class="n">footer</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_footer&quot;</span><span class="p">)</span>
</span><span id="L-2899"><a href="#L-2899"><span class="linenos">2899</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">footer</span><span class="p">))</span>
</span><span id="L-2900"><a href="#L-2900"><span class="linenos">2900</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">footer</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="L-2901"><a href="#L-2901"><span class="linenos">2901</span></a>
</span><span id="L-2902"><a href="#L-2902"><span class="linenos">2902</span></a><span class="k">def</span> <span class="nf">bbcMicro_partPhonemeCount</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2903"><a href="#L-2903"><span class="linenos">2903</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Returns the number of &#39;part phonemes&#39; (at least that&#39;s what I&#39;m calling them) for the BBC Micro phonemes in pronunc.  The *SPEAK command cannot take more than 117 part-phonemes at a time before saying &quot;Line too long&quot;, and in some cases it takes less than that (I&#39;m not sure why); 115 is a safer limit.&quot;&quot;&quot;</span>
</span><span id="L-2904"><a href="#L-2904"><span class="linenos">2904</span></a>   <span class="n">partCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">pronunc0</span> <span class="o">=</span> <span class="n">pronunc</span>
</span><span id="L-2905"><a href="#L-2905"><span class="linenos">2905</span></a>   <span class="k">while</span> <span class="n">pronunc</span><span class="p">:</span>
</span><span id="L-2906"><a href="#L-2906"><span class="linenos">2906</span></a>      <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2907"><a href="#L-2907"><span class="linenos">2907</span></a>      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="s1">&#39; ,AA,AE,AH,AI,AO,AW,AY,B,CH,CT,DH,DUX,D,EE,EH,ER,F,G,/H,IH,IX,IY,J,K,L,M,NX,N,OW,OL,OY,O,P,R,SH,S,TH,T,UH,/UL,/U,UW,UX,V,W,Y,ZH,Z&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span> <span class="c1"># phonemes and space count, but pitch numbers do not count</span>
</span><span id="L-2908"><a href="#L-2908"><span class="linenos">2908</span></a>         <span class="k">if</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
</span><span id="L-2909"><a href="#L-2909"><span class="linenos">2909</span></a>            <span class="n">partCount</span> <span class="o">+=</span> <span class="p">{</span>
</span><span id="L-2910"><a href="#L-2910"><span class="linenos">2910</span></a>               <span class="c1"># *SPEAK can take 117 of most single-letter phonemes, or 116 (limited by the 232+6-character input limit) of most 2-letter phonemes</span>
</span><span id="L-2911"><a href="#L-2911"><span class="linenos">2911</span></a>               <span class="s1">&#39;AW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;IY&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;OW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;OL&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;UW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;/UL&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># *SPEAK can take 58 of these</span>
</span><span id="L-2912"><a href="#L-2912"><span class="linenos">2912</span></a>               <span class="s1">&#39;DUX&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;AY&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;CH&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;OY&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># *SPEAK can take 39 of these</span>
</span><span id="L-2913"><a href="#L-2913"><span class="linenos">2913</span></a>               <span class="s1">&#39;CT&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="c1"># *SPEAK can take 29 of these</span>
</span><span id="L-2914"><a href="#L-2914"><span class="linenos">2914</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-2915"><a href="#L-2915"><span class="linenos">2915</span></a>            <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):]</span> <span class="p">;</span> <span class="n">found</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="k">break</span>
</span><span id="L-2916"><a href="#L-2916"><span class="linenos">2916</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span><span id="L-2917"><a href="#L-2917"><span class="linenos">2917</span></a>         <span class="k">assert</span> <span class="n">as_printable</span><span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span><span class="s2">&quot;Unrecognised BBC Micro phoneme at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; in &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pronunc0</span><span class="p">)</span>
</span><span id="L-2918"><a href="#L-2918"><span class="linenos">2918</span></a>         <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-2919"><a href="#L-2919"><span class="linenos">2919</span></a>   <span class="k">return</span> <span class="n">partCount</span>
</span><span id="L-2920"><a href="#L-2920"><span class="linenos">2920</span></a>
</span><span id="L-2921"><a href="#L-2921"><span class="linenos">2921</span></a><span class="k">def</span> <span class="nf">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2922"><a href="#L-2922"><span class="linenos">2922</span></a>    <span class="s2">&quot;Returns pronunc with any necessary markup for putting it in a text (using the inline_format setting)&quot;</span>
</span><span id="L-2923"><a href="#L-2923"><span class="linenos">2923</span></a>    <span class="n">pronunc</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="c1"># UTF-8 output - ok for pasting into Firefox etc *IF* the terminal/X11 understands utf-8 (otherwise redirect to a file, point the browser at it, and set encoding to utf-8, or try --convert&#39;ing which will o/p HTML)</span>
</span><span id="L-2924"><a href="#L-2924"><span class="linenos">2924</span></a>    <span class="nb">format</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_format&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-2925"><a href="#L-2925"><span class="linenos">2925</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span>
</span><span id="L-2926"><a href="#L-2926"><span class="linenos">2926</span></a>       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># see above</span>
</span><span id="L-2927"><a href="#L-2927"><span class="linenos">2927</span></a>       <span class="k">return</span> <span class="nb">format</span> <span class="o">%</span> <span class="n">pronunc</span>
</span><span id="L-2928"><a href="#L-2928"><span class="linenos">2928</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2929"><a href="#L-2929"><span class="linenos">2929</span></a><span class="k">def</span> <span class="nf">markup_doubleTalk_word</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2930"><a href="#L-2930"><span class="linenos">2930</span></a>   <span class="s2">&quot;Special-case function set as inline_format in doubletalk (checks environment variables for command code)&quot;</span>
</span><span id="L-2931"><a href="#L-2931"><span class="linenos">2931</span></a>   <span class="n">cmd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DTALK_COMMAND_CODE&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-2932"><a href="#L-2932"><span class="linenos">2932</span></a>   <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">cmd</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</span><span id="L-2933"><a href="#L-2933"><span class="linenos">2933</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="L-2934"><a href="#L-2934"><span class="linenos">2934</span></a>   <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">D</span><span class="si">%s%s</span><span class="s2">T&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">pronunc</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>
</span><span id="L-2935"><a href="#L-2935"><span class="linenos">2935</span></a><span class="k">def</span> <span class="nf">markup_bbcMicro_word</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="L-2936"><a href="#L-2936"><span class="linenos">2936</span></a>   <span class="s2">&quot;Special-case function set as inline_format in bbcmicro.  Begins a new *SPEAK command when necessary.  See also write_bbcmicro_phones.&quot;</span>
</span><span id="L-2937"><a href="#L-2937"><span class="linenos">2937</span></a>   <span class="k">global</span> <span class="n">bbc_partsSoFar</span><span class="p">,</span><span class="n">bbc_charsSoFar</span>
</span><span id="L-2938"><a href="#L-2938"><span class="linenos">2938</span></a>   <span class="n">thisPartCount</span> <span class="o">=</span> <span class="n">bbcMicro_partPhonemeCount</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="L-2939"><a href="#L-2939"><span class="linenos">2939</span></a>   <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bbc_partsSoFar</span> <span class="ow">or</span> <span class="n">bbc_partsSoFar</span><span class="o">+</span><span class="n">thisPartCount</span> <span class="o">&gt;</span> <span class="mi">115</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bbc_charsSoFar</span> <span class="ow">or</span> <span class="n">bbc_charsSoFar</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">238</span><span class="p">):</span> <span class="c1"># 238 is max len of BBC BASIC prompt (both the immediate prompt and the one with line number supplied by AUTO, in both BASIC II and BASIC IV); re other limit see bbcMicro_partPhonemeCount</span>
</span><span id="L-2940"><a href="#L-2940"><span class="linenos">2940</span></a>      <span class="k">if</span> <span class="n">bbc_charsSoFar</span><span class="p">:</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-2941"><a href="#L-2941"><span class="linenos">2941</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="L-2942"><a href="#L-2942"><span class="linenos">2942</span></a>      <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;*SPEAK&quot;</span> <span class="c1"># (could add a space if want to make it more readable, at the expense of an extra keystroke in the paste buffer; by the way, when not using the ROM version you must use *SPEAK not OS.(&quot;SPEAK&quot;), at least on a Model B; seems OSCLI doesn&#39;t go through quite the same vectors as star)</span>
</span><span id="L-2943"><a href="#L-2943"><span class="linenos">2943</span></a>      <span class="n">bbc_charsSoFar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 for the space that&#39;ll be after this word if we don&#39;t start a new line</span>
</span><span id="L-2944"><a href="#L-2944"><span class="linenos">2944</span></a>      <span class="n">bbc_partsSoFar</span> <span class="o">=</span> <span class="n">thisPartCount</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># ditto</span>
</span><span id="L-2945"><a href="#L-2945"><span class="linenos">2945</span></a>      <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">cmd</span><span class="p">)</span><span class="o">+</span><span class="n">pronunc</span>
</span><span id="L-2946"><a href="#L-2946"><span class="linenos">2946</span></a>   <span class="k">else</span><span class="p">:</span>
</span><span id="L-2947"><a href="#L-2947"><span class="linenos">2947</span></a>      <span class="n">bbc_charsSoFar</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-2948"><a href="#L-2948"><span class="linenos">2948</span></a>      <span class="n">bbc_partsSoFar</span> <span class="o">+=</span> <span class="n">thisPartCount</span><span class="o">+</span><span class="mi">1</span>
</span><span id="L-2949"><a href="#L-2949"><span class="linenos">2949</span></a>      <span class="k">return</span> <span class="n">pronunc</span>
</span><span id="L-2950"><a href="#L-2950"><span class="linenos">2950</span></a><span class="n">bbc_partsSoFar</span><span class="o">=</span><span class="n">bbc_charsSoFar</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-2951"><a href="#L-2951"><span class="linenos">2951</span></a>
</span><span id="L-2952"><a href="#L-2952"><span class="linenos">2952</span></a><span class="k">def</span> <span class="nf">sylcount</span><span class="p">(</span><span class="n">example_format_festival</span><span class="p">):</span>
</span><span id="L-2953"><a href="#L-2953"><span class="linenos">2953</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Tries to count the number of syllables in a Festival string (see mainopt_syllables).  We treat @ as counting the same as the previous syllable (e.g. &quot;fire&quot;, &quot;power&quot;), but this can vary in different songs, so the result will likely need a bit of proofreading.&quot;&quot;&quot;</span>
</span><span id="L-2954"><a href="#L-2954"><span class="linenos">2954</span></a>  <span class="n">count</span> <span class="o">=</span> <span class="n">inVowel</span> <span class="o">=</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2955"><a href="#L-2955"><span class="linenos">2955</span></a>  <span class="n">festival</span> <span class="o">=</span> <span class="n">example_format_festival</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="c1"># no brackets, emphasis by vowels, but spaces between each syllable</span>
</span><span id="L-2956"><a href="#L-2956"><span class="linenos">2956</span></a>  <span class="k">for</span> <span class="n">phone</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">festival</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">festival</span><span class="p">))):</span>
</span><span id="L-2957"><a href="#L-2957"><span class="linenos">2957</span></a>    <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">:</span> <span class="n">inVowel</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># unconditionally start new syllable</span>
</span><span id="L-2958"><a href="#L-2958"><span class="linenos">2958</span></a>    <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;aeiou@12&quot;</span><span class="p">:</span>
</span><span id="L-2959"><a href="#L-2959"><span class="linenos">2959</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">inVowel</span><span class="p">:</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2960"><a href="#L-2960"><span class="linenos">2960</span></a>      <span class="k">elif</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;@&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hadAt</span><span class="p">:</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># (e.g. &quot;loyal&quot;, but NOT &#39;1&#39;, e.g. &quot;world&quot;)</span>
</span><span id="L-2961"><a href="#L-2961"><span class="linenos">2961</span></a>      <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">phone</span><span class="p">:</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># for words like &quot;cheerful&quot; (&quot;i@ 1 @&quot; counts as one)</span>
</span><span id="L-2962"><a href="#L-2962"><span class="linenos">2962</span></a>      <span class="n">inVowel</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="L-2963"><a href="#L-2963"><span class="linenos">2963</span></a>      <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;@&quot;</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">festival</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">festival</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">]:</span> <span class="c1"># special rule for higher, Messiah, etc - like &quot;fire&quot; but usually 2 syllables</span>
</span><span id="L-2964"><a href="#L-2964"><span class="linenos">2964</span></a>        <span class="n">maybeCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-2965"><a href="#L-2965"><span class="linenos">2965</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="L-2966"><a href="#L-2966"><span class="linenos">2966</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;drz&quot;</span><span class="p">:</span> <span class="n">count</span> <span class="o">+=</span> <span class="n">maybeCount</span> <span class="c1"># not &#39;r/z&#39; e.g. &quot;ours&quot;, &quot;fired&quot; usually 1 syllable in songs, &quot;desirable&quot; usually 4 not 5</span>
</span><span id="L-2967"><a href="#L-2967"><span class="linenos">2967</span></a>      <span class="c1"># TODO steward?  y u@ 1 d but usally 2 syllables</span>
</span><span id="L-2968"><a href="#L-2968"><span class="linenos">2968</span></a>      <span class="n">inVowel</span> <span class="o">=</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-2969"><a href="#L-2969"><span class="linenos">2969</span></a>  <span class="k">return</span> <span class="n">count</span>
</span><span id="L-2970"><a href="#L-2970"><span class="linenos">2970</span></a><span class="k">def</span> <span class="nf">hyphenate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">numSyls</span><span class="p">):</span>
</span><span id="L-2971"><a href="#L-2971"><span class="linenos">2971</span></a>  <span class="s2">&quot;See mainopt_syllables&quot;</span>
</span><span id="L-2972"><a href="#L-2972"><span class="linenos">2972</span></a>  <span class="n">orig</span> <span class="o">=</span> <span class="n">word</span>
</span><span id="L-2973"><a href="#L-2973"><span class="linenos">2973</span></a>  <span class="k">try</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span><span class="n">isu8</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="kc">True</span>
</span><span id="L-2974"><a href="#L-2974"><span class="linenos">2974</span></a>  <span class="k">except</span><span class="p">:</span> <span class="n">isu8</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-2975"><a href="#L-2975"><span class="linenos">2975</span></a>  <span class="n">pre</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="n">post</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-2976"><a href="#L-2976"><span class="linenos">2976</span></a>  <span class="k">while</span> <span class="n">word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;a&#39;</span><span class="o">&lt;=</span><span class="n">word</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">&lt;=</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
</span><span id="L-2977"><a href="#L-2977"><span class="linenos">2977</span></a>    <span class="n">pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span> <span class="p">;</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-2978"><a href="#L-2978"><span class="linenos">2978</span></a>  <span class="k">while</span> <span class="n">word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;a&#39;</span><span class="o">&lt;=</span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">&lt;=</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
</span><span id="L-2979"><a href="#L-2979"><span class="linenos">2979</span></a>    <span class="n">post</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span> <span class="p">;</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2980"><a href="#L-2980"><span class="linenos">2980</span></a>  <span class="k">if</span> <span class="n">numSyls</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span> <span class="k">return</span> <span class="n">orig</span> <span class="c1"># probably numbers or something</span>
</span><span id="L-2981"><a href="#L-2981"><span class="linenos">2981</span></a>  <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">numSyls</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">numSyls</span><span class="p">)</span> <span class="p">;</span> <span class="n">syls</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-2982"><a href="#L-2982"><span class="linenos">2982</span></a>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSyls</span><span class="p">):</span>
</span><span id="L-2983"><a href="#L-2983"><span class="linenos">2983</span></a>    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">numSyls</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">syls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">l</span><span class="p">:])</span>
</span><span id="L-2984"><a href="#L-2984"><span class="linenos">2984</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">syls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">l</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">l</span><span class="p">])</span>
</span><span id="L-2985"><a href="#L-2985"><span class="linenos">2985</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</span><span id="L-2986"><a href="#L-2986"><span class="linenos">2986</span></a>      <span class="k">if</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">):</span>
</span><span id="L-2987"><a href="#L-2987"><span class="linenos">2987</span></a>        <span class="c1"># repeated consonant at start - put one on previous</span>
</span><span id="L-2988"><a href="#L-2988"><span class="linenos">2988</span></a>        <span class="c1"># (or hyphen at start - move it to the previous)</span>
</span><span id="L-2989"><a href="#L-2989"><span class="linenos">2989</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-2990"><a href="#L-2990"><span class="linenos">2990</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-2991"><a href="#L-2991"><span class="linenos">2991</span></a>      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="L-2992"><a href="#L-2992"><span class="linenos">2992</span></a>        <span class="c1"># better move this splitpoint after that hyphen (TODO: move more than one character?)</span>
</span><span id="L-2993"><a href="#L-2993"><span class="linenos">2993</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="L-2994"><a href="#L-2994"><span class="linenos">2994</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="L-2995"><a href="#L-2995"><span class="linenos">2995</span></a>      <span class="k">elif</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">)</span> \
</span><span id="L-2996"><a href="#L-2996"><span class="linenos">2996</span></a>            <span class="ow">or</span> <span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiouy&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">))</span> \
</span><span id="L-2997"><a href="#L-2997"><span class="linenos">2997</span></a>            <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))):</span>
</span><span id="L-2998"><a href="#L-2998"><span class="linenos">2998</span></a>        <span class="c1"># repeated consonant at end - put one on next</span>
</span><span id="L-2999"><a href="#L-2999"><span class="linenos">2999</span></a>        <span class="c1"># or vowel on right: move a letter over (sometimes the right thing to do...)</span>
</span><span id="L-3000"><a href="#L-3000"><span class="linenos">3000</span></a>        <span class="c1"># (unless doing so leaves no vowels)</span>
</span><span id="L-3001"><a href="#L-3001"><span class="linenos">3001</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-3002"><a href="#L-3002"><span class="linenos">3002</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-3003"><a href="#L-3003"><span class="linenos">3003</span></a>  <span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pre</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;- &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">syls</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span id="L-3004"><a href="#L-3004"><span class="linenos">3004</span></a>  <span class="k">if</span> <span class="n">isu8</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3005"><a href="#L-3005"><span class="linenos">3005</span></a>  <span class="k">return</span> <span class="n">word</span>
</span><span id="L-3006"><a href="#L-3006"><span class="linenos">3006</span></a>
</span><span id="L-3007"><a href="#L-3007"><span class="linenos">3007</span></a><span class="k">def</span> <span class="nf">macSayCommand</span><span class="p">():</span>
</span><span id="L-3008"><a href="#L-3008"><span class="linenos">3008</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the environment variable SAY_COMMAND if it is set and if it is non-empty, otherwise return &quot;say&quot;.</span>
</span><span id="L-3009"><a href="#L-3009"><span class="linenos">3009</span></a><span class="sd">  E.g. SAY_COMMAND=&quot;say -o file.aiff&quot; (TODO: document this in the help text?)</span>
</span><span id="L-3010"><a href="#L-3010"><span class="linenos">3010</span></a><span class="sd">  In Gradint you can set (e.g. if you have a ~/.festivalrc) extra_speech=[(&quot;en&quot;,&quot;python lexconvert.py --mac-uk festival&quot;)] ; extra_speech_tofile=[(&quot;en&quot;,&#39;echo %s | SAY_COMMAND=&quot;say -o /tmp/said.aiff&quot; python lexconvert.py --mac-uk festival &amp;&amp; sox /tmp/said.aiff /tmp/said.wav&#39;,&quot;/tmp/said.wav&quot;)]&quot;&quot;&quot;</span>
</span><span id="L-3011"><a href="#L-3011"><span class="linenos">3011</span></a>  <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAY_COMMAND&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-3012"><a href="#L-3012"><span class="linenos">3012</span></a>  <span class="k">if</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="L-3013"><a href="#L-3013"><span class="linenos">3013</span></a>  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;say&quot;</span>
</span><span id="L-3014"><a href="#L-3014"><span class="linenos">3014</span></a>
</span><span id="L-3015"><a href="#L-3015"><span class="linenos">3015</span></a><span class="k">def</span> <span class="nf">stdin_is_terminal</span><span class="p">():</span>
</span><span id="L-3016"><a href="#L-3016"><span class="linenos">3016</span></a>   <span class="s2">&quot;Returns True if it seems the standard input is connected to a terminal (rather than piped from a file etc)&quot;</span>
</span><span id="L-3017"><a href="#L-3017"><span class="linenos">3017</span></a>   <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span><span class="s2">&quot;isatty&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span>
</span><span id="L-3018"><a href="#L-3018"><span class="linenos">3018</span></a>
</span><span id="L-3019"><a href="#L-3019"><span class="linenos">3019</span></a><span class="k">def</span> <span class="nf">getInputText</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">as_iterable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="L-3020"><a href="#L-3020"><span class="linenos">3020</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Gets text either from the command line or from standard input.  Issue prompt if there&#39;s nothing on the command line and standard input is connected to a tty instead of a pipe or file.  If as_iterable, return an iterable object over the lines instead of reading and returning all text at once.  If as_iterable==&#39;maybe&#39;, return the iterable but if not reading from a tty then read everything into one item.&quot;&quot;&quot;</span>
</span><span id="L-3021"><a href="#L-3021"><span class="linenos">3021</span></a>  <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="L-3022"><a href="#L-3022"><span class="linenos">3022</span></a>  <span class="k">if</span> <span class="n">txt</span><span class="p">:</span>
</span><span id="L-3023"><a href="#L-3023"><span class="linenos">3023</span></a>    <span class="k">if</span> <span class="n">as_iterable</span><span class="o">==</span><span class="s1">&#39;maybe&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">txt</span><span class="p">]</span>
</span><span id="L-3024"><a href="#L-3024"><span class="linenos">3024</span></a>    <span class="k">elif</span> <span class="n">as_iterable</span><span class="p">:</span> <span class="k">return</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3025"><a href="#L-3025"><span class="linenos">3025</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">txt</span>
</span><span id="L-3026"><a href="#L-3026"><span class="linenos">3026</span></a>  <span class="k">if</span> <span class="n">stdin_is_terminal</span><span class="p">():</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Enter &quot;</span><span class="o">+</span><span class="n">prompt</span><span class="o">+</span><span class="s2">&quot; (EOF when done)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3027"><a href="#L-3027"><span class="linenos">3027</span></a>  <span class="k">elif</span> <span class="n">as_iterable</span><span class="o">==</span><span class="s1">&#39;maybe&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()]</span>
</span><span id="L-3028"><a href="#L-3028"><span class="linenos">3028</span></a>  <span class="k">if</span> <span class="n">as_iterable</span><span class="p">:</span> <span class="k">return</span> <span class="n">my_xreadlines</span><span class="p">()</span>
</span><span id="L-3029"><a href="#L-3029"><span class="linenos">3029</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="L-3030"><a href="#L-3030"><span class="linenos">3030</span></a>     <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-3031"><a href="#L-3031"><span class="linenos">3031</span></a>     <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SystemExit</span>
</span><span id="L-3032"><a href="#L-3032"><span class="linenos">3032</span></a>
</span><span id="L-3033"><a href="#L-3033"><span class="linenos">3033</span></a><span class="k">try</span><span class="p">:</span> <span class="n">raw_input</span> <span class="c1"># Python 2</span>
</span><span id="L-3034"><a href="#L-3034"><span class="linenos">3034</span></a><span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span> <span class="n">raw_input</span> <span class="o">=</span> <span class="nb">input</span> <span class="c1"># Python 3</span>
</span><span id="L-3035"><a href="#L-3035"><span class="linenos">3035</span></a><span class="k">def</span> <span class="nf">my_xreadlines</span><span class="p">():</span>
</span><span id="L-3036"><a href="#L-3036"><span class="linenos">3036</span></a>   <span class="s2">&quot;On some platforms this might be a bit more responsive than sys.stdin.xreadlines&quot;</span>
</span><span id="L-3037"><a href="#L-3037"><span class="linenos">3037</span></a>   <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="L-3038"><a href="#L-3038"><span class="linenos">3038</span></a>      <span class="k">try</span><span class="p">:</span> <span class="k">yield</span> <span class="n">raw_input</span><span class="p">()</span>
</span><span id="L-3039"><a href="#L-3039"><span class="linenos">3039</span></a>      <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-3040"><a href="#L-3040"><span class="linenos">3040</span></a>      <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SystemExit</span>
</span><span id="L-3041"><a href="#L-3041"><span class="linenos">3041</span></a>
</span><span id="L-3042"><a href="#L-3042"><span class="linenos">3042</span></a><span class="k">def</span> <span class="nf">output_clauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">clauses</span><span class="p">):</span>
</span><span id="L-3043"><a href="#L-3043"><span class="linenos">3043</span></a>   <span class="s2">&quot;Writes out clauses and words in format &#39;format&#39; (clauses is a list of lists of words in the phones of &#39;format&#39;).  By default, calls markup_inline_word and join as appropriate.  If however the format&#39;s &#39;clause_separator&#39; has been set to a special case, calls that.&quot;</span>
</span><span id="L-3044"><a href="#L-3044"><span class="linenos">3044</span></a>   <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;output_is_binary&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="s2">&quot;isatty&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
</span><span id="L-3045"><a href="#L-3045"><span class="linenos">3045</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This is a binary format - not writing to terminal.</span><span class="se">\n</span><span class="s2">Please direct output to a file or pipe.&quot;</span><span class="p">)</span>
</span><span id="L-3046"><a href="#L-3046"><span class="linenos">3046</span></a>      <span class="k">return</span>
</span><span id="L-3047"><a href="#L-3047"><span class="linenos">3047</span></a>   <span class="n">clause_sep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;clause_separator&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3048"><a href="#L-3048"><span class="linenos">3048</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clause_sep</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">clause_sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">wordSeparator</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">)</span> <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">))</span>
</span><span id="L-3049"><a href="#L-3049"><span class="linenos">3049</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clause_sep</span><span class="p">(</span><span class="n">clauses</span><span class="p">)</span>
</span><span id="L-3050"><a href="#L-3050"><span class="linenos">3050</span></a><span class="k">def</span> <span class="nf">write_bbcmicro_phones</span><span class="p">(</span><span class="n">clauses</span><span class="p">):</span>
</span><span id="L-3051"><a href="#L-3051"><span class="linenos">3051</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as clause_separator in bbcmicro format.  Must be a special case because it needs to track any extra keystrokes to avoid &quot;Line too long&quot;.  And while we&#39;re at it, we might as well start a new *SPEAK command with each clause, using the natural brief delay between commands; this should minimise the occurrence of additional delays in arbitrary places.  Also calls print_bbc_warnings&quot;&quot;&quot;</span>
</span><span id="L-3052"><a href="#L-3052"><span class="linenos">3052</span></a>  <span class="n">totalKeystrokes</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3053"><a href="#L-3053"><span class="linenos">3053</span></a>  <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">:</span>
</span><span id="L-3054"><a href="#L-3054"><span class="linenos">3054</span></a>    <span class="k">global</span> <span class="n">bbc_charsSoFar</span> <span class="p">;</span> <span class="n">bbc_charsSoFar</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-3055"><a href="#L-3055"><span class="linenos">3055</span></a>    <span class="n">l</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;bbcmicro&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">])</span>
</span><span id="L-3056"><a href="#L-3056"><span class="linenos">3056</span></a>    <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)))</span>
</span><span id="L-3057"><a href="#L-3057"><span class="linenos">3057</span></a>    <span class="n">totalKeystrokes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">;</span> <span class="n">lines</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3058"><a href="#L-3058"><span class="linenos">3058</span></a>  <span class="n">print_bbc_warnings</span><span class="p">(</span><span class="n">totalKeystrokes</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
</span><span id="L-3059"><a href="#L-3059"><span class="linenos">3059</span></a><span class="k">def</span> <span class="nf">print_bbc_warnings</span><span class="p">(</span><span class="n">keyCount</span><span class="p">,</span><span class="n">lineCount</span><span class="p">):</span>
</span><span id="L-3060"><a href="#L-3060"><span class="linenos">3060</span></a>  <span class="s2">&quot;Print any relevant size warnings regarding sending &#39;keyCount&#39; keys in &#39;lineCount&#39; lines to the BBC Micro&quot;</span>
</span><span id="L-3061"><a href="#L-3061"><span class="linenos">3061</span></a>  <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># try to keep in sync if someone&#39;s doing 2&gt;&amp;1 | less</span>
</span><span id="L-3062"><a href="#L-3062"><span class="linenos">3062</span></a>  <span class="n">limits_exceeded</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">severe</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-3063"><a href="#L-3063"><span class="linenos">3063</span></a>  <span class="k">if</span> <span class="n">keyCount</span> <span class="o">&gt;=</span> <span class="mi">32768</span><span class="p">:</span>
</span><span id="L-3064"><a href="#L-3064"><span class="linenos">3064</span></a>    <span class="n">severe</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BeebEm 32K keystroke limit&quot;</span><span class="p">)</span> <span class="c1"># At least in version 3, the clipboard is defined in beebwin.h as a char of size 32768 and its bounds are not checked.  Additionally, if you script a second paste before the first has finished (or if you try to use BeebEm&#39;s Copy command) then the first paste will be interrupted.  So if you really want to make BeebEm read more then I suggest setting a printer destination file, putting a VDU 2,10,3 after each batch of commands, and waiting for that \n to appear in that printer file before sending the next batch, or perhaps write a set of programs to a disk image and have them CHAIN each other or whatever.</span>
</span><span id="L-3065"><a href="#L-3065"><span class="linenos">3065</span></a>  <span class="n">shadow_himem</span><span class="o">=</span><span class="mh">0x8000</span> <span class="c1"># if using a &#39;shadow mode&#39; on the Master/B+/Integra-B (modes 128-135, which leave all main RAM free)</span>
</span><span id="L-3066"><a href="#L-3066"><span class="linenos">3066</span></a>  <span class="n">mode7_himem</span><span class="o">=</span><span class="mh">0x7c00</span> <span class="c1"># (40x25 characters = 1000 bytes, by default starting at 7c00 with 24 bytes spare at the top, but the scrolling system uses the full 1024 bytes and can tell the video controller to start rendering at any one of them; if you get Jeremy Ruston&#39;s book and program the VIDC yourself then you could fix it at 7c18 if you really want, or just set HIMEM=&amp;8000 and don&#39;t touch the screen, but that doesn&#39;t give you very much more room)</span>
</span><span id="L-3067"><a href="#L-3067"><span class="linenos">3067</span></a>  <span class="n">default_speech_loc</span><span class="o">=</span><span class="mh">0x5500</span>
</span><span id="L-3068"><a href="#L-3068"><span class="linenos">3068</span></a>  <span class="n">overhead_per_program_line</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="L-3069"><a href="#L-3069"><span class="linenos">3069</span></a>  <span class="k">for</span> <span class="n">page</span><span class="p">,</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3070"><a href="#L-3070"><span class="linenos">3070</span></a>        <span class="p">(</span><span class="mh">0x1900</span><span class="p">,</span><span class="s2">&quot;Model B&quot;</span><span class="p">),</span> <span class="c1"># with Acorn DFS (a reasonable assumption although alternate DFS ROMs are different)</span>
</span><span id="L-3071"><a href="#L-3071"><span class="linenos">3071</span></a>        <span class="p">(</span><span class="mh">0xE00</span><span class="p">,</span><span class="s2">&quot;Master&quot;</span><span class="p">)]:</span> <span class="c1"># (the Master has 8k of special paged-in &quot;filing system RAM&quot;, so doesn&#39;t need 2816 bytes of main RAM for DFS)</span>
</span><span id="L-3072"><a href="#L-3072"><span class="linenos">3072</span></a>     <span class="n">top</span> <span class="o">=</span> <span class="n">page</span><span class="o">+</span><span class="n">keyCount</span><span class="o">+</span><span class="n">lineCount</span><span class="o">*</span><span class="p">(</span><span class="n">overhead_per_program_line</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span> <span class="c1"># the -1 is because keyCount includes a carriage return at the end of each line</span>
</span><span id="L-3073"><a href="#L-3073"><span class="linenos">3073</span></a>     <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s2">&quot;Master&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot; (use Speech&#39;s Sideways RAM version instead, e.g. *SRLOAD SP8000 8000 7 and reset, but sound quality might be worse)&quot;</span> <span class="c1"># I don&#39;t know why but SP8000 can play higher and more distorted than SPEECH, at least on emulation (and changing the emulation speed doesn&#39;t help, because that setting, at least in BeebEm3, just controls extra usleep every frame; it doesn&#39;t actually slow down the 6502 *between* frames; anyway timing of sound changes is done by CyclesToSamples stuff in beebsound.cc&#39;s SoundTrigger).  If on the Master you go into View (*WORD) and then try SP8000, it plays _lower_ than *SPEECH (even if you do *BASIC first) and *SAY can corrupt a View document; ViewSheet (*SHEET) doesn&#39;t seem to have this effect; neither does *TERMINAL but *SAY can confuse the terminal.</span>
</span><span id="L-3074"><a href="#L-3074"><span class="linenos">3074</span></a>     <span class="c1"># Re bank numbers, by default banks 4 to 7 are Sideways RAM (4*16k=64k) and I suppose filling up from 7 makes sense because banks 8-F are ROMs (ANFS,DFS,ViewSheet,Edit,BASIC,ADFS,View,Terminal; OS is a separate 16k so there&#39;s scope for 144k of supplied ROM).  Banks 0-3 are ROM expansion slots.  The &quot;128&quot; in the name &quot;Master 128&quot; comes from 32k main RAM, 64k Sideways RAM, 20k shadow RAM (for screen modes 128-135), 4k OS &quot;private RAM&quot; (paged on top of 8000-8FFF) and 8k filing system RAM (paged on top of C000-DFFF) = 128k.  Not sure what happened on the B+.</span>
</span><span id="L-3075"><a href="#L-3075"><span class="linenos">3075</span></a>     <span class="c1"># By the way BeebEm&#39;s beebsound.cc also shows us why SOUND was always out of tune especially in the higher pitches.  The 16-bit freqval given to the chip is 125000/freq and must be an integer, so the likely temperament in cents for non-PCM is given by [int(math.log(125000.0/math.ceil(125000/freq)/freq,2**(1.0/1200))) for freq in [440*((2**(1.0/12))**semi) for semi in range(-12*3+2,12*2+6)]] (the actual temperament will depend on the OS&#39;s implementation of mapping SOUND pitch values to freqval&#39;s, unless you program the chip directly, but this list is indicative and varies over 10% in the top 2 octaves)</span>
</span><span id="L-3076"><a href="#L-3076"><span class="linenos">3076</span></a>     <span class="c1"># Some other ROMs (e.g. Alan Blundell&#39;s &quot;Informant&quot; 1989) seem to result in a crash after the *SPEECH and/or *SPEAK commands complete, at least in some emulator configurations; this may or may not be resolved via timing adjustments or adjustments in the ROM order; not sure exactly what the problem is</span>
</span><span id="L-3077"><a href="#L-3077"><span class="linenos">3077</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot; (Speech program will be overwritten unless relocated)&quot;</span> <span class="c1"># (could use Sideways RAM for it instead if you have it fitted, see above)</span>
</span><span id="L-3078"><a href="#L-3078"><span class="linenos">3078</span></a>     <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">default_speech_loc</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> TOP=&amp;</span><span class="si">%X</span><span class="s2"> limit</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">default_speech_loc</span><span class="p">,</span><span class="n">x</span><span class="p">))</span> <span class="c1"># The Speech program does nothing to stop your program (or its variables etc) from growing large enough to overwrite &amp;5500, nor does it stop the stack pointer (coming down from HIMEM) from overwriting &amp;72FF. For more safety on a Model B you could use RELOCAT to put Speech at &amp;5E00 and be sure to set HIMEM=&amp;5E00 before loading, but then you must avoid commands that change HIMEM, such as MODE (but selecting any non-shadow mode other than 7 will overwrite Speech anyway, although if you set the mode before loading Speech then it&#39;ll overwrite screen memory and still work as long as the affected part of the screen is undisturbed).  You can&#39;t do tricks like ditching the lexicon because RELOCAT won&#39;t let you go above 5E00 (unless you fix it, but I haven&#39;t looked in detail; if you can fix RELOCAT to go above 5E00 then you can create a lexicon-free Speech by taking the 1st 0x1560 bytes of SPEECH and append two * bytes, relocate to &amp;6600 and set HIMEM, but don&#39;t expect *SAY to work, unless you put a really small lexicon into the spare 144 bytes that are left - RELOCAT needs an xx00 address so you can&#39;t have those bytes at the bottom).  You could even relocate to &amp;6A00 and overwrite (non-shadow) screen memory if you don&#39;t mind the screen being filled with gibberish that you&#39;d better not erase! (well if you program the VIDC as mentioned above and you didn&#39;t re-add a small lexicon then you could get yourself 3.6 lines of usable Mode 7 display from the spare bytes but it&#39;s probably not worth the effort)</span>
</span><span id="L-3079"><a href="#L-3079"><span class="linenos">3079</span></a>     <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">mode7_himem</span><span class="p">:</span>
</span><span id="L-3080"><a href="#L-3080"><span class="linenos">3080</span></a>        <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s2">&quot;Master&quot;</span><span class="p">:</span>
</span><span id="L-3081"><a href="#L-3081"><span class="linenos">3081</span></a>           <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">shadow_himem</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; 32k HIMEM limit (even for shadow modes)&quot;</span><span class="p">)</span> <span class="c1"># TODO: maybe add instructions for using BAS128 on the B+ or Master; this sets PAGE=&amp;10000 and HIMEM=&amp;20000 (i.e. 64k for programs), which uses all 4 SRAM slots so you can&#39;t use SP8000 (unless it&#39;s on a real ROM); if using Speech in main memory you need to RELOCAT it to leave &amp;3000 upwards for Bas128 code; putting it at &amp;1900 for B+/DFS leaves you only 417 bytes for lexicon (which might not matter if you&#39;re using only *SPEECH: just create a shortened lexicon); putting it at &amp;E00 for Master allows space for the default 2204-byte lexicon with 1029 bytes to spare; TODO check if Bas128 uses any workspace between &amp;E00 and &amp;3000 though.  Alternatively (if you really want to store such a long program on the BBC) then you&#39;d better split it into several programs that CHAIN each other (as mentioned above).</span>
</span><span id="L-3082"><a href="#L-3082"><span class="linenos">3082</span></a>           <span class="k">else</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; Mode 7 HIMEM limit (use shadow modes 128-135)&quot;</span><span class="p">)</span>
</span><span id="L-3083"><a href="#L-3083"><span class="linenos">3083</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; Mode 7 HIMEM limit&quot;</span><span class="p">)</span> <span class="c1"># unless you overwrite the screen (see above) - let&#39;s assume the Model B hasn&#39;t been fitted with shadow modes (although the Integra-B add-on does give them to the Model B, and leaves PAGE at &amp;1900; B+ has shadow modes but I don&#39;t know what&#39;s supposed to happen to PAGE on it).  65C02 Tube doesn&#39;t help much (it&#39;ll try to run Speech on the coprocessor instead of the host, and this results in silence because it can&#39;t send its sound back across the Tube; don&#39;t know if there&#39;s a way to make it run on the host in these circumstances or what the host&#39;s memory map is like)</span>
</span><span id="L-3084"><a href="#L-3084"><span class="linenos">3084</span></a>  <span class="k">if</span> <span class="n">lineCount</span> <span class="o">&gt;</span> <span class="mi">32768</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BBC BASIC line number limit&quot;</span><span class="p">)</span> <span class="c1"># and you wouldn&#39;t get this far without filling the memory, even with 128k (4 bytes per line)</span>
</span><span id="L-3085"><a href="#L-3085"><span class="linenos">3085</span></a>  <span class="k">elif</span> <span class="mi">10</span><span class="o">*</span><span class="n">lineCount</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;AUTO line number limit (try AUTO 0,1)&quot;</span><span class="p">)</span> <span class="c1"># (default AUTO increments in steps of 10; you can use AUTO 0,1 to start at 0 and increment in steps of 1.  BBC BASIC stores its line info in a compact form which allows a range of 0-32767.)</span>
</span><span id="L-3086"><a href="#L-3086"><span class="linenos">3086</span></a>  <span class="k">if</span> <span class="n">severe</span><span class="p">:</span> <span class="n">warning</span><span class="p">,</span><span class="n">after</span><span class="o">=</span><span class="s2">&quot;WARNING: &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span>
</span><span id="L-3087"><a href="#L-3087"><span class="linenos">3087</span></a>  <span class="k">else</span><span class="p">:</span> <span class="n">warning</span><span class="p">,</span><span class="n">after</span><span class="o">=</span><span class="s2">&quot;Note: &quot;</span><span class="p">,</span><span class="s2">&quot;It should still work if pasted into BeebEm as immediate commands. &quot;</span>
</span><span id="L-3088"><a href="#L-3088"><span class="linenos">3088</span></a>  <span class="n">after</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">+</span><span class="n">after</span><span class="o">+</span><span class="s2">&quot;See comments in lexconvert for more details.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="L-3089"><a href="#L-3089"><span class="linenos">3089</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits_exceeded</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warning</span><span class="o">+</span><span class="s2">&quot;this text may be too big for the BBC Micro. The following limits were exceeded: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">limits_exceeded</span><span class="p">)</span><span class="o">+</span><span class="n">after</span><span class="p">)</span>
</span><span id="L-3090"><a href="#L-3090"><span class="linenos">3090</span></a>  <span class="k">elif</span> <span class="n">limits_exceeded</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warning</span><span class="o">+</span><span class="s2">&quot;this text may be too big for the BBC Micro because it exceeds the &quot;</span><span class="o">+</span><span class="n">limits_exceeded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">after</span><span class="p">)</span>
</span><span id="L-3091"><a href="#L-3091"><span class="linenos">3091</span></a><span class="k">def</span> <span class="nf">bbc_prepDefaultLex</span><span class="p">(</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="L-3092"><a href="#L-3092"><span class="linenos">3092</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as lex_header in bbcmicro format.  If SPEECH_DISK and MAKE_SPEECH_ROM is set, then read the ROM code from SPEECH_DISK and write to outFile (meant to go before the lexicon, to make a modified BBC Micro Speech ROM with custom lexicon)&quot;&quot;&quot;</span>
</span><span id="L-3093"><a href="#L-3093"><span class="linenos">3093</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="k">return</span>
</span><span id="L-3094"><a href="#L-3094"><span class="linenos">3094</span></a>  <span class="n">sd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SPEECH_DISK&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3095"><a href="#L-3095"><span class="linenos">3095</span></a>  <span class="n">d</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># if this fails, SPEECH_DISK was not set or was set incorrectly (it&#39;s required for MAKE_SPEECH_ROM)</span>
</span><span id="L-3096"><a href="#L-3096"><span class="linenos">3096</span></a>  <span class="n">i</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;LO&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;LP&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x82</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x11</span><span class="p">))</span> <span class="c1"># start of SP8000 file (if this fails, it wasn&#39;t a Speech disk)</span>
</span><span id="L-3097"><a href="#L-3097"><span class="linenos">3097</span></a>  <span class="n">j</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&gt;OUS_&#39;</span><span class="p">),</span><span class="n">i</span><span class="p">)</span> <span class="c1"># start of lexicon (ditto)</span>
</span><span id="L-3098"><a href="#L-3098"><span class="linenos">3098</span></a>  <span class="k">assert</span> <span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">==</span><span class="mh">0x1683</span><span class="p">,</span> <span class="s2">&quot;Is this really an original disk image?&quot;</span>
</span><span id="L-3099"><a href="#L-3099"><span class="linenos">3099</span></a>  <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-3100"><a href="#L-3100"><span class="linenos">3100</span></a><span class="k">def</span> <span class="nf">bbc_appendDefaultLex</span><span class="p">(</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="L-3101"><a href="#L-3101"><span class="linenos">3101</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as lex_footer in bbcmicro format.  If SPEECH_DISK is set, read Speech&#39;s default lexicon from it and append this to outFile.  Otherwise just write a terminating &gt;** to outFile.  In either case, check for exceeding 16k if we&#39;re MAKE_SPEECH_ROM, close the file and call print_bbclex_instructions.&quot;&quot;&quot;</span>
</span><span id="L-3102"><a href="#L-3102"><span class="linenos">3102</span></a>  <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SPEECH_DISK&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="L-3103"><a href="#L-3103"><span class="linenos">3103</span></a>     <span class="n">sd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SPEECH_DISK&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3104"><a href="#L-3104"><span class="linenos">3104</span></a>     <span class="n">d</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-3105"><a href="#L-3105"><span class="linenos">3105</span></a>     <span class="n">i</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&gt;OUS_&#39;</span><span class="p">))</span> <span class="c1"># if this fails, it wasn&#39;t a Speech disk</span>
</span><span id="L-3106"><a href="#L-3106"><span class="linenos">3106</span></a>     <span class="n">j</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt;**&quot;</span><span class="p">),</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-3107"><a href="#L-3107"><span class="linenos">3107</span></a>     <span class="k">assert</span> <span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">==</span><span class="mi">2201</span><span class="p">,</span> <span class="s2">&quot;Lexicon on SPEECH_DISK is wrong size (</span><span class="si">%d</span><span class="s2">). Is this really an original disk image?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-3108"><a href="#L-3108"><span class="linenos">3108</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
</span><span id="L-3109"><a href="#L-3109"><span class="linenos">3109</span></a>     <span class="c1"># TODO: can we compress the BBC lexicon?  i.e. detect if a rule will happen anyway due to subsequent wildcard rules, and delete it if so (don&#39;t know how many bytes that would save)</span>
</span><span id="L-3110"><a href="#L-3110"><span class="linenos">3110</span></a>  <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;**&quot;</span><span class="p">)</span>
</span><span id="L-3111"><a href="#L-3111"><span class="linenos">3111</span></a>  <span class="n">fileLen</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="L-3112"><a href="#L-3112"><span class="linenos">3112</span></a>  <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fileLen</span> <span class="o">&lt;=</span> <span class="mi">16384</span><span class="p">,</span> <span class="s2">&quot;Speech ROM file got too big (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">fileLen</span>
</span><span id="L-3113"><a href="#L-3113"><span class="linenos">3113</span></a>  <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3114"><a href="#L-3114"><span class="linenos">3114</span></a>  <span class="n">print_bbclex_instructions</span><span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="s2">&quot;bbcmicro&quot;</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">),</span><span class="n">fileLen</span><span class="p">)</span>
</span><span id="L-3115"><a href="#L-3115"><span class="linenos">3115</span></a>
</span><span id="L-3116"><a href="#L-3116"><span class="linenos">3116</span></a><span class="k">def</span> <span class="nf">bbcshortest</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="L-3117"><a href="#L-3117"><span class="linenos">3117</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert integer n into the shortest possible number of BBC Micro keystrokes; prefer hex if and only if the extra &#39;&amp;&#39; keystroke won&#39;t make it any longer than its decimal equivalent&quot;&quot;&quot;</span>
</span><span id="L-3118"><a href="#L-3118"><span class="linenos">3118</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span><span id="L-3119"><a href="#L-3119"><span class="linenos">3119</span></a>  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
</span><span id="L-3120"><a href="#L-3120"><span class="linenos">3120</span></a><span class="k">def</span> <span class="nf">bbcKeystrokes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">start</span><span class="p">):</span>
</span><span id="L-3121"><a href="#L-3121"><span class="linenos">3121</span></a>  <span class="s2">&quot;Return BBC BASIC keystrokes to put data into RAM starting at address start, without using the BASIC heap in the process (although we do use one of the page-4 integer variables to save some keystrokes).  Assumes the data is mostly ASCII so the $ operator is the least-keystrokes method of getting it in (rather than ? and ! operators, assembler EQUB/EQUW/EQUS, 6502 mnemonics, etc); we don&#39;t mind about overwriting the byte after with a CHR$(13).  Keystrokes are limited to ASCII for easier copy/paste.  See comments for more details.&quot;</span>
</span><span id="L-3122"><a href="#L-3122"><span class="linenos">3122</span></a>  <span class="c1"># Taken to the extreme, a &#39;find the least keystrokes&#39; function would be some kind of data compressor; we&#39;re not doing that here as we assume this is going to be used to poke in a lexicon, which is basically ASCII with a few CHR$(128)s thrown in; this &#39;$ operator&#39; method is highly likely to yield the least keystrokes for that kind of data, apart from setting and using temporary string variables, but then (1) you&#39;re in the realms of data compression and (2) you require heap memory, which might not be a good idea depending on where we&#39;re putting our lexicon.</span>
</span><span id="L-3123"><a href="#L-3123"><span class="linenos">3123</span></a>  <span class="c1"># I suppose it wouldn&#39;t hurt in most cases to have an A$=CHR$(128), but not doing this for now because you might be in a situation where you can&#39;t touch the heap at all (I&#39;m not sure where the workspace for assembling strings is though).</span>
</span><span id="L-3124"><a href="#L-3124"><span class="linenos">3124</span></a>  <span class="c1"># However, just to be pedantic about saving a few bytes, there is one thing we CAN do: if we have a lexicon with a lot of CHR$(128)s in it, let&#39;s set up BASIC&#39;s page-4 integer variables such that $A%=CHR$(128), saving 6 keystrokes per entry without needing the heap (an additional 1 keystroke per entry could be saved if we didn&#39;t mind putting an A$ on the heap).</span>
</span><span id="L-3125"><a href="#L-3125"><span class="linenos">3125</span></a>  <span class="n">use_int_hack</span> <span class="o">=</span> <span class="p">((</span><span class="n">start</span><span class="o">&gt;=</span><span class="mi">1030</span> <span class="ow">or</span> <span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1026</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="L-3126"><a href="#L-3126"><span class="linenos">3126</span></a>  <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">ret</span><span class="o">=</span><span class="p">[]</span>
</span><span id="L-3127"><a href="#L-3127"><span class="linenos">3127</span></a>  <span class="k">if</span> <span class="n">use_int_hack</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;A%=&amp;408:B%=&amp;D80:&quot;</span><span class="p">)</span> <span class="c1"># (@% is at &amp;400 and each is 4 byte LSB-MSB; $x reads to next 0D)</span>
</span><span id="L-3128"><a href="#L-3128"><span class="linenos">3128</span></a>  <span class="c1"># (If we&#39;re guaranteed to NOT be using Bas128 and therefore all memory addresses are effectively masked by &amp;FFFF, we can instead set A%=&amp;D800406 (using A%&#39;s low 2 bytes to point to A%&#39;s high 2 bytes) for a 1-off saving of 5 keystrokes and 1 page-4 variable, but this saving is not really worth the readability compromise and the risk posed by the possibility of Bas128 - I don&#39;t know how Bas128 treats addresses above &amp;1FFFF)</span>
</span><span id="L-3129"><a href="#L-3129"><span class="linenos">3129</span></a>  <span class="c1"># (An even &#39;nastier&#39; trick would be to put !13=&amp;D80 and then use $13, as those bytes are used by BASIC&#39;s random number generator, which presumably isn&#39;t called during the paste and we don&#39;t mind disrupting it; again I don&#39;t know about Bas128.  But you can&#39;t do it because BASIC gives a &quot;$ range&quot; error on anything below 256.)</span>
</span><span id="L-3130"><a href="#L-3130"><span class="linenos">3130</span></a>  <span class="c1"># (I suppose one thing you _could_ do is LOMEM=&amp;400:A$=CHR$(13) and end with LOMEM=TOP, which would overwrite 3 page-4 variables and let you use just A$ instead of $A%, saving keystrokes over A%=&amp;D800406 after 21 more lexicon words, at the expense of losing track of any variables you had on the heap.  But this is getting silly.)</span>
</span><span id="L-3131"><a href="#L-3131"><span class="linenos">3131</span></a>  <span class="k">else</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-3132"><a href="#L-3132"><span class="linenos">3132</span></a>  <span class="n">bbc_max_line_len</span> <span class="o">=</span> <span class="mi">238</span>
</span><span id="L-3133"><a href="#L-3133"><span class="linenos">3133</span></a>  <span class="n">inQuote</span><span class="o">=</span><span class="n">needPlus</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">needCmd</span><span class="o">=</span><span class="mi">1</span>
</span><span id="L-3134"><a href="#L-3134"><span class="linenos">3134</span></a>  <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="L-3135"><a href="#L-3135"><span class="linenos">3135</span></a>    <span class="k">if</span> <span class="n">needCmd</span><span class="p">:</span>
</span><span id="L-3136"><a href="#L-3136"><span class="linenos">3136</span></a>       <span class="n">thisLine</span> <span class="o">+=</span> <span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">bbcshortest</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">))</span>
</span><span id="L-3137"><a href="#L-3137"><span class="linenos">3137</span></a>       <span class="n">inQuote</span><span class="o">=</span><span class="n">needPlus</span><span class="o">=</span><span class="n">needCmd</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-3138"><a href="#L-3138"><span class="linenos">3138</span></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">),</span><span class="mi">1</span> <span class="c1"># inQ MUST be 0 or 1, not False/True, because it&#39;s also used as &#39;len of necessary close quote&#39; below</span>
</span><span id="L-3139"><a href="#L-3139"><span class="linenos">3139</span></a>    <span class="k">elif</span> <span class="mi">32</span><span class="o">&lt;=</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">127</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span>
</span><span id="L-3140"><a href="#L-3140"><span class="linenos">3140</span></a>    <span class="k">elif</span> <span class="n">use_int_hack</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">128</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;$A%&quot;</span><span class="p">),</span><span class="mi">0</span>
</span><span id="L-3141"><a href="#L-3141"><span class="linenos">3141</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span><span class="o">=</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;CHR$(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)),</span><span class="mi">0</span>
</span><span id="L-3142"><a href="#L-3142"><span class="linenos">3142</span></a>    <span class="n">addToLine</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">newNeedPlus</span> <span class="o">=</span> <span class="n">needPlus</span>
</span><span id="L-3143"><a href="#L-3143"><span class="linenos">3143</span></a>    <span class="k">if</span> <span class="n">inQ</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inQuote</span><span class="p">:</span>
</span><span id="L-3144"><a href="#L-3144"><span class="linenos">3144</span></a>       <span class="k">if</span> <span class="n">needPlus</span><span class="p">:</span> <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
</span><span id="L-3145"><a href="#L-3145"><span class="linenos">3145</span></a>       <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
</span><span id="L-3146"><a href="#L-3146"><span class="linenos">3146</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">0</span>
</span><span id="L-3147"><a href="#L-3147"><span class="linenos">3147</span></a>    <span class="k">elif</span> <span class="n">inQuote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inQ</span><span class="p">:</span>
</span><span id="L-3148"><a href="#L-3148"><span class="linenos">3148</span></a>       <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;+&#39;</span><span class="p">))</span>
</span><span id="L-3149"><a href="#L-3149"><span class="linenos">3149</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># after what we&#39;ll add</span>
</span><span id="L-3150"><a href="#L-3150"><span class="linenos">3150</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">inQ</span><span class="p">:</span>
</span><span id="L-3151"><a href="#L-3151"><span class="linenos">3151</span></a>       <span class="k">if</span> <span class="n">needPlus</span><span class="p">:</span> <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
</span><span id="L-3152"><a href="#L-3152"><span class="linenos">3152</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># after what we&#39;ll add</span>
</span><span id="L-3153"><a href="#L-3153"><span class="linenos">3153</span></a>    <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="L-3154"><a href="#L-3154"><span class="linenos">3154</span></a>    <span class="n">addToLine</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">addToLine</span><span class="p">)</span>
</span><span id="L-3155"><a href="#L-3155"><span class="linenos">3155</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">addToLine</span><span class="p">)</span><span class="o">+</span><span class="n">inQ</span> <span class="o">&gt;</span> <span class="n">bbc_max_line_len</span><span class="p">:</span> <span class="c1"># oops, we&#39;ve gone too far, back off and end prev line</span>
</span><span id="L-3156"><a href="#L-3156"><span class="linenos">3156</span></a>       <span class="k">if</span> <span class="n">inQuote</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="L-3157"><a href="#L-3157"><span class="linenos">3157</span></a>       <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span>
</span><span id="L-3158"><a href="#L-3158"><span class="linenos">3158</span></a>       <span class="n">thisLine</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">needCmd</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="k">continue</span>
</span><span id="L-3159"><a href="#L-3159"><span class="linenos">3159</span></a>    <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">addToLine</span> <span class="p">;</span> <span class="n">inQuote</span><span class="o">=</span><span class="n">inQ</span>
</span><span id="L-3160"><a href="#L-3160"><span class="linenos">3160</span></a>    <span class="n">needPlus</span><span class="o">=</span><span class="n">newNeedPlus</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3161"><a href="#L-3161"><span class="linenos">3161</span></a>  <span class="k">if</span> <span class="n">inQuote</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="L-3162"><a href="#L-3162"><span class="linenos">3162</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">needCmd</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span>
</span><span id="L-3163"><a href="#L-3163"><span class="linenos">3163</span></a>  <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="L-3164"><a href="#L-3164"><span class="linenos">3164</span></a><span class="k">def</span> <span class="nf">print_bbclex_instructions</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
</span><span id="L-3165"><a href="#L-3165"><span class="linenos">3165</span></a><span class="w"> </span><span class="sd">&quot;&quot;&quot;Print suitable instructions for a BBC Micro lexicon of the given filename and size (the exact nature of the instructions depends on the size).  If appropriate, create a .key file containing keystrokes for transferring to an emulator.&quot;&quot;&quot;</span>
</span><span id="L-3166"><a href="#L-3166"><span class="linenos">3166</span></a> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> bytes, hex </span><span class="si">%X</span><span class="s2">) can now installed on an emulator (set in Roms.cfg or whatever), or loaded onto a chip.  The sound quality of this might be worse than that of the main-RAM version.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">))</span> <span class="c1"># (at least on emulation - see comment on sound quality above)</span>
</span><span id="L-3167"><a href="#L-3167"><span class="linenos">3167</span></a> <span class="k">else</span><span class="p">:</span>
</span><span id="L-3168"><a href="#L-3168"><span class="linenos">3168</span></a>  <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The size of this lexicon is </span><span class="si">%d</span><span class="s2"> bytes (hex </span><span class="si">%X</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">))</span> <span class="c1"># (the default lexicon is 2204 bytes)</span>
</span><span id="L-3169"><a href="#L-3169"><span class="linenos">3169</span></a>  <span class="n">bbcStart</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-3170"><a href="#L-3170"><span class="linenos">3170</span></a>  <span class="n">noSRAM_lex_offset</span><span class="o">=</span><span class="mh">0x155F</span> <span class="c1"># (on the BBC Micro, SRAM means Sideways RAM, not Static RAM as it does elsewhere; for clarity we&#39;d better say &quot;Sideways RAM&quot; in all output)</span>
</span><span id="L-3171"><a href="#L-3171"><span class="linenos">3171</span></a>  <span class="n">SRAM_lex_offset</span><span class="o">=</span><span class="mh">0x1683</span>
</span><span id="L-3172"><a href="#L-3172"><span class="linenos">3172</span></a>  <span class="n">SRAM_max</span><span class="o">=</span><span class="mh">0x4000</span> <span class="c1"># 16k</span>
</span><span id="L-3173"><a href="#L-3173"><span class="linenos">3173</span></a>  <span class="n">noSRAM_default_addr</span><span class="o">=</span><span class="mh">0x5500</span>
</span><span id="L-3174"><a href="#L-3174"><span class="linenos">3174</span></a>  <span class="n">noSRAM_min_addr</span><span class="o">=</span><span class="mh">0xE00</span> <span class="c1"># minimum supported by RELOCAT</span>
</span><span id="L-3175"><a href="#L-3175"><span class="linenos">3175</span></a>  <span class="n">page</span><span class="o">=</span><span class="mh">0x1900</span> <span class="c1"># or 0xE00 for Master (but OK to just leave this at 0x1900 regardless of model; it harmlessly increases the range where special_relocate_instructions &#39;kick in&#39;)</span>
</span><span id="L-3176"><a href="#L-3176"><span class="linenos">3176</span></a>  <span class="n">noSRAM_himem</span><span class="o">=</span><span class="mh">0x7c00</span> <span class="c1"># unless you&#39;re in a shadow mode or something (see comments on himem above), however leaving this at 0x7c00 is usually harmless (just causes the &#39;need to relocate&#39; to &#39;kick in&#39; earlier, although if memory is really full it might say &#39;too big&#39; 1k too early)</span>
</span><span id="L-3177"><a href="#L-3177"><span class="linenos">3177</span></a>  <span class="k">def</span> <span class="nf">special_relocate_instructions</span><span class="p">(</span><span class="n">reloc_addr</span><span class="p">):</span>
</span><span id="L-3178"><a href="#L-3178"><span class="linenos">3178</span></a>    <span class="n">pagemove_min</span><span class="p">,</span><span class="n">pagemove_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mh">0xE00</span><span class="p">,</span><span class="n">page</span><span class="o">-</span><span class="mh">0x1E00</span><span class="p">),</span> <span class="n">page</span><span class="o">+</span><span class="mh">0xE00</span> <span class="c1"># if relocating to within this range, must move PAGE before loading RELOCAT. RELOCAT&#39;s supported range is 0xE00 to 0x5E00, omitting (PAGE-&amp;1E00) to (PAGE+&amp;E00)</span>
</span><span id="L-3179"><a href="#L-3179"><span class="linenos">3179</span></a>    <span class="k">if</span> <span class="n">reloc_addr</span> <span class="o">&lt;</span> <span class="mh">0x1900</span><span class="p">:</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot; On a Model B with Acorn DFS you won&#39;t be able to use the disk after relocating below &amp;1900, and you can&#39;t run star commands from tape so you have to initialise via CALL. (On a Master, DFS is not affected as it doesn&#39;t use &amp;E00-&amp;1900.)&quot;</span>
</span><span id="L-3180"><a href="#L-3180"><span class="linenos">3180</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-3181"><a href="#L-3181"><span class="linenos">3181</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">pagemove_min</span><span class="o">&lt;=</span><span class="n">reloc_addr</span><span class="o">&lt;</span><span class="n">pagemove_max</span><span class="p">:</span>
</span><span id="L-3182"><a href="#L-3182"><span class="linenos">3182</span></a>      <span class="k">return</span> <span class="n">extra</span> <span class="c1"># no other special instructions needed</span>
</span><span id="L-3183"><a href="#L-3183"><span class="linenos">3183</span></a>    <span class="n">newpage</span> <span class="o">=</span> <span class="n">reloc_addr</span><span class="o">+</span><span class="mh">0x1E00</span>
</span><span id="L-3184"><a href="#L-3184"><span class="linenos">3184</span></a>    <span class="n">page_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mh">0x5E00</span><span class="p">,</span><span class="n">noSRAM_default_addr</span><span class="o">-</span><span class="mh">0xE00</span><span class="p">)</span>
</span><span id="L-3185"><a href="#L-3185"><span class="linenos">3185</span></a>    <span class="k">if</span> <span class="n">newpage</span> <span class="o">&gt;</span> <span class="n">page_max</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span> <span class="c1"># &quot;Unfortunately RELOCAT can&#39;t put it at &amp;%X even with PAGE changes.&quot; % reloc_addr</span>
</span><span id="L-3186"><a href="#L-3186"><span class="linenos">3186</span></a>    <span class="k">return</span> <span class="s2">&quot; Please run RELOCAT with PAGE in the range of &amp;</span><span class="si">%X</span><span class="s2"> to &amp;</span><span class="si">%X</span><span class="s2"> for this relocation to work.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newpage</span><span class="p">,</span><span class="n">page_max</span><span class="p">,</span><span class="n">extra</span><span class="p">)</span>
</span><span id="L-3187"><a href="#L-3187"><span class="linenos">3187</span></a>  <span class="k">if</span> <span class="n">noSRAM_default_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span><span class="o">+</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">noSRAM_himem</span><span class="p">:</span>
</span><span id="L-3188"><a href="#L-3188"><span class="linenos">3188</span></a>    <span class="n">reloc_addr</span> <span class="o">=</span> <span class="n">noSRAM_himem</span><span class="o">-</span><span class="n">noSRAM_lex_offset</span><span class="o">-</span><span class="n">size</span>
</span><span id="L-3189"><a href="#L-3189"><span class="linenos">3189</span></a>    <span class="n">reloc_addr</span> <span class="o">-=</span> <span class="p">(</span><span class="n">reloc_addr</span><span class="o">%</span><span class="mi">256</span><span class="p">)</span>
</span><span id="L-3190"><a href="#L-3190"><span class="linenos">3190</span></a>    <span class="k">if</span> <span class="n">reloc_addr</span> <span class="o">&gt;=</span> <span class="n">noSRAM_min_addr</span><span class="p">:</span>
</span><span id="L-3191"><a href="#L-3191"><span class="linenos">3191</span></a>      <span class="n">instr</span> <span class="o">=</span> <span class="n">special_relocate_instructions</span><span class="p">(</span><span class="n">reloc_addr</span><span class="p">)</span>
</span><span id="L-3192"><a href="#L-3192"><span class="linenos">3192</span></a>      <span class="k">if</span> <span class="n">instr</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in main RAM even with relocation, unless RELOCAT is rewritten to work from files.&quot;</span><span class="p">)</span>
</span><span id="L-3193"><a href="#L-3193"><span class="linenos">3193</span></a>      <span class="k">else</span><span class="p">:</span>
</span><span id="L-3194"><a href="#L-3194"><span class="linenos">3194</span></a>        <span class="n">bbcStart</span> <span class="o">=</span> <span class="n">reloc_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span>
</span><span id="L-3195"><a href="#L-3195"><span class="linenos">3195</span></a>        <span class="n">reloc_call</span> <span class="o">=</span> <span class="n">reloc_addr</span> <span class="o">+</span> <span class="mh">0xB00</span>
</span><span id="L-3196"><a href="#L-3196"><span class="linenos">3196</span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech at its default address of &amp;</span><span class="si">%X</span><span class="s2">, but you could use RELOCAT to put a version at &amp;</span><span class="si">%X</span><span class="s2"> and then initialise it with CALL </span><span class="si">%s</span><span class="s2"> (or do the suggested *SAVE, reset, and run *SP). Be sure to set HIMEM=&amp;</span><span class="si">%X</span><span class="s2">. Then *LOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> or change the relocated SP file from offset &amp;</span><span class="si">%X</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">noSRAM_default_addr</span><span class="p">,</span><span class="n">reloc_addr</span><span class="p">,</span><span class="n">bbcshortest</span><span class="p">(</span><span class="n">reloc_call</span><span class="p">),</span><span class="n">reloc_addr</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">noSRAM_lex_offset</span><span class="p">,</span><span class="n">instr</span><span class="p">))</span>
</span><span id="L-3197"><a href="#L-3197"><span class="linenos">3197</span></a>    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in main RAM even with relocation.&quot;</span><span class="p">)</span>
</span><span id="L-3198"><a href="#L-3198"><span class="linenos">3198</span></a>  <span class="k">else</span><span class="p">:</span> <span class="c1"># fits at default location - no relocation needed</span>
</span><span id="L-3199"><a href="#L-3199"><span class="linenos">3199</span></a>    <span class="n">bbcStart</span> <span class="o">=</span> <span class="n">noSRAM_default_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span>
</span><span id="L-3200"><a href="#L-3200"><span class="linenos">3200</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can load this lexicon by *LOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> or change the SPEECH file from offset &amp;</span><span class="si">%X</span><span class="s2">. Suggest you also set HIMEM=&amp;</span><span class="si">%X</span><span class="s2"> for safety.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">noSRAM_lex_offset</span><span class="p">,</span><span class="n">noSRAM_default_addr</span><span class="p">))</span>
</span><span id="L-3201"><a href="#L-3201"><span class="linenos">3201</span></a>  <span class="k">if</span> <span class="n">bbcStart</span><span class="p">:</span> <span class="c1"># we managed to fit it into main RAM</span>
</span><span id="L-3202"><a href="#L-3202"><span class="linenos">3202</span></a>     <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3203"><a href="#L-3203"><span class="linenos">3203</span></a>     <span class="n">keys</span> <span class="o">=</span> <span class="n">bbcKeystrokes</span><span class="p">(</span><span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span><span class="n">bbcStart</span><span class="p">)</span>
</span><span id="L-3204"><a href="#L-3204"><span class="linenos">3204</span></a>     <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s2">&quot;.key&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3205"><a href="#L-3205"><span class="linenos">3205</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="L-3206"><a href="#L-3206"><span class="linenos">3206</span></a>     <span class="k">del</span> <span class="n">f</span>
</span><span id="L-3207"><a href="#L-3207"><span class="linenos">3207</span></a>     <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;For ease of transfer to emulators etc, a self-contained keystroke file for putting </span><span class="si">%s</span><span class="s2"> data at &amp;</span><span class="si">%X</span><span class="s2"> has been written to </span><span class="si">%s</span><span class="s2">.key&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>
</span><span id="L-3208"><a href="#L-3208"><span class="linenos">3208</span></a>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;(This file looks too big for BeebEm to paste though)&quot;</span><span class="p">)</span> <span class="c1"># see comments elsewhere</span>
</span><span id="L-3209"><a href="#L-3209"><span class="linenos">3209</span></a>  <span class="c1"># Instructions for replacing lex in SRAM:</span>
</span><span id="L-3210"><a href="#L-3210"><span class="linenos">3210</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">SRAM_max</span><span class="o">-</span><span class="n">SRAM_lex_offset</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in Sideways RAM.&quot;</span><span class="p">)</span> <span class="c1"># unless you can patch Speech to run in SRAM but read its lexicon from main RAM, or run in main RAM but page in multiple banks of SRAM for the lexicon (but even then there&#39;ll be a limit)</span>
</span><span id="L-3211"><a href="#L-3211"><span class="linenos">3211</span></a>  <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can load this lexicon into Sideways RAM by *SRLOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> 7 (or whichever bank number you&#39;re using), or change the SP8000 file from offset &amp;</span><span class="si">%X</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">SRAM_lex_offset</span><span class="o">+</span><span class="mh">0x8000</span><span class="p">,</span><span class="n">SRAM_lex_offset</span><span class="p">))</span>
</span><span id="L-3212"><a href="#L-3212"><span class="linenos">3212</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SPEECH_DISK&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;If you want to append the default lexicon to this one, set SPEECH_DISK to the image of the original Speech disk before running lexconvert, e.g. export SPEECH_DISK=/usr/local/BeebEm3/diskimg/Speech.ssd&quot;</span><span class="p">)</span>
</span><span id="L-3213"><a href="#L-3213"><span class="linenos">3213</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="n">SRAM_max</span><span class="o">-</span><span class="n">SRAM_lex_offset</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can also set MAKE_SPEECH_ROM=1 (along with SPEECH_DISK) to create a SPEECH.ROM file instead&quot;</span><span class="p">)</span>
</span><span id="L-3214"><a href="#L-3214"><span class="linenos">3214</span></a> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;If you get &#39;Mistake in speech&#39; when testing some words, try starting with &#39;*SAY, &#39; (this seems to be a Speech bug)&quot;</span><span class="p">)</span> <span class="c1"># - can&#39;t track down which words it does and doesn&#39;t apply to</span>
</span><span id="L-3215"><a href="#L-3215"><span class="linenos">3215</span></a> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;It might be better to load your lexicon into eSpeak and use lexconvert&#39;s --phones option to drive the BBC with phonemes.&quot;</span><span class="p">)</span>
</span><span id="L-3216"><a href="#L-3216"><span class="linenos">3216</span></a>
</span><span id="L-3217"><a href="#L-3217"><span class="linenos">3217</span></a><span class="k">def</span> <span class="nf">mainopt_version</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="L-3218"><a href="#L-3218"><span class="linenos">3218</span></a>   <span class="c1"># TODO: doc string for the help? (or would this option clutter it needlessly) - just print lexconvert&#39;s version number and nothing else</span>
</span><span id="L-3219"><a href="#L-3219"><span class="linenos">3219</span></a>   <span class="nb">print</span> <span class="p">(</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="L-3220"><a href="#L-3220"><span class="linenos">3220</span></a>
</span><span id="L-3221"><a href="#L-3221"><span class="linenos">3221</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="L-3222"><a href="#L-3222"><span class="linenos">3222</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Introspect the module to find the mainopt_ functions, and either call one of them or print the help.  Returns the error code to send back to the OS.&quot;&quot;&quot;</span>
</span><span id="L-3223"><a href="#L-3223"><span class="linenos">3223</span></a>    <span class="k">def</span> <span class="nf">funcToOpt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;--&quot;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="L-3224"><a href="#L-3224"><span class="linenos">3224</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3225"><a href="#L-3225"><span class="linenos">3225</span></a>        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mainopt_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">funcToOpt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
</span><span id="L-3226"><a href="#L-3226"><span class="linenos">3226</span></a>           <span class="k">try</span><span class="p">:</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">funcToOpt</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="L-3227"><a href="#L-3227"><span class="linenos">3227</span></a>           <span class="k">except</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="L-3228"><a href="#L-3228"><span class="linenos">3228</span></a>              <span class="c1"># Python 2.6+ can have &quot;except Message as e&quot;,</span>
</span><span id="L-3229"><a href="#L-3229"><span class="linenos">3229</span></a>              <span class="c1"># but Python 2.5 has to have &quot;except Message,e&quot;</span>
</span><span id="L-3230"><a href="#L-3230"><span class="linenos">3230</span></a>              <span class="c1"># which is disallowed in Python 3, so</span>
</span><span id="L-3231"><a href="#L-3231"><span class="linenos">3231</span></a>              <span class="n">msg</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">message</span>
</span><span id="L-3232"><a href="#L-3232"><span class="linenos">3232</span></a>           <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="L-3233"><a href="#L-3233"><span class="linenos">3233</span></a>              <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="L-3234"><a href="#L-3234"><span class="linenos">3234</span></a>              <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="L-3235"><a href="#L-3235"><span class="linenos">3235</span></a>           <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-3236"><a href="#L-3236"><span class="linenos">3236</span></a>    <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;--htmlhelp&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="c1"># (undocumented option used for my website, don&#39;t rely on it staying)</span>
</span><span id="L-3237"><a href="#L-3237"><span class="linenos">3237</span></a>    <span class="k">def</span> <span class="nf">htmlify</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;(--[2A-Za-z-]*)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;&lt;kbd&gt;\1&lt;/kbd&gt;&#39;</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">))</span>
</span><span id="L-3238"><a href="#L-3238"><span class="linenos">3238</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">html</span><span class="p">:</span> <span class="n">htmlify</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span>
</span><span id="L-3239"><a href="#L-3239"><span class="linenos">3239</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">htmlify</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">))</span>
</span><span id="L-3240"><a href="#L-3240"><span class="linenos">3240</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="n">missALine</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;&quot;</span>
</span><span id="L-3241"><a href="#L-3241"><span class="linenos">3241</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">missALine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="L-3242"><a href="#L-3242"><span class="linenos">3242</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="L-3243"><a href="#L-3243"><span class="linenos">3243</span></a>    <span class="k">if</span> <span class="s1">&#39;--formats&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span> <span class="c1"># non-HTML mode only (format descriptions are included in HTML anyway, and don&#39;t worry about the capability summary)</span>
</span><span id="L-3244"><a href="#L-3244"><span class="linenos">3244</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats (and support levels):&quot;</span><span class="p">)</span>
</span><span id="L-3245"><a href="#L-3245"><span class="linenos">3245</span></a>       <span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">;</span> <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-3246"><a href="#L-3246"><span class="linenos">3246</span></a>       <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="L-3247"><a href="#L-3247"><span class="linenos">3247</span></a>          <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3248"><a href="#L-3248"><span class="linenos">3248</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;phones&quot;</span><span class="p">)</span>
</span><span id="L-3249"><a href="#L-3249"><span class="linenos">3249</span></a>          <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;speaking&quot;</span><span class="p">)</span>
</span><span id="L-3250"><a href="#L-3250"><span class="linenos">3250</span></a>          <span class="k">else</span><span class="p">:</span>
</span><span id="L-3251"><a href="#L-3251"><span class="linenos">3251</span></a>             <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_read_function&quot;</span><span class="p">):</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lex-read&quot;</span><span class="p">)</span>
</span><span id="L-3252"><a href="#L-3252"><span class="linenos">3252</span></a>             <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">):</span>
</span><span id="L-3253"><a href="#L-3253"><span class="linenos">3253</span></a>                <span class="n">ltype</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_type&quot;</span><span class="p">)</span>
</span><span id="L-3254"><a href="#L-3254"><span class="linenos">3254</span></a>                <span class="k">if</span> <span class="n">ltype</span><span class="p">:</span> <span class="n">ltype</span><span class="o">=</span><span class="s2">&quot; as &quot;</span><span class="o">+</span><span class="n">ltype</span>
</span><span id="L-3255"><a href="#L-3255"><span class="linenos">3255</span></a>                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lex-write&quot;</span><span class="o">+</span><span class="n">ltype</span><span class="p">)</span>
</span><span id="L-3256"><a href="#L-3256"><span class="linenos">3256</span></a>          <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="L-3257"><a href="#L-3257"><span class="linenos">3257</span></a>          <span class="nb">print</span> <span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">))</span>
</span><span id="L-3258"><a href="#L-3258"><span class="linenos">3258</span></a>       <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-3259"><a href="#L-3259"><span class="linenos">3259</span></a>    <span class="k">elif</span> <span class="n">html</span><span class="p">:</span>
</span><span id="L-3260"><a href="#L-3260"><span class="linenos">3260</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats:&quot;</span><span class="p">)</span>
</span><span id="L-3261"><a href="#L-3261"><span class="linenos">3261</span></a>       <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;&lt;table id=&quot;formats&quot;&gt;&#39;</span><span class="p">)</span>
</span><span id="L-3262"><a href="#L-3262"><span class="linenos">3262</span></a>       <span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">;</span> <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="L-3263"><a href="#L-3263"><span class="linenos">3263</span></a>       <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;nobr&gt;&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;&lt;/nobr&gt;&lt;/td&gt;&lt;td valign=&quot;top&quot;&gt;&#39;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="L-3264"><a href="#L-3264"><span class="linenos">3264</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;/table&gt;&lt;script&gt;&lt;!-- try to be more readable on some smartphones</span><span class="se">\n</span><span class="s2">if(((screen &amp;&amp; screen.width&lt;600) || navigator.userAgent.slice(-6)==</span><span class="se">\&quot;</span><span class="s2">Gecko/</span><span class="se">\&quot;</span><span class="s2"> /* UC Browser? */) &amp;&amp; document.getElementById &amp;&amp; document.getElementById(&#39;formats&#39;).outerHTML) document.getElementById(&#39;formats&#39;).outerHTML = document.getElementById(&#39;formats&#39;).outerHTML.replace(/&lt;table/g,&#39;&lt;dl&#39;).replace(/&lt;.table/g,&#39;&lt;&#39;+&#39;/dl&#39;).replace(/&lt;tr&gt;&lt;td/g,&#39;&lt;dt&#39;).replace(/&lt;.td&gt;&lt;td/g,&#39;&lt;&#39;+&#39;/dt&gt;&lt;dd&#39;).replace(/&lt;.td&gt;&lt;.tr/g,&#39;&lt;&#39;+&#39;/dd&#39;);</span><span class="se">\n</span><span class="s2">//--&gt;&lt;/script&gt;&quot;</span><span class="p">)</span>
</span><span id="L-3265"><a href="#L-3265"><span class="linenos">3265</span></a>    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Use --formats to see their descriptions)&quot;</span><span class="p">)</span>
</span><span id="L-3266"><a href="#L-3266"><span class="linenos">3266</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="L-3267"><a href="#L-3267"><span class="linenos">3267</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Program options:&quot;</span><span class="p">)</span>
</span><span id="L-3268"><a href="#L-3268"><span class="linenos">3268</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="L-3269"><a href="#L-3269"><span class="linenos">3269</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;dl&gt;&quot;</span><span class="p">)</span>
</span><span id="L-3270"><a href="#L-3270"><span class="linenos">3270</span></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">opt</span><span class="p">,</span><span class="n">desc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="ow">not</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()]):</span>
</span><span id="L-3271"><a href="#L-3271"><span class="linenos">3271</span></a>       <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mainopt_&quot;</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="L-3272"><a href="#L-3272"><span class="linenos">3272</span></a>       <span class="n">opt</span> <span class="o">=</span> <span class="n">funcToOpt</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</span><span id="L-3273"><a href="#L-3273"><span class="linenos">3273</span></a>       <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># undocumented option</span>
</span><span id="L-3274"><a href="#L-3274"><span class="linenos">3274</span></a>       <span class="n">params</span><span class="p">,</span><span class="n">rest</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-3275"><a href="#L-3275"><span class="linenos">3275</span></a>       <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="L-3276"><a href="#L-3276"><span class="linenos">3276</span></a>       <span class="k">if</span> <span class="n">params</span><span class="p">:</span> <span class="n">opt</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">params</span><span class="p">)</span>
</span><span id="L-3277"><a href="#L-3277"><span class="linenos">3277</span></a>       <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;dt&gt;&quot;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/dt&gt;&lt;dd&gt;&quot;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/dd&gt;&quot;</span><span class="p">)</span>
</span><span id="L-3278"><a href="#L-3278"><span class="linenos">3278</span></a>       <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="n">opt</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">rest</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3279"><a href="#L-3279"><span class="linenos">3279</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;/dl&gt;&quot;</span><span class="p">)</span>
</span><span id="L-3280"><a href="#L-3280"><span class="linenos">3280</span></a>    <span class="k">return</span> <span class="mi">0</span>
</span><span id="L-3281"><a href="#L-3281"><span class="linenos">3281</span></a>
</span><span id="L-3282"><a href="#L-3282"><span class="linenos">3282</span></a><span class="n">catchingSigs</span> <span class="o">=</span> <span class="n">inSigHandler</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3283"><a href="#L-3283"><span class="linenos">3283</span></a><span class="k">def</span> <span class="nf">catchSignals</span><span class="p">():</span>
</span><span id="L-3284"><a href="#L-3284"><span class="linenos">3284</span></a>  <span class="s2">&quot;We had better try to catch all signals if using MacBritish_System_Lexicon so we can safely clean it up. We raise KeyboardInterrupt instead (need to catch this). Might not work with multithreaded code.&quot;</span>
</span><span id="L-3285"><a href="#L-3285"><span class="linenos">3285</span></a>  <span class="k">global</span> <span class="n">catchingSigs</span>
</span><span id="L-3286"><a href="#L-3286"><span class="linenos">3286</span></a>  <span class="k">if</span> <span class="n">catchingSigs</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-3287"><a href="#L-3287"><span class="linenos">3287</span></a>  <span class="n">catchingSigs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3288"><a href="#L-3288"><span class="linenos">3288</span></a>  <span class="kn">import</span> <span class="nn">signal</span>
</span><span id="L-3289"><a href="#L-3289"><span class="linenos">3289</span></a>  <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sigNo</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-3290"><a href="#L-3290"><span class="linenos">3290</span></a>    <span class="k">global</span> <span class="n">inSigHandler</span>
</span><span id="L-3291"><a href="#L-3291"><span class="linenos">3291</span></a>    <span class="k">if</span> <span class="n">inSigHandler</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-3292"><a href="#L-3292"><span class="linenos">3292</span></a>    <span class="n">inSigHandler</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="L-3293"><a href="#L-3293"><span class="linenos">3293</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">killpg</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpgrp</span><span class="p">(),</span><span class="n">sigNo</span><span class="p">)</span>
</span><span id="L-3294"><a href="#L-3294"><span class="linenos">3294</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Caught signal </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigNo</span><span class="p">)</span>
</span><span id="L-3295"><a href="#L-3295"><span class="linenos">3295</span></a>    <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span>
</span><span id="L-3296"><a href="#L-3296"><span class="linenos">3296</span></a>  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">signal</span><span class="o">.</span><span class="n">NSIG</span><span class="p">):</span>
</span><span id="L-3297"><a href="#L-3297"><span class="linenos">3297</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="L-3298"><a href="#L-3298"><span class="linenos">3298</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="c1"># sent on subprocess completion</span>
</span><span id="L-3299"><a href="#L-3299"><span class="linenos">3299</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGTSTP</span><span class="p">,</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGCONT</span><span class="p">,</span> <span class="c1"># Ctrl-Z / fg</span>
</span><span id="L-3300"><a href="#L-3300"><span class="linenos">3300</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGWINCH</span><span class="p">,</span> <span class="c1"># window-size change</span>
</span><span id="L-3301"><a href="#L-3301"><span class="linenos">3301</span></a>    <span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signal</span><span class="o">.</span><span class="n">getsignal</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">:</span>
</span><span id="L-3302"><a href="#L-3302"><span class="linenos">3302</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</span><span id="L-3303"><a href="#L-3303"><span class="linenos">3303</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-3304"><a href="#L-3304"><span class="linenos">3304</span></a><span class="k">class</span> <span class="nc">MacBritish_System_Lexicon</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="L-3305"><a href="#L-3305"><span class="linenos">3305</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Overwrites some of the pronunciations in the system</span>
</span><span id="L-3306"><a href="#L-3306"><span class="linenos">3306</span></a><span class="sd">    lexicon (after backing up the original).  Cannot</span>
</span><span id="L-3307"><a href="#L-3307"><span class="linenos">3307</span></a><span class="sd">    change the actual words in the system lexicon, so just</span>
</span><span id="L-3308"><a href="#L-3308"><span class="linenos">3308</span></a><span class="sd">    alters pronunciations of words you don&#39;t intend to use</span>
</span><span id="L-3309"><a href="#L-3309"><span class="linenos">3309</span></a><span class="sd">    so you can substitute these into your texts.</span>
</span><span id="L-3310"><a href="#L-3310"><span class="linenos">3310</span></a><span class="sd">    Restores the lexicon on close().&quot;&quot;&quot;</span>
</span><span id="L-3311"><a href="#L-3311"><span class="linenos">3311</span></a>    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3312"><a href="#L-3312"><span class="linenos">3312</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">voice</span><span class="o">=</span><span class="s2">&quot;Daniel&quot;</span><span class="p">):</span>
</span><span id="L-3313"><a href="#L-3313"><span class="linenos">3313</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;text is the text you want to speak (so that any</span>
</span><span id="L-3314"><a href="#L-3314"><span class="linenos">3314</span></a><span class="sd">        words used in it that are not mentioned in your</span>
</span><span id="L-3315"><a href="#L-3315"><span class="linenos">3315</span></a><span class="sd">        lexicon are unchanged in the system lexicon);</span>
</span><span id="L-3316"><a href="#L-3316"><span class="linenos">3316</span></a><span class="sd">        text=&quot;&quot; means you just want to speak phonemes.</span>
</span><span id="L-3317"><a href="#L-3317"><span class="linenos">3317</span></a><span class="sd">        Special value of text=False means lexicon read only.</span>
</span><span id="L-3318"><a href="#L-3318"><span class="linenos">3318</span></a><span class="sd">        voice can be Daniel, Emily or Serena.&quot;&quot;&quot;</span>
</span><span id="L-3319"><a href="#L-3319"><span class="linenos">3319</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="L-3320"><a href="#L-3320"><span class="linenos">3320</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="L-3321"><a href="#L-3321"><span class="linenos">3321</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span> <span class="s2">&quot;There is already another instance of MacBritish_System_Lexicon for the &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; voice&quot;</span>
</span><span id="L-3322"><a href="#L-3322"><span class="linenos">3322</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;lockfile -1 -r 10 /tmp/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span> <span class="c1"># in case some other process has it (note: if you run with python -O, this check won&#39;t happen!)</span>
</span><span id="L-3323"><a href="#L-3323"><span class="linenos">3323</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="n">voice</span> <span class="c1"># (don&#39;t set this if text==False, since we won&#39;t need cleanup on __del__)</span>
</span><span id="L-3324"><a href="#L-3324"><span class="linenos">3324</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.SpeechVoice/Contents/Resources/PCMWave&quot;</span>
</span><span id="L-3325"><a href="#L-3325"><span class="linenos">3325</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;Compact.SpeechVoice/Contents/Resources/PCMWave&quot;</span><span class="p">)),</span> <span class="s2">&quot;The only installation of &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; found on this system was the Compact one, which lexconvert does not yet support&quot;</span> <span class="c1"># TODO: could try self.wordIndexStart = findW(&quot;Abiquiu&quot;),self.phIndexStart = findW(&quot;&#39;@b.Ik.ju&quot;),self.wordIndexEnd = findW(&quot;www.youtube.com&quot;,1),self.phIndexEnd = findW(&quot;&#39;d^b.l.ju.&#39;d^b.l.ju.&#39;d^b.l.ju.dA+t.&#39;ju.&#39;tjub.dA+t.kA+m&quot;,1), but &quot;t&quot; in phones should be ignored, &quot;activesync&quot; and &quot;afterlife&quot; have no phones, &quot;aqua&quot; has TWO sets of phonemes (aquarium ok) and there are other synchronization issues.</span>
</span><span id="L-3326"><a href="#L-3326"><span class="linenos">3326</span></a>        <span class="c1"># TODO: some sync issues persist even on the NON-Compact version in newer versions of macOS (e.g. 10.12).  This currently leads to exceptions in findW on such systems (which do say it could be due to wrong version of the voice); fixing would need looking at more sync issues as above</span>
</span><span id="L-3327"><a href="#L-3327"><span class="linenos">3327</span></a>        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span><span class="s2">&quot;Cannot find an installation of &#39;&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;&#39; on this system&quot;</span>
</span><span id="L-3328"><a href="#L-3328"><span class="linenos">3328</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0&quot;</span><span class="p">):</span>
</span><span id="L-3329"><a href="#L-3329"><span class="linenos">3329</span></a>            <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span> <span class="c1"># (use the backup file for read-only, if we created one before; this means we don&#39;t have to worry about locks)</span>
</span><span id="L-3330"><a href="#L-3330"><span class="linenos">3330</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># create a backup</span>
</span><span id="L-3331"><a href="#L-3331"><span class="linenos">3331</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Backing up &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (you&#39;ll need a password if you&#39;re not running as root)</span>
</span><span id="L-3332"><a href="#L-3332"><span class="linenos">3332</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo mv </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2">; sudo cp </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3333"><a href="#L-3333"><span class="linenos">3333</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating backup&quot;</span>
</span><span id="L-3334"><a href="#L-3334"><span class="linenos">3334</span></a>        <span class="n">lexFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;.lexdir&quot;</span>
</span><span id="L-3335"><a href="#L-3335"><span class="linenos">3335</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="L-3336"><a href="#L-3336"><span class="linenos">3336</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Creating lexdir file...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3337"><a href="#L-3337"><span class="linenos">3337</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo touch </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> ; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3338"><a href="#L-3338"><span class="linenos">3338</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating lexdir&quot;</span>
</span><span id="L-3339"><a href="#L-3339"><span class="linenos">3339</span></a>        <span class="n">compat_err</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This probably means your Mac has a new version of the voice that is no longer compatible with this system-lexicon patch.&quot;</span>
</span><span id="L-3340"><a href="#L-3340"><span class="linenos">3340</span></a>        <span class="kn">import</span> <span class="nn">cPickle</span>
</span><span id="L-3341"><a href="#L-3341"><span class="linenos">3341</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="L-3342"><a href="#L-3342"><span class="linenos">3342</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="L-3343"><a href="#L-3343"><span class="linenos">3343</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3344"><a href="#L-3344"><span class="linenos">3344</span></a>            <span class="n">dat</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="L-3345"><a href="#L-3345"><span class="linenos">3345</span></a>            <span class="k">def</span> <span class="nf">findW</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">rtnPastEnd</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="L-3346"><a href="#L-3346"><span class="linenos">3346</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="n">dat</span><span class="p">)</span>
</span><span id="L-3347"><a href="#L-3347"><span class="linenos">3347</span></a>                <span class="k">try</span><span class="p">:</span> <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="L-3348"><a href="#L-3348"><span class="linenos">3348</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="s2">&quot; not found in voice file&quot;</span><span class="o">+</span><span class="n">compat_err</span><span class="p">)</span>
</span><span id="L-3349"><a href="#L-3349"><span class="linenos">3349</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="L-3350"><a href="#L-3350"><span class="linenos">3350</span></a>                    <span class="n">n2</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="L-3351"><a href="#L-3351"><span class="linenos">3351</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not uniquely identify a byte position (has at least </span><span class="si">%d</span><span class="s2"> and </span><span class="si">%d</span><span class="s2">)</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">n2</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">compat_err</span><span class="p">))</span>
</span><span id="L-3352"><a href="#L-3352"><span class="linenos">3352</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="L-3353"><a href="#L-3353"><span class="linenos">3353</span></a>                <span class="k">if</span> <span class="n">rtnPastEnd</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</span><span id="L-3354"><a href="#L-3354"><span class="linenos">3354</span></a>                <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="L-3355"><a href="#L-3355"><span class="linenos">3355</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;808s&quot;</span><span class="p">)</span>
</span><span id="L-3356"><a href="#L-3356"><span class="linenos">3356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;e&amp;It.o&amp;U.e&amp;Its&quot;</span><span class="p">)</span>
</span><span id="L-3357"><a href="#L-3357"><span class="linenos">3357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;zombie&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-3358"><a href="#L-3358"><span class="linenos">3358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;zA+m.bI&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-3359"><a href="#L-3359"><span class="linenos">3359</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="p">))</span>
</span><span id="L-3360"><a href="#L-3360"><span class="linenos">3360</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3361"><a href="#L-3361"><span class="linenos">3361</span></a>        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="L-3362"><a href="#L-3362"><span class="linenos">3362</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">())</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; words but &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; phonemes&quot;</span><span class="o">+</span><span class="n">compat_err</span>
</span><span id="L-3363"><a href="#L-3363"><span class="linenos">3363</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span>
</span><span id="L-3364"><a href="#L-3364"><span class="linenos">3364</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-3365"><a href="#L-3365"><span class="linenos">3365</span></a>        <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">voice</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="L-3366"><a href="#L-3366"><span class="linenos">3366</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="mi">160</span><span class="p">),</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="L-3367"><a href="#L-3367"><span class="linenos">3367</span></a>        <span class="n">catchSignals</span><span class="p">()</span>
</span><span id="L-3368"><a href="#L-3368"><span class="linenos">3368</span></a>    <span class="k">def</span> <span class="nf">allWords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3369"><a href="#L-3369"><span class="linenos">3369</span></a>        <span class="s2">&quot;Returns a list of words that are defined in the system lexicon (which won&#39;t be changed, but see allPh)&quot;</span>
</span><span id="L-3370"><a href="#L-3370"><span class="linenos">3370</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span>
</span><span id="L-3371"><a href="#L-3371"><span class="linenos">3371</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
</span><span id="L-3372"><a href="#L-3372"><span class="linenos">3372</span></a>    <span class="k">def</span> <span class="nf">allPh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3373"><a href="#L-3373"><span class="linenos">3373</span></a>        <span class="s2">&quot;Returns a list of (file position, phoneme string) for each of the primary phoneme entries from the system lexicon.  These entries can be changed in-place by writing to the said file position, and then spoken by giving the voice the corresponding word from allWords (but see also usable_words).&quot;</span>
</span><span id="L-3374"><a href="#L-3374"><span class="linenos">3374</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span>
</span><span id="L-3375"><a href="#L-3375"><span class="linenos">3375</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
</span><span id="L-3376"><a href="#L-3376"><span class="linenos">3376</span></a>            <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span>
</span><span id="L-3377"><a href="#L-3377"><span class="linenos">3377</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="L-3378"><a href="#L-3378"><span class="linenos">3378</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;a&amp;I.&#39;fo&amp;Un&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;lI.@n&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;so&amp;Un.j$&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">last</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;tR+e&amp;I.si&quot;</span><span class="p">]):</span> <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="c1"># (the listed pronunciations are secondary ones that for some reason are in the list)</span>
</span><span id="L-3379"><a href="#L-3379"><span class="linenos">3379</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="n">last</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="L-3380"><a href="#L-3380"><span class="linenos">3380</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># +1 for the \x00</span>
</span><span id="L-3381"><a href="#L-3381"><span class="linenos">3381</span></a>            <span class="k">assert</span> <span class="n">pos</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 because the last \00 will result in a &quot;&quot; item after; the above +1 will be incorrect for that item</span>
</span><span id="L-3382"><a href="#L-3382"><span class="linenos">3382</span></a>            <span class="k">return</span> <span class="n">r</span>
</span><span id="L-3383"><a href="#L-3383"><span class="linenos">3383</span></a>        <span class="k">return</span> <span class="n">f</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))])</span>
</span><span id="L-3384"><a href="#L-3384"><span class="linenos">3384</span></a>    <span class="k">def</span> <span class="nf">usable_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words_ok_to_redefine</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="L-3385"><a href="#L-3385"><span class="linenos">3385</span></a>        <span class="s2">&quot;Returns a list of (word,phoneme_file_position,original_phonemes) by combining allWords with allPh, but omitting any words that don&#39;t seem &#39;usable&#39; (for example words that contain spaces, since these lexicon entries don&#39;t seem to be actually used by the voice).  Words that occur in self.textToAvoid are also considered non-usable, unless they also occur in words_ok_to_redefine (user lexicon).&quot;</span>
</span><span id="L-3386"><a href="#L-3386"><span class="linenos">3386</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()):</span>
</span><span id="L-3387"><a href="#L-3387"><span class="linenos">3387</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># it seems words not matching this regexp are NOT used by the engine</span>
</span><span id="L-3388"><a href="#L-3388"><span class="linenos">3388</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">phonemes</span> <span class="ow">and</span> <span class="mi">32</span><span class="o">&lt;</span><span class="nb">ord</span><span class="p">(</span><span class="n">phonemes</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">127</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># better not touch those, just in case</span>
</span><span id="L-3389"><a href="#L-3389"><span class="linenos">3389</span></a>            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_ok_to_redefine</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-3390"><a href="#L-3390"><span class="linenos">3390</span></a>            <span class="k">yield</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span>
</span><span id="L-3391"><a href="#L-3391"><span class="linenos">3391</span></a>    <span class="k">def</span> <span class="nf">check_redef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wordsAndPhonemes</span><span class="p">):</span>
</span><span id="L-3392"><a href="#L-3392"><span class="linenos">3392</span></a>        <span class="s2">&quot;Diagnostic function to list on standard error the &#39;redefinitions&#39; we want to make.  wordsAndPhonemes is a list of (original system-lexicon word, proposed new phonemes).  The old phonemes are also listed, fetched from allPh.&quot;</span>
</span><span id="L-3393"><a href="#L-3393"><span class="linenos">3393</span></a>        <span class="n">aw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()</span> <span class="p">;</span> <span class="n">ap</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="L-3394"><a href="#L-3394"><span class="linenos">3394</span></a>        <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">wordsAndPhonemes</span><span class="p">:</span>
</span><span id="L-3395"><a href="#L-3395"><span class="linenos">3395</span></a>          <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-3396"><a href="#L-3396"><span class="linenos">3396</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="L-3397"><a href="#L-3397"><span class="linenos">3397</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">aw</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="L-3398"><a href="#L-3398"><span class="linenos">3398</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="L-3399"><a href="#L-3399"><span class="linenos">3399</span></a>            <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()</span>
</span><span id="L-3400"><a href="#L-3400"><span class="linenos">3400</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning: some words were already in system lexicon</span><span class="se">\n</span><span class="s2">word</span><span class="se">\t</span><span class="s2">old</span><span class="se">\t</span><span class="s2">new</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3401"><a href="#L-3401"><span class="linenos">3401</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">ap</span><span class="p">[</span><span class="n">aw</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="L-3402"><a href="#L-3402"><span class="linenos">3402</span></a>    <span class="k">def</span> <span class="nf">speakPhones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phonesList</span><span class="p">):</span>
</span><span id="L-3403"><a href="#L-3403"><span class="linenos">3403</span></a>        <span class="s2">&quot;Speaks every phonetic word in phonesList&quot;</span>
</span><span id="L-3404"><a href="#L-3404"><span class="linenos">3404</span></a>        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;s&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phonesList</span><span class="p">))]</span>
</span><span id="L-3405"><a href="#L-3405"><span class="linenos">3405</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonesList</span><span class="p">)</span>
</span><span id="L-3406"><a href="#L-3406"><span class="linenos">3406</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-3407"><a href="#L-3407"><span class="linenos">3407</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">))</span>
</span><span id="L-3408"><a href="#L-3408"><span class="linenos">3408</span></a>    <span class="k">def</span> <span class="nf">readWithLex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lex</span><span class="p">):</span>
</span><span id="L-3409"><a href="#L-3409"><span class="linenos">3409</span></a>        <span class="s2">&quot;Reads the text given in the constructor after setting up the lexicon with the given (word,phoneme) list&quot;</span>
</span><span id="L-3410"><a href="#L-3410"><span class="linenos">3410</span></a>        <span class="c1"># self.check_redef(lex) # uncomment if you want to know about these</span>
</span><span id="L-3411"><a href="#L-3411"><span class="linenos">3411</span></a>        <span class="n">textToPrint</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39; &#39;</span>
</span><span id="L-3412"><a href="#L-3412"><span class="linenos">3412</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2019</span><span class="s1">&#39;</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span> <span class="c1"># (ignore pronunciation marks 2032 and b7 that might be in the text, but still print them in textToPrint; also normalise apostrophes but not in textToPrint, and be careful with dashes as lex&#39;ing the word after a hyphen or em-dash won&#39;t work BUT we still want to support hyphenated words IN the lexicon, so em-dashes are replaced here and hyphens are included in nonWordBefore below)</span>
</span><span id="L-3413"><a href="#L-3413"><span class="linenos">3413</span></a>        <span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c1"># keep only the ones actually used in the text (no point setting whole lexicon)</span>
</span><span id="L-3414"><a href="#L-3414"><span class="linenos">3414</span></a>        <span class="n">nonWordBefore</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?i)(?&lt;=[^A-Za-z&quot;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-])&quot;</span> <span class="c1"># see below for why chr(0) is included, and see comment above for why hyphen is at the end; (?i) = ignore case</span>
</span><span id="L-3415"><a href="#L-3415"><span class="linenos">3415</span></a>        <span class="n">nonWordAfter</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?=([^A-Za-z&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-]|[&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;-][^A-Za-z]))&quot;</span> <span class="c1"># followed by non-letter non-apostrophe, or followed by apostrophe non-letter (so not if followed by &quot;&#39;s&quot;, because the voice won&#39;t use our custom lex entry if &quot;&#39;s&quot; is added to the lex&#39;d word, TODO: automatically add &quot;&#39;s&quot; versions to the lexicon via +s or +iz?) (also not if followed by hyphen-letters; hyphen before start is handled above, although TODO preceded by non-letter + hyphen might be OK)</span>
</span><span id="L-3416"><a href="#L-3416"><span class="linenos">3416</span></a>        <span class="n">ttal</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="L-3417"><a href="#L-3417"><span class="linenos">3417</span></a>        <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">pp</span> <span class="ow">in</span> <span class="n">lex</span><span class="p">:</span>
</span><span id="L-3418"><a href="#L-3418"><span class="linenos">3418</span></a>          <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># so you can add words with accents etc (in utf-8) to the lexicon</span>
</span><span id="L-3419"><a href="#L-3419"><span class="linenos">3419</span></a>          <span class="k">if</span> <span class="n">ww</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ttal</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="n">tta</span><span class="p">):</span>
</span><span id="L-3420"><a href="#L-3420"><span class="linenos">3420</span></a>            <span class="n">words2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span> <span class="p">;</span> <span class="n">phonemes2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
</span><span id="L-3421"><a href="#L-3421"><span class="linenos">3421</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
</span><span id="L-3422"><a href="#L-3422"><span class="linenos">3422</span></a>           <span class="n">tta</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">,</span><span class="n">tta</span><span class="p">)</span>
</span><span id="L-3423"><a href="#L-3423"><span class="linenos">3423</span></a>           <span class="n">textToPrint</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;[</span><span class="se">\u2032\u00b4\u02b9\u00b7</span><span class="s1">]*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">textToPrint</span><span class="p">)</span>
</span><span id="L-3424"><a href="#L-3424"><span class="linenos">3424</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="L-3425"><a href="#L-3425"><span class="linenos">3425</span></a>        <span class="n">term</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TERM&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="L-3426"><a href="#L-3426"><span class="linenos">3426</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;xterm&quot;</span> <span class="ow">in</span> <span class="n">term</span> <span class="ow">or</span> <span class="n">term</span><span class="o">==</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span> <span class="c1"># we can probably underline words (inverse is more widely supported than underline, e.g. should work even on an old Linux console in case someone&#39;s using that to control an OS X server, but there might be a *lot* of words, which wouldn&#39;t be very good in inverse if user needs dark background and inverse is bright.  Unlike Annogen, we&#39;re dealing primarily with Latin letters.)</span>
</span><span id="L-3427"><a href="#L-3427"><span class="linenos">3427</span></a>           <span class="kn">import</span> <span class="nn">textwrap</span>
</span><span id="L-3428"><a href="#L-3428"><span class="linenos">3428</span></a>           <span class="n">textwrap</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="c1"># a &#39;hack&#39; to make (at least the 2.x implementations of) textwrap ignore our chr(0) and chr(1) markers in their calculations.  Relies on textwrap calling len().</span>
</span><span id="L-3429"><a href="#L-3429"><span class="linenos">3429</span></a>           <span class="nb">print</span> <span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">textToPrint</span><span class="p">,</span><span class="n">stdout_width_unix</span><span class="p">(),</span><span class="n">break_on_hyphens</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[4m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="c1"># break_on_hyphens=False because we don&#39;t really want hyphenated NAMES to be split across lines, and anyway textwrap in (at least) Python 2.7 has a bug that sometimes causes a line breaks to be inserted before a syllable marker symbol like &#39;prime&#39;</span>
</span><span id="L-3430"><a href="#L-3430"><span class="linenos">3430</span></a>        <span class="c1"># else don&#39;t print anything (saves confusion)</span>
</span><span id="L-3431"><a href="#L-3431"><span class="linenos">3431</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="L-3432"><a href="#L-3432"><span class="linenos">3432</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tta</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="L-3433"><a href="#L-3433"><span class="linenos">3433</span></a>    <span class="k">def</span> <span class="nf">setMultiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="L-3434"><a href="#L-3434"><span class="linenos">3434</span></a>        <span class="s2">&quot;Sets phonemes for words, returning dict of word to substitute word.  Flushes file buffer before return.&quot;</span>
</span><span id="L-3435"><a href="#L-3435"><span class="linenos">3435</span></a>        <span class="n">avail</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">needed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="L-3436"><a href="#L-3436"><span class="linenos">3436</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usable_words</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="L-3437"><a href="#L-3437"><span class="linenos">3437</span></a>            <span class="n">avail</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="L-3438"><a href="#L-3438"><span class="linenos">3438</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="L-3439"><a href="#L-3439"><span class="linenos">3439</span></a>            <span class="n">needed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="L-3440"><a href="#L-3440"><span class="linenos">3440</span></a>        <span class="n">avail</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="p">;</span> <span class="n">needed</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># shortest phon first</span>
</span><span id="L-3441"><a href="#L-3441"><span class="linenos">3441</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">wDic</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">iDone</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span> <span class="p">;</span> <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">True</span>
</span><span id="L-3442"><a href="#L-3442"><span class="linenos">3442</span></a>        <span class="c1"># mustBeAlpha: prefer alphabetical words, since</span>
</span><span id="L-3443"><a href="#L-3443"><span class="linenos">3443</span></a>        <span class="c1"># these can be capitalised at start of sentence</span>
</span><span id="L-3444"><a href="#L-3444"><span class="linenos">3444</span></a>        <span class="c1"># (the prosody doesn&#39;t always work if it isn&#39;t)</span>
</span><span id="L-3445"><a href="#L-3445"><span class="linenos">3445</span></a>        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="n">needed</span><span class="p">:</span>
</span><span id="L-3446"><a href="#L-3446"><span class="linenos">3446</span></a>            <span class="k">while</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mustBeAlpha</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;[A-Za-z]&quot;</span><span class="p">),</span><span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iDone</span><span class="p">:</span>
</span><span id="L-3447"><a href="#L-3447"><span class="linenos">3447</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3448"><a href="#L-3448"><span class="linenos">3448</span></a>                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">avail</span><span class="p">):</span>
</span><span id="L-3449"><a href="#L-3449"><span class="linenos">3449</span></a>                    <span class="k">if</span> <span class="n">mustBeAlpha</span><span class="p">:</span> <span class="c1"># desperate situation: we HAVE to use the non-alphabetical slots now (ideally we should pick words that never occur at start of sentence for them, but this branch is hopefully a rare situation in practice)</span>
</span><span id="L-3450"><a href="#L-3450"><span class="linenos">3450</span></a>                       <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">False</span> <span class="p">;</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="k">continue</span>
</span><span id="L-3451"><a href="#L-3451"><span class="linenos">3451</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Could not find enough lexicon slots!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># TODO: we passed &#39;words&#39; to usable_words&#39;s words_ok_to_redefine - this might not be the case if we didn&#39;t find enough slots</span>
</span><span id="L-3452"><a href="#L-3452"><span class="linenos">3452</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span><span id="L-3453"><a href="#L-3453"><span class="linenos">3453</span></a>            <span class="n">iDone</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="L-3454"><a href="#L-3454"><span class="linenos">3454</span></a>            <span class="n">_</span><span class="p">,</span><span class="n">wSubst</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">oldPhon</span> <span class="o">=</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="L-3455"><a href="#L-3455"><span class="linenos">3455</span></a>            <span class="k">if</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">:</span> <span class="n">oldPhon</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># shouldn&#39;t happen if setMultiple is called only once, but might be useful for small experiments in the Python interpreter etc</span>
</span><span id="L-3456"><a href="#L-3456"><span class="linenos">3456</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">,</span><span class="n">oldPhon</span><span class="p">)</span>
</span><span id="L-3457"><a href="#L-3457"><span class="linenos">3457</span></a>            <span class="n">wDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">wSubst</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">wSubst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># always capitalise it so it can be used at start of sentence too (TODO: copy original capitalisation of each instance instead, in case it happens to come directly after a dotted abbreviation? although if it&#39;s something that&#39;s always capitalised anyway, e.g. most names, then this won&#39;t make any difference)</span>
</span><span id="L-3458"><a href="#L-3458"><span class="linenos">3458</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span><span id="L-3459"><a href="#L-3459"><span class="linenos">3459</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="L-3460"><a href="#L-3460"><span class="linenos">3460</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets phonemes at position phPos to new value.</span>
</span><span id="L-3461"><a href="#L-3461"><span class="linenos">3461</span></a><span class="sd">        Caller should flush the file buffer when done.&quot;&quot;&quot;</span>
</span><span id="L-3462"><a href="#L-3462"><span class="linenos">3462</span></a>        <span class="c1"># print &quot;Debugger: setting %x to %s&quot; % (phPos,val)</span>
</span><span id="L-3463"><a href="#L-3463"><span class="linenos">3463</span></a>        <span class="k">if</span> <span class="n">old</span><span class="p">:</span>
</span><span id="L-3464"><a href="#L-3464"><span class="linenos">3464</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Cannot call set() twice on same phoneme while re-specifying &#39;old&#39;&quot;</span>
</span><span id="L-3465"><a href="#L-3465"><span class="linenos">3465</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">),</span> <span class="s2">&quot;New phoneme is too long!&quot;</span>
</span><span id="L-3466"><a href="#L-3466"><span class="linenos">3466</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">[</span><span class="n">phPos</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span>
</span><span id="L-3467"><a href="#L-3467"><span class="linenos">3467</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">assert</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Must specify old values (for restore) when setting for first time&quot;</span>
</span><span id="L-3468"><a href="#L-3468"><span class="linenos">3468</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">phPos</span><span class="p">)</span>
</span><span id="L-3469"><a href="#L-3469"><span class="linenos">3469</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="L-3470"><a href="#L-3470"><span class="linenos">3470</span></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3471"><a href="#L-3471"><span class="linenos">3471</span></a>        <span class="s2">&quot;WARNING - this might not be called before exit - best to call close() manually&quot;</span>
</span><span id="L-3472"><a href="#L-3472"><span class="linenos">3472</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="p">:</span> <span class="k">return</span>
</span><span id="L-3473"><a href="#L-3473"><span class="linenos">3473</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3474"><a href="#L-3474"><span class="linenos">3474</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="L-3475"><a href="#L-3475"><span class="linenos">3475</span></a>        <span class="k">for</span> <span class="n">phPos</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="L-3476"><a href="#L-3476"><span class="linenos">3476</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</span><span id="L-3477"><a href="#L-3477"><span class="linenos">3477</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="L-3478"><a href="#L-3478"><span class="linenos">3478</span></a>        <span class="k">del</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="p">]</span>
</span><span id="L-3479"><a href="#L-3479"><span class="linenos">3479</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -f /tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span>
</span><span id="L-3480"><a href="#L-3480"><span class="linenos">3480</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">=</span><span class="kc">None</span>
</span><span id="L-3481"><a href="#L-3481"><span class="linenos">3481</span></a><span class="k">def</span> <span class="nf">stdout_width_unix</span><span class="p">():</span> <span class="c1"># assumes isatty</span>
</span><span id="L-3482"><a href="#L-3482"><span class="linenos">3482</span></a>   <span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span><span class="nn">fcntl</span><span class="o">,</span><span class="nn">termios</span>
</span><span id="L-3483"><a href="#L-3483"><span class="linenos">3483</span></a>   <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;hh&#39;</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">termios</span><span class="o">.</span><span class="n">TIOCGWINSZ</span><span class="p">,</span><span class="s1">&#39;1234&#39;</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-3484"><a href="#L-3484"><span class="linenos">3484</span></a>
</span><span id="L-3485"><a href="#L-3485"><span class="linenos">3485</span></a><span class="n">lexFormats</span> <span class="o">=</span> <span class="n">LexFormats</span><span class="p">()</span> <span class="c1"># at end, in case it refers to anything that was defined later</span>
</span><span id="L-3486"><a href="#L-3486"><span class="linenos">3486</span></a>
</span><span id="L-3487"><a href="#L-3487"><span class="linenos">3487</span></a><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="n">main</span><span class="p">())</span>
</span></pre></div>


            </section>
                <section id="Phonemes">
                            <input id="Phonemes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">Phonemes</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="Phonemes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Phonemes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Phonemes-27"><a href="#Phonemes-27"><span class="linenos"> 27</span></a><span class="k">def</span> <span class="nf">Phonemes</span><span class="p">():</span>
</span><span id="Phonemes-28"><a href="#Phonemes-28"><span class="linenos"> 28</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Create phonemes by calling vowel(), consonant(),</span>
</span><span id="Phonemes-29"><a href="#Phonemes-29"><span class="linenos"> 29</span></a><span class="sd">     variant() and other().</span>
</span><span id="Phonemes-30"><a href="#Phonemes-30"><span class="linenos"> 30</span></a><span class="sd">   </span>
</span><span id="Phonemes-31"><a href="#Phonemes-31"><span class="linenos"> 31</span></a><span class="sd">     For the variants, if a particular variant does not</span>
</span><span id="Phonemes-32"><a href="#Phonemes-32"><span class="linenos"> 32</span></a><span class="sd">     exist in the destination format then we will treat it</span>
</span><span id="Phonemes-33"><a href="#Phonemes-33"><span class="linenos"> 33</span></a><span class="sd">     as equivalent to the last non-variant we created.</span>
</span><span id="Phonemes-34"><a href="#Phonemes-34"><span class="linenos"> 34</span></a><span class="sd">  </span>
</span><span id="Phonemes-35"><a href="#Phonemes-35"><span class="linenos"> 35</span></a><span class="sd">     For anything else that does not exist in the</span>
</span><span id="Phonemes-36"><a href="#Phonemes-36"><span class="linenos"> 36</span></a><span class="sd">     destination format, we will first try to break the</span>
</span><span id="Phonemes-37"><a href="#Phonemes-37"><span class="linenos"> 37</span></a><span class="sd">     source&#39;s phoneme into parts (e.g. see the treatment</span>
</span><span id="Phonemes-38"><a href="#Phonemes-38"><span class="linenos"> 38</span></a><span class="sd">     of opt_ol_as_in_gold by eSpeak and bbcmicro), and if</span>
</span><span id="Phonemes-39"><a href="#Phonemes-39"><span class="linenos"> 39</span></a><span class="sd">     that still doesn&#39;t work then we drop a character</span>
</span><span id="Phonemes-40"><a href="#Phonemes-40"><span class="linenos"> 40</span></a><span class="sd">     (warning depending on the source format&#39;s setting of</span>
</span><span id="Phonemes-41"><a href="#Phonemes-41"><span class="linenos"> 41</span></a><span class="sd">     safe_to_drop_characters).  makeDic does however warn</span>
</span><span id="Phonemes-42"><a href="#Phonemes-42"><span class="linenos"> 42</span></a><span class="sd">     about any non-variant consonants, or non-variant</span>
</span><span id="Phonemes-43"><a href="#Phonemes-43"><span class="linenos"> 43</span></a><span class="sd">     vowels that weren&#39;t marked optional, missing from a</span>
</span><span id="Phonemes-44"><a href="#Phonemes-44"><span class="linenos"> 44</span></a><span class="sd">     format. &quot;&quot;&quot;</span>
</span><span id="Phonemes-45"><a href="#Phonemes-45"><span class="linenos"> 45</span></a>   <span class="n">a_as_in_ah</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-46"><a href="#Phonemes-46"><span class="linenos"> 46</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-47"><a href="#Phonemes-47"><span class="linenos"> 47</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-48"><a href="#Phonemes-48"><span class="linenos"> 48</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var4_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-49"><a href="#Phonemes-49"><span class="linenos"> 49</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var5_a_as_in_ah</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-50"><a href="#Phonemes-50"><span class="linenos"> 50</span></a>   <span class="n">a_as_in_apple</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-51"><a href="#Phonemes-51"><span class="linenos"> 51</span></a>   <span class="n">u_as_in_but</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span> <span class="c1"># or the first part of un as in hunt</span>
</span><span id="Phonemes-52"><a href="#Phonemes-52"><span class="linenos"> 52</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_u_as_in_but</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-53"><a href="#Phonemes-53"><span class="linenos"> 53</span></a>   <span class="n">o_as_in_orange</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-54"><a href="#Phonemes-54"><span class="linenos"> 54</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_orange</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-55"><a href="#Phonemes-55"><span class="linenos"> 55</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_o_as_in_orange</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-56"><a href="#Phonemes-56"><span class="linenos"> 56</span></a>   <span class="n">o_as_in_now</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-57"><a href="#Phonemes-57"><span class="linenos"> 57</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_now</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-58"><a href="#Phonemes-58"><span class="linenos"> 58</span></a>   <span class="n">a_as_in_ago</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-59"><a href="#Phonemes-59"><span class="linenos"> 59</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ago</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-60"><a href="#Phonemes-60"><span class="linenos"> 60</span></a>   <span class="n">e_as_in_herd</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-61"><a href="#Phonemes-61"><span class="linenos"> 61</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">ar_as_in_year</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-62"><a href="#Phonemes-62"><span class="linenos"> 62</span></a>   <span class="n">eye</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-63"><a href="#Phonemes-63"><span class="linenos"> 63</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_eye</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-64"><a href="#Phonemes-64"><span class="linenos"> 64</span></a>   <span class="n">b</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-65"><a href="#Phonemes-65"><span class="linenos"> 65</span></a>   <span class="n">ch</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-66"><a href="#Phonemes-66"><span class="linenos"> 66</span></a>   <span class="n">d</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-67"><a href="#Phonemes-67"><span class="linenos"> 67</span></a>   <span class="n">th_as_in_them</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-68"><a href="#Phonemes-68"><span class="linenos"> 68</span></a>   <span class="n">e_as_in_them</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-69"><a href="#Phonemes-69"><span class="linenos"> 69</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_e_as_in_them</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-70"><a href="#Phonemes-70"><span class="linenos"> 70</span></a>   <span class="n">a_as_in_air</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-71"><a href="#Phonemes-71"><span class="linenos"> 71</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-72"><a href="#Phonemes-72"><span class="linenos"> 72</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-73"><a href="#Phonemes-73"><span class="linenos"> 73</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-74"><a href="#Phonemes-74"><span class="linenos"> 74</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var4_a_as_in_air</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-75"><a href="#Phonemes-75"><span class="linenos"> 75</span></a>   <span class="n">a_as_in_ate</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-76"><a href="#Phonemes-76"><span class="linenos"> 76</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_a_as_in_ate</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-77"><a href="#Phonemes-77"><span class="linenos"> 77</span></a>   <span class="n">f</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-78"><a href="#Phonemes-78"><span class="linenos"> 78</span></a>   <span class="n">g</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-79"><a href="#Phonemes-79"><span class="linenos"> 79</span></a>   <span class="n">h</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-80"><a href="#Phonemes-80"><span class="linenos"> 80</span></a>   <span class="n">i_as_in_it</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-81"><a href="#Phonemes-81"><span class="linenos"> 81</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_i_as_in_it</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-82"><a href="#Phonemes-82"><span class="linenos"> 82</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_i_as_in_it</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-83"><a href="#Phonemes-83"><span class="linenos"> 83</span></a>   <span class="n">ear</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-84"><a href="#Phonemes-84"><span class="linenos"> 84</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_ear</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-85"><a href="#Phonemes-85"><span class="linenos"> 85</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_ear</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-86"><a href="#Phonemes-86"><span class="linenos"> 86</span></a>   <span class="n">e_as_in_eat</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-87"><a href="#Phonemes-87"><span class="linenos"> 87</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_e_as_in_eat</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-88"><a href="#Phonemes-88"><span class="linenos"> 88</span></a>   <span class="n">j_as_in_jump</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-89"><a href="#Phonemes-89"><span class="linenos"> 89</span></a>   <span class="n">k</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-90"><a href="#Phonemes-90"><span class="linenos"> 90</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">opt_scottish_loch</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-91"><a href="#Phonemes-91"><span class="linenos"> 91</span></a>   <span class="n">l</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-92"><a href="#Phonemes-92"><span class="linenos"> 92</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_l</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-93"><a href="#Phonemes-93"><span class="linenos"> 93</span></a>   <span class="n">m</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-94"><a href="#Phonemes-94"><span class="linenos"> 94</span></a>   <span class="n">n</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-95"><a href="#Phonemes-95"><span class="linenos"> 95</span></a>   <span class="n">ng</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-96"><a href="#Phonemes-96"><span class="linenos"> 96</span></a>   <span class="n">o_as_in_go</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-97"><a href="#Phonemes-97"><span class="linenos"> 97</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_o_as_in_go</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-98"><a href="#Phonemes-98"><span class="linenos"> 98</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_o_as_in_go</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-99"><a href="#Phonemes-99"><span class="linenos"> 99</span></a>   <span class="n">opt_ol_as_in_gold</span> <span class="o">=</span> <span class="n">opt_vowel</span><span class="p">()</span> <span class="c1"># see eSpeak / bbcmicro</span>
</span><span id="Phonemes-100"><a href="#Phonemes-100"><span class="linenos">100</span></a>   <span class="n">oy_as_in_toy</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-101"><a href="#Phonemes-101"><span class="linenos">101</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oy_as_in_toy</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-102"><a href="#Phonemes-102"><span class="linenos">102</span></a>   <span class="n">p</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-103"><a href="#Phonemes-103"><span class="linenos">103</span></a>   <span class="n">r</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-104"><a href="#Phonemes-104"><span class="linenos">104</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_r</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-105"><a href="#Phonemes-105"><span class="linenos">105</span></a>   <span class="n">s</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-106"><a href="#Phonemes-106"><span class="linenos">106</span></a>   <span class="n">sh</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-107"><a href="#Phonemes-107"><span class="linenos">107</span></a>   <span class="n">t</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-108"><a href="#Phonemes-108"><span class="linenos">108</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_t</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-109"><a href="#Phonemes-109"><span class="linenos">109</span></a>   <span class="n">th_as_in_think</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-110"><a href="#Phonemes-110"><span class="linenos">110</span></a>   <span class="n">oor_as_in_poor</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-111"><a href="#Phonemes-111"><span class="linenos">111</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oor_as_in_poor</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-112"><a href="#Phonemes-112"><span class="linenos">112</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">opt_u_as_in_pull</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-113"><a href="#Phonemes-113"><span class="linenos">113</span></a>   <span class="n">opt_ul_as_in_pull</span> <span class="o">=</span> <span class="n">opt_vowel</span><span class="p">()</span> <span class="c1"># see eSpeak / bbcmicro</span>
</span><span id="Phonemes-114"><a href="#Phonemes-114"><span class="linenos">114</span></a>   <span class="n">oo_as_in_food</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-115"><a href="#Phonemes-115"><span class="linenos">115</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_oo_as_in_food</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-116"><a href="#Phonemes-116"><span class="linenos">116</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_oo_as_in_food</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-117"><a href="#Phonemes-117"><span class="linenos">117</span></a>   <span class="n">close_to_or</span> <span class="o">=</span> <span class="n">vowel</span><span class="p">()</span>
</span><span id="Phonemes-118"><a href="#Phonemes-118"><span class="linenos">118</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-119"><a href="#Phonemes-119"><span class="linenos">119</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var2_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-120"><a href="#Phonemes-120"><span class="linenos">120</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var3_close_to_or</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-121"><a href="#Phonemes-121"><span class="linenos">121</span></a>   <span class="n">v</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-122"><a href="#Phonemes-122"><span class="linenos">122</span></a>   <span class="n">w</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-123"><a href="#Phonemes-123"><span class="linenos">123</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">var1_w</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-124"><a href="#Phonemes-124"><span class="linenos">124</span></a>   <span class="n">y</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-125"><a href="#Phonemes-125"><span class="linenos">125</span></a>   <span class="n">z</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-126"><a href="#Phonemes-126"><span class="linenos">126</span></a>   <span class="n">ge_of_blige_etc</span> <span class="o">=</span> <span class="n">consonant</span><span class="p">()</span>
</span><span id="Phonemes-127"><a href="#Phonemes-127"><span class="linenos">127</span></a>   <span class="n">glottal_stop</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-128"><a href="#Phonemes-128"><span class="linenos">128</span></a>   <span class="n">syllable_separator</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-129"><a href="#Phonemes-129"><span class="linenos">129</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">primary_stress</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-130"><a href="#Phonemes-130"><span class="linenos">130</span></a>   <span class="n">_</span><span class="p">,</span> <span class="n">secondary_stress</span> <span class="o">=</span> <span class="n">variant</span><span class="p">()</span>
</span><span id="Phonemes-131"><a href="#Phonemes-131"><span class="linenos">131</span></a>   <span class="n">text_sharp</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-132"><a href="#Phonemes-132"><span class="linenos">132</span></a>   <span class="n">text_underline</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-133"><a href="#Phonemes-133"><span class="linenos">133</span></a>   <span class="n">text_question</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-134"><a href="#Phonemes-134"><span class="linenos">134</span></a>   <span class="n">text_exclamation</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-135"><a href="#Phonemes-135"><span class="linenos">135</span></a>   <span class="n">text_comma</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span>
</span><span id="Phonemes-136"><a href="#Phonemes-136"><span class="linenos">136</span></a>   <span class="n">ipa_colon</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="c1"># for catching missed cases</span>
</span><span id="Phonemes-137"><a href="#Phonemes-137"><span class="linenos">137</span></a>   <span class="k">del</span> <span class="n">_</span> <span class="p">;</span> <span class="k">return</span> <span class="nb">locals</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Create phonemes by calling vowel(), consonant(),
variant() and other().</p>

<p>For the variants, if a particular variant does not
exist in the destination format then we will treat it
as equivalent to the last non-variant we created.</p>

<p>For anything else that does not exist in the
destination format, we will first try to break the
source's phoneme into parts (e.g. see the treatment
of opt_ol_as_in_gold by eSpeak and bbcmicro), and if
that still doesn't work then we drop a character
(warning depending on the source format's setting of
safe_to_drop_characters).  makeDic does however warn
about any non-variant consonants, or non-variant
vowels that weren't marked optional, missing from a
format.</p>
</div>


                </section>
                <section id="LexFormats">
                            <input id="LexFormats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">LexFormats</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="LexFormats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#LexFormats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="LexFormats-139"><a href="#LexFormats-139"><span class="linenos"> 139</span></a><span class="k">def</span> <span class="nf">LexFormats</span><span class="p">():</span>
</span><span id="LexFormats-140"><a href="#LexFormats-140"><span class="linenos"> 140</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Makes the phoneme conversion tables of each format.</span>
</span><span id="LexFormats-141"><a href="#LexFormats-141"><span class="linenos"> 141</span></a><span class="sd">     Each table has string to phoneme entries and phoneme</span>
</span><span id="LexFormats-142"><a href="#LexFormats-142"><span class="linenos"> 142</span></a><span class="sd">     to string entries.  The string to phoneme entries are</span>
</span><span id="LexFormats-143"><a href="#LexFormats-143"><span class="linenos"> 143</span></a><span class="sd">     used when converting OUT of that format, and the</span>
</span><span id="LexFormats-144"><a href="#LexFormats-144"><span class="linenos"> 144</span></a><span class="sd">     phoneme to string entries are used when converting IN</span>
</span><span id="LexFormats-145"><a href="#LexFormats-145"><span class="linenos"> 145</span></a><span class="sd">     (so you can recognise phonemes you don&#39;t support and</span>
</span><span id="LexFormats-146"><a href="#LexFormats-146"><span class="linenos"> 146</span></a><span class="sd">     convert them to something else).  By default, a tuple</span>
</span><span id="LexFormats-147"><a href="#LexFormats-147"><span class="linenos"> 147</span></a><span class="sd">     of the form (string,phoneme) will create entries in</span>
</span><span id="LexFormats-148"><a href="#LexFormats-148"><span class="linenos"> 148</span></a><span class="sd">     BOTH directions; one-directional entries are created</span>
</span><span id="LexFormats-149"><a href="#LexFormats-149"><span class="linenos"> 149</span></a><span class="sd">     via (string,phoneme,False) or (phoneme,string,False).</span>
</span><span id="LexFormats-150"><a href="#LexFormats-150"><span class="linenos"> 150</span></a><span class="sd">     The makeDic function checks the keys are unique.</span>
</span><span id="LexFormats-151"><a href="#LexFormats-151"><span class="linenos"> 151</span></a><span class="sd">     </span>
</span><span id="LexFormats-152"><a href="#LexFormats-152"><span class="linenos"> 152</span></a><span class="sd">     First parameter is always a description of the</span>
</span><span id="LexFormats-153"><a href="#LexFormats-153"><span class="linenos"> 153</span></a><span class="sd">     format, then come the phoneme entries as described</span>
</span><span id="LexFormats-154"><a href="#LexFormats-154"><span class="linenos"> 154</span></a><span class="sd">     above, then any additional settings:</span>
</span><span id="LexFormats-155"><a href="#LexFormats-155"><span class="linenos"> 155</span></a>
</span><span id="LexFormats-156"><a href="#LexFormats-156"><span class="linenos"> 156</span></a><span class="sd">       stress_comes_before_vowel (default False means any</span>
</span><span id="LexFormats-157"><a href="#LexFormats-157"><span class="linenos"> 157</span></a><span class="sd">       stress mark goes AFTER the affected vowel; set to</span>
</span><span id="LexFormats-158"><a href="#LexFormats-158"><span class="linenos"> 158</span></a><span class="sd">       True if the format requires stress placed before)</span>
</span><span id="LexFormats-159"><a href="#LexFormats-159"><span class="linenos"> 159</span></a>
</span><span id="LexFormats-160"><a href="#LexFormats-160"><span class="linenos"> 160</span></a><span class="sd">       word_separator (default same as phoneme_separator)</span>
</span><span id="LexFormats-161"><a href="#LexFormats-161"><span class="linenos"> 161</span></a><span class="sd">       phoneme_separator (default &quot; &quot;)</span>
</span><span id="LexFormats-162"><a href="#LexFormats-162"><span class="linenos"> 162</span></a><span class="sd">       clause_separator (default newline)</span>
</span><span id="LexFormats-163"><a href="#LexFormats-163"><span class="linenos"> 163</span></a>
</span><span id="LexFormats-164"><a href="#LexFormats-164"><span class="linenos"> 164</span></a><span class="sd">       (For a special case, clause_separator can also be</span>
</span><span id="LexFormats-165"><a href="#LexFormats-165"><span class="linenos"> 165</span></a><span class="sd">        set to a function.  If that happens, the function</span>
</span><span id="LexFormats-166"><a href="#LexFormats-166"><span class="linenos"> 166</span></a><span class="sd">        will be called whenever lexconvert needs to output</span>
</span><span id="LexFormats-167"><a href="#LexFormats-167"><span class="linenos"> 167</span></a><span class="sd">        a list of (lists of words) in this format.  See</span>
</span><span id="LexFormats-168"><a href="#LexFormats-168"><span class="linenos"> 168</span></a><span class="sd">        bbcmicro for an example function clause_separator)</span>
</span><span id="LexFormats-169"><a href="#LexFormats-169"><span class="linenos"> 169</span></a>
</span><span id="LexFormats-170"><a href="#LexFormats-170"><span class="linenos"> 170</span></a><span class="sd">       safe_to_drop_characters (default False, can be a</span>
</span><span id="LexFormats-171"><a href="#LexFormats-171"><span class="linenos"> 171</span></a><span class="sd">       string of safe characters or True = all; controls</span>
</span><span id="LexFormats-172"><a href="#LexFormats-172"><span class="linenos"> 172</span></a><span class="sd">       warnings when unrecognised characters are found)</span>
</span><span id="LexFormats-173"><a href="#LexFormats-173"><span class="linenos"> 173</span></a>
</span><span id="LexFormats-174"><a href="#LexFormats-174"><span class="linenos"> 174</span></a><span class="sd">       approximate_missing (default False) - if True,</span>
</span><span id="LexFormats-175"><a href="#LexFormats-175"><span class="linenos"> 175</span></a><span class="sd">       makeDic will attempt to compensate for missing</span>
</span><span id="LexFormats-176"><a href="#LexFormats-176"><span class="linenos"> 176</span></a><span class="sd">       phonemes by approximating them to others, instead of</span>
</span><span id="LexFormats-177"><a href="#LexFormats-177"><span class="linenos"> 177</span></a><span class="sd">       warning about them.  This is useful for American codes</span>
</span><span id="LexFormats-178"><a href="#LexFormats-178"><span class="linenos"> 178</span></a><span class="sd">       that can&#39;t cope with all the British English phonemes.</span>
</span><span id="LexFormats-179"><a href="#LexFormats-179"><span class="linenos"> 179</span></a><span class="sd">       (Approximation is done automatically anyway in the</span>
</span><span id="LexFormats-180"><a href="#LexFormats-180"><span class="linenos"> 180</span></a><span class="sd">       case of variant phonemes; approximate_missing adds in</span>
</span><span id="LexFormats-181"><a href="#LexFormats-181"><span class="linenos"> 181</span></a><span class="sd">       some additional approximations - see comments in code)</span>
</span><span id="LexFormats-182"><a href="#LexFormats-182"><span class="linenos"> 182</span></a>
</span><span id="LexFormats-183"><a href="#LexFormats-183"><span class="linenos"> 183</span></a><span class="sd">       cleanup_regexps (default none) - optional list of</span>
</span><span id="LexFormats-184"><a href="#LexFormats-184"><span class="linenos"> 184</span></a><span class="sd">       (search,replace) regular expressions to &quot;clean up&quot;</span>
</span><span id="LexFormats-185"><a href="#LexFormats-185"><span class="linenos"> 185</span></a><span class="sd">       after converting each word INTO this format</span>
</span><span id="LexFormats-186"><a href="#LexFormats-186"><span class="linenos"> 186</span></a><span class="sd">       cleanup_func (default none) - optional special-case</span>
</span><span id="LexFormats-187"><a href="#LexFormats-187"><span class="linenos"> 187</span></a><span class="sd">       function to pass result through after cleanup_regexps</span>
</span><span id="LexFormats-188"><a href="#LexFormats-188"><span class="linenos"> 188</span></a>
</span><span id="LexFormats-189"><a href="#LexFormats-189"><span class="linenos"> 189</span></a><span class="sd">       cvtOut_regexps (default none) - optional list of</span>
</span><span id="LexFormats-190"><a href="#LexFormats-190"><span class="linenos"> 190</span></a><span class="sd">       (search,replace) regular expressions to &quot;clean up&quot;</span>
</span><span id="LexFormats-191"><a href="#LexFormats-191"><span class="linenos"> 191</span></a><span class="sd">       before starting to convert OUT of this format</span>
</span><span id="LexFormats-192"><a href="#LexFormats-192"><span class="linenos"> 192</span></a><span class="sd">       cvtOut_func (default none) - optional special-case</span>
</span><span id="LexFormats-193"><a href="#LexFormats-193"><span class="linenos"> 193</span></a><span class="sd">       function to pass through before any cvtOut_regexps</span>
</span><span id="LexFormats-194"><a href="#LexFormats-194"><span class="linenos"> 194</span></a><span class="sd">  </span>
</span><span id="LexFormats-195"><a href="#LexFormats-195"><span class="linenos"> 195</span></a><span class="sd">       inline_format (default &quot;%s&quot;) the format string for</span>
</span><span id="LexFormats-196"><a href="#LexFormats-196"><span class="linenos"> 196</span></a><span class="sd">       printing a word with --phones or --phones2phones</span>
</span><span id="LexFormats-197"><a href="#LexFormats-197"><span class="linenos"> 197</span></a><span class="sd">       (can be used to put markup around each word)</span>
</span><span id="LexFormats-198"><a href="#LexFormats-198"><span class="linenos"> 198</span></a><span class="sd">       (can also be a function taking the phonetic word</span>
</span><span id="LexFormats-199"><a href="#LexFormats-199"><span class="linenos"> 199</span></a><span class="sd">        and returning the resulting string, e.g. bbcmicro)</span>
</span><span id="LexFormats-200"><a href="#LexFormats-200"><span class="linenos"> 200</span></a>
</span><span id="LexFormats-201"><a href="#LexFormats-201"><span class="linenos"> 201</span></a><span class="sd">       output_is_binary (default False) - True if the output</span>
</span><span id="LexFormats-202"><a href="#LexFormats-202"><span class="linenos"> 202</span></a><span class="sd">       is almost certainly unsuitable for a terminal; will</span>
</span><span id="LexFormats-203"><a href="#LexFormats-203"><span class="linenos"> 203</span></a><span class="sd">       cause lexconvert to refuse to print phonemes unless</span>
</span><span id="LexFormats-204"><a href="#LexFormats-204"><span class="linenos"> 204</span></a><span class="sd">       its standard output is redirected to a file or pipe</span>
</span><span id="LexFormats-205"><a href="#LexFormats-205"><span class="linenos"> 205</span></a><span class="sd">       (affects the --phones and --phones2phones options)</span>
</span><span id="LexFormats-206"><a href="#LexFormats-206"><span class="linenos"> 206</span></a>
</span><span id="LexFormats-207"><a href="#LexFormats-207"><span class="linenos"> 207</span></a><span class="sd">       inline_header (default none) text to print first</span>
</span><span id="LexFormats-208"><a href="#LexFormats-208"><span class="linenos"> 208</span></a><span class="sd">         when outputting from --phones or --phones2phones</span>
</span><span id="LexFormats-209"><a href="#LexFormats-209"><span class="linenos"> 209</span></a><span class="sd">       inline_footer (default none) text to print last</span>
</span><span id="LexFormats-210"><a href="#LexFormats-210"><span class="linenos"> 210</span></a><span class="sd">       inline_oneoff_header (default none) text to print</span>
</span><span id="LexFormats-211"><a href="#LexFormats-211"><span class="linenos"> 211</span></a><span class="sd">         before inline_header on the first time only</span>
</span><span id="LexFormats-212"><a href="#LexFormats-212"><span class="linenos"> 212</span></a>
</span><span id="LexFormats-213"><a href="#LexFormats-213"><span class="linenos"> 213</span></a><span class="sd">       lex_filename - filename of a lexicon file.  If this</span>
</span><span id="LexFormats-214"><a href="#LexFormats-214"><span class="linenos"> 214</span></a><span class="sd">       is not specified, there is no support for writing a</span>
</span><span id="LexFormats-215"><a href="#LexFormats-215"><span class="linenos"> 215</span></a><span class="sd">       lexicon in this format: there can still be READ</span>
</span><span id="LexFormats-216"><a href="#LexFormats-216"><span class="linenos"> 216</span></a><span class="sd">       support if you define lex_read_function to open the</span>
</span><span id="LexFormats-217"><a href="#LexFormats-217"><span class="linenos"> 217</span></a><span class="sd">       lexicon by itself, but otherwise the format can be</span>
</span><span id="LexFormats-218"><a href="#LexFormats-218"><span class="linenos"> 218</span></a><span class="sd">       used only with --phones and --phones2phones.</span>
</span><span id="LexFormats-219"><a href="#LexFormats-219"><span class="linenos"> 219</span></a>
</span><span id="LexFormats-220"><a href="#LexFormats-220"><span class="linenos"> 220</span></a><span class="sd">       lex_entry_format - format string for writing each</span>
</span><span id="LexFormats-221"><a href="#LexFormats-221"><span class="linenos"> 221</span></a><span class="sd">       (word, pronunciation) entry to the lexicon file.</span>
</span><span id="LexFormats-222"><a href="#LexFormats-222"><span class="linenos"> 222</span></a><span class="sd">       This is also needed for lexicon-write support.</span>
</span><span id="LexFormats-223"><a href="#LexFormats-223"><span class="linenos"> 223</span></a>
</span><span id="LexFormats-224"><a href="#LexFormats-224"><span class="linenos"> 224</span></a><span class="sd">       lex_header, lex_footer - optional strings to write</span>
</span><span id="LexFormats-225"><a href="#LexFormats-225"><span class="linenos"> 225</span></a><span class="sd">       at the beginning and at the end of the lexicon file</span>
</span><span id="LexFormats-226"><a href="#LexFormats-226"><span class="linenos"> 226</span></a><span class="sd">       (can also be functions that take the open file as a</span>
</span><span id="LexFormats-227"><a href="#LexFormats-227"><span class="linenos"> 227</span></a><span class="sd">        parameter, e.g. for bbcmicro; lex_footer is</span>
</span><span id="LexFormats-228"><a href="#LexFormats-228"><span class="linenos"> 228</span></a><span class="sd">        allowed to close the file if it needs to do</span>
</span><span id="LexFormats-229"><a href="#LexFormats-229"><span class="linenos"> 229</span></a><span class="sd">        something with it afterwards)</span>
</span><span id="LexFormats-230"><a href="#LexFormats-230"><span class="linenos"> 230</span></a>
</span><span id="LexFormats-231"><a href="#LexFormats-231"><span class="linenos"> 231</span></a><span class="sd">       lex_word_case - optional &quot;upper&quot; or &quot;lower&quot; to</span>
</span><span id="LexFormats-232"><a href="#LexFormats-232"><span class="linenos"> 232</span></a><span class="sd">       force a particular case for lexicon words (not</span>
</span><span id="LexFormats-233"><a href="#LexFormats-233"><span class="linenos"> 233</span></a><span class="sd">       pronunciations - they&#39;re determined by the table).</span>
</span><span id="LexFormats-234"><a href="#LexFormats-234"><span class="linenos"> 234</span></a><span class="sd">       The default is to allow words to be in either case.</span>
</span><span id="LexFormats-235"><a href="#LexFormats-235"><span class="linenos"> 235</span></a>
</span><span id="LexFormats-236"><a href="#LexFormats-236"><span class="linenos"> 236</span></a><span class="sd">       lex_type (default &quot;&quot;) - used by the --formats</span>
</span><span id="LexFormats-237"><a href="#LexFormats-237"><span class="linenos"> 237</span></a><span class="sd">       option when summarising the support for each format</span>
</span><span id="LexFormats-238"><a href="#LexFormats-238"><span class="linenos"> 238</span></a>
</span><span id="LexFormats-239"><a href="#LexFormats-239"><span class="linenos"> 239</span></a><span class="sd">       lex_read_function - Python function to READ the</span>
</span><span id="LexFormats-240"><a href="#LexFormats-240"><span class="linenos"> 240</span></a><span class="sd">       lexicon file and return a (word,phonemes) list.</span>
</span><span id="LexFormats-241"><a href="#LexFormats-241"><span class="linenos"> 241</span></a><span class="sd">       If this is not specified, there&#39;s no read support</span>
</span><span id="LexFormats-242"><a href="#LexFormats-242"><span class="linenos"> 242</span></a><span class="sd">       for lexicons in this format (but there can still be</span>
</span><span id="LexFormats-243"><a href="#LexFormats-243"><span class="linenos"> 243</span></a><span class="sd">       write support - see above - and you can still use</span>
</span><span id="LexFormats-244"><a href="#LexFormats-244"><span class="linenos"> 244</span></a><span class="sd">       --phones and --phones2phones).  If lex_filename is</span>
</span><span id="LexFormats-245"><a href="#LexFormats-245"><span class="linenos"> 245</span></a><span class="sd">       specified then this function will be given the open</span>
</span><span id="LexFormats-246"><a href="#LexFormats-246"><span class="linenos"> 246</span></a><span class="sd">       file as a parameter. &quot;&quot;&quot;</span>
</span><span id="LexFormats-247"><a href="#LexFormats-247"><span class="linenos"> 247</span></a>  
</span><span id="LexFormats-248"><a href="#LexFormats-248"><span class="linenos"> 248</span></a>  <span class="n">phonemes</span> <span class="o">=</span> <span class="n">Phonemes</span><span class="p">()</span> <span class="p">;</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">phonemes</span><span class="p">)</span>
</span><span id="LexFormats-249"><a href="#LexFormats-249"><span class="linenos"> 249</span></a>  <span class="k">return</span> <span class="p">{</span> <span class="s2">&quot;festival&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-250"><a href="#LexFormats-250"><span class="linenos"> 250</span></a>    <span class="s2">&quot;Festival&#39;s British voice&quot;</span><span class="p">,</span>
</span><span id="LexFormats-251"><a href="#LexFormats-251"><span class="linenos"> 251</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-252"><a href="#LexFormats-252"><span class="linenos"> 252</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-253"><a href="#LexFormats-253"><span class="linenos"> 253</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-254"><a href="#LexFormats-254"><span class="linenos"> 254</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-255"><a href="#LexFormats-255"><span class="linenos"> 255</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-256"><a href="#LexFormats-256"><span class="linenos"> 256</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-257"><a href="#LexFormats-257"><span class="linenos"> 257</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-258"><a href="#LexFormats-258"><span class="linenos"> 258</span></a>    <span class="p">(</span><span class="s1">&#39;au&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-259"><a href="#LexFormats-259"><span class="linenos"> 259</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-260"><a href="#LexFormats-260"><span class="linenos"> 260</span></a>    <span class="p">(</span><span class="s1">&#39;@@&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-261"><a href="#LexFormats-261"><span class="linenos"> 261</span></a>    <span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-262"><a href="#LexFormats-262"><span class="linenos"> 262</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-263"><a href="#LexFormats-263"><span class="linenos"> 263</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-264"><a href="#LexFormats-264"><span class="linenos"> 264</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-265"><a href="#LexFormats-265"><span class="linenos"> 265</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-266"><a href="#LexFormats-266"><span class="linenos"> 266</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-267"><a href="#LexFormats-267"><span class="linenos"> 267</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;@@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-268"><a href="#LexFormats-268"><span class="linenos"> 268</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-269"><a href="#LexFormats-269"><span class="linenos"> 269</span></a>    <span class="p">(</span><span class="s1">&#39;ei&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-270"><a href="#LexFormats-270"><span class="linenos"> 270</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-271"><a href="#LexFormats-271"><span class="linenos"> 271</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-272"><a href="#LexFormats-272"><span class="linenos"> 272</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-273"><a href="#LexFormats-273"><span class="linenos"> 273</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-274"><a href="#LexFormats-274"><span class="linenos"> 274</span></a>    <span class="p">(</span><span class="s1">&#39;i@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-275"><a href="#LexFormats-275"><span class="linenos"> 275</span></a>    <span class="p">(</span><span class="s1">&#39;ii&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-276"><a href="#LexFormats-276"><span class="linenos"> 276</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-277"><a href="#LexFormats-277"><span class="linenos"> 277</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-278"><a href="#LexFormats-278"><span class="linenos"> 278</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-279"><a href="#LexFormats-279"><span class="linenos"> 279</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-280"><a href="#LexFormats-280"><span class="linenos"> 280</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-281"><a href="#LexFormats-281"><span class="linenos"> 281</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-282"><a href="#LexFormats-282"><span class="linenos"> 282</span></a>    <span class="p">(</span><span class="s1">&#39;ou&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-283"><a href="#LexFormats-283"><span class="linenos"> 283</span></a>    <span class="p">(</span><span class="s1">&#39;oi&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-284"><a href="#LexFormats-284"><span class="linenos"> 284</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-285"><a href="#LexFormats-285"><span class="linenos"> 285</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-286"><a href="#LexFormats-286"><span class="linenos"> 286</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-287"><a href="#LexFormats-287"><span class="linenos"> 287</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-288"><a href="#LexFormats-288"><span class="linenos"> 288</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-289"><a href="#LexFormats-289"><span class="linenos"> 289</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-290"><a href="#LexFormats-290"><span class="linenos"> 290</span></a>    <span class="p">(</span><span class="s1">&#39;u@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-291"><a href="#LexFormats-291"><span class="linenos"> 291</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-292"><a href="#LexFormats-292"><span class="linenos"> 292</span></a>    <span class="p">(</span><span class="s1">&#39;uu&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-293"><a href="#LexFormats-293"><span class="linenos"> 293</span></a>    <span class="p">(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-294"><a href="#LexFormats-294"><span class="linenos"> 294</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-295"><a href="#LexFormats-295"><span class="linenos"> 295</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-296"><a href="#LexFormats-296"><span class="linenos"> 296</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-297"><a href="#LexFormats-297"><span class="linenos"> 297</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-298"><a href="#LexFormats-298"><span class="linenos"> 298</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-299"><a href="#LexFormats-299"><span class="linenos"> 299</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;HOME&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;.festivalrc&quot;</span><span class="p">,</span>
</span><span id="LexFormats-300"><a href="#LexFormats-300"><span class="linenos"> 300</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;(lex.add.entry &#39;( </span><span class="se">\&quot;</span><span class="si">%s</span><span class="se">\&quot;</span><span class="s2"> n </span><span class="si">%s</span><span class="s2">))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-301"><a href="#LexFormats-301"><span class="linenos"> 301</span></a>    <span class="n">lex_header</span><span class="o">=</span><span class="s2">&quot;;; -*- mode: lisp -*-</span><span class="se">\n</span><span class="s2">(eval (list voice_default))</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-302"><a href="#LexFormats-302"><span class="linenos"> 302</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;[&#39;</span><span class="o">+</span><span class="n">getoutput</span><span class="p">(</span><span class="s2">&quot;grep -vi parameter.set &lt; ~/.festivalrc | grep -v &#39;(eval&#39; | sed -e &#39;s/;.*//&#39; -e &#39;s/.lex.add.entry//&#39; -e s/</span><span class="se">\&quot;</span><span class="s2">&#39;</span><span class="se">\&quot;</span><span class="s2">&#39;[(] *</span><span class="se">\&quot;</span><span class="s2">/[</span><span class="se">\&quot;</span><span class="s2">/&#39; -e &#39;s/</span><span class="se">\&quot;</span><span class="s2"> [^ ]* /</span><span class="se">\&quot;</span><span class="s2">,(</span><span class="se">\&quot;</span><span class="s2">/&#39; -e &#39;s/</span><span class="se">\&quot;</span><span class="s2">.*$/&amp;</span><span class="se">\&quot;</span><span class="s2">],/&#39; -e &#39;s/[()]/ /g&#39; -e &#39;s/  */ /g&#39;&quot;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">),</span>
</span><span id="LexFormats-303"><a href="#LexFormats-303"><span class="linenos"> 303</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really? (could instead give a string of known-safe characters)</span>
</span><span id="LexFormats-304"><a href="#LexFormats-304"><span class="linenos"> 304</span></a>    <span class="n">cleanup_func</span> <span class="o">=</span> <span class="n">festival_group_stress</span><span class="p">,</span>
</span><span id="LexFormats-305"><a href="#LexFormats-305"><span class="linenos"> 305</span></a>  <span class="p">),</span>
</span><span id="LexFormats-306"><a href="#LexFormats-306"><span class="linenos"> 306</span></a>
</span><span id="LexFormats-307"><a href="#LexFormats-307"><span class="linenos"> 307</span></a>  <span class="s2">&quot;example&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-308"><a href="#LexFormats-308"><span class="linenos"> 308</span></a>    <span class="s2">&quot;A small built-in example lexicon for testing when you don&#39;t have your full custom lexicon to hand.  Use --convert to write it in one of the other formats and see if a synth can import it.&quot;</span><span class="p">,</span>
</span><span id="LexFormats-309"><a href="#LexFormats-309"><span class="linenos"> 309</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="p">[</span>
</span><span id="LexFormats-310"><a href="#LexFormats-310"><span class="linenos"> 310</span></a>       <span class="p">(</span><span class="s2">&quot;Shadrach&quot;</span><span class="p">,</span><span class="s2">&quot;shei1drak&quot;</span><span class="p">),</span>
</span><span id="LexFormats-311"><a href="#LexFormats-311"><span class="linenos"> 311</span></a>       <span class="p">(</span><span class="s2">&quot;Meshach&quot;</span><span class="p">,</span><span class="s2">&quot;mii1shak&quot;</span><span class="p">),</span>
</span><span id="LexFormats-312"><a href="#LexFormats-312"><span class="linenos"> 312</span></a>       <span class="p">(</span><span class="s2">&quot;Abednego&quot;</span><span class="p">,</span><span class="s2">&quot;@be1dniigou&quot;</span><span class="p">),</span>
</span><span id="LexFormats-313"><a href="#LexFormats-313"><span class="linenos"> 313</span></a>    <span class="p">],</span> <span class="n">cleanup_func</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="LexFormats-314"><a href="#LexFormats-314"><span class="linenos"> 314</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lex_entry_format</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LexFormats-315"><a href="#LexFormats-315"><span class="linenos"> 315</span></a>
</span><span id="LexFormats-316"><a href="#LexFormats-316"><span class="linenos"> 316</span></a>  <span class="s2">&quot;festival-cmu&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-317"><a href="#LexFormats-317"><span class="linenos"> 317</span></a>    <span class="s2">&quot;American CMU version of Festival&quot;</span><span class="p">,</span>
</span><span id="LexFormats-318"><a href="#LexFormats-318"><span class="linenos"> 318</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-319"><a href="#LexFormats-319"><span class="linenos"> 319</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-320"><a href="#LexFormats-320"><span class="linenos"> 320</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-321"><a href="#LexFormats-321"><span class="linenos"> 321</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-322"><a href="#LexFormats-322"><span class="linenos"> 322</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-323"><a href="#LexFormats-323"><span class="linenos"> 323</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span> <span class="c1"># TODO: check this one</span>
</span><span id="LexFormats-324"><a href="#LexFormats-324"><span class="linenos"> 324</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-325"><a href="#LexFormats-325"><span class="linenos"> 325</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-326"><a href="#LexFormats-326"><span class="linenos"> 326</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-327"><a href="#LexFormats-327"><span class="linenos"> 327</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-328"><a href="#LexFormats-328"><span class="linenos"> 328</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-329"><a href="#LexFormats-329"><span class="linenos"> 329</span></a>    <span class="p">(</span><span class="s1">&#39;hh&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-330"><a href="#LexFormats-330"><span class="linenos"> 330</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-331"><a href="#LexFormats-331"><span class="linenos"> 331</span></a>    <span class="p">(</span><span class="s1">&#39;ey ah&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-332"><a href="#LexFormats-332"><span class="linenos"> 332</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-333"><a href="#LexFormats-333"><span class="linenos"> 333</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-334"><a href="#LexFormats-334"><span class="linenos"> 334</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-335"><a href="#LexFormats-335"><span class="linenos"> 335</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-336"><a href="#LexFormats-336"><span class="linenos"> 336</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-337"><a href="#LexFormats-337"><span class="linenos"> 337</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-338"><a href="#LexFormats-338"><span class="linenos"> 338</span></a>  <span class="p">),</span>
</span><span id="LexFormats-339"><a href="#LexFormats-339"><span class="linenos"> 339</span></a>
</span><span id="LexFormats-340"><a href="#LexFormats-340"><span class="linenos"> 340</span></a>  <span class="s2">&quot;espeak&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-341"><a href="#LexFormats-341"><span class="linenos"> 341</span></a>    <span class="s2">&quot;eSpeak&#39;s default British voice&quot;</span><span class="p">,</span> <span class="c1"># but eSpeak&#39;s phoneme representation isn&#39;t always that simple, hence the regexps at the end</span>
</span><span id="LexFormats-342"><a href="#LexFormats-342"><span class="linenos"> 342</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-343"><a href="#LexFormats-343"><span class="linenos"> 343</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-344"><a href="#LexFormats-344"><span class="linenos"> 344</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-345"><a href="#LexFormats-345"><span class="linenos"> 345</span></a>    <span class="c1"># TODO: glottal_stop? (in regional pronunciations etc)</span>
</span><span id="LexFormats-346"><a href="#LexFormats-346"><span class="linenos"> 346</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-347"><a href="#LexFormats-347"><span class="linenos"> 347</span></a>    <span class="p">(</span><span class="s1">&#39;A@&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-348"><a href="#LexFormats-348"><span class="linenos"> 348</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-349"><a href="#LexFormats-349"><span class="linenos"> 349</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-350"><a href="#LexFormats-350"><span class="linenos"> 350</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-351"><a href="#LexFormats-351"><span class="linenos"> 351</span></a>    <span class="p">(</span><span class="s1">&#39;a2&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: this is actually an a_as_in_apple variant in espeak; festival @1 is not in mrpa PhoneSet</span>
</span><span id="LexFormats-352"><a href="#LexFormats-352"><span class="linenos"> 352</span></a>    <span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-353"><a href="#LexFormats-353"><span class="linenos"> 353</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-354"><a href="#LexFormats-354"><span class="linenos"> 354</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-355"><a href="#LexFormats-355"><span class="linenos"> 355</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-356"><a href="#LexFormats-356"><span class="linenos"> 356</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-357"><a href="#LexFormats-357"><span class="linenos"> 357</span></a>    <span class="p">(</span><span class="s1">&#39;a#&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># (TODO: eSpeak sometimes uses a# in &#39;had&#39; when in a sentence, and this doesn&#39;t always sound good on other synths; might sometimes want to convert it to a_as_in_apple; not sure what contexts would call for this though)</span>
</span><span id="LexFormats-358"><a href="#LexFormats-358"><span class="linenos"> 358</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-359"><a href="#LexFormats-359"><span class="linenos"> 359</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-360"><a href="#LexFormats-360"><span class="linenos"> 360</span></a>    <span class="p">(</span><span class="s1">&#39;@2&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-361"><a href="#LexFormats-361"><span class="linenos"> 361</span></a>    <span class="p">(</span><span class="s1">&#39;@-&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># (eSpeak @- sounds to me like a shorter version of @, TODO: double-check the relationship between @ and @2 in Festival)</span>
</span><span id="LexFormats-362"><a href="#LexFormats-362"><span class="linenos"> 362</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-363"><a href="#LexFormats-363"><span class="linenos"> 363</span></a>    <span class="p">(</span><span class="s1">&#39;aI2&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-364"><a href="#LexFormats-364"><span class="linenos"> 364</span></a>    <span class="p">(</span><span class="s1">&#39;aI;&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-365"><a href="#LexFormats-365"><span class="linenos"> 365</span></a>    <span class="p">(</span><span class="s1">&#39;aI2;&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-366"><a href="#LexFormats-366"><span class="linenos"> 366</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-367"><a href="#LexFormats-367"><span class="linenos"> 367</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-368"><a href="#LexFormats-368"><span class="linenos"> 368</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-369"><a href="#LexFormats-369"><span class="linenos"> 369</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-370"><a href="#LexFormats-370"><span class="linenos"> 370</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-371"><a href="#LexFormats-371"><span class="linenos"> 371</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-372"><a href="#LexFormats-372"><span class="linenos"> 372</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-373"><a href="#LexFormats-373"><span class="linenos"> 373</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-374"><a href="#LexFormats-374"><span class="linenos"> 374</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-375"><a href="#LexFormats-375"><span class="linenos"> 375</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-376"><a href="#LexFormats-376"><span class="linenos"> 376</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-377"><a href="#LexFormats-377"><span class="linenos"> 377</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-378"><a href="#LexFormats-378"><span class="linenos"> 378</span></a>    <span class="p">(</span><span class="s1">&#39;I;&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-379"><a href="#LexFormats-379"><span class="linenos"> 379</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-380"><a href="#LexFormats-380"><span class="linenos"> 380</span></a>    <span class="p">(</span><span class="s1">&#39;I2&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-381"><a href="#LexFormats-381"><span class="linenos"> 381</span></a>    <span class="p">(</span><span class="s1">&#39;I2;&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-382"><a href="#LexFormats-382"><span class="linenos"> 382</span></a>    <span class="p">(</span><span class="s1">&#39;i@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-383"><a href="#LexFormats-383"><span class="linenos"> 383</span></a>    <span class="p">(</span><span class="s1">&#39;i@3&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span>
</span><span id="LexFormats-384"><a href="#LexFormats-384"><span class="linenos"> 384</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-385"><a href="#LexFormats-385"><span class="linenos"> 385</span></a>    <span class="p">(</span><span class="s1">&#39;i:;&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-386"><a href="#LexFormats-386"><span class="linenos"> 386</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-387"><a href="#LexFormats-387"><span class="linenos"> 387</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-388"><a href="#LexFormats-388"><span class="linenos"> 388</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-389"><a href="#LexFormats-389"><span class="linenos"> 389</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-390"><a href="#LexFormats-390"><span class="linenos"> 390</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-391"><a href="#LexFormats-391"><span class="linenos"> 391</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-392"><a href="#LexFormats-392"><span class="linenos"> 392</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-393"><a href="#LexFormats-393"><span class="linenos"> 393</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-394"><a href="#LexFormats-394"><span class="linenos"> 394</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-395"><a href="#LexFormats-395"><span class="linenos"> 395</span></a>    <span class="p">(</span><span class="s1">&#39;oUl&#39;</span><span class="p">,</span><span class="n">opt_ol_as_in_gold</span><span class="p">),</span> <span class="c1"># (espeak says &quot;gold&quot; in a slightly &#39;posh&#39; way though) (if dest format doesn&#39;t have opt_ol_as_in_gold, it&#39;ll get o_as_in_go + the l)</span>
</span><span id="LexFormats-396"><a href="#LexFormats-396"><span class="linenos"> 396</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-397"><a href="#LexFormats-397"><span class="linenos"> 397</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-398"><a href="#LexFormats-398"><span class="linenos"> 398</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-399"><a href="#LexFormats-399"><span class="linenos"> 399</span></a>    <span class="p">(</span><span class="s1">&#39;r-&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-400"><a href="#LexFormats-400"><span class="linenos"> 400</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-401"><a href="#LexFormats-401"><span class="linenos"> 401</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-402"><a href="#LexFormats-402"><span class="linenos"> 402</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-403"><a href="#LexFormats-403"><span class="linenos"> 403</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-404"><a href="#LexFormats-404"><span class="linenos"> 404</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-405"><a href="#LexFormats-405"><span class="linenos"> 405</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-406"><a href="#LexFormats-406"><span class="linenos"> 406</span></a>    <span class="p">(</span><span class="s1">&#39;@5&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-407"><a href="#LexFormats-407"><span class="linenos"> 407</span></a>    <span class="p">(</span><span class="s1">&#39;Ul&#39;</span><span class="p">,</span><span class="n">opt_ul_as_in_pull</span><span class="p">),</span> <span class="c1"># if dest format doesn&#39;t have this, it&#39;ll get opt_u_as_in_pull from the U, then the l</span>
</span><span id="LexFormats-408"><a href="#LexFormats-408"><span class="linenos"> 408</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-409"><a href="#LexFormats-409"><span class="linenos"> 409</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-410"><a href="#LexFormats-410"><span class="linenos"> 410</span></a>    <span class="p">(</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-411"><a href="#LexFormats-411"><span class="linenos"> 411</span></a>    <span class="p">(</span><span class="s1">&#39;o@&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-412"><a href="#LexFormats-412"><span class="linenos"> 412</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-413"><a href="#LexFormats-413"><span class="linenos"> 413</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-414"><a href="#LexFormats-414"><span class="linenos"> 414</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-415"><a href="#LexFormats-415"><span class="linenos"> 415</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-416"><a href="#LexFormats-416"><span class="linenos"> 416</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-417"><a href="#LexFormats-417"><span class="linenos"> 417</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-418"><a href="#LexFormats-418"><span class="linenos"> 418</span></a>    <span class="n">lex_filename</span> <span class="o">=</span> <span class="s2">&quot;en_extra&quot;</span><span class="p">,</span>
</span><span id="LexFormats-419"><a href="#LexFormats-419"><span class="linenos"> 419</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-420"><a href="#LexFormats-420"><span class="linenos"> 420</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">()[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;//&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
</span><span id="LexFormats-421"><a href="#LexFormats-421"><span class="linenos"> 421</span></a>    <span class="n">lex_footer</span><span class="o">=</span><span class="k">lambda</span> <span class="n">f</span><span class="p">:(</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)),</span> <span class="c1"># see also a bit of special-case code in mainopt_convert</span>
</span><span id="LexFormats-422"><a href="#LexFormats-422"><span class="linenos"> 422</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;[[</span><span class="si">%s</span><span class="s2">]]&quot;</span><span class="p">,</span>
</span><span id="LexFormats-423"><a href="#LexFormats-423"><span class="linenos"> 423</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-424"><a href="#LexFormats-424"><span class="linenos"> 424</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-425"><a href="#LexFormats-425"><span class="linenos"> 425</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="s2">&quot;_: !&quot;</span><span class="p">,</span>
</span><span id="LexFormats-426"><a href="#LexFormats-426"><span class="linenos"> 426</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="LexFormats-427"><a href="#LexFormats-427"><span class="linenos"> 427</span></a>      <span class="p">(</span><span class="s2">&quot;k&#39;a2n&quot;</span><span class="p">,</span><span class="s2">&quot;k&#39;@n&quot;</span><span class="p">),</span>
</span><span id="LexFormats-428"><a href="#LexFormats-428"><span class="linenos"> 428</span></a>      <span class="p">(</span><span class="s2">&quot;ka2n&quot;</span><span class="p">,</span><span class="s2">&quot;k@n&quot;</span><span class="p">),</span>
</span><span id="LexFormats-429"><a href="#LexFormats-429"><span class="linenos"> 429</span></a>      <span class="p">(</span><span class="s2">&quot;gg&quot;</span><span class="p">,</span><span class="s2">&quot;g&quot;</span><span class="p">),</span>
</span><span id="LexFormats-430"><a href="#LexFormats-430"><span class="linenos"> 430</span></a>      <span class="p">(</span><span class="s2">&quot;@U&quot;</span><span class="p">,</span><span class="s2">&quot;oU&quot;</span><span class="p">),</span> <span class="c1"># (eSpeak uses oU to represent @U; difference is given by its accent parameters)</span>
</span><span id="LexFormats-431"><a href="#LexFormats-431"><span class="linenos"> 431</span></a>      <span class="p">(</span><span class="s2">&quot;([iU]|([AO]:))@r$&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\1</span><span class="s2">@&quot;</span><span class="p">),</span>
</span><span id="LexFormats-432"><a href="#LexFormats-432"><span class="linenos"> 432</span></a>      <span class="p">(</span><span class="s2">&quot;([^e])@r&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1_remove_3&quot;</span><span class="p">),(</span><span class="s2">&quot;_remove_&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="LexFormats-433"><a href="#LexFormats-433"><span class="linenos"> 433</span></a>      <span class="c1"># (r&quot;([^iU]@)l&quot;,r&quot;\1L&quot;) # only in older versions of espeak (not valid in more recent versions)</span>
</span><span id="LexFormats-434"><a href="#LexFormats-434"><span class="linenos"> 434</span></a>      <span class="p">(</span><span class="s2">&quot;rr$&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>
</span><span id="LexFormats-435"><a href="#LexFormats-435"><span class="linenos"> 435</span></a>      <span class="p">(</span><span class="s2">&quot;3:r$&quot;</span><span class="p">,</span><span class="s2">&quot;3:&quot;</span><span class="p">),</span>
</span><span id="LexFormats-436"><a href="#LexFormats-436"><span class="linenos"> 436</span></a>      <span class="p">(</span><span class="s2">&quot;</span><span class="si">%%</span><span class="s2">+&quot;</span><span class="p">,</span><span class="s2">&quot;%&quot;</span><span class="p">),(</span><span class="s2">&quot;^%&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),(</span><span class="s2">&quot;%$&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">),</span>
</span><span id="LexFormats-437"><a href="#LexFormats-437"><span class="linenos"> 437</span></a>      <span class="c1"># TODO: &#39;declared&#39; &amp; &#39;declare&#39; the &#39;r&#39; after the &#39;E&#39; sounds a bit &#39;regional&#39; (but pretty).  but sounds incomplete w/out &#39;r&#39;, and there doesn&#39;t seem to be an E2 or E@</span>
</span><span id="LexFormats-438"><a href="#LexFormats-438"><span class="linenos"> 438</span></a>      <span class="c1"># TODO: consider adding &#39;g&#39; to words ending in &#39;N&#39; (if want the &#39;g&#39; pronounced in &#39;-ng&#39; words) (however, careful of words like &#39;yankee&#39; where the &#39;g&#39; would be followed by a &#39;k&#39;; this may also be a problem going into the next word)</span>
</span><span id="LexFormats-439"><a href="#LexFormats-439"><span class="linenos"> 439</span></a>    <span class="p">],</span>
</span><span id="LexFormats-440"><a href="#LexFormats-440"><span class="linenos"> 440</span></a>     <span class="n">cvtOut_regexps</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="LexFormats-441"><a href="#LexFormats-441"><span class="linenos"> 441</span></a>       <span class="p">(</span><span class="s2">&quot;e@r$&quot;</span><span class="p">,</span><span class="s2">&quot;e@&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;e@r([bdDfghklmnNprsStTvwjzZ])&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;e@\1&quot;</span><span class="p">),</span> <span class="c1"># because the &#39;r&#39; is implicit in other synths (but DO have it if there&#39;s another vowel to follow)</span>
</span><span id="LexFormats-442"><a href="#LexFormats-442"><span class="linenos"> 442</span></a>     <span class="p">],</span>
</span><span id="LexFormats-443"><a href="#LexFormats-443"><span class="linenos"> 443</span></a>  <span class="p">),</span>
</span><span id="LexFormats-444"><a href="#LexFormats-444"><span class="linenos"> 444</span></a>
</span><span id="LexFormats-445"><a href="#LexFormats-445"><span class="linenos"> 445</span></a>  <span class="s2">&quot;sapi&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-446"><a href="#LexFormats-446"><span class="linenos"> 446</span></a>    <span class="s2">&quot;Microsoft Speech API (American English)&quot;</span><span class="p">,</span>
</span><span id="LexFormats-447"><a href="#LexFormats-447"><span class="linenos"> 447</span></a>    <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-448"><a href="#LexFormats-448"><span class="linenos"> 448</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-449"><a href="#LexFormats-449"><span class="linenos"> 449</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-450"><a href="#LexFormats-450"><span class="linenos"> 450</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-451"><a href="#LexFormats-451"><span class="linenos"> 451</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-452"><a href="#LexFormats-452"><span class="linenos"> 452</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-453"><a href="#LexFormats-453"><span class="linenos"> 453</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-454"><a href="#LexFormats-454"><span class="linenos"> 454</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-455"><a href="#LexFormats-455"><span class="linenos"> 455</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-456"><a href="#LexFormats-456"><span class="linenos"> 456</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-457"><a href="#LexFormats-457"><span class="linenos"> 457</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-458"><a href="#LexFormats-458"><span class="linenos"> 458</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-459"><a href="#LexFormats-459"><span class="linenos"> 459</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-460"><a href="#LexFormats-460"><span class="linenos"> 460</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-461"><a href="#LexFormats-461"><span class="linenos"> 461</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-462"><a href="#LexFormats-462"><span class="linenos"> 462</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-463"><a href="#LexFormats-463"><span class="linenos"> 463</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-464"><a href="#LexFormats-464"><span class="linenos"> 464</span></a>    <span class="p">(</span><span class="n">a_as_in_ate</span><span class="p">,</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-465"><a href="#LexFormats-465"><span class="linenos"> 465</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-466"><a href="#LexFormats-466"><span class="linenos"> 466</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-467"><a href="#LexFormats-467"><span class="linenos"> 467</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="c1"># Jan suggested &#39;hh&#39;, but I can&#39;t get this to work on Windows XP (TODO: try newer versions of Windows)</span>
</span><span id="LexFormats-468"><a href="#LexFormats-468"><span class="linenos"> 468</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-469"><a href="#LexFormats-469"><span class="linenos"> 469</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-470"><a href="#LexFormats-470"><span class="linenos"> 470</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-471"><a href="#LexFormats-471"><span class="linenos"> 471</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-472"><a href="#LexFormats-472"><span class="linenos"> 472</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-473"><a href="#LexFormats-473"><span class="linenos"> 473</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-474"><a href="#LexFormats-474"><span class="linenos"> 474</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-475"><a href="#LexFormats-475"><span class="linenos"> 475</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-476"><a href="#LexFormats-476"><span class="linenos"> 476</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-477"><a href="#LexFormats-477"><span class="linenos"> 477</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-478"><a href="#LexFormats-478"><span class="linenos"> 478</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-479"><a href="#LexFormats-479"><span class="linenos"> 479</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-480"><a href="#LexFormats-480"><span class="linenos"> 480</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-481"><a href="#LexFormats-481"><span class="linenos"> 481</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-482"><a href="#LexFormats-482"><span class="linenos"> 482</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-483"><a href="#LexFormats-483"><span class="linenos"> 483</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-484"><a href="#LexFormats-484"><span class="linenos"> 484</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-485"><a href="#LexFormats-485"><span class="linenos"> 485</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-486"><a href="#LexFormats-486"><span class="linenos"> 486</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-487"><a href="#LexFormats-487"><span class="linenos"> 487</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-488"><a href="#LexFormats-488"><span class="linenos"> 488</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-489"><a href="#LexFormats-489"><span class="linenos"> 489</span></a>    <span class="c1"># (&#39;x&#39;,var1_w), # suggested by Jan, but I can&#39;t get this to work on Windows XP (TODO: try newer versions of Windows)</span>
</span><span id="LexFormats-490"><a href="#LexFormats-490"><span class="linenos"> 490</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-491"><a href="#LexFormats-491"><span class="linenos"> 491</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-492"><a href="#LexFormats-492"><span class="linenos"> 492</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-493"><a href="#LexFormats-493"><span class="linenos"> 493</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-494"><a href="#LexFormats-494"><span class="linenos"> 494</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;run-ptts.bat&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-495"><a href="#LexFormats-495"><span class="linenos"> 495</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;rem  You have to run this file</span><span class="se">\n</span><span class="s2">rem  with ptts.exe in the same directory</span><span class="se">\n</span><span class="s2">rem  to add these words to the SAPI lexicon</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-496"><a href="#LexFormats-496"><span class="linenos"> 496</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s1">&#39;ptts -la </span><span class="si">%s</span><span class="s1"> &quot;</span><span class="si">%s</span><span class="s1">&quot;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="LexFormats-497"><a href="#LexFormats-497"><span class="linenos"> 497</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s1">&#39;&lt;pron sym=&quot;</span><span class="si">%s</span><span class="s1">&quot;/&gt;&#39;</span><span class="p">,</span>
</span><span id="LexFormats-498"><a href="#LexFormats-498"><span class="linenos"> 498</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-499"><a href="#LexFormats-499"><span class="linenos"> 499</span></a>  <span class="p">),</span>
</span><span id="LexFormats-500"><a href="#LexFormats-500"><span class="linenos"> 500</span></a>
</span><span id="LexFormats-501"><a href="#LexFormats-501"><span class="linenos"> 501</span></a>  <span class="s2">&quot;cepstral&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-502"><a href="#LexFormats-502"><span class="linenos"> 502</span></a>    <span class="s2">&quot;Cepstral&#39;s British English SSML phoneset&quot;</span><span class="p">,</span>
</span><span id="LexFormats-503"><a href="#LexFormats-503"><span class="linenos"> 503</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-504"><a href="#LexFormats-504"><span class="linenos"> 504</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-505"><a href="#LexFormats-505"><span class="linenos"> 505</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-506"><a href="#LexFormats-506"><span class="linenos"> 506</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-507"><a href="#LexFormats-507"><span class="linenos"> 507</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-508"><a href="#LexFormats-508"><span class="linenos"> 508</span></a>    <span class="p">(</span><span class="s1">&#39;oa&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-509"><a href="#LexFormats-509"><span class="linenos"> 509</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-510"><a href="#LexFormats-510"><span class="linenos"> 510</span></a>    <span class="p">(</span><span class="s1">&#39;er&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-511"><a href="#LexFormats-511"><span class="linenos"> 511</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-512"><a href="#LexFormats-512"><span class="linenos"> 512</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-513"><a href="#LexFormats-513"><span class="linenos"> 513</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-514"><a href="#LexFormats-514"><span class="linenos"> 514</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-515"><a href="#LexFormats-515"><span class="linenos"> 515</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-516"><a href="#LexFormats-516"><span class="linenos"> 516</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-517"><a href="#LexFormats-517"><span class="linenos"> 517</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-518"><a href="#LexFormats-518"><span class="linenos"> 518</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-519"><a href="#LexFormats-519"><span class="linenos"> 519</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-520"><a href="#LexFormats-520"><span class="linenos"> 520</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-521"><a href="#LexFormats-521"><span class="linenos"> 521</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-522"><a href="#LexFormats-522"><span class="linenos"> 522</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-523"><a href="#LexFormats-523"><span class="linenos"> 523</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-524"><a href="#LexFormats-524"><span class="linenos"> 524</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-525"><a href="#LexFormats-525"><span class="linenos"> 525</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-526"><a href="#LexFormats-526"><span class="linenos"> 526</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-527"><a href="#LexFormats-527"><span class="linenos"> 527</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-528"><a href="#LexFormats-528"><span class="linenos"> 528</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-529"><a href="#LexFormats-529"><span class="linenos"> 529</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-530"><a href="#LexFormats-530"><span class="linenos"> 530</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-531"><a href="#LexFormats-531"><span class="linenos"> 531</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-532"><a href="#LexFormats-532"><span class="linenos"> 532</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-533"><a href="#LexFormats-533"><span class="linenos"> 533</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-534"><a href="#LexFormats-534"><span class="linenos"> 534</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-535"><a href="#LexFormats-535"><span class="linenos"> 535</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-536"><a href="#LexFormats-536"><span class="linenos"> 536</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-537"><a href="#LexFormats-537"><span class="linenos"> 537</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-538"><a href="#LexFormats-538"><span class="linenos"> 538</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-539"><a href="#LexFormats-539"><span class="linenos"> 539</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-540"><a href="#LexFormats-540"><span class="linenos"> 540</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-541"><a href="#LexFormats-541"><span class="linenos"> 541</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-542"><a href="#LexFormats-542"><span class="linenos"> 542</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-543"><a href="#LexFormats-543"><span class="linenos"> 543</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-544"><a href="#LexFormats-544"><span class="linenos"> 544</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-545"><a href="#LexFormats-545"><span class="linenos"> 545</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-546"><a href="#LexFormats-546"><span class="linenos"> 546</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-547"><a href="#LexFormats-547"><span class="linenos"> 547</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;lexicon.txt&quot;</span><span class="p">,</span>
</span><span id="LexFormats-548"><a href="#LexFormats-548"><span class="linenos"> 548</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> 0 </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-549"><a href="#LexFormats-549"><span class="linenos"> 549</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">ignore</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="LexFormats-550"><a href="#LexFormats-550"><span class="linenos"> 550</span></a>    <span class="n">lex_word_case</span> <span class="o">=</span> <span class="s2">&quot;lower&quot;</span><span class="p">,</span>
</span><span id="LexFormats-551"><a href="#LexFormats-551"><span class="linenos"> 551</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;&lt;phoneme ph=&#39;</span><span class="si">%s</span><span class="s2">&#39;&gt;p&lt;/phoneme&gt;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-552"><a href="#LexFormats-552"><span class="linenos"> 552</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-553"><a href="#LexFormats-553"><span class="linenos"> 553</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s2">&quot; 1&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">),(</span><span class="s2">&quot; 0&quot;</span><span class="p">,</span><span class="s2">&quot;0&quot;</span><span class="p">)],</span>
</span><span id="LexFormats-554"><a href="#LexFormats-554"><span class="linenos"> 554</span></a>  <span class="p">),</span>
</span><span id="LexFormats-555"><a href="#LexFormats-555"><span class="linenos"> 555</span></a>
</span><span id="LexFormats-556"><a href="#LexFormats-556"><span class="linenos"> 556</span></a>  <span class="s2">&quot;mac&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-557"><a href="#LexFormats-557"><span class="linenos"> 557</span></a>    <span class="s2">&quot;approximation in American English using the [[inpt PHON]] notation of Apple&#39;s US voices&quot;</span><span class="p">,</span>
</span><span id="LexFormats-558"><a href="#LexFormats-558"><span class="linenos"> 558</span></a>    <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-559"><a href="#LexFormats-559"><span class="linenos"> 559</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-560"><a href="#LexFormats-560"><span class="linenos"> 560</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-561"><a href="#LexFormats-561"><span class="linenos"> 561</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-562"><a href="#LexFormats-562"><span class="linenos"> 562</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-563"><a href="#LexFormats-563"><span class="linenos"> 563</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-564"><a href="#LexFormats-564"><span class="linenos"> 564</span></a>    <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-565"><a href="#LexFormats-565"><span class="linenos"> 565</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-566"><a href="#LexFormats-566"><span class="linenos"> 566</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-567"><a href="#LexFormats-567"><span class="linenos"> 567</span></a>    <span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-568"><a href="#LexFormats-568"><span class="linenos"> 568</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: is this really the best approximation?</span>
</span><span id="LexFormats-569"><a href="#LexFormats-569"><span class="linenos"> 569</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-570"><a href="#LexFormats-570"><span class="linenos"> 570</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-571"><a href="#LexFormats-571"><span class="linenos"> 571</span></a>    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-572"><a href="#LexFormats-572"><span class="linenos"> 572</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-573"><a href="#LexFormats-573"><span class="linenos"> 573</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-574"><a href="#LexFormats-574"><span class="linenos"> 574</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-575"><a href="#LexFormats-575"><span class="linenos"> 575</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-576"><a href="#LexFormats-576"><span class="linenos"> 576</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-577"><a href="#LexFormats-577"><span class="linenos"> 577</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-578"><a href="#LexFormats-578"><span class="linenos"> 578</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-579"><a href="#LexFormats-579"><span class="linenos"> 579</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-580"><a href="#LexFormats-580"><span class="linenos"> 580</span></a>    <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-581"><a href="#LexFormats-581"><span class="linenos"> 581</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-582"><a href="#LexFormats-582"><span class="linenos"> 582</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-583"><a href="#LexFormats-583"><span class="linenos"> 583</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-584"><a href="#LexFormats-584"><span class="linenos"> 584</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-585"><a href="#LexFormats-585"><span class="linenos"> 585</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-586"><a href="#LexFormats-586"><span class="linenos"> 586</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-587"><a href="#LexFormats-587"><span class="linenos"> 587</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-588"><a href="#LexFormats-588"><span class="linenos"> 588</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-589"><a href="#LexFormats-589"><span class="linenos"> 589</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-590"><a href="#LexFormats-590"><span class="linenos"> 590</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-591"><a href="#LexFormats-591"><span class="linenos"> 591</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-592"><a href="#LexFormats-592"><span class="linenos"> 592</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-593"><a href="#LexFormats-593"><span class="linenos"> 593</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-594"><a href="#LexFormats-594"><span class="linenos"> 594</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-595"><a href="#LexFormats-595"><span class="linenos"> 595</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-596"><a href="#LexFormats-596"><span class="linenos"> 596</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-597"><a href="#LexFormats-597"><span class="linenos"> 597</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-598"><a href="#LexFormats-598"><span class="linenos"> 598</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-599"><a href="#LexFormats-599"><span class="linenos"> 599</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-600"><a href="#LexFormats-600"><span class="linenos"> 600</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-601"><a href="#LexFormats-601"><span class="linenos"> 601</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-602"><a href="#LexFormats-602"><span class="linenos"> 602</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-603"><a href="#LexFormats-603"><span class="linenos"> 603</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-604"><a href="#LexFormats-604"><span class="linenos"> 604</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-605"><a href="#LexFormats-605"><span class="linenos"> 605</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;substitute.sh&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-606"><a href="#LexFormats-606"><span class="linenos"> 606</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;substitution script&quot;</span><span class="p">,</span>
</span><span id="LexFormats-607"><a href="#LexFormats-607"><span class="linenos"> 607</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;#!/bin/bash</span><span class="se">\n\n</span><span class="s2"># I don&#39;t yet know how to add to the Apple US lexicon,</span><span class="se">\n</span><span class="s2"># so here is a &#39;sed&#39; command you can run on your text</span><span class="se">\n</span><span class="s2"># to put the pronunciation inline:</span><span class="se">\n\n</span><span class="s2">sed -E -e :S </span><span class="se">\\\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-608"><a href="#LexFormats-608"><span class="linenos"> 608</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot; -e &#39;s/(^|[^A-Za-z])</span><span class="si">%s</span><span class="s2">($|[^A-Za-z[12=])/\1[[inpt PHON]]</span><span class="si">%s</span><span class="s2">[[inpt TEXT]]\2/g&#39;&quot;</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\\\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-609"><a href="#LexFormats-609"><span class="linenos"> 609</span></a>    <span class="c1"># but /g is non-overlapping matches and won&#39;t catch 2 words in the lex right next to each other with only one non-alpha in between, so we put :S at start and tS at end to make the whole operation repeat until it hasn&#39;t done any more substitutions (hence also the exclusion of [, 1, 2 or = following a word so it doesn&#39;t try to substitute stuff inside the phonemes; TODO: assert the lexicon does not contain &quot;inpt&quot;, &quot;PHON&quot; or &quot;TEXT&quot;)</span>
</span><span id="LexFormats-610"><a href="#LexFormats-610"><span class="linenos"> 610</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">f</span><span class="p">:(</span><span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot; -e tS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span><span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">(),</span><span class="n">os</span><span class="o">.</span><span class="n">chmod</span><span class="p">(</span><span class="s2">&quot;substitute.sh&quot;</span><span class="p">,</span><span class="mi">493</span><span class="p">)),</span> <span class="c1"># 493 = 0755, but no way to specify octal that works on both Python 2.5 and Python 3 (0o works on 2.6+)</span>
</span><span id="LexFormats-611"><a href="#LexFormats-611"><span class="linenos"> 611</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;[[inpt PHON]]</span><span class="si">%s</span><span class="s2">[[inpt TEXT]]&quot;</span><span class="p">,</span>
</span><span id="LexFormats-612"><a href="#LexFormats-612"><span class="linenos"> 612</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-613"><a href="#LexFormats-613"><span class="linenos"> 613</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-614"><a href="#LexFormats-614"><span class="linenos"> 614</span></a>  <span class="p">),</span>
</span><span id="LexFormats-615"><a href="#LexFormats-615"><span class="linenos"> 615</span></a>
</span><span id="LexFormats-616"><a href="#LexFormats-616"><span class="linenos"> 616</span></a>  <span class="s2">&quot;mac-uk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-617"><a href="#LexFormats-617"><span class="linenos"> 617</span></a>    <span class="s2">&quot;Scansoft/Nuance British voices in Mac OS 10.7+ (system lexicon editing required, see --mac-uk option)&quot;</span><span class="p">,</span>
</span><span id="LexFormats-618"><a href="#LexFormats-618"><span class="linenos"> 618</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-619"><a href="#LexFormats-619"><span class="linenos"> 619</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-620"><a href="#LexFormats-620"><span class="linenos"> 620</span></a>    <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-621"><a href="#LexFormats-621"><span class="linenos"> 621</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-622"><a href="#LexFormats-622"><span class="linenos"> 622</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-623"><a href="#LexFormats-623"><span class="linenos"> 623</span></a>    <span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-624"><a href="#LexFormats-624"><span class="linenos"> 624</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-625"><a href="#LexFormats-625"><span class="linenos"> 625</span></a>    <span class="p">(</span><span class="s1">&#39;A+&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-626"><a href="#LexFormats-626"><span class="linenos"> 626</span></a>    <span class="p">(</span><span class="s1">&#39;a&amp;U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-627"><a href="#LexFormats-627"><span class="linenos"> 627</span></a>    <span class="p">(</span><span class="s1">&#39;E0&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-628"><a href="#LexFormats-628"><span class="linenos"> 628</span></a>    <span class="p">(</span><span class="s1">&#39;a&amp;I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-629"><a href="#LexFormats-629"><span class="linenos"> 629</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-630"><a href="#LexFormats-630"><span class="linenos"> 630</span></a>    <span class="p">(</span><span class="s1">&#39;t&amp;S&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-631"><a href="#LexFormats-631"><span class="linenos"> 631</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-632"><a href="#LexFormats-632"><span class="linenos"> 632</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-633"><a href="#LexFormats-633"><span class="linenos"> 633</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-634"><a href="#LexFormats-634"><span class="linenos"> 634</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="LexFormats-635"><a href="#LexFormats-635"><span class="linenos"> 635</span></a>    <span class="p">(</span><span class="s1">&#39;E&amp;$&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-636"><a href="#LexFormats-636"><span class="linenos"> 636</span></a>    <span class="p">(</span><span class="s1">&#39;e&amp;I&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-637"><a href="#LexFormats-637"><span class="linenos"> 637</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-638"><a href="#LexFormats-638"><span class="linenos"> 638</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-639"><a href="#LexFormats-639"><span class="linenos"> 639</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-640"><a href="#LexFormats-640"><span class="linenos"> 640</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-641"><a href="#LexFormats-641"><span class="linenos"> 641</span></a>    <span class="p">(</span><span class="s1">&#39;I&amp;$&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-642"><a href="#LexFormats-642"><span class="linenos"> 642</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-643"><a href="#LexFormats-643"><span class="linenos"> 643</span></a>    <span class="p">(</span><span class="s1">&#39;d&amp;Z&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-644"><a href="#LexFormats-644"><span class="linenos"> 644</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-645"><a href="#LexFormats-645"><span class="linenos"> 645</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-646"><a href="#LexFormats-646"><span class="linenos"> 646</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-647"><a href="#LexFormats-647"><span class="linenos"> 647</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-648"><a href="#LexFormats-648"><span class="linenos"> 648</span></a>    <span class="p">(</span><span class="s1">&#39;nK&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-649"><a href="#LexFormats-649"><span class="linenos"> 649</span></a>    <span class="p">(</span><span class="s1">&#39;o&amp;U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-650"><a href="#LexFormats-650"><span class="linenos"> 650</span></a>    <span class="p">(</span><span class="s1">&#39;O&amp;I&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-651"><a href="#LexFormats-651"><span class="linenos"> 651</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-652"><a href="#LexFormats-652"><span class="linenos"> 652</span></a>    <span class="p">(</span><span class="s1">&#39;R+&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-653"><a href="#LexFormats-653"><span class="linenos"> 653</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-654"><a href="#LexFormats-654"><span class="linenos"> 654</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-655"><a href="#LexFormats-655"><span class="linenos"> 655</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-656"><a href="#LexFormats-656"><span class="linenos"> 656</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-657"><a href="#LexFormats-657"><span class="linenos"> 657</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-658"><a href="#LexFormats-658"><span class="linenos"> 658</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-659"><a href="#LexFormats-659"><span class="linenos"> 659</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-660"><a href="#LexFormats-660"><span class="linenos"> 660</span></a>    <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-661"><a href="#LexFormats-661"><span class="linenos"> 661</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-662"><a href="#LexFormats-662"><span class="linenos"> 662</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-663"><a href="#LexFormats-663"><span class="linenos"> 663</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-664"><a href="#LexFormats-664"><span class="linenos"> 664</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-665"><a href="#LexFormats-665"><span class="linenos"> 665</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-666"><a href="#LexFormats-666"><span class="linenos"> 666</span></a>    <span class="c1"># lex_filename not set (mac-uk code does not permanently save the lexicon; see --mac-uk option to read text)</span>
</span><span id="LexFormats-667"><a href="#LexFormats-667"><span class="linenos"> 667</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="o">*</span><span class="n">args</span><span class="p">:[(</span><span class="n">w</span><span class="p">,</span><span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">_</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">usable_words</span><span class="p">()],</span>
</span><span id="LexFormats-668"><a href="#LexFormats-668"><span class="linenos"> 668</span></a>    <span class="n">inline_oneoff_header</span> <span class="o">=</span> <span class="s2">&quot;(mac-uk phonemes output is for information only; you&#39;ll need the --mac-uk or --trymac-uk options to use it)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-669"><a href="#LexFormats-669"><span class="linenos"> 669</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-670"><a href="#LexFormats-670"><span class="linenos"> 670</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-671"><a href="#LexFormats-671"><span class="linenos"> 671</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-672"><a href="#LexFormats-672"><span class="linenos"> 672</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;o\&amp;U\.Ol&#39;</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;o\&amp;Ul&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-673"><a href="#LexFormats-673"><span class="linenos"> 673</span></a>  <span class="p">),</span>
</span><span id="LexFormats-674"><a href="#LexFormats-674"><span class="linenos"> 674</span></a>
</span><span id="LexFormats-675"><a href="#LexFormats-675"><span class="linenos"> 675</span></a>  <span class="s2">&quot;x-sampa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-676"><a href="#LexFormats-676"><span class="linenos"> 676</span></a>    <span class="s2">&quot;General X-SAMPA notation, contributed by Jan Weiss&quot;</span><span class="p">,</span>
</span><span id="LexFormats-677"><a href="#LexFormats-677"><span class="linenos"> 677</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-678"><a href="#LexFormats-678"><span class="linenos"> 678</span></a>    <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-679"><a href="#LexFormats-679"><span class="linenos"> 679</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-680"><a href="#LexFormats-680"><span class="linenos"> 680</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-681"><a href="#LexFormats-681"><span class="linenos"> 681</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="LexFormats-682"><a href="#LexFormats-682"><span class="linenos"> 682</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-683"><a href="#LexFormats-683"><span class="linenos"> 683</span></a>    <span class="p">(</span><span class="s1">&#39;Ar</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-684"><a href="#LexFormats-684"><span class="linenos"> 684</span></a>    <span class="p">(</span><span class="s1">&#39;a:&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-685"><a href="#LexFormats-685"><span class="linenos"> 685</span></a>    <span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-686"><a href="#LexFormats-686"><span class="linenos"> 686</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-687"><a href="#LexFormats-687"><span class="linenos"> 687</span></a>    <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-688"><a href="#LexFormats-688"><span class="linenos"> 688</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-689"><a href="#LexFormats-689"><span class="linenos"> 689</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-690"><a href="#LexFormats-690"><span class="linenos"> 690</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-691"><a href="#LexFormats-691"><span class="linenos"> 691</span></a>    <span class="p">(</span><span class="s1">&#39;{O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-692"><a href="#LexFormats-692"><span class="linenos"> 692</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-693"><a href="#LexFormats-693"><span class="linenos"> 693</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-694"><a href="#LexFormats-694"><span class="linenos"> 694</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-695"><a href="#LexFormats-695"><span class="linenos"> 695</span></a>    <span class="p">(</span><span class="s1">&#39;Ae&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="LexFormats-696"><a href="#LexFormats-696"><span class="linenos"> 696</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-697"><a href="#LexFormats-697"><span class="linenos"> 697</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-698"><a href="#LexFormats-698"><span class="linenos"> 698</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-699"><a href="#LexFormats-699"><span class="linenos"> 699</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-700"><a href="#LexFormats-700"><span class="linenos"> 700</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-701"><a href="#LexFormats-701"><span class="linenos"> 701</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-702"><a href="#LexFormats-702"><span class="linenos"> 702</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-703"><a href="#LexFormats-703"><span class="linenos"> 703</span></a>    <span class="p">(</span><span class="s1">&#39;E@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-704"><a href="#LexFormats-704"><span class="linenos"> 704</span></a>    <span class="p">(</span><span class="s1">&#39;Er</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-705"><a href="#LexFormats-705"><span class="linenos"> 705</span></a>    <span class="p">(</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-706"><a href="#LexFormats-706"><span class="linenos"> 706</span></a>    <span class="p">(</span><span class="s1">&#39;E:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-707"><a href="#LexFormats-707"><span class="linenos"> 707</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-708"><a href="#LexFormats-708"><span class="linenos"> 708</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-709"><a href="#LexFormats-709"><span class="linenos"> 709</span></a>    <span class="p">(</span><span class="s1">&#39;{I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-710"><a href="#LexFormats-710"><span class="linenos"> 710</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-711"><a href="#LexFormats-711"><span class="linenos"> 711</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-712"><a href="#LexFormats-712"><span class="linenos"> 712</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-713"><a href="#LexFormats-713"><span class="linenos"> 713</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-714"><a href="#LexFormats-714"><span class="linenos"> 714</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-715"><a href="#LexFormats-715"><span class="linenos"> 715</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-716"><a href="#LexFormats-716"><span class="linenos"> 716</span></a>    <span class="p">(</span><span class="s1">&#39;Ir</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="LexFormats-717"><a href="#LexFormats-717"><span class="linenos"> 717</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-718"><a href="#LexFormats-718"><span class="linenos"> 718</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-719"><a href="#LexFormats-719"><span class="linenos"> 719</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-720"><a href="#LexFormats-720"><span class="linenos"> 720</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-721"><a href="#LexFormats-721"><span class="linenos"> 721</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-722"><a href="#LexFormats-722"><span class="linenos"> 722</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-723"><a href="#LexFormats-723"><span class="linenos"> 723</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-724"><a href="#LexFormats-724"><span class="linenos"> 724</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-725"><a href="#LexFormats-725"><span class="linenos"> 725</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-726"><a href="#LexFormats-726"><span class="linenos"> 726</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-727"><a href="#LexFormats-727"><span class="linenos"> 727</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-728"><a href="#LexFormats-728"><span class="linenos"> 728</span></a>    <span class="p">(</span><span class="s1">&#39;@}&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-729"><a href="#LexFormats-729"><span class="linenos"> 729</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-730"><a href="#LexFormats-730"><span class="linenos"> 730</span></a>    <span class="p">(</span><span class="s1">&#39;oI&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-731"><a href="#LexFormats-731"><span class="linenos"> 731</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-732"><a href="#LexFormats-732"><span class="linenos"> 732</span></a>    <span class="p">(</span><span class="s1">&#39;r</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-733"><a href="#LexFormats-733"><span class="linenos"> 733</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-734"><a href="#LexFormats-734"><span class="linenos"> 734</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-735"><a href="#LexFormats-735"><span class="linenos"> 735</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-736"><a href="#LexFormats-736"><span class="linenos"> 736</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-737"><a href="#LexFormats-737"><span class="linenos"> 737</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-738"><a href="#LexFormats-738"><span class="linenos"> 738</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-739"><a href="#LexFormats-739"><span class="linenos"> 739</span></a>    <span class="p">(</span><span class="s1">&#39;Ur</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-740"><a href="#LexFormats-740"><span class="linenos"> 740</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-741"><a href="#LexFormats-741"><span class="linenos"> 741</span></a>    <span class="p">(</span><span class="s1">&#39;}:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-742"><a href="#LexFormats-742"><span class="linenos"> 742</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-743"><a href="#LexFormats-743"><span class="linenos"> 743</span></a>    <span class="p">(</span><span class="n">var2_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-744"><a href="#LexFormats-744"><span class="linenos"> 744</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-745"><a href="#LexFormats-745"><span class="linenos"> 745</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-746"><a href="#LexFormats-746"><span class="linenos"> 746</span></a>    <span class="p">(</span><span class="s1">&#39;o:&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-747"><a href="#LexFormats-747"><span class="linenos"> 747</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-748"><a href="#LexFormats-748"><span class="linenos"> 748</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-749"><a href="#LexFormats-749"><span class="linenos"> 749</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="LexFormats-750"><a href="#LexFormats-750"><span class="linenos"> 750</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-751"><a href="#LexFormats-751"><span class="linenos"> 751</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-752"><a href="#LexFormats-752"><span class="linenos"> 752</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-753"><a href="#LexFormats-753"><span class="linenos"> 753</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;acapela.txt&quot;</span><span class="p">,</span>
</span><span id="LexFormats-754"><a href="#LexFormats-754"><span class="linenos"> 754</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s2">#</span><span class="si">%s</span><span class="se">\t</span><span class="s2">UNKNOWN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># TODO: may be able to convert part-of-speech (NOUN etc) to/from some other formats e.g. Festival</span>
</span><span id="LexFormats-755"><a href="#LexFormats-755"><span class="linenos"> 755</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">,</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="LexFormats-756"><a href="#LexFormats-756"><span class="linenos"> 756</span></a>    <span class="c1"># TODO: inline_format ?</span>
</span><span id="LexFormats-757"><a href="#LexFormats-757"><span class="linenos"> 757</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-758"><a href="#LexFormats-758"><span class="linenos"> 758</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-759"><a href="#LexFormats-759"><span class="linenos"> 759</span></a>  <span class="p">),</span>
</span><span id="LexFormats-760"><a href="#LexFormats-760"><span class="linenos"> 760</span></a>  <span class="s2">&quot;vocaloid&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-761"><a href="#LexFormats-761"><span class="linenos"> 761</span></a>     <span class="s2">&quot;X-SAMPA phonemes for Yamaha&#39;s Vocaloid singing synthesizer.  Contributed by Lorenzo Gatti, who tested in Vocaloid 4 using two American English voices.&quot;</span><span class="p">,</span>
</span><span id="LexFormats-762"><a href="#LexFormats-762"><span class="linenos"> 762</span></a>     <span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-763"><a href="#LexFormats-763"><span class="linenos"> 763</span></a>     <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># not used by Vocaloid</span>
</span><span id="LexFormats-764"><a href="#LexFormats-764"><span class="linenos"> 764</span></a>     <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-765"><a href="#LexFormats-765"><span class="linenos"> 765</span></a>     <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-766"><a href="#LexFormats-766"><span class="linenos"> 766</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-767"><a href="#LexFormats-767"><span class="linenos"> 767</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-768"><a href="#LexFormats-768"><span class="linenos"> 768</span></a>     <span class="p">(</span><span class="n">var5_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-769"><a href="#LexFormats-769"><span class="linenos"> 769</span></a>     <span class="p">(</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-770"><a href="#LexFormats-770"><span class="linenos"> 770</span></a>     <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-771"><a href="#LexFormats-771"><span class="linenos"> 771</span></a>     <span class="p">(</span><span class="n">var2_o_as_in_orange</span><span class="p">,</span> <span class="s1">&#39;O@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-772"><a href="#LexFormats-772"><span class="linenos"> 772</span></a>     <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-773"><a href="#LexFormats-773"><span class="linenos"> 773</span></a>     <span class="p">(</span><span class="s1">&#39;@r&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-774"><a href="#LexFormats-774"><span class="linenos"> 774</span></a>     <span class="p">(</span><span class="n">var1_eye</span><span class="p">,</span> <span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-775"><a href="#LexFormats-775"><span class="linenos"> 775</span></a>     <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-776"><a href="#LexFormats-776"><span class="linenos"> 776</span></a>     <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="LexFormats-777"><a href="#LexFormats-777"><span class="linenos"> 777</span></a>     <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-778"><a href="#LexFormats-778"><span class="linenos"> 778</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-779"><a href="#LexFormats-779"><span class="linenos"> 779</span></a>     <span class="p">(</span><span class="n">var2_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-780"><a href="#LexFormats-780"><span class="linenos"> 780</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-781"><a href="#LexFormats-781"><span class="linenos"> 781</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_air</span><span class="p">,</span> <span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-782"><a href="#LexFormats-782"><span class="linenos"> 782</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_ate</span><span class="p">,</span> <span class="s1">&#39;eI&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-783"><a href="#LexFormats-783"><span class="linenos"> 783</span></a>     <span class="p">(</span><span class="n">var1_i_as_in_it</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-784"><a href="#LexFormats-784"><span class="linenos"> 784</span></a>     <span class="p">(</span><span class="n">var1_ear</span><span class="p">,</span> <span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-785"><a href="#LexFormats-785"><span class="linenos"> 785</span></a>     <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-786"><a href="#LexFormats-786"><span class="linenos"> 786</span></a>     <span class="p">(</span><span class="n">var1_e_as_in_eat</span><span class="p">,</span> <span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-787"><a href="#LexFormats-787"><span class="linenos"> 787</span></a>     <span class="p">(</span><span class="n">var2_o_as_in_go</span><span class="p">,</span> <span class="s1">&#39;@U&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-788"><a href="#LexFormats-788"><span class="linenos"> 788</span></a>     <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span> <span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-789"><a href="#LexFormats-789"><span class="linenos"> 789</span></a>     <span class="p">(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span> <span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-790"><a href="#LexFormats-790"><span class="linenos"> 790</span></a>     <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-791"><a href="#LexFormats-791"><span class="linenos"> 791</span></a>     <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-792"><a href="#LexFormats-792"><span class="linenos"> 792</span></a>     <span class="p">(</span><span class="n">var1_oor_as_in_poor</span><span class="p">,</span> <span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-793"><a href="#LexFormats-793"><span class="linenos"> 793</span></a>     <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-794"><a href="#LexFormats-794"><span class="linenos"> 794</span></a>     <span class="p">(</span><span class="n">var1_oo_as_in_food</span><span class="p">,</span> <span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-795"><a href="#LexFormats-795"><span class="linenos"> 795</span></a>     <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-796"><a href="#LexFormats-796"><span class="linenos"> 796</span></a>     <span class="p">(</span><span class="n">var2_close_to_or</span><span class="p">,</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-797"><a href="#LexFormats-797"><span class="linenos"> 797</span></a>     <span class="p">(</span><span class="n">var1_w</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-798"><a href="#LexFormats-798"><span class="linenos"> 798</span></a>     <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;vocaloid.txt&quot;</span><span class="p">,</span>
</span><span id="LexFormats-799"><a href="#LexFormats-799"><span class="linenos"> 799</span></a>     <span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span>
</span><span id="LexFormats-800"><a href="#LexFormats-800"><span class="linenos"> 800</span></a>     <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LexFormats-801"><a href="#LexFormats-801"><span class="linenos"> 801</span></a>  <span class="p">),</span>
</span><span id="LexFormats-802"><a href="#LexFormats-802"><span class="linenos"> 802</span></a>  <span class="s2">&quot;android-pico&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-803"><a href="#LexFormats-803"><span class="linenos"> 803</span></a>    <span class="s1">&#39;X-SAMPA phonemes for the default </span><span class="se">\&quot;</span><span class="s1">Pico</span><span class="se">\&quot;</span><span class="s1"> voice in Android (1.6+, American), wrapped in Java code&#39;</span><span class="p">,</span> <span class="c1"># you could put en-GB instead of en-US, but it must be installed on the phone</span>
</span><span id="LexFormats-804"><a href="#LexFormats-804"><span class="linenos"> 804</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span> <span class="c1"># won&#39;t sound without the :</span>
</span><span id="LexFormats-805"><a href="#LexFormats-805"><span class="linenos"> 805</span></a>    <span class="p">(</span><span class="n">var5_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># a: won&#39;t sound</span>
</span><span id="LexFormats-806"><a href="#LexFormats-806"><span class="linenos"> 806</span></a>    <span class="p">(</span><span class="s1">&#39;@U:&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-807"><a href="#LexFormats-807"><span class="linenos"> 807</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span> <span class="c1"># &#39;1&#39; won&#39;t sound</span>
</span><span id="LexFormats-808"><a href="#LexFormats-808"><span class="linenos"> 808</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="c1"># &#39;i&#39; won&#39;t sound</span>
</span><span id="LexFormats-809"><a href="#LexFormats-809"><span class="linenos"> 809</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span> <span class="c1"># }: won&#39;t sound</span>
</span><span id="LexFormats-810"><a href="#LexFormats-810"><span class="linenos"> 810</span></a>    <span class="p">(</span><span class="s1">&#39;a_I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;a_U&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;e_I&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;O_I&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span><span class="s1">&#39;O_I&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;o_U&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-811"><a href="#LexFormats-811"><span class="linenos"> 811</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;</span><span class="se">\\\\</span><span class="s1">&#39;</span><span class="p">),(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;quot;&#39;</span><span class="p">),(</span><span class="s1">&#39;::&#39;</span><span class="p">,</span><span class="s1">&#39;:&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-812"><a href="#LexFormats-812"><span class="linenos"> 812</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-813"><a href="#LexFormats-813"><span class="linenos"> 813</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LexFormats-814"><a href="#LexFormats-814"><span class="linenos"> 814</span></a>    <span class="n">inline_oneoff_header</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;class Speak { public static void speak(android.app.Activity a,String s) { class OnInit implements android.speech.tts.TextToSpeech.OnInitListener { public OnInit(String s) { this.s = s; } public void onInit(int i) { mTts.speak(this.s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private String s; }; if(mTts==null) mTts=new android.speech.tts.TextToSpeech(a,new OnInit(s),&quot;com.svox.pico&quot;); else mTts.speak(s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private static android.speech.tts.TextToSpeech mTts = null; };&#39;</span><span class="o">+</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="LexFormats-815"><a href="#LexFormats-815"><span class="linenos"> 815</span></a>    <span class="n">inline_header</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Speak.speak(this,&quot;&lt;speak xml:lang=\&quot;en-US\&quot;&gt;&#39;</span><span class="p">,</span>
</span><span id="LexFormats-816"><a href="#LexFormats-816"><span class="linenos"> 816</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&lt;phoneme alphabet=\&quot;xsampa\&quot; ph=\&quot;</span><span class="si">%s</span><span class="s1">\&quot;/&gt;&#39;</span><span class="p">,</span>
</span><span id="LexFormats-817"><a href="#LexFormats-817"><span class="linenos"> 817</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;.\n&quot;</span><span class="p">,</span> <span class="c1"># note r&quot;\n&quot; != &quot;\n&quot;</span>
</span><span id="LexFormats-818"><a href="#LexFormats-818"><span class="linenos"> 818</span></a>    <span class="n">inline_footer</span><span class="o">=</span><span class="s1">&#39;&lt;/speak&gt;&quot;);&#39;</span><span class="p">,</span>
</span><span id="LexFormats-819"><a href="#LexFormats-819"><span class="linenos"> 819</span></a>  <span class="p">),</span>
</span><span id="LexFormats-820"><a href="#LexFormats-820"><span class="linenos"> 820</span></a>
</span><span id="LexFormats-821"><a href="#LexFormats-821"><span class="linenos"> 821</span></a>  <span class="s2">&quot;acapela-uk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-822"><a href="#LexFormats-822"><span class="linenos"> 822</span></a>    <span class="s1">&#39;Acapela-optimised X-SAMPA for UK English voices (e.g. &quot;Peter&quot;), contributed by Jan Weiss&#39;</span><span class="p">,</span>
</span><span id="LexFormats-823"><a href="#LexFormats-823"><span class="linenos"> 823</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span> <span class="c1"># copied from &quot;x-sampa&quot;, not tested</span>
</span><span id="LexFormats-824"><a href="#LexFormats-824"><span class="linenos"> 824</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-825"><a href="#LexFormats-825"><span class="linenos"> 825</span></a>    <span class="p">(</span><span class="s1">&#39;{&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-826"><a href="#LexFormats-826"><span class="linenos"> 826</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-827"><a href="#LexFormats-827"><span class="linenos"> 827</span></a>    <span class="p">(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-828"><a href="#LexFormats-828"><span class="linenos"> 828</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-829"><a href="#LexFormats-829"><span class="linenos"> 829</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-830"><a href="#LexFormats-830"><span class="linenos"> 830</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-831"><a href="#LexFormats-831"><span class="linenos"> 831</span></a>    <span class="p">(</span><span class="s1">&#39;{O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-832"><a href="#LexFormats-832"><span class="linenos"> 832</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-833"><a href="#LexFormats-833"><span class="linenos"> 833</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-834"><a href="#LexFormats-834"><span class="linenos"> 834</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-835"><a href="#LexFormats-835"><span class="linenos"> 835</span></a>    <span class="p">(</span><span class="s1">&#39;A e&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="LexFormats-836"><a href="#LexFormats-836"><span class="linenos"> 836</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-837"><a href="#LexFormats-837"><span class="linenos"> 837</span></a>    <span class="p">(</span><span class="s1">&#39;t S&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-838"><a href="#LexFormats-838"><span class="linenos"> 838</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-839"><a href="#LexFormats-839"><span class="linenos"> 839</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-840"><a href="#LexFormats-840"><span class="linenos"> 840</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-841"><a href="#LexFormats-841"><span class="linenos"> 841</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-842"><a href="#LexFormats-842"><span class="linenos"> 842</span></a>    <span class="p">(</span><span class="s1">&#39;e @&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-843"><a href="#LexFormats-843"><span class="linenos"> 843</span></a>    <span class="p">(</span><span class="s1">&#39;e r&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-844"><a href="#LexFormats-844"><span class="linenos"> 844</span></a>    <span class="p">(</span><span class="s1">&#39;e :&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-845"><a href="#LexFormats-845"><span class="linenos"> 845</span></a>    <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e :&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-846"><a href="#LexFormats-846"><span class="linenos"> 846</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-847"><a href="#LexFormats-847"><span class="linenos"> 847</span></a>    <span class="p">(</span><span class="s1">&#39;{I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-848"><a href="#LexFormats-848"><span class="linenos"> 848</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-849"><a href="#LexFormats-849"><span class="linenos"> 849</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-850"><a href="#LexFormats-850"><span class="linenos"> 850</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-851"><a href="#LexFormats-851"><span class="linenos"> 851</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-852"><a href="#LexFormats-852"><span class="linenos"> 852</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-853"><a href="#LexFormats-853"><span class="linenos"> 853</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-854"><a href="#LexFormats-854"><span class="linenos"> 854</span></a>    <span class="p">(</span><span class="s1">&#39;I r&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="LexFormats-855"><a href="#LexFormats-855"><span class="linenos"> 855</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-856"><a href="#LexFormats-856"><span class="linenos"> 856</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-857"><a href="#LexFormats-857"><span class="linenos"> 857</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-858"><a href="#LexFormats-858"><span class="linenos"> 858</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-859"><a href="#LexFormats-859"><span class="linenos"> 859</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-860"><a href="#LexFormats-860"><span class="linenos"> 860</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-861"><a href="#LexFormats-861"><span class="linenos"> 861</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-862"><a href="#LexFormats-862"><span class="linenos"> 862</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-863"><a href="#LexFormats-863"><span class="linenos"> 863</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-864"><a href="#LexFormats-864"><span class="linenos"> 864</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-865"><a href="#LexFormats-865"><span class="linenos"> 865</span></a>    <span class="p">(</span><span class="s1">&#39;o U&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-866"><a href="#LexFormats-866"><span class="linenos"> 866</span></a>    <span class="p">(</span><span class="s1">&#39;@ }&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-867"><a href="#LexFormats-867"><span class="linenos"> 867</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-868"><a href="#LexFormats-868"><span class="linenos"> 868</span></a>    <span class="p">(</span><span class="s1">&#39;o I&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-869"><a href="#LexFormats-869"><span class="linenos"> 869</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-870"><a href="#LexFormats-870"><span class="linenos"> 870</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-871"><a href="#LexFormats-871"><span class="linenos"> 871</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-872"><a href="#LexFormats-872"><span class="linenos"> 872</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-873"><a href="#LexFormats-873"><span class="linenos"> 873</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-874"><a href="#LexFormats-874"><span class="linenos"> 874</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-875"><a href="#LexFormats-875"><span class="linenos"> 875</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-876"><a href="#LexFormats-876"><span class="linenos"> 876</span></a>    <span class="p">(</span><span class="s1">&#39;U r&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-877"><a href="#LexFormats-877"><span class="linenos"> 877</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-878"><a href="#LexFormats-878"><span class="linenos"> 878</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-879"><a href="#LexFormats-879"><span class="linenos"> 879</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-880"><a href="#LexFormats-880"><span class="linenos"> 880</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-881"><a href="#LexFormats-881"><span class="linenos"> 881</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-882"><a href="#LexFormats-882"><span class="linenos"> 882</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-883"><a href="#LexFormats-883"><span class="linenos"> 883</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-884"><a href="#LexFormats-884"><span class="linenos"> 884</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-885"><a href="#LexFormats-885"><span class="linenos"> 885</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-886"><a href="#LexFormats-886"><span class="linenos"> 886</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;acapela.txt&quot;</span><span class="p">,</span>
</span><span id="LexFormats-887"><a href="#LexFormats-887"><span class="linenos"> 887</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="se">\t</span><span class="s2">#</span><span class="si">%s</span><span class="se">\t</span><span class="s2">UNKNOWN</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># TODO: part-of-speech (as above)</span>
</span><span id="LexFormats-888"><a href="#LexFormats-888"><span class="linenos"> 888</span></a>    <span class="n">lex_read_function</span><span class="o">=</span><span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:[(</span><span class="n">word</span><span class="p">,</span><span class="n">pronunc</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;#&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">,</span> <span class="n">ignore</span> <span class="ow">in</span> <span class="p">[</span><span class="n">l</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">lexfile</span><span class="o">.</span><span class="n">readlines</span><span class="p">()]],</span>
</span><span id="LexFormats-889"><a href="#LexFormats-889"><span class="linenos"> 889</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">Prn=</span><span class="si">%s</span><span class="se">\\</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-890"><a href="#LexFormats-890"><span class="linenos"> 890</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-891"><a href="#LexFormats-891"><span class="linenos"> 891</span></a>  <span class="p">),</span>
</span><span id="LexFormats-892"><a href="#LexFormats-892"><span class="linenos"> 892</span></a>
</span><span id="LexFormats-893"><a href="#LexFormats-893"><span class="linenos"> 893</span></a>  <span class="s2">&quot;cmu&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-894"><a href="#LexFormats-894"><span class="linenos"> 894</span></a>    <span class="s1">&#39;format of the US-English Carnegie Mellon University Pronouncing Dictionary, contributed by Jan Weiss&#39;</span><span class="p">,</span> <span class="c1"># http://www.speech.cs.cmu.edu/cgi-bin/cmudict</span>
</span><span id="LexFormats-895"><a href="#LexFormats-895"><span class="linenos"> 895</span></a>    <span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">),</span>
</span><span id="LexFormats-896"><a href="#LexFormats-896"><span class="linenos"> 896</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-897"><a href="#LexFormats-897"><span class="linenos"> 897</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-898"><a href="#LexFormats-898"><span class="linenos"> 898</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-899"><a href="#LexFormats-899"><span class="linenos"> 899</span></a>    <span class="p">(</span><span class="n">var1_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-900"><a href="#LexFormats-900"><span class="linenos"> 900</span></a>    <span class="p">(</span><span class="n">ipa_colon</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-901"><a href="#LexFormats-901"><span class="linenos"> 901</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-902"><a href="#LexFormats-902"><span class="linenos"> 902</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-903"><a href="#LexFormats-903"><span class="linenos"> 903</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-904"><a href="#LexFormats-904"><span class="linenos"> 904</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-905"><a href="#LexFormats-905"><span class="linenos"> 905</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># seems they don&#39;t use AX as festival-cmu does</span>
</span><span id="LexFormats-906"><a href="#LexFormats-906"><span class="linenos"> 906</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span> <span class="c1"># TODO: check this one</span>
</span><span id="LexFormats-907"><a href="#LexFormats-907"><span class="linenos"> 907</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-908"><a href="#LexFormats-908"><span class="linenos"> 908</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-909"><a href="#LexFormats-909"><span class="linenos"> 909</span></a>    <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-910"><a href="#LexFormats-910"><span class="linenos"> 910</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-911"><a href="#LexFormats-911"><span class="linenos"> 911</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-912"><a href="#LexFormats-912"><span class="linenos"> 912</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-913"><a href="#LexFormats-913"><span class="linenos"> 913</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-914"><a href="#LexFormats-914"><span class="linenos"> 914</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-915"><a href="#LexFormats-915"><span class="linenos"> 915</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-916"><a href="#LexFormats-916"><span class="linenos"> 916</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-917"><a href="#LexFormats-917"><span class="linenos"> 917</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-918"><a href="#LexFormats-918"><span class="linenos"> 918</span></a>    <span class="p">(</span><span class="s1">&#39;HH&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-919"><a href="#LexFormats-919"><span class="linenos"> 919</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-920"><a href="#LexFormats-920"><span class="linenos"> 920</span></a>    <span class="p">(</span><span class="s1">&#39;EY AH&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-921"><a href="#LexFormats-921"><span class="linenos"> 921</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-922"><a href="#LexFormats-922"><span class="linenos"> 922</span></a>    <span class="p">(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-923"><a href="#LexFormats-923"><span class="linenos"> 923</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-924"><a href="#LexFormats-924"><span class="linenos"> 924</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-925"><a href="#LexFormats-925"><span class="linenos"> 925</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-926"><a href="#LexFormats-926"><span class="linenos"> 926</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-927"><a href="#LexFormats-927"><span class="linenos"> 927</span></a>    <span class="p">(</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-928"><a href="#LexFormats-928"><span class="linenos"> 928</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-929"><a href="#LexFormats-929"><span class="linenos"> 929</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-930"><a href="#LexFormats-930"><span class="linenos"> 930</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-931"><a href="#LexFormats-931"><span class="linenos"> 931</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-932"><a href="#LexFormats-932"><span class="linenos"> 932</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-933"><a href="#LexFormats-933"><span class="linenos"> 933</span></a>    <span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-934"><a href="#LexFormats-934"><span class="linenos"> 934</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-935"><a href="#LexFormats-935"><span class="linenos"> 935</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-936"><a href="#LexFormats-936"><span class="linenos"> 936</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-937"><a href="#LexFormats-937"><span class="linenos"> 937</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-938"><a href="#LexFormats-938"><span class="linenos"> 938</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-939"><a href="#LexFormats-939"><span class="linenos"> 939</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-940"><a href="#LexFormats-940"><span class="linenos"> 940</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-941"><a href="#LexFormats-941"><span class="linenos"> 941</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-942"><a href="#LexFormats-942"><span class="linenos"> 942</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-943"><a href="#LexFormats-943"><span class="linenos"> 943</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-944"><a href="#LexFormats-944"><span class="linenos"> 944</span></a>    <span class="c1"># lex_filename not set (does CMU have a lex file?)</span>
</span><span id="LexFormats-945"><a href="#LexFormats-945"><span class="linenos"> 945</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-946"><a href="#LexFormats-946"><span class="linenos"> 946</span></a>  <span class="p">),</span>
</span><span id="LexFormats-947"><a href="#LexFormats-947"><span class="linenos"> 947</span></a>
</span><span id="LexFormats-948"><a href="#LexFormats-948"><span class="linenos"> 948</span></a>  <span class="c1"># BEGIN PRE-32bit ERA SYNTHS (TODO: add an attribute to JS-hide them by default in HTML?  what about the SpeakJet which probably isn&#39;t a 32-bit chip but is post 32-bit era?  and then what about the &#39;approximation&#39; formats - kana etc - would they need hiding by default also?  maybe best to just leave it)</span>
</span><span id="LexFormats-949"><a href="#LexFormats-949"><span class="linenos"> 949</span></a>  <span class="s2">&quot;apollo&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-950"><a href="#LexFormats-950"><span class="linenos"> 950</span></a>    <span class="s1">&#39;Dolphin Apollo 2 serial-port and parallel-port hardware synthesizers (in case anybody still uses those)&#39;</span><span class="p">,</span>
</span><span id="LexFormats-951"><a href="#LexFormats-951"><span class="linenos"> 951</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># I don&#39;t think the Apollo had anything to mark stress; TODO: control the pitch instead like bbcmicro ?</span>
</span><span id="LexFormats-952"><a href="#LexFormats-952"><span class="linenos"> 952</span></a>    <span class="p">(</span><span class="s1">&#39;_QQ&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># a slight pause</span>
</span><span id="LexFormats-953"><a href="#LexFormats-953"><span class="linenos"> 953</span></a>    <span class="p">(</span><span class="s1">&#39;_AA&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-954"><a href="#LexFormats-954"><span class="linenos"> 954</span></a>    <span class="p">(</span><span class="s1">&#39;_AI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-955"><a href="#LexFormats-955"><span class="linenos"> 955</span></a>    <span class="p">(</span><span class="s1">&#39;_AR&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-956"><a href="#LexFormats-956"><span class="linenos"> 956</span></a>    <span class="p">(</span><span class="s1">&#39;_AW&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-957"><a href="#LexFormats-957"><span class="linenos"> 957</span></a>    <span class="p">(</span><span class="s1">&#39;_A&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-958"><a href="#LexFormats-958"><span class="linenos"> 958</span></a>    <span class="p">(</span><span class="s1">&#39;_B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-959"><a href="#LexFormats-959"><span class="linenos"> 959</span></a>    <span class="p">(</span><span class="s1">&#39;_CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-960"><a href="#LexFormats-960"><span class="linenos"> 960</span></a>    <span class="p">(</span><span class="s1">&#39;_D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-961"><a href="#LexFormats-961"><span class="linenos"> 961</span></a>    <span class="p">(</span><span class="s1">&#39;_DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-962"><a href="#LexFormats-962"><span class="linenos"> 962</span></a>    <span class="p">(</span><span class="s1">&#39;_EE&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-963"><a href="#LexFormats-963"><span class="linenos"> 963</span></a>    <span class="p">(</span><span class="s1">&#39;_EI&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-964"><a href="#LexFormats-964"><span class="linenos"> 964</span></a>    <span class="p">(</span><span class="s1">&#39;_ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-965"><a href="#LexFormats-965"><span class="linenos"> 965</span></a>    <span class="p">(</span><span class="s1">&#39;_E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-966"><a href="#LexFormats-966"><span class="linenos"> 966</span></a>    <span class="p">(</span><span class="s1">&#39;_F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-967"><a href="#LexFormats-967"><span class="linenos"> 967</span></a>    <span class="p">(</span><span class="s1">&#39;_G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-968"><a href="#LexFormats-968"><span class="linenos"> 968</span></a>    <span class="p">(</span><span class="s1">&#39;_H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-969"><a href="#LexFormats-969"><span class="linenos"> 969</span></a>    <span class="p">(</span><span class="s1">&#39;_IA&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-970"><a href="#LexFormats-970"><span class="linenos"> 970</span></a>    <span class="p">(</span><span class="s1">&#39;_IE&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-971"><a href="#LexFormats-971"><span class="linenos"> 971</span></a>    <span class="p">(</span><span class="s1">&#39;_I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-972"><a href="#LexFormats-972"><span class="linenos"> 972</span></a>    <span class="p">(</span><span class="s1">&#39;_J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-973"><a href="#LexFormats-973"><span class="linenos"> 973</span></a>    <span class="p">(</span><span class="s1">&#39;_K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-974"><a href="#LexFormats-974"><span class="linenos"> 974</span></a>    <span class="p">(</span><span class="s1">&#39;_KK&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># sCHool</span>
</span><span id="LexFormats-975"><a href="#LexFormats-975"><span class="linenos"> 975</span></a>    <span class="p">(</span><span class="s1">&#39;_L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-976"><a href="#LexFormats-976"><span class="linenos"> 976</span></a>    <span class="p">(</span><span class="s1">&#39;_M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-977"><a href="#LexFormats-977"><span class="linenos"> 977</span></a>    <span class="p">(</span><span class="s1">&#39;_NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-978"><a href="#LexFormats-978"><span class="linenos"> 978</span></a>    <span class="p">(</span><span class="s1">&#39;_N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-979"><a href="#LexFormats-979"><span class="linenos"> 979</span></a>    <span class="p">(</span><span class="s1">&#39;_OA&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-980"><a href="#LexFormats-980"><span class="linenos"> 980</span></a>    <span class="p">(</span><span class="s1">&#39;_OO&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-981"><a href="#LexFormats-981"><span class="linenos"> 981</span></a>    <span class="p">(</span><span class="s1">&#39;_OR&#39;</span><span class="p">,</span><span class="n">var3_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-982"><a href="#LexFormats-982"><span class="linenos"> 982</span></a>    <span class="p">(</span><span class="s1">&#39;_OW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-983"><a href="#LexFormats-983"><span class="linenos"> 983</span></a>    <span class="p">(</span><span class="s1">&#39;_OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-984"><a href="#LexFormats-984"><span class="linenos"> 984</span></a>    <span class="p">(</span><span class="s1">&#39;_O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-985"><a href="#LexFormats-985"><span class="linenos"> 985</span></a>    <span class="p">(</span><span class="s1">&#39;_P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-986"><a href="#LexFormats-986"><span class="linenos"> 986</span></a>    <span class="p">(</span><span class="s1">&#39;_PP&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># sPeech (a stronger P ?)</span>
</span><span id="LexFormats-987"><a href="#LexFormats-987"><span class="linenos"> 987</span></a>    <span class="c1"># _Q = k w - done by cleanup_regexps below</span>
</span><span id="LexFormats-988"><a href="#LexFormats-988"><span class="linenos"> 988</span></a>    <span class="p">(</span><span class="s1">&#39;_R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-989"><a href="#LexFormats-989"><span class="linenos"> 989</span></a>    <span class="p">(</span><span class="s1">&#39;_SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-990"><a href="#LexFormats-990"><span class="linenos"> 990</span></a>    <span class="p">(</span><span class="s1">&#39;_S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-991"><a href="#LexFormats-991"><span class="linenos"> 991</span></a>    <span class="p">(</span><span class="s1">&#39;_TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-992"><a href="#LexFormats-992"><span class="linenos"> 992</span></a>    <span class="p">(</span><span class="s1">&#39;_T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;_TT&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-993"><a href="#LexFormats-993"><span class="linenos"> 993</span></a>    <span class="p">(</span><span class="s1">&#39;_UU&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-994"><a href="#LexFormats-994"><span class="linenos"> 994</span></a>    <span class="p">(</span><span class="s1">&#39;_U&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-995"><a href="#LexFormats-995"><span class="linenos"> 995</span></a>    <span class="p">(</span><span class="s1">&#39;_V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-996"><a href="#LexFormats-996"><span class="linenos"> 996</span></a>    <span class="p">(</span><span class="s1">&#39;_W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-997"><a href="#LexFormats-997"><span class="linenos"> 997</span></a>    <span class="c1"># _X = k s - done by cleanup_regexps below</span>
</span><span id="LexFormats-998"><a href="#LexFormats-998"><span class="linenos"> 998</span></a>    <span class="p">(</span><span class="s1">&#39;_Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-999"><a href="#LexFormats-999"><span class="linenos"> 999</span></a>    <span class="p">(</span><span class="s1">&#39;_ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1000"><a href="#LexFormats-1000"><span class="linenos">1000</span></a>    <span class="p">(</span><span class="s1">&#39;_Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1001"><a href="#LexFormats-1001"><span class="linenos">1001</span></a>    <span class="c1"># lex_filename not set (the hardware doesn&#39;t have one; HAL has an &quot;exceptions dictionary&quot; but I don&#39;t know much about it)</span>
</span><span id="LexFormats-1002"><a href="#LexFormats-1002"><span class="linenos">1002</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1003"><a href="#LexFormats-1003"><span class="linenos">1003</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1004"><a href="#LexFormats-1004"><span class="linenos">1004</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1005"><a href="#LexFormats-1005"><span class="linenos">1005</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;_K_W&#39;</span><span class="p">,</span><span class="s1">&#39;_Q&#39;</span><span class="p">),(</span><span class="s1">&#39;_K_S&#39;</span><span class="p">,</span><span class="s1">&#39;_X&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-1006"><a href="#LexFormats-1006"><span class="linenos">1006</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;_Q&#39;</span><span class="p">,</span><span class="s1">&#39;_K_W&#39;</span><span class="p">),(</span><span class="s1">&#39;_X&#39;</span><span class="p">,</span><span class="s1">&#39;_K_S&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-1007"><a href="#LexFormats-1007"><span class="linenos">1007</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1008"><a href="#LexFormats-1008"><span class="linenos">1008</span></a>  <span class="s2">&quot;dectalk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1009"><a href="#LexFormats-1009"><span class="linenos">1009</span></a>    <span class="s1">&#39;DECtalk hardware synthesizers (American English)&#39;</span><span class="p">,</span> <span class="c1"># (1984-ish serial port; later ISA cards)</span>
</span><span id="LexFormats-1010"><a href="#LexFormats-1010"><span class="linenos">1010</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1011"><a href="#LexFormats-1011"><span class="linenos">1011</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1012"><a href="#LexFormats-1012"><span class="linenos">1012</span></a>    <span class="p">(</span><span class="s1">&#39;aa&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1013"><a href="#LexFormats-1013"><span class="linenos">1013</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1014"><a href="#LexFormats-1014"><span class="linenos">1014</span></a>    <span class="p">(</span><span class="s1">&#39;ah&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1015"><a href="#LexFormats-1015"><span class="linenos">1015</span></a>    <span class="p">(</span><span class="s1">&#39;ao&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span> <span class="c1"># bought</span>
</span><span id="LexFormats-1016"><a href="#LexFormats-1016"><span class="linenos">1016</span></a>    <span class="p">(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1017"><a href="#LexFormats-1017"><span class="linenos">1017</span></a>    <span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1018"><a href="#LexFormats-1018"><span class="linenos">1018</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1019"><a href="#LexFormats-1019"><span class="linenos">1019</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1020"><a href="#LexFormats-1020"><span class="linenos">1020</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1021"><a href="#LexFormats-1021"><span class="linenos">1021</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;dx&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1022"><a href="#LexFormats-1022"><span class="linenos">1022</span></a>    <span class="p">(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1023"><a href="#LexFormats-1023"><span class="linenos">1023</span></a>    <span class="p">(</span><span class="s1">&#39;eh&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1024"><a href="#LexFormats-1024"><span class="linenos">1024</span></a>    <span class="p">(</span><span class="s1">&#39;el&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># -le of bottle, allophone ?</span>
</span><span id="LexFormats-1025"><a href="#LexFormats-1025"><span class="linenos">1025</span></a>    <span class="c1"># TODO: en: -on of button (2 phonemes?)</span>
</span><span id="LexFormats-1026"><a href="#LexFormats-1026"><span class="linenos">1026</span></a>    <span class="p">(</span><span class="s1">&#39;ey&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1027"><a href="#LexFormats-1027"><span class="linenos">1027</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1028"><a href="#LexFormats-1028"><span class="linenos">1028</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1029"><a href="#LexFormats-1029"><span class="linenos">1029</span></a>    <span class="p">(</span><span class="s1">&#39;hx&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1030"><a href="#LexFormats-1030"><span class="linenos">1030</span></a>    <span class="p">(</span><span class="s1">&#39;ih&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;ix&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1031"><a href="#LexFormats-1031"><span class="linenos">1031</span></a>    <span class="p">(</span><span class="s1">&#39;iy&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;q&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1032"><a href="#LexFormats-1032"><span class="linenos">1032</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1033"><a href="#LexFormats-1033"><span class="linenos">1033</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1034"><a href="#LexFormats-1034"><span class="linenos">1034</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;lx&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1035"><a href="#LexFormats-1035"><span class="linenos">1035</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1036"><a href="#LexFormats-1036"><span class="linenos">1036</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1037"><a href="#LexFormats-1037"><span class="linenos">1037</span></a>    <span class="p">(</span><span class="s1">&#39;nx&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1038"><a href="#LexFormats-1038"><span class="linenos">1038</span></a>    <span class="p">(</span><span class="s1">&#39;ow&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1039"><a href="#LexFormats-1039"><span class="linenos">1039</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1040"><a href="#LexFormats-1040"><span class="linenos">1040</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1041"><a href="#LexFormats-1041"><span class="linenos">1041</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;rx&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1042"><a href="#LexFormats-1042"><span class="linenos">1042</span></a>    <span class="p">(</span><span class="s1">&#39;rr&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1043"><a href="#LexFormats-1043"><span class="linenos">1043</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1044"><a href="#LexFormats-1044"><span class="linenos">1044</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1045"><a href="#LexFormats-1045"><span class="linenos">1045</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;tx&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1046"><a href="#LexFormats-1046"><span class="linenos">1046</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1047"><a href="#LexFormats-1047"><span class="linenos">1047</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1048"><a href="#LexFormats-1048"><span class="linenos">1048</span></a>    <span class="p">(</span><span class="s1">&#39;uw&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1049"><a href="#LexFormats-1049"><span class="linenos">1049</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1050"><a href="#LexFormats-1050"><span class="linenos">1050</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1051"><a href="#LexFormats-1051"><span class="linenos">1051</span></a>    <span class="p">(</span><span class="s1">&#39;yx&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1052"><a href="#LexFormats-1052"><span class="linenos">1052</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1053"><a href="#LexFormats-1053"><span class="linenos">1053</span></a>    <span class="p">(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1054"><a href="#LexFormats-1054"><span class="linenos">1054</span></a>    <span class="p">(</span><span class="s1">&#39;ihr&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span> <span class="c1"># DECtalk makes this from ih + r</span>
</span><span id="LexFormats-1055"><a href="#LexFormats-1055"><span class="linenos">1055</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1056"><a href="#LexFormats-1056"><span class="linenos">1056</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;yxuw&#39;</span><span class="p">,</span><span class="s1">&#39;yu&#39;</span><span class="p">)],</span> <span class="c1"># TODO: other allophones (&quot;x&#39;,False&quot; stuff above)?</span>
</span><span id="LexFormats-1057"><a href="#LexFormats-1057"><span class="linenos">1057</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;yu&#39;</span><span class="p">,</span><span class="s1">&#39;yxuw&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-1058"><a href="#LexFormats-1058"><span class="linenos">1058</span></a>    <span class="c1"># lex_filename not set (depends on which model etc)</span>
</span><span id="LexFormats-1059"><a href="#LexFormats-1059"><span class="linenos">1059</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1060"><a href="#LexFormats-1060"><span class="linenos">1060</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1061"><a href="#LexFormats-1061"><span class="linenos">1061</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1062"><a href="#LexFormats-1062"><span class="linenos">1062</span></a>    <span class="n">inline_header</span><span class="o">=</span><span class="s2">&quot;[:phoneme on]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1063"><a href="#LexFormats-1063"><span class="linenos">1063</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="s2">&quot;[</span><span class="si">%s</span><span class="s2">]&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1064"><a href="#LexFormats-1064"><span class="linenos">1064</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1065"><a href="#LexFormats-1065"><span class="linenos">1065</span></a>  <span class="s2">&quot;doubletalk&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1066"><a href="#LexFormats-1066"><span class="linenos">1066</span></a>    <span class="s1">&#39;DoubleTalk PC/LT serial-port hardware synthesizers (American English; assumes DOS driver by default, otherwise set DTALK_COMMAND_CODE to your current command-code binary value, e.g. export DTALK_COMMAND_CODE=1)&#39;</span><span class="p">,</span> <span class="c1"># (1 is the synth&#39;s default; the DOS driver lets you put * instead)</span>
</span><span id="LexFormats-1067"><a href="#LexFormats-1067"><span class="linenos">1067</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1068"><a href="#LexFormats-1068"><span class="linenos">1068</span></a>    <span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span> <span class="c1"># TODO: check it doesn&#39;t need a balancing \ afterwards (docs do say it&#39;s a &quot;temporary&quot; change of pitch, but it&#39;s unclear how long a &#39;temporary&#39;)</span>
</span><span id="LexFormats-1069"><a href="#LexFormats-1069"><span class="linenos">1069</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1070"><a href="#LexFormats-1070"><span class="linenos">1070</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone</span>
</span><span id="LexFormats-1071"><a href="#LexFormats-1071"><span class="linenos">1071</span></a>    <span class="p">(</span><span class="n">o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: is this the best approximation we can do?</span>
</span><span id="LexFormats-1072"><a href="#LexFormats-1072"><span class="linenos">1072</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1073"><a href="#LexFormats-1073"><span class="linenos">1073</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1074"><a href="#LexFormats-1074"><span class="linenos">1074</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1075"><a href="#LexFormats-1075"><span class="linenos">1075</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1076"><a href="#LexFormats-1076"><span class="linenos">1076</span></a>    <span class="p">(</span><span class="s1">&#39;PX&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;TX&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># aspirated allophones</span>
</span><span id="LexFormats-1077"><a href="#LexFormats-1077"><span class="linenos">1077</span></a>    <span class="p">(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;KX&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># ditto</span>
</span><span id="LexFormats-1078"><a href="#LexFormats-1078"><span class="linenos">1078</span></a>    <span class="p">(</span><span class="s1">&#39;YY&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1079"><a href="#LexFormats-1079"><span class="linenos">1079</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1080"><a href="#LexFormats-1080"><span class="linenos">1080</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1081"><a href="#LexFormats-1081"><span class="linenos">1081</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1082"><a href="#LexFormats-1082"><span class="linenos">1082</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1083"><a href="#LexFormats-1083"><span class="linenos">1083</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1084"><a href="#LexFormats-1084"><span class="linenos">1084</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1085"><a href="#LexFormats-1085"><span class="linenos">1085</span></a>    <span class="p">(</span><span class="s1">&#39;DX&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># an American &quot;d&quot;-like &quot;t&quot;</span>
</span><span id="LexFormats-1086"><a href="#LexFormats-1086"><span class="linenos">1086</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1087"><a href="#LexFormats-1087"><span class="linenos">1087</span></a>    <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1088"><a href="#LexFormats-1088"><span class="linenos">1088</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1089"><a href="#LexFormats-1089"><span class="linenos">1089</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1090"><a href="#LexFormats-1090"><span class="linenos">1090</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1091"><a href="#LexFormats-1091"><span class="linenos">1091</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1092"><a href="#LexFormats-1092"><span class="linenos">1092</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="n">markup_doubleTalk_word</span><span class="p">,</span>
</span><span id="LexFormats-1093"><a href="#LexFormats-1093"><span class="linenos">1093</span></a>    <span class="n">format_is_binary</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;DTALK_COMMAND_CODE&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LexFormats-1094"><a href="#LexFormats-1094"><span class="linenos">1094</span></a>    <span class="c1"># DoubleTalk does have a loadable &quot;exceptions dictionary&quot; but usually relies on a DOS tool to write it; I don&#39;t have the documentation about it (and don&#39;t know how much RAM is available for it - it&#39;s taken from the input buffer)</span>
</span><span id="LexFormats-1095"><a href="#LexFormats-1095"><span class="linenos">1095</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1096"><a href="#LexFormats-1096"><span class="linenos">1096</span></a>  <span class="s2">&quot;keynote&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1097"><a href="#LexFormats-1097"><span class="linenos">1097</span></a>    <span class="s1">&#39;Phoneme-read and lexicon-add codes for Keynote Gold hardware synthesizers (American English)&#39;</span><span class="p">,</span> <span class="c1"># ISA, PCMCIA, serial, etc; non-serial models give you an INT 2Fh param to get the address of an API function to call; not sure which software can send these codes directly to it)</span>
</span><span id="LexFormats-1098"><a href="#LexFormats-1098"><span class="linenos">1098</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1099"><a href="#LexFormats-1099"><span class="linenos">1099</span></a>    <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">),(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&quot;&#39;</span><span class="p">),</span>
</span><span id="LexFormats-1100"><a href="#LexFormats-1100"><span class="linenos">1100</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1101"><a href="#LexFormats-1101"><span class="linenos">1101</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1102"><a href="#LexFormats-1102"><span class="linenos">1102</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;dh&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1103"><a href="#LexFormats-1103"><span class="linenos">1103</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;zh&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1104"><a href="#LexFormats-1104"><span class="linenos">1104</span></a>    <span class="p">(</span><span class="s1">&#39;jh&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1105"><a href="#LexFormats-1105"><span class="linenos">1105</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1106"><a href="#LexFormats-1106"><span class="linenos">1106</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1107"><a href="#LexFormats-1107"><span class="linenos">1107</span></a>    <span class="p">(</span><span class="s1">&#39;ae&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1108"><a href="#LexFormats-1108"><span class="linenos">1108</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1109"><a href="#LexFormats-1109"><span class="linenos">1109</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1110"><a href="#LexFormats-1110"><span class="linenos">1110</span></a>    <span class="p">(</span><span class="s1">&#39;^&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1111"><a href="#LexFormats-1111"><span class="linenos">1111</span></a>    <span class="p">(</span><span class="s1">&#39;ay&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;Oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),(</span><span class="s1">&#39;aw&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1112"><a href="#LexFormats-1112"><span class="linenos">1112</span></a>    <span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1113"><a href="#LexFormats-1113"><span class="linenos">1113</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1114"><a href="#LexFormats-1114"><span class="linenos">1114</span></a>    <span class="n">inline_format</span><span class="o">=</span><span class="s2">&quot;[p]</span><span class="si">%s</span><span class="s2">[t]&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1115"><a href="#LexFormats-1115"><span class="linenos">1115</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;keynote.dat&quot;</span><span class="p">,</span> <span class="c1"># you have to somehow get this directly dumped to the card, see comment above</span>
</span><span id="LexFormats-1116"><a href="#LexFormats-1116"><span class="linenos">1116</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;[x]</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lex_footer</span><span class="o">=</span><span class="s2">&quot;[t]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1117"><a href="#LexFormats-1117"><span class="linenos">1117</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="c1"># even though it&#39;s &quot;&#39;&quot;</span>
</span><span id="LexFormats-1118"><a href="#LexFormats-1118"><span class="linenos">1118</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1119"><a href="#LexFormats-1119"><span class="linenos">1119</span></a>  <span class="s2">&quot;audapter&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-1120"><a href="#LexFormats-1120"><span class="linenos">1120</span></a>  <span class="s2">&quot;Audapter Speech System, an old hardware serial/parallel-port synthesizer (American English)&quot;</span><span class="p">,</span> <span class="c1"># 1989 I think.  The phonemes themselves are the same as the Keynote above, but there&#39;s an extra binary byte in the commands and the lex format is stricter.  I haven&#39;t checked but my guess is Audapter came before Keynote.</span>
</span><span id="LexFormats-1121"><a href="#LexFormats-1121"><span class="linenos">1121</span></a>  <span class="n">inline_format</span><span class="o">=</span><span class="s1">&#39;</span><span class="se">\x05</span><span class="s1">[p] </span><span class="si">%s</span><span class="se">\x05</span><span class="s1">[t]&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1122"><a href="#LexFormats-1122"><span class="linenos">1122</span></a>  <span class="n">format_is_binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1123"><a href="#LexFormats-1123"><span class="linenos">1123</span></a>  <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;audapter.dat&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1124"><a href="#LexFormats-1124"><span class="linenos">1124</span></a>  <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\x05</span><span class="s2">[x]</span><span class="si">%s</span><span class="s2"> </span><span class="si">%s</span><span class="se">\x05</span><span class="s2">[t]</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">lex_footer</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1125"><a href="#LexFormats-1125"><span class="linenos">1125</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1126"><a href="#LexFormats-1126"><span class="linenos">1126</span></a>  <span class="s2">&quot;bbcmicro&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1127"><a href="#LexFormats-1127"><span class="linenos">1127</span></a>    <span class="s2">&quot;BBC Micro Speech program from 1985 (see comments in lexconvert.py for more details)&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1128"><a href="#LexFormats-1128"><span class="linenos">1128</span></a>    <span class="c1"># Speech was written by David J. Hoskins and published by Superior Software.  It took 7.5k of RAM including 3.1k of samples (49 phonemes + 1 for fricatives at 64 bytes each, 4-bit ~5.5kHz), 2.2k of lexicon, and 2.2k of machine code; sounds &quot;retro&quot; by modern standards but quite impressive for the BBC Micro in 1985.  Samples are played by amplitude-modulating the BBC&#39;s tone generator.</span>
</span><span id="LexFormats-1129"><a href="#LexFormats-1129"><span class="linenos">1129</span></a>    <span class="c1"># If you use an emulator like BeebEm, you&#39;ll need diskimg/Speech.ssd.  This can be made from your original Speech disc, or you might be able to find one but beware of copyright!  Same goes with the ROM images included in BeebEm (you might want to delete ones you didn&#39;t have).  There has been considerable discussion over whether UK copyright law does or should allow &quot;format-shifting&quot; your own legally-purchased media, and I don&#39;t fully understand all the discussion so I don&#39;t want to give advice on it here.  The issue is &quot;format-shifting&quot; your legally-purchased BBC Micro ROM code and Speech disc to emulator images; IF this is all right then I suspect downloading someone else&#39;s copy is arguably allowed as long as you bought it legally &quot;back in the day&quot;, but I&#39;m not a solicitor so I don&#39;t know.</span>
</span><span id="LexFormats-1130"><a href="#LexFormats-1130"><span class="linenos">1130</span></a>    <span class="c1"># (Incidentally, yes I was the Silas Brown referred to in Beebug 11.1 p.59, 11.9 p.50/11.10 p.47 and 12.10 p.24, and, no, the question in the final issue wasn&#39;t quite how I put it, but all taken in good humour.)</span>
</span><span id="LexFormats-1131"><a href="#LexFormats-1131"><span class="linenos">1131</span></a>    <span class="c1"># lexconvert&#39;s --phones bbcmicro option creates *SPEAK commands which you can type into the BBC Micro or paste into an emulator, either at the BASIC prompt, or in a listing with line numbers provided by AUTO.  You have to load the Speech program first of course.</span>
</span><span id="LexFormats-1132"><a href="#LexFormats-1132"><span class="linenos">1132</span></a>    <span class="c1"># To script this on BeebEm, first turn off the Speech disc&#39;s boot option (by turning off File / Disc options / Write protect and entering &quot;*OPT 4,0&quot;; use &quot;*OPT 4,3&quot; if you want it back later; if you prefer to edit the disk image outside of the emulator then change byte 0x106 from 0x33 to 0x03), and then you can do (e.g. on a Mac) open /usr/local/BeebEm3/diskimg/Speech.ssd &amp;&amp; sleep 1 &amp;&amp; (echo &#39;*SPEECH&#39;;python lexconvert.py --phones bbcmicro &quot;Greetings from 19 85&quot;) | pbcopy &amp;&amp; osascript -e &#39;tell application &quot;System Events&quot; to keystroke &quot;v&quot; using command down&#39;</span>
</span><span id="LexFormats-1133"><a href="#LexFormats-1133"><span class="linenos">1133</span></a>    <span class="c1"># or if you know it&#39;s already loaded: echo &quot;Here is some text&quot; | python lexconvert.py --phones bbcmicro | pbcopy &amp;&amp; osascript -e &#39;tell application &quot;BeebEm3&quot; to activate&#39; &amp;&amp; osascript -e &#39;tell application &quot;System Events&quot; to keystroke &quot;v&quot; using command down&#39;</span>
</span><span id="LexFormats-1134"><a href="#LexFormats-1134"><span class="linenos">1134</span></a>    <span class="c1"># (unfortunately there doesn&#39;t seem to be a way of doing it without giving the emulator window focus)</span>
</span><span id="LexFormats-1135"><a href="#LexFormats-1135"><span class="linenos">1135</span></a>    <span class="c1"># If you want to emulate a Master, you might need a *DISK before the *SPEECH (to take it out of ADFS mode).</span>
</span><span id="LexFormats-1136"><a href="#LexFormats-1136"><span class="linenos">1136</span></a>    <span class="c1"># You can also put Speech into ROM, but this can cause problems: see comments on SP8000 later.</span>
</span><span id="LexFormats-1137"><a href="#LexFormats-1137"><span class="linenos">1137</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1138"><a href="#LexFormats-1138"><span class="linenos">1138</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1139"><a href="#LexFormats-1139"><span class="linenos">1139</span></a>    <span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span> <span class="c1"># (these are pitch numbers on the BBC; normal pitch is 6, and lower numbers are higher pitches, so try 5=secondary and 4=primary; 3 sounds less calm)</span>
</span><span id="LexFormats-1140"><a href="#LexFormats-1140"><span class="linenos">1140</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1141"><a href="#LexFormats-1141"><span class="linenos">1141</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1142"><a href="#LexFormats-1142"><span class="linenos">1142</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1143"><a href="#LexFormats-1143"><span class="linenos">1143</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1144"><a href="#LexFormats-1144"><span class="linenos">1144</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1145"><a href="#LexFormats-1145"><span class="linenos">1145</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1146"><a href="#LexFormats-1146"><span class="linenos">1146</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1147"><a href="#LexFormats-1147"><span class="linenos">1147</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1148"><a href="#LexFormats-1148"><span class="linenos">1148</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1149"><a href="#LexFormats-1149"><span class="linenos">1149</span></a>    <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1150"><a href="#LexFormats-1150"><span class="linenos">1150</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1151"><a href="#LexFormats-1151"><span class="linenos">1151</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1152"><a href="#LexFormats-1152"><span class="linenos">1152</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1153"><a href="#LexFormats-1153"><span class="linenos">1153</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1154"><a href="#LexFormats-1154"><span class="linenos">1154</span></a>    <span class="p">(</span><span class="s1">&#39;AI&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1155"><a href="#LexFormats-1155"><span class="linenos">1155</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1156"><a href="#LexFormats-1156"><span class="linenos">1156</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1157"><a href="#LexFormats-1157"><span class="linenos">1157</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1158"><a href="#LexFormats-1158"><span class="linenos">1158</span></a>    <span class="p">(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1159"><a href="#LexFormats-1159"><span class="linenos">1159</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1160"><a href="#LexFormats-1160"><span class="linenos">1160</span></a>    <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">var2_i_as_in_it</span><span class="p">),</span> <span class="c1"># (IX sounds to me like a slightly shorter version of IH)</span>
</span><span id="LexFormats-1161"><a href="#LexFormats-1161"><span class="linenos">1161</span></a>    <span class="p">(</span><span class="s1">&#39;IXAH&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1162"><a href="#LexFormats-1162"><span class="linenos">1162</span></a>    <span class="p">(</span><span class="s1">&#39;EER&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># e.g. &#39;hear&#39;, &#39;near&#39; - near enough</span>
</span><span id="LexFormats-1163"><a href="#LexFormats-1163"><span class="linenos">1163</span></a>    <span class="p">(</span><span class="s1">&#39;EE&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1164"><a href="#LexFormats-1164"><span class="linenos">1164</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1165"><a href="#LexFormats-1165"><span class="linenos">1165</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1166"><a href="#LexFormats-1166"><span class="linenos">1166</span></a>    <span class="p">(</span><span class="s1">&#39;C&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># for CT as in &quot;fact&quot;, read out as K+T</span>
</span><span id="LexFormats-1167"><a href="#LexFormats-1167"><span class="linenos">1167</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1168"><a href="#LexFormats-1168"><span class="linenos">1168</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1169"><a href="#LexFormats-1169"><span class="linenos">1169</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1170"><a href="#LexFormats-1170"><span class="linenos">1170</span></a>    <span class="p">(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1171"><a href="#LexFormats-1171"><span class="linenos">1171</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1172"><a href="#LexFormats-1172"><span class="linenos">1172</span></a>    <span class="p">(</span><span class="s1">&#39;OL&#39;</span><span class="p">,</span><span class="n">opt_ol_as_in_gold</span><span class="p">),</span> <span class="c1"># (if dest format doesn&#39;t have this, it&#39;ll get o_as_in_orange from the O, then the l)</span>
</span><span id="LexFormats-1173"><a href="#LexFormats-1173"><span class="linenos">1173</span></a>    <span class="p">(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1174"><a href="#LexFormats-1174"><span class="linenos">1174</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1175"><a href="#LexFormats-1175"><span class="linenos">1175</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1176"><a href="#LexFormats-1176"><span class="linenos">1176</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1177"><a href="#LexFormats-1177"><span class="linenos">1177</span></a>    <span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1178"><a href="#LexFormats-1178"><span class="linenos">1178</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1179"><a href="#LexFormats-1179"><span class="linenos">1179</span></a>    <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1180"><a href="#LexFormats-1180"><span class="linenos">1180</span></a>    <span class="p">(</span><span class="s1">&#39;AOR&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1181"><a href="#LexFormats-1181"><span class="linenos">1181</span></a>    <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really? (espeak &#39;U&#39; goes to opt_u_as_in_pull, and eSpeak also used U for the o in good, which sounds best with Speech&#39;s default UH4, hence the line below, but where did we get UH-&gt;oor_as_in_poor from?  Low-priority though because how often do you convert OUT of bbcmicro format)</span>
</span><span id="LexFormats-1182"><a href="#LexFormats-1182"><span class="linenos">1182</span></a>    <span class="p">(</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1183"><a href="#LexFormats-1183"><span class="linenos">1183</span></a>    <span class="p">(</span><span class="s1">&#39;/U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1184"><a href="#LexFormats-1184"><span class="linenos">1184</span></a>    <span class="p">(</span><span class="s1">&#39;/UL&#39;</span><span class="p">,</span><span class="n">opt_ul_as_in_pull</span><span class="p">),</span> <span class="c1"># if dest format doesn&#39;t have this, it&#39;ll get opt_u_as_in_pull from the /U, then l</span>
</span><span id="LexFormats-1185"><a href="#LexFormats-1185"><span class="linenos">1185</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1186"><a href="#LexFormats-1186"><span class="linenos">1186</span></a>    <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1187"><a href="#LexFormats-1187"><span class="linenos">1187</span></a>    <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1188"><a href="#LexFormats-1188"><span class="linenos">1188</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1189"><a href="#LexFormats-1189"><span class="linenos">1189</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1190"><a href="#LexFormats-1190"><span class="linenos">1190</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1191"><a href="#LexFormats-1191"><span class="linenos">1191</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1192"><a href="#LexFormats-1192"><span class="linenos">1192</span></a>    <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1193"><a href="#LexFormats-1193"><span class="linenos">1193</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="s2">&quot;SPEECH.ROM&quot;</span><span class="p">,</span><span class="s2">&quot;BBCLEX&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1194"><a href="#LexFormats-1194"><span class="linenos">1194</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt; </span><span class="si">%s</span><span class="s2">_&quot;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># (specifying &#39;whole word&#39; for now; remove the space before or the _ after if you want)</span>
</span><span id="LexFormats-1195"><a href="#LexFormats-1195"><span class="linenos">1195</span></a>    <span class="n">lex_read_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">lexfile</span><span class="p">:</span> <span class="p">[(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span><span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">,[</span><span class="n">w</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">lexfile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">)])],</span> <span class="c1"># TODO: this reads back the entries we generate, but is unlikely to work well with the wildcards in the default lexicon that would have been added if SPEECH_DISK was set (c.f. trying to read eSpeak&#39;s en_rules instead of en_extra)</span>
</span><span id="LexFormats-1196"><a href="#LexFormats-1196"><span class="linenos">1196</span></a>    <span class="n">lex_word_case</span> <span class="o">=</span> <span class="s2">&quot;upper&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1197"><a href="#LexFormats-1197"><span class="linenos">1197</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="n">bbc_prepDefaultLex</span><span class="p">,</span>
</span><span id="LexFormats-1198"><a href="#LexFormats-1198"><span class="linenos">1198</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="n">bbc_appendDefaultLex</span><span class="p">,</span> <span class="c1"># + &quot;&gt;**&quot;</span>
</span><span id="LexFormats-1199"><a href="#LexFormats-1199"><span class="linenos">1199</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="n">markup_bbcMicro_word</span><span class="p">,</span>
</span><span id="LexFormats-1200"><a href="#LexFormats-1200"><span class="linenos">1200</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1201"><a href="#LexFormats-1201"><span class="linenos">1201</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="n">write_bbcmicro_phones</span><span class="p">,</span> <span class="c1"># special case</span>
</span><span id="LexFormats-1202"><a href="#LexFormats-1202"><span class="linenos">1202</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1203"><a href="#LexFormats-1203"><span class="linenos">1203</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="LexFormats-1204"><a href="#LexFormats-1204"><span class="linenos">1204</span></a>      <span class="p">(</span><span class="s1">&#39;KT&#39;</span><span class="p">,</span><span class="s1">&#39;CT&#39;</span><span class="p">),</span> <span class="c1"># Speech instructions: &quot;CT as in fact&quot;</span>
</span><span id="LexFormats-1205"><a href="#LexFormats-1205"><span class="linenos">1205</span></a>      <span class="p">(</span><span class="s1">&#39;DYUW&#39;</span><span class="p">,</span><span class="s1">&#39;DUX&#39;</span><span class="p">),</span> <span class="c1"># &quot;DUX as in duke&quot;</span>
</span><span id="LexFormats-1206"><a href="#LexFormats-1206"><span class="linenos">1206</span></a>      <span class="p">(</span><span class="s1">&#39;AHR$&#39;</span><span class="p">,</span><span class="s1">&#39;AH&#39;</span><span class="p">),</span> <span class="c1"># usually sounds a bit better</span>
</span><span id="LexFormats-1207"><a href="#LexFormats-1207"><span class="linenos">1207</span></a>    <span class="p">],</span>
</span><span id="LexFormats-1208"><a href="#LexFormats-1208"><span class="linenos">1208</span></a>    <span class="n">cvtOut_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;DUX&#39;</span><span class="p">,</span><span class="s1">&#39;DYUW&#39;</span><span class="p">)],</span> <span class="c1"># CT handled above</span>
</span><span id="LexFormats-1209"><a href="#LexFormats-1209"><span class="linenos">1209</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1210"><a href="#LexFormats-1210"><span class="linenos">1210</span></a>  <span class="s2">&quot;bbcmicro-cc&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1211"><a href="#LexFormats-1211"><span class="linenos">1211</span></a>     <span class="s2">&quot;Computer Concepts Speech ROM which provided phonemes for the BBC Micro&#39;s TMS5220 </span><span class="se">\&quot;</span><span class="s2">speech chip</span><span class="se">\&quot;</span><span class="s2"> add-on (less widely sold than the software-only product)&quot;</span><span class="p">,</span> <span class="c1"># (and harder to run on an emulator.  It wasn&#39;t the only phoneme ROM, e.g. Easytalk Speech Utility ROM by Galaxy, reviewed in Beebug Jan/Feb 1985 (3.8) p.32, expanded on Acorn&#39;s original PHROM with commands like *SAY Y.U:N.I.V.ER.S but we don&#39;t know all the phonemes; there were also some allophone-based hardware boards)</span>
</span><span id="LexFormats-1212"><a href="#LexFormats-1212"><span class="linenos">1212</span></a>     <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1213"><a href="#LexFormats-1213"><span class="linenos">1213</span></a>     <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1214"><a href="#LexFormats-1214"><span class="linenos">1214</span></a>     <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1215"><a href="#LexFormats-1215"><span class="linenos">1215</span></a>     <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),(</span><span class="s1">&#39;AR&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1216"><a href="#LexFormats-1216"><span class="linenos">1216</span></a>     <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),(</span><span class="s1">&#39;OR&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1217"><a href="#LexFormats-1217"><span class="linenos">1217</span></a>     <span class="p">(</span><span class="s1">&#39;OO&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1218"><a href="#LexFormats-1218"><span class="linenos">1218</span></a>     <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1219"><a href="#LexFormats-1219"><span class="linenos">1219</span></a>     <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;EA&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),(</span><span class="s1">&#39;ea&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1220"><a href="#LexFormats-1220"><span class="linenos">1220</span></a>     <span class="p">(</span><span class="s1">&#39;UR&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1221"><a href="#LexFormats-1221"><span class="linenos">1221</span></a>     <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1222"><a href="#LexFormats-1222"><span class="linenos">1222</span></a>     <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1223"><a href="#LexFormats-1223"><span class="linenos">1223</span></a>     <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1224"><a href="#LexFormats-1224"><span class="linenos">1224</span></a>     <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1225"><a href="#LexFormats-1225"><span class="linenos">1225</span></a>     <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1226"><a href="#LexFormats-1226"><span class="linenos">1226</span></a>     <span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1227"><a href="#LexFormats-1227"><span class="linenos">1227</span></a>     <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NG&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1228"><a href="#LexFormats-1228"><span class="linenos">1228</span></a>     <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1229"><a href="#LexFormats-1229"><span class="linenos">1229</span></a>     <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1230"><a href="#LexFormats-1230"><span class="linenos">1230</span></a>     <span class="n">inline_header</span><span class="o">=</span><span class="s2">&quot;*UTTER &lt;1&gt; &quot;</span><span class="p">,</span>
</span><span id="LexFormats-1231"><a href="#LexFormats-1231"><span class="linenos">1231</span></a>     <span class="n">clause_separator</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">*UTTER &lt;1&gt; &quot;</span><span class="p">,</span> <span class="c1"># TODO: manual does not say what the maximum length is; longest parameter in examples is 80 bytes; should we use inline_format to make each WORD a separate command?</span>
</span><span id="LexFormats-1232"><a href="#LexFormats-1232"><span class="linenos">1232</span></a>     <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;[*] &#39;</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">),(</span><span class="s1">&#39;[+] &#39;</span><span class="p">,</span><span class="s1">&#39;+&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-1233"><a href="#LexFormats-1233"><span class="linenos">1233</span></a>     <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="s1">&#39; &#39;</span><span class="p">,</span>
</span><span id="LexFormats-1234"><a href="#LexFormats-1234"><span class="linenos">1234</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1235"><a href="#LexFormats-1235"><span class="linenos">1235</span></a>     
</span><span id="LexFormats-1236"><a href="#LexFormats-1236"><span class="linenos">1236</span></a>  <span class="s2">&quot;amiga&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1237"><a href="#LexFormats-1237"><span class="linenos">1237</span></a>    <span class="s1">&#39;AmigaOS speech synthesizer (American English)&#39;</span><span class="p">,</span> <span class="c1"># shipped with the 1985 Amiga release; developed by SoftVoice Inc</span>
</span><span id="LexFormats-1238"><a href="#LexFormats-1238"><span class="linenos">1238</span></a>    <span class="c1"># All I had to go by for this was a screenshot on Marcos Miranda&#39;s &quot;blog&quot;.  I once saw this synth demonstrated but never tried it.  My early background was the BBC Micro, not Amigas etc.  But I know some people are keen on Amigas so I might as well include it.</span>
</span><span id="LexFormats-1239"><a href="#LexFormats-1239"><span class="linenos">1239</span></a>    <span class="c1"># (By the way I think David Hoskins had it harder than SoftVoice.  Yes they were both in 1985, but the Amiga was a new 16-bit machine while the BBC was an older 8-bit one.  See the &quot;sam&quot; format for an even older one though, although probably not written by one person.)</span>
</span><span id="LexFormats-1240"><a href="#LexFormats-1240"><span class="linenos">1240</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1241"><a href="#LexFormats-1241"><span class="linenos">1241</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1242"><a href="#LexFormats-1242"><span class="linenos">1242</span></a>    <span class="p">(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1243"><a href="#LexFormats-1243"><span class="linenos">1243</span></a>    <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1244"><a href="#LexFormats-1244"><span class="linenos">1244</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1245"><a href="#LexFormats-1245"><span class="linenos">1245</span></a>    <span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1246"><a href="#LexFormats-1246"><span class="linenos">1246</span></a>    <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1247"><a href="#LexFormats-1247"><span class="linenos">1247</span></a>    <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1248"><a href="#LexFormats-1248"><span class="linenos">1248</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1249"><a href="#LexFormats-1249"><span class="linenos">1249</span></a>    <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1250"><a href="#LexFormats-1250"><span class="linenos">1250</span></a>    <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1251"><a href="#LexFormats-1251"><span class="linenos">1251</span></a>    <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1252"><a href="#LexFormats-1252"><span class="linenos">1252</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1253"><a href="#LexFormats-1253"><span class="linenos">1253</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1254"><a href="#LexFormats-1254"><span class="linenos">1254</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1255"><a href="#LexFormats-1255"><span class="linenos">1255</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1256"><a href="#LexFormats-1256"><span class="linenos">1256</span></a>    <span class="p">(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1257"><a href="#LexFormats-1257"><span class="linenos">1257</span></a>    <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1258"><a href="#LexFormats-1258"><span class="linenos">1258</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1259"><a href="#LexFormats-1259"><span class="linenos">1259</span></a>    <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1260"><a href="#LexFormats-1260"><span class="linenos">1260</span></a>    <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1261"><a href="#LexFormats-1261"><span class="linenos">1261</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1262"><a href="#LexFormats-1262"><span class="linenos">1262</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1263"><a href="#LexFormats-1263"><span class="linenos">1263</span></a>    <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1264"><a href="#LexFormats-1264"><span class="linenos">1264</span></a>    <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1265"><a href="#LexFormats-1265"><span class="linenos">1265</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1266"><a href="#LexFormats-1266"><span class="linenos">1266</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1267"><a href="#LexFormats-1267"><span class="linenos">1267</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1268"><a href="#LexFormats-1268"><span class="linenos">1268</span></a>    <span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1269"><a href="#LexFormats-1269"><span class="linenos">1269</span></a>    <span class="c1"># The following consonants were not on the screenshot</span>
</span><span id="LexFormats-1270"><a href="#LexFormats-1270"><span class="linenos">1270</span></a>    <span class="c1"># (or at least I couldn&#39;t find them) so I&#39;m guessing.</span>
</span><span id="LexFormats-1271"><a href="#LexFormats-1271"><span class="linenos">1271</span></a>    <span class="c1"># I think this should work given the way the other</span>
</span><span id="LexFormats-1272"><a href="#LexFormats-1272"><span class="linenos">1272</span></a>    <span class="c1"># consonants work in this table.</span>
</span><span id="LexFormats-1273"><a href="#LexFormats-1273"><span class="linenos">1273</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1274"><a href="#LexFormats-1274"><span class="linenos">1274</span></a>    <span class="c1"># The following vowels were not in the screenshot and</span>
</span><span id="LexFormats-1275"><a href="#LexFormats-1275"><span class="linenos">1275</span></a>    <span class="c1"># we just have to hope this guess is right - when</span>
</span><span id="LexFormats-1276"><a href="#LexFormats-1276"><span class="linenos">1276</span></a>    <span class="c1"># someone tries it on an Amiga and says it doesn&#39;t</span>
</span><span id="LexFormats-1277"><a href="#LexFormats-1277"><span class="linenos">1277</span></a>    <span class="c1"># work, maybe we can update this....</span>
</span><span id="LexFormats-1278"><a href="#LexFormats-1278"><span class="linenos">1278</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1279"><a href="#LexFormats-1279"><span class="linenos">1279</span></a>    <span class="c1"># and these ones we can approximate to ones we already know (given that we&#39;re having to approximate British to an American voice anyway, it can&#39;t hurt TOO much more)</span>
</span><span id="LexFormats-1280"><a href="#LexFormats-1280"><span class="linenos">1280</span></a>     <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1281"><a href="#LexFormats-1281"><span class="linenos">1281</span></a>     <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1282"><a href="#LexFormats-1282"><span class="linenos">1282</span></a>     <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1283"><a href="#LexFormats-1283"><span class="linenos">1283</span></a>     <span class="p">(</span><span class="n">ear</span><span class="p">,</span><span class="s1">&#39;IYAH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># or try IYER, or there might be a phoneme for it</span>
</span><span id="LexFormats-1284"><a href="#LexFormats-1284"><span class="linenos">1284</span></a>     <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1285"><a href="#LexFormats-1285"><span class="linenos">1285</span></a>     <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1286"><a href="#LexFormats-1286"><span class="linenos">1286</span></a>    <span class="c1"># lex_filename not set (I have no idea how the Amiga lexicon worked)</span>
</span><span id="LexFormats-1287"><a href="#LexFormats-1287"><span class="linenos">1287</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1288"><a href="#LexFormats-1288"><span class="linenos">1288</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1289"><a href="#LexFormats-1289"><span class="linenos">1289</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1290"><a href="#LexFormats-1290"><span class="linenos">1290</span></a>  <span class="s2">&quot;sam&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1291"><a href="#LexFormats-1291"><span class="linenos">1291</span></a>  <span class="s1">&#39;Software Automatic Mouth (1982 American English synth that ran on C64, Atari 400/800/etc and Apple II/etc)&#39;</span><span class="p">,</span> <span class="c1"># *might* be similar to Macintalk on the 1st Macintosh in 1984</span>
</span><span id="LexFormats-1292"><a href="#LexFormats-1292"><span class="linenos">1292</span></a>  <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1293"><a href="#LexFormats-1293"><span class="linenos">1293</span></a>  <span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;4&#39;</span><span class="p">),</span>
</span><span id="LexFormats-1294"><a href="#LexFormats-1294"><span class="linenos">1294</span></a>  <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;5&#39;</span><span class="p">),</span>
</span><span id="LexFormats-1295"><a href="#LexFormats-1295"><span class="linenos">1295</span></a>  <span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1296"><a href="#LexFormats-1296"><span class="linenos">1296</span></a>  <span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1297"><a href="#LexFormats-1297"><span class="linenos">1297</span></a>  <span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1298"><a href="#LexFormats-1298"><span class="linenos">1298</span></a>  <span class="p">(</span><span class="s1">&#39;AE&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1299"><a href="#LexFormats-1299"><span class="linenos">1299</span></a>  <span class="p">(</span><span class="s1">&#39;AA&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1300"><a href="#LexFormats-1300"><span class="linenos">1300</span></a>  <span class="p">(</span><span class="s1">&#39;AH&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1301"><a href="#LexFormats-1301"><span class="linenos">1301</span></a>  <span class="p">(</span><span class="s1">&#39;AO&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1302"><a href="#LexFormats-1302"><span class="linenos">1302</span></a>  <span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1303"><a href="#LexFormats-1303"><span class="linenos">1303</span></a>  <span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1304"><a href="#LexFormats-1304"><span class="linenos">1304</span></a>  <span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1305"><a href="#LexFormats-1305"><span class="linenos">1305</span></a>  <span class="p">(</span><span class="s1">&#39;ER&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1306"><a href="#LexFormats-1306"><span class="linenos">1306</span></a>  <span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="LexFormats-1307"><a href="#LexFormats-1307"><span class="linenos">1307</span></a>  <span class="p">(</span><span class="s1">&#39;IX&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="LexFormats-1308"><a href="#LexFormats-1308"><span class="linenos">1308</span></a>  <span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1309"><a href="#LexFormats-1309"><span class="linenos">1309</span></a>  <span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),(</span><span class="s1">&#39;OY&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1310"><a href="#LexFormats-1310"><span class="linenos">1310</span></a>  <span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1311"><a href="#LexFormats-1311"><span class="linenos">1311</span></a>  <span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># allophone?</span>
</span><span id="LexFormats-1312"><a href="#LexFormats-1312"><span class="linenos">1312</span></a>  <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),(</span><span class="s1">&#39;Y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1313"><a href="#LexFormats-1313"><span class="linenos">1313</span></a>  <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),(</span><span class="s1">&#39;NX&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1314"><a href="#LexFormats-1314"><span class="linenos">1314</span></a>  <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1315"><a href="#LexFormats-1315"><span class="linenos">1315</span></a>  <span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1316"><a href="#LexFormats-1316"><span class="linenos">1316</span></a>  <span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1317"><a href="#LexFormats-1317"><span class="linenos">1317</span></a>  <span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),(</span><span class="s1">&#39;/H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),(</span><span class="s1">&#39;Q&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="LexFormats-1318"><a href="#LexFormats-1318"><span class="linenos">1318</span></a>  <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1319"><a href="#LexFormats-1319"><span class="linenos">1319</span></a>  <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1320"><a href="#LexFormats-1320"><span class="linenos">1320</span></a>  <span class="c1"># TODO: inline_format etc similar to bbcmicro?</span>
</span><span id="LexFormats-1321"><a href="#LexFormats-1321"><span class="linenos">1321</span></a>  <span class="c1"># In Atari BASIC, you set SAM$ to the phonemes and then</span>
</span><span id="LexFormats-1322"><a href="#LexFormats-1322"><span class="linenos">1322</span></a>  <span class="c1"># do A=USR(8192).  I don&#39;t know about the C64 etc versions.</span>
</span><span id="LexFormats-1323"><a href="#LexFormats-1323"><span class="linenos">1323</span></a>  <span class="c1"># (max 255 phonemes per string; don&#39;t know max line len.)</span>
</span><span id="LexFormats-1324"><a href="#LexFormats-1324"><span class="linenos">1324</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1325"><a href="#LexFormats-1325"><span class="linenos">1325</span></a>  <span class="c1"># END (?) PRE-32bit ERA SYNTHS (but see TODO above re SpeakJet, which is below)</span>
</span><span id="LexFormats-1326"><a href="#LexFormats-1326"><span class="linenos">1326</span></a>
</span><span id="LexFormats-1327"><a href="#LexFormats-1327"><span class="linenos">1327</span></a>  <span class="s2">&quot;speakjet&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1328"><a href="#LexFormats-1328"><span class="linenos">1328</span></a>    <span class="s1">&#39;Allophone codes for the American English &quot;SpeakJet&quot; speech synthesis chip (the conversion from phonemes to allophones might need tweaking).  Set the SPEAKJET_SYM environment variable to use mnemonics, otherwise numbers are used (set SPEAKJET_BINARY for binary output).&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1329"><a href="#LexFormats-1329"><span class="linenos">1329</span></a>  <span class="c1"># TODO: might want to do something similar for the older Votrax SC-02 chip, but would need to check how exactly its phoneme interface was exposed to software by the PC cards that used it (Heathkit HV-2000 etc; not sure if any are still in use though)</span>
</span><span id="LexFormats-1330"><a href="#LexFormats-1330"><span class="linenos">1330</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: instead of having emphasis, the Speakjet has a &#39;faster&#39; code for all NON-emphasized syllables</span>
</span><span id="LexFormats-1331"><a href="#LexFormats-1331"><span class="linenos">1331</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IY&#39;</span><span class="p">,</span><span class="mi">128</span><span class="p">),</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1332"><a href="#LexFormats-1332"><span class="linenos">1332</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IH&#39;</span><span class="p">,</span><span class="mi">129</span><span class="p">),</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1333"><a href="#LexFormats-1333"><span class="linenos">1333</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EY&#39;</span><span class="p">,</span><span class="mi">130</span><span class="p">),</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1334"><a href="#LexFormats-1334"><span class="linenos">1334</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EH&#39;</span><span class="p">,</span><span class="mi">131</span><span class="p">),</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1335"><a href="#LexFormats-1335"><span class="linenos">1335</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AY&#39;</span><span class="p">,</span><span class="mi">132</span><span class="p">),</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1336"><a href="#LexFormats-1336"><span class="linenos">1336</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AX&#39;</span><span class="p">,</span><span class="mi">133</span><span class="p">),</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1337"><a href="#LexFormats-1337"><span class="linenos">1337</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UX&#39;</span><span class="p">,</span><span class="mi">134</span><span class="p">),</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1338"><a href="#LexFormats-1338"><span class="linenos">1338</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OH&#39;</span><span class="p">,</span><span class="mi">135</span><span class="p">),</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1339"><a href="#LexFormats-1339"><span class="linenos">1339</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AW&#39;</span><span class="p">,</span><span class="mi">136</span><span class="p">),</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1340"><a href="#LexFormats-1340"><span class="linenos">1340</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OW&#39;</span><span class="p">,</span><span class="mi">137</span><span class="p">),</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1341"><a href="#LexFormats-1341"><span class="linenos">1341</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UH&#39;</span><span class="p">,</span><span class="mi">138</span><span class="p">),</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1342"><a href="#LexFormats-1342"><span class="linenos">1342</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;UW&#39;</span><span class="p">,</span><span class="mi">139</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1343"><a href="#LexFormats-1343"><span class="linenos">1343</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;MM&#39;</span><span class="p">,</span><span class="mi">140</span><span class="p">),</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1344"><a href="#LexFormats-1344"><span class="linenos">1344</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NE&#39;</span><span class="p">,</span><span class="mi">141</span><span class="p">),</span><span class="n">n</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1345"><a href="#LexFormats-1345"><span class="linenos">1345</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NO&#39;</span><span class="p">,</span><span class="mi">142</span><span class="p">),</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1346"><a href="#LexFormats-1346"><span class="linenos">1346</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NGE&#39;</span><span class="p">,</span><span class="mi">143</span><span class="p">),</span><span class="n">ng</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1347"><a href="#LexFormats-1347"><span class="linenos">1347</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;NGO&#39;</span><span class="p">,</span><span class="mi">144</span><span class="p">),</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1348"><a href="#LexFormats-1348"><span class="linenos">1348</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;LE&#39;</span><span class="p">,</span><span class="mi">145</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1349"><a href="#LexFormats-1349"><span class="linenos">1349</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;LO&#39;</span><span class="p">,</span><span class="mi">146</span><span class="p">),</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1350"><a href="#LexFormats-1350"><span class="linenos">1350</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;WW&#39;</span><span class="p">,</span><span class="mi">147</span><span class="p">),</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1351"><a href="#LexFormats-1351"><span class="linenos">1351</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;RR&#39;</span><span class="p">,</span><span class="mi">148</span><span class="p">),</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1352"><a href="#LexFormats-1352"><span class="linenos">1352</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYRR&#39;</span><span class="p">,</span><span class="mi">149</span><span class="p">),</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1353"><a href="#LexFormats-1353"><span class="linenos">1353</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EYRR&#39;</span><span class="p">,</span><span class="mi">150</span><span class="p">),</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1354"><a href="#LexFormats-1354"><span class="linenos">1354</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AXRR&#39;</span><span class="p">,</span><span class="mi">151</span><span class="p">),</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1355"><a href="#LexFormats-1355"><span class="linenos">1355</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AWRR&#39;</span><span class="p">,</span><span class="mi">152</span><span class="p">),</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1356"><a href="#LexFormats-1356"><span class="linenos">1356</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWRR&#39;</span><span class="p">,</span><span class="mi">153</span><span class="p">),</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1357"><a href="#LexFormats-1357"><span class="linenos">1357</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EYIY&#39;</span><span class="p">,</span><span class="mi">154</span><span class="p">),</span><span class="n">a_as_in_ate</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1358"><a href="#LexFormats-1358"><span class="linenos">1358</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OHIY&#39;</span><span class="p">,</span><span class="mi">155</span><span class="p">),</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1359"><a href="#LexFormats-1359"><span class="linenos">1359</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWIY&#39;</span><span class="p">,</span><span class="mi">156</span><span class="p">),</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1360"><a href="#LexFormats-1360"><span class="linenos">1360</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OHIH&#39;</span><span class="p">,</span><span class="mi">157</span><span class="p">),</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1361"><a href="#LexFormats-1361"><span class="linenos">1361</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYEH&#39;</span><span class="p">,</span><span class="mi">158</span><span class="p">),</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1362"><a href="#LexFormats-1362"><span class="linenos">1362</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EHLL&#39;</span><span class="p">,</span><span class="mi">159</span><span class="p">),</span><span class="n">l</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1363"><a href="#LexFormats-1363"><span class="linenos">1363</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IYUW&#39;</span><span class="p">,</span><span class="mi">160</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1364"><a href="#LexFormats-1364"><span class="linenos">1364</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;AXUW&#39;</span><span class="p">,</span><span class="mi">161</span><span class="p">),</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1365"><a href="#LexFormats-1365"><span class="linenos">1365</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;IHUW&#39;</span><span class="p">,</span><span class="mi">162</span><span class="p">),</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1366"><a href="#LexFormats-1366"><span class="linenos">1366</span></a>    <span class="c1"># TODO: 163 AYWW = o_as_in_now a_as_in_ago ? handle in cleanup_regexps + cvtOut_regexps ?</span>
</span><span id="LexFormats-1367"><a href="#LexFormats-1367"><span class="linenos">1367</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OWWW&#39;</span><span class="p">,</span><span class="mi">164</span><span class="p">),</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1368"><a href="#LexFormats-1368"><span class="linenos">1368</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;JH&#39;</span><span class="p">,</span><span class="mi">165</span><span class="p">),</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1369"><a href="#LexFormats-1369"><span class="linenos">1369</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;VV&#39;</span><span class="p">,</span><span class="mi">166</span><span class="p">),</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1370"><a href="#LexFormats-1370"><span class="linenos">1370</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ZZ&#39;</span><span class="p">,</span><span class="mi">167</span><span class="p">),</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1371"><a href="#LexFormats-1371"><span class="linenos">1371</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ZH&#39;</span><span class="p">,</span><span class="mi">168</span><span class="p">),</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1372"><a href="#LexFormats-1372"><span class="linenos">1372</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DH&#39;</span><span class="p">,</span><span class="mi">169</span><span class="p">),</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1373"><a href="#LexFormats-1373"><span class="linenos">1373</span></a>    <span class="c1"># TODO: get cleanup_regexps to clean up some of these according to what&#39;s coming next etc:</span>
</span><span id="LexFormats-1374"><a href="#LexFormats-1374"><span class="linenos">1374</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;BE&#39;</span><span class="p">,</span><span class="mi">170</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1375"><a href="#LexFormats-1375"><span class="linenos">1375</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;BO&#39;</span><span class="p">,</span><span class="mi">171</span><span class="p">),</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1376"><a href="#LexFormats-1376"><span class="linenos">1376</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EB&#39;</span><span class="p">,</span><span class="mi">172</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1377"><a href="#LexFormats-1377"><span class="linenos">1377</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OB&#39;</span><span class="p">,</span><span class="mi">173</span><span class="p">),</span><span class="n">b</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1378"><a href="#LexFormats-1378"><span class="linenos">1378</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DE&#39;</span><span class="p">,</span><span class="mi">174</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1379"><a href="#LexFormats-1379"><span class="linenos">1379</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;DO&#39;</span><span class="p">,</span><span class="mi">175</span><span class="p">),</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1380"><a href="#LexFormats-1380"><span class="linenos">1380</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;ED&#39;</span><span class="p">,</span><span class="mi">176</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1381"><a href="#LexFormats-1381"><span class="linenos">1381</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OD&#39;</span><span class="p">,</span><span class="mi">177</span><span class="p">),</span><span class="n">d</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1382"><a href="#LexFormats-1382"><span class="linenos">1382</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;GE&#39;</span><span class="p">,</span><span class="mi">178</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1383"><a href="#LexFormats-1383"><span class="linenos">1383</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;GO&#39;</span><span class="p">,</span><span class="mi">179</span><span class="p">),</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1384"><a href="#LexFormats-1384"><span class="linenos">1384</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EG&#39;</span><span class="p">,</span><span class="mi">180</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1385"><a href="#LexFormats-1385"><span class="linenos">1385</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OG&#39;</span><span class="p">,</span><span class="mi">181</span><span class="p">),</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1386"><a href="#LexFormats-1386"><span class="linenos">1386</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;CH&#39;</span><span class="p">,</span><span class="mi">182</span><span class="p">),</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1387"><a href="#LexFormats-1387"><span class="linenos">1387</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;HE&#39;</span><span class="p">,</span><span class="mi">183</span><span class="p">),</span><span class="n">h</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1388"><a href="#LexFormats-1388"><span class="linenos">1388</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;HO&#39;</span><span class="p">,</span><span class="mi">184</span><span class="p">),</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1389"><a href="#LexFormats-1389"><span class="linenos">1389</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;WH&#39;</span><span class="p">,</span><span class="mi">185</span><span class="p">),</span><span class="n">w</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1390"><a href="#LexFormats-1390"><span class="linenos">1390</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;FF&#39;</span><span class="p">,</span><span class="mi">186</span><span class="p">),</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1391"><a href="#LexFormats-1391"><span class="linenos">1391</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SE&#39;</span><span class="p">,</span><span class="mi">187</span><span class="p">),</span><span class="n">s</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1392"><a href="#LexFormats-1392"><span class="linenos">1392</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SO&#39;</span><span class="p">,</span><span class="mi">188</span><span class="p">),</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1393"><a href="#LexFormats-1393"><span class="linenos">1393</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;SH&#39;</span><span class="p">,</span><span class="mi">189</span><span class="p">),</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1394"><a href="#LexFormats-1394"><span class="linenos">1394</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TH&#39;</span><span class="p">,</span><span class="mi">190</span><span class="p">),</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1395"><a href="#LexFormats-1395"><span class="linenos">1395</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TT&#39;</span><span class="p">,</span><span class="mi">191</span><span class="p">),</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1396"><a href="#LexFormats-1396"><span class="linenos">1396</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;TU&#39;</span><span class="p">,</span><span class="mi">192</span><span class="p">),</span><span class="n">t</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1397"><a href="#LexFormats-1397"><span class="linenos">1397</span></a>    <span class="c1"># TODO: 193 TS in cleanup_regexps and cvtOut_regexps</span>
</span><span id="LexFormats-1398"><a href="#LexFormats-1398"><span class="linenos">1398</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;KE&#39;</span><span class="p">,</span><span class="mi">194</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1399"><a href="#LexFormats-1399"><span class="linenos">1399</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;KO&#39;</span><span class="p">,</span><span class="mi">195</span><span class="p">),</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1400"><a href="#LexFormats-1400"><span class="linenos">1400</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;EK&#39;</span><span class="p">,</span><span class="mi">196</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1401"><a href="#LexFormats-1401"><span class="linenos">1401</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;OK&#39;</span><span class="p">,</span><span class="mi">197</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1402"><a href="#LexFormats-1402"><span class="linenos">1402</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;PE&#39;</span><span class="p">,</span><span class="mi">198</span><span class="p">),</span><span class="n">p</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1403"><a href="#LexFormats-1403"><span class="linenos">1403</span></a>    <span class="p">(</span><span class="n">speakjet</span><span class="p">(</span><span class="s1">&#39;PO&#39;</span><span class="p">,</span><span class="mi">199</span><span class="p">),</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1404"><a href="#LexFormats-1404"><span class="linenos">1404</span></a>    <span class="c1"># lex_filename not set (I think the front-end software might have one, but don&#39;t know if it&#39;s accessible; chip itself just takes phonemes)</span>
</span><span id="LexFormats-1405"><a href="#LexFormats-1405"><span class="linenos">1405</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1406"><a href="#LexFormats-1406"><span class="linenos">1406</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="LexFormats-1407"><a href="#LexFormats-1407"><span class="linenos">1407</span></a>    <span class="n">phoneme_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span>
</span><span id="LexFormats-1408"><a href="#LexFormats-1408"><span class="linenos">1408</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># TODO: is there a pause code?</span>
</span><span id="LexFormats-1409"><a href="#LexFormats-1409"><span class="linenos">1409</span></a>    <span class="n">output_is_binary</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LexFormats-1410"><a href="#LexFormats-1410"><span class="linenos">1410</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1411"><a href="#LexFormats-1411"><span class="linenos">1411</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1412"><a href="#LexFormats-1412"><span class="linenos">1412</span></a>
</span><span id="LexFormats-1413"><a href="#LexFormats-1413"><span class="linenos">1413</span></a>  <span class="s2">&quot;rsynth&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1414"><a href="#LexFormats-1414"><span class="linenos">1414</span></a>    <span class="s1">&#39;rsynth text-to-speech C library (American English)&#39;</span><span class="p">,</span> <span class="c1"># TODO: test</span>
</span><span id="LexFormats-1415"><a href="#LexFormats-1415"><span class="linenos">1415</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: emphasis?</span>
</span><span id="LexFormats-1416"><a href="#LexFormats-1416"><span class="linenos">1416</span></a>    <span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1417"><a href="#LexFormats-1417"><span class="linenos">1417</span></a>    <span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1418"><a href="#LexFormats-1418"><span class="linenos">1418</span></a>    <span class="p">(</span><span class="s2">&quot;eI&quot;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1419"><a href="#LexFormats-1419"><span class="linenos">1419</span></a>    <span class="p">(</span><span class="s2">&quot;E&quot;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1420"><a href="#LexFormats-1420"><span class="linenos">1420</span></a>    <span class="p">(</span><span class="s2">&quot;{&quot;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1421"><a href="#LexFormats-1421"><span class="linenos">1421</span></a>    <span class="p">(</span><span class="s2">&quot;V&quot;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1422"><a href="#LexFormats-1422"><span class="linenos">1422</span></a>    <span class="p">(</span><span class="s2">&quot;Q&quot;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1423"><a href="#LexFormats-1423"><span class="linenos">1423</span></a>    <span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1424"><a href="#LexFormats-1424"><span class="linenos">1424</span></a>    <span class="p">(</span><span class="s2">&quot;oU&quot;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1425"><a href="#LexFormats-1425"><span class="linenos">1425</span></a>    <span class="p">(</span><span class="s2">&quot;U&quot;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1426"><a href="#LexFormats-1426"><span class="linenos">1426</span></a>    <span class="p">(</span><span class="s2">&quot;u:&quot;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1427"><a href="#LexFormats-1427"><span class="linenos">1427</span></a>    <span class="p">(</span><span class="s2">&quot;m&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1428"><a href="#LexFormats-1428"><span class="linenos">1428</span></a>    <span class="p">(</span><span class="s2">&quot;n&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1429"><a href="#LexFormats-1429"><span class="linenos">1429</span></a>    <span class="p">(</span><span class="s2">&quot;N&quot;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1430"><a href="#LexFormats-1430"><span class="linenos">1430</span></a>    <span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1431"><a href="#LexFormats-1431"><span class="linenos">1431</span></a>    <span class="p">(</span><span class="s2">&quot;w&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1432"><a href="#LexFormats-1432"><span class="linenos">1432</span></a>    <span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1433"><a href="#LexFormats-1433"><span class="linenos">1433</span></a>    <span class="p">(</span><span class="s2">&quot;I@&quot;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1434"><a href="#LexFormats-1434"><span class="linenos">1434</span></a>    <span class="p">(</span><span class="s2">&quot;e@&quot;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1435"><a href="#LexFormats-1435"><span class="linenos">1435</span></a>    <span class="p">(</span><span class="s2">&quot;3:&quot;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1436"><a href="#LexFormats-1436"><span class="linenos">1436</span></a>    <span class="p">(</span><span class="s2">&quot;Qr&quot;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1437"><a href="#LexFormats-1437"><span class="linenos">1437</span></a>    <span class="p">(</span><span class="s2">&quot;OI&quot;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1438"><a href="#LexFormats-1438"><span class="linenos">1438</span></a>    <span class="p">(</span><span class="s2">&quot;aI&quot;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1439"><a href="#LexFormats-1439"><span class="linenos">1439</span></a>    <span class="p">(</span><span class="s2">&quot;j&quot;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1440"><a href="#LexFormats-1440"><span class="linenos">1440</span></a>    <span class="p">(</span><span class="s2">&quot;U@&quot;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1441"><a href="#LexFormats-1441"><span class="linenos">1441</span></a>    <span class="p">(</span><span class="s2">&quot;aU&quot;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1442"><a href="#LexFormats-1442"><span class="linenos">1442</span></a>    <span class="p">(</span><span class="s2">&quot;@U&quot;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1443"><a href="#LexFormats-1443"><span class="linenos">1443</span></a>    <span class="p">(</span><span class="s2">&quot;dZ&quot;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1444"><a href="#LexFormats-1444"><span class="linenos">1444</span></a>    <span class="p">(</span><span class="s2">&quot;v&quot;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1445"><a href="#LexFormats-1445"><span class="linenos">1445</span></a>    <span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1446"><a href="#LexFormats-1446"><span class="linenos">1446</span></a>    <span class="p">(</span><span class="s2">&quot;Z&quot;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1447"><a href="#LexFormats-1447"><span class="linenos">1447</span></a>    <span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1448"><a href="#LexFormats-1448"><span class="linenos">1448</span></a>    <span class="p">(</span><span class="s2">&quot;b&quot;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1449"><a href="#LexFormats-1449"><span class="linenos">1449</span></a>    <span class="p">(</span><span class="s2">&quot;d&quot;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1450"><a href="#LexFormats-1450"><span class="linenos">1450</span></a>    <span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1451"><a href="#LexFormats-1451"><span class="linenos">1451</span></a>    <span class="p">(</span><span class="s2">&quot;tS&quot;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1452"><a href="#LexFormats-1452"><span class="linenos">1452</span></a>    <span class="p">(</span><span class="s2">&quot;h&quot;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1453"><a href="#LexFormats-1453"><span class="linenos">1453</span></a>    <span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1454"><a href="#LexFormats-1454"><span class="linenos">1454</span></a>    <span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1455"><a href="#LexFormats-1455"><span class="linenos">1455</span></a>    <span class="p">(</span><span class="s2">&quot;S&quot;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1456"><a href="#LexFormats-1456"><span class="linenos">1456</span></a>    <span class="p">(</span><span class="s2">&quot;T&quot;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1457"><a href="#LexFormats-1457"><span class="linenos">1457</span></a>    <span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1458"><a href="#LexFormats-1458"><span class="linenos">1458</span></a>    <span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1459"><a href="#LexFormats-1459"><span class="linenos">1459</span></a>    <span class="p">(</span><span class="s2">&quot;p&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1460"><a href="#LexFormats-1460"><span class="linenos">1460</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1461"><a href="#LexFormats-1461"><span class="linenos">1461</span></a>    <span class="c1"># lex_filename not set (TODO: check what sort of lexicon is used by rsynth&#39;s &quot;say&quot; front-end)</span>
</span><span id="LexFormats-1462"><a href="#LexFormats-1462"><span class="linenos">1462</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1463"><a href="#LexFormats-1463"><span class="linenos">1463</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1464"><a href="#LexFormats-1464"><span class="linenos">1464</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1465"><a href="#LexFormats-1465"><span class="linenos">1465</span></a>
</span><span id="LexFormats-1466"><a href="#LexFormats-1466"><span class="linenos">1466</span></a>  <span class="s2">&quot;unicode-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1467"><a href="#LexFormats-1467"><span class="linenos">1467</span></a>    <span class="s2">&quot;IPA symbols in Unicode, as used by an increasing number of dictionary programs, websites etc&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1468"><a href="#LexFormats-1468"><span class="linenos">1468</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1469"><a href="#LexFormats-1469"><span class="linenos">1469</span></a>    <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1470"><a href="#LexFormats-1470"><span class="linenos">1470</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02c8</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1471"><a href="#LexFormats-1471"><span class="linenos">1471</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02cc</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1472"><a href="#LexFormats-1472"><span class="linenos">1472</span></a>    <span class="c1"># NB the above two are &quot;modifier&quot;, not &quot;combining&quot;,</span>
</span><span id="LexFormats-1473"><a href="#LexFormats-1473"><span class="linenos">1473</span></a>    <span class="c1"># Unicode characters.  There IS a difference.  If</span>
</span><span id="LexFormats-1474"><a href="#LexFormats-1474"><span class="linenos">1474</span></a>    <span class="c1"># your software displays them as overprinting the</span>
</span><span id="LexFormats-1475"><a href="#LexFormats-1475"><span class="linenos">1475</span></a>    <span class="c1"># surrounding letters, you have a bug.</span>
</span><span id="LexFormats-1476"><a href="#LexFormats-1476"><span class="linenos">1476</span></a>    <span class="c1"># (E.g. WeChat v1.2.2.1 on Mac OS 10.7)</span>
</span><span id="LexFormats-1477"><a href="#LexFormats-1477"><span class="linenos">1477</span></a>    <span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">text_sharp</span><span class="p">),</span>
</span><span id="LexFormats-1478"><a href="#LexFormats-1478"><span class="linenos">1478</span></a>    <span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">,</span><span class="n">text_underline</span><span class="p">),</span>
</span><span id="LexFormats-1479"><a href="#LexFormats-1479"><span class="linenos">1479</span></a>    <span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="n">text_question</span><span class="p">),</span>
</span><span id="LexFormats-1480"><a href="#LexFormats-1480"><span class="linenos">1480</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">text_exclamation</span><span class="p">),</span>
</span><span id="LexFormats-1481"><a href="#LexFormats-1481"><span class="linenos">1481</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">text_comma</span><span class="p">),</span>
</span><span id="LexFormats-1482"><a href="#LexFormats-1482"><span class="linenos">1482</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1483"><a href="#LexFormats-1483"><span class="linenos">1483</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="LexFormats-1484"><a href="#LexFormats-1484"><span class="linenos">1484</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1485"><a href="#LexFormats-1485"><span class="linenos">1485</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1486"><a href="#LexFormats-1486"><span class="linenos">1486</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1487"><a href="#LexFormats-1487"><span class="linenos">1487</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1488"><a href="#LexFormats-1488"><span class="linenos">1488</span></a>    <span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1489"><a href="#LexFormats-1489"><span class="linenos">1489</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028c</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1490"><a href="#LexFormats-1490"><span class="linenos">1490</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\u1d27</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># 28c sometimes mistakenly written as 1d27</span>
</span><span id="LexFormats-1491"><a href="#LexFormats-1491"><span class="linenos">1491</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0252</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1492"><a href="#LexFormats-1492"><span class="linenos">1492</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1493"><a href="#LexFormats-1493"><span class="linenos">1493</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1494"><a href="#LexFormats-1494"><span class="linenos">1494</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1495"><a href="#LexFormats-1495"><span class="linenos">1495</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1496"><a href="#LexFormats-1496"><span class="linenos">1496</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1497"><a href="#LexFormats-1497"><span class="linenos">1497</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1498"><a href="#LexFormats-1498"><span class="linenos">1498</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1499"><a href="#LexFormats-1499"><span class="linenos">1499</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;a</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span> <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028c\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1500"><a href="#LexFormats-1500"><span class="linenos">1500</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0251</span><span class="s1">e&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="LexFormats-1501"><a href="#LexFormats-1501"><span class="linenos">1501</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1502"><a href="#LexFormats-1502"><span class="linenos">1502</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;t</span><span class="se">\u0283</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1503"><a href="#LexFormats-1503"><span class="linenos">1503</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02a7</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1504"><a href="#LexFormats-1504"><span class="linenos">1504</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1505"><a href="#LexFormats-1505"><span class="linenos">1505</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xf0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1506"><a href="#LexFormats-1506"><span class="linenos">1506</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1507"><a href="#LexFormats-1507"><span class="linenos">1507</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1508"><a href="#LexFormats-1508"><span class="linenos">1508</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="LexFormats-1509"><a href="#LexFormats-1509"><span class="linenos">1509</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025c\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1510"><a href="#LexFormats-1510"><span class="linenos">1510</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1511"><a href="#LexFormats-1511"><span class="linenos">1511</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1512"><a href="#LexFormats-1512"><span class="linenos">1512</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1513"><a href="#LexFormats-1513"><span class="linenos">1513</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u025b\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1514"><a href="#LexFormats-1514"><span class="linenos">1514</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1515"><a href="#LexFormats-1515"><span class="linenos">1515</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;e</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1516"><a href="#LexFormats-1516"><span class="linenos">1516</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1517"><a href="#LexFormats-1517"><span class="linenos">1517</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1518"><a href="#LexFormats-1518"><span class="linenos">1518</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0261</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1519"><a href="#LexFormats-1519"><span class="linenos">1519</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1520"><a href="#LexFormats-1520"><span class="linenos">1520</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1521"><a href="#LexFormats-1521"><span class="linenos">1521</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0268</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1522"><a href="#LexFormats-1522"><span class="linenos">1522</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1523"><a href="#LexFormats-1523"><span class="linenos">1523</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="LexFormats-1524"><a href="#LexFormats-1524"><span class="linenos">1524</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u026a\u0279\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="LexFormats-1525"><a href="#LexFormats-1525"><span class="linenos">1525</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1526"><a href="#LexFormats-1526"><span class="linenos">1526</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;i</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1527"><a href="#LexFormats-1527"><span class="linenos">1527</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;d</span><span class="se">\u0292</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1528"><a href="#LexFormats-1528"><span class="linenos">1528</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02a4</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1529"><a href="#LexFormats-1529"><span class="linenos">1529</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1530"><a href="#LexFormats-1530"><span class="linenos">1530</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-1531"><a href="#LexFormats-1531"><span class="linenos">1531</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1532"><a href="#LexFormats-1532"><span class="linenos">1532</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;d</span><span class="se">\u026b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="LexFormats-1533"><a href="#LexFormats-1533"><span class="linenos">1533</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1534"><a href="#LexFormats-1534"><span class="linenos">1534</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1535"><a href="#LexFormats-1535"><span class="linenos">1535</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u014b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1536"><a href="#LexFormats-1536"><span class="linenos">1536</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1537"><a href="#LexFormats-1537"><span class="linenos">1537</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1538"><a href="#LexFormats-1538"><span class="linenos">1538</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1539"><a href="#LexFormats-1539"><span class="linenos">1539</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259\u0289</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1540"><a href="#LexFormats-1540"><span class="linenos">1540</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1541"><a href="#LexFormats-1541"><span class="linenos">1541</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u026a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1542"><a href="#LexFormats-1542"><span class="linenos">1542</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1543"><a href="#LexFormats-1543"><span class="linenos">1543</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1544"><a href="#LexFormats-1544"><span class="linenos">1544</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1545"><a href="#LexFormats-1545"><span class="linenos">1545</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1546"><a href="#LexFormats-1546"><span class="linenos">1546</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0283</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1547"><a href="#LexFormats-1547"><span class="linenos">1547</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1548"><a href="#LexFormats-1548"><span class="linenos">1548</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u027e</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="LexFormats-1549"><a href="#LexFormats-1549"><span class="linenos">1549</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u03b8</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1550"><a href="#LexFormats-1550"><span class="linenos">1550</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a\u0259</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1551"><a href="#LexFormats-1551"><span class="linenos">1551</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a\u0279</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1552"><a href="#LexFormats-1552"><span class="linenos">1552</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1553"><a href="#LexFormats-1553"><span class="linenos">1553</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0289\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1554"><a href="#LexFormats-1554"><span class="linenos">1554</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;u</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1555"><a href="#LexFormats-1555"><span class="linenos">1555</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1556"><a href="#LexFormats-1556"><span class="linenos">1556</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1557"><a href="#LexFormats-1557"><span class="linenos">1557</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0254</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1558"><a href="#LexFormats-1558"><span class="linenos">1558</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;o</span><span class="se">\u02d0</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1559"><a href="#LexFormats-1559"><span class="linenos">1559</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1560"><a href="#LexFormats-1560"><span class="linenos">1560</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1561"><a href="#LexFormats-1561"><span class="linenos">1561</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u028d</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="LexFormats-1562"><a href="#LexFormats-1562"><span class="linenos">1562</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1563"><a href="#LexFormats-1563"><span class="linenos">1563</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1564"><a href="#LexFormats-1564"><span class="linenos">1564</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0292</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1565"><a href="#LexFormats-1565"><span class="linenos">1565</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0294</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="LexFormats-1566"><a href="#LexFormats-1566"><span class="linenos">1566</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-ipa.html&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1567"><a href="#LexFormats-1567"><span class="linenos">1567</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;HTML&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1568"><a href="#LexFormats-1568"><span class="linenos">1568</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;meta name=&quot;mobileoptimized&quot; content=&quot;0&quot;&gt;&lt;meta name=&quot;viewport&quot; content=&quot;width=device-width&quot;&gt;&lt;meta http-equiv=&quot;Content-Type&quot; content=&quot;text/html; charset=utf-8&quot;&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1569"><a href="#LexFormats-1569"><span class="linenos">1569</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;&lt;tr&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;&lt;td&gt;</span><span class="si">%s</span><span class="s2">&lt;/td&gt;&lt;/tr&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1570"><a href="#LexFormats-1570"><span class="linenos">1570</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="s2">&quot;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1571"><a href="#LexFormats-1571"><span class="linenos">1571</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1572"><a href="#LexFormats-1572"><span class="linenos">1572</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1573"><a href="#LexFormats-1573"><span class="linenos">1573</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really? (at least &#39;-&#39; should be safe to drop)</span>
</span><span id="LexFormats-1574"><a href="#LexFormats-1574"><span class="linenos">1574</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="n">unicode_preprocess</span><span class="p">,</span>
</span><span id="LexFormats-1575"><a href="#LexFormats-1575"><span class="linenos">1575</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1576"><a href="#LexFormats-1576"><span class="linenos">1576</span></a>
</span><span id="LexFormats-1577"><a href="#LexFormats-1577"><span class="linenos">1577</span></a>  <span class="s2">&quot;unicode-ipa-syls&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-1578"><a href="#LexFormats-1578"><span class="linenos">1578</span></a>  <span class="s2">&quot;Like unicode-ipa but with syllable separators preserved&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1579"><a href="#LexFormats-1579"><span class="linenos">1579</span></a>  <span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;.&#39;</span><span class="p">),</span>
</span><span id="LexFormats-1580"><a href="#LexFormats-1580"><span class="linenos">1580</span></a>  <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">r</span><span class="s2">&quot;\.+&quot;</span><span class="p">,</span><span class="s2">&quot;.&quot;</span><span class="p">)],</span> <span class="c1"># multiple . to one .</span>
</span><span id="LexFormats-1581"><a href="#LexFormats-1581"><span class="linenos">1581</span></a>  <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
</span><span id="LexFormats-1582"><a href="#LexFormats-1582"><span class="linenos">1582</span></a>
</span><span id="LexFormats-1583"><a href="#LexFormats-1583"><span class="linenos">1583</span></a>  <span class="s2">&quot;yinghan&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-1584"><a href="#LexFormats-1584"><span class="linenos">1584</span></a>     <span class="s2">&quot;As unicode-ipa but, when converting a user lexicon, generates Python code that reads Wenlin Yinghan dictionary entries and adds IPA bands to matching words&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1585"><a href="#LexFormats-1585"><span class="linenos">1585</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;yinghan-ipa.py&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1586"><a href="#LexFormats-1586"><span class="linenos">1586</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;Python script&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1587"><a href="#LexFormats-1587"><span class="linenos">1587</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s1">&#39;#!/usr/bin/env python</span><span class="se">\n</span><span class="s1"># -*- coding: utf-8 -*-</span><span class="se">\n</span><span class="s1"># Works in both Python 2 and Python 3</span><span class="se">\n\n</span><span class="s1">import sys; d={&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1588"><a href="#LexFormats-1588"><span class="linenos">1588</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s1">&#39;u&quot;</span><span class="si">%s</span><span class="s1">&quot;:u&quot;</span><span class="si">%s</span><span class="s1">&quot;,</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1589"><a href="#LexFormats-1589"><span class="linenos">1589</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="s2">&quot;}</span><span class="se">\n</span><span class="s2">import re</span><span class="se">\n</span><span class="s2">try: i,o=sys.stdin.buffer,sys.stdout.buffer # Python 3</span><span class="se">\n</span><span class="s2">except AttributeError: i,o=sys.stdin,sys.stdout # Python 2</span><span class="se">\n</span><span class="s2">for k in list(d.keys()): d[k.lower().encode(&#39;utf-8&#39;)]=d[k]</span><span class="se">\n</span><span class="s2">nextIsHead=False</span><span class="se">\n</span><span class="s2">for l in i:</span><span class="se">\n</span><span class="s2"> o.write(l)</span><span class="se">\n</span><span class="s2"> if nextIsHead and l.strip():</span><span class="se">\n</span><span class="s2">  w=l.split()</span><span class="se">\n</span><span class="s2">  if w[0]==u&#39;ehw&#39;.encode(&#39;utf-8&#39;): l=u&#39; &#39;.encode(&#39;utf-8&#39;).join(w[1:])</span><span class="se">\n</span><span class="s2">  k = re.sub(u&#39;</span><span class="se">\\\\</span><span class="s2">([^)]*</span><span class="se">\\\\</span><span class="s2">)$&#39;.encode(&#39;utf-8&#39;),u&#39;&#39;.encode(&#39;utf-8&#39;),l.strip()).strip().lower()</span><span class="se">\n</span><span class="s2">  if k in d: o.write(u&#39;ipa &#39;.encode(&#39;utf-8&#39;)+d[k].encode(&#39;utf-8&#39;)+u&#39;</span><span class="se">\\</span><span class="s2">n&#39;.encode(&#39;utf-8&#39;))</span><span class="se">\n</span><span class="s2"> if l.startswith(u&#39;*** &#39;.encode(&#39;utf-8&#39;)): nextIsHead=True</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># (allow parenthesised explanation after headword when matching)</span>
</span><span id="LexFormats-1590"><a href="#LexFormats-1590"><span class="linenos">1590</span></a>    <span class="n">noInherit</span><span class="o">=</span><span class="kc">True</span>
</span><span id="LexFormats-1591"><a href="#LexFormats-1591"><span class="linenos">1591</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1592"><a href="#LexFormats-1592"><span class="linenos">1592</span></a>
</span><span id="LexFormats-1593"><a href="#LexFormats-1593"><span class="linenos">1593</span></a>  <span class="s2">&quot;unicode-rough&quot;</span> <span class="p">:</span> <span class="n">makeVariantDic</span><span class="p">(</span>
</span><span id="LexFormats-1594"><a href="#LexFormats-1594"><span class="linenos">1594</span></a>    <span class="s2">&quot;A non-standard notation that&#39;s reminiscent of unicode-ipa but changed so that more of the characters show in old browsers with incomplete fonts&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1595"><a href="#LexFormats-1595"><span class="linenos">1595</span></a>    <span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1596"><a href="#LexFormats-1596"><span class="linenos">1596</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1597"><a href="#LexFormats-1597"><span class="linenos">1597</span></a>    <span class="p">(</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1598"><a href="#LexFormats-1598"><span class="linenos">1598</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="LexFormats-1599"><a href="#LexFormats-1599"><span class="linenos">1599</span></a>    <span class="p">(</span><span class="n">var3_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1600"><a href="#LexFormats-1600"><span class="linenos">1600</span></a>    <span class="p">(</span><span class="n">var4_a_as_in_ah</span><span class="p">,</span><span class="s1">&#39;ar-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1601"><a href="#LexFormats-1601"><span class="linenos">1601</span></a>    <span class="p">(</span><span class="s1">&#39;uh&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1602"><a href="#LexFormats-1602"><span class="linenos">1602</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u0259</span><span class="s1">:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1603"><a href="#LexFormats-1603"><span class="linenos">1603</span></a>    <span class="p">(</span><span class="s1">&#39;ai&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1604"><a href="#LexFormats-1604"><span class="linenos">1604</span></a>    <span class="p">(</span><span class="s1">&#39;ch&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1605"><a href="#LexFormats-1605"><span class="linenos">1605</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1606"><a href="#LexFormats-1606"><span class="linenos">1606</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="LexFormats-1607"><a href="#LexFormats-1607"><span class="linenos">1607</span></a>     <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1608"><a href="#LexFormats-1608"><span class="linenos">1608</span></a>     <span class="p">(</span><span class="n">var1_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1609"><a href="#LexFormats-1609"><span class="linenos">1609</span></a>     <span class="p">(</span><span class="n">var2_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1610"><a href="#LexFormats-1610"><span class="linenos">1610</span></a>     <span class="p">(</span><span class="n">var3_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1611"><a href="#LexFormats-1611"><span class="linenos">1611</span></a>     <span class="p">(</span><span class="n">var4_a_as_in_air</span><span class="p">,</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1612"><a href="#LexFormats-1612"><span class="linenos">1612</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;ei&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1613"><a href="#LexFormats-1613"><span class="linenos">1613</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\xe6</span><span class="s1">i&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1614"><a href="#LexFormats-1614"><span class="linenos">1614</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1615"><a href="#LexFormats-1615"><span class="linenos">1615</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_i_as_in_it</span><span class="p">,</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1616"><a href="#LexFormats-1616"><span class="linenos">1616</span></a>    <span class="p">(</span><span class="s1">&#39;eeuh-&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span> <span class="p">(</span><span class="n">var2_ear</span><span class="p">,</span><span class="s1">&#39;eeuh-&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1617"><a href="#LexFormats-1617"><span class="linenos">1617</span></a>    <span class="p">(</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_e_as_in_eat</span><span class="p">,</span><span class="s1">&#39;ee&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1618"><a href="#LexFormats-1618"><span class="linenos">1618</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1619"><a href="#LexFormats-1619"><span class="linenos">1619</span></a>    <span class="p">(</span><span class="s1">&#39;ng&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1620"><a href="#LexFormats-1620"><span class="linenos">1620</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1621"><a href="#LexFormats-1621"><span class="linenos">1621</span></a>    <span class="p">(</span><span class="n">var2_o_as_in_go</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># override unicode-ipa</span>
</span><span id="LexFormats-1622"><a href="#LexFormats-1622"><span class="linenos">1622</span></a>    <span class="p">(</span><span class="n">var1_u_as_in_but</span><span class="p">,</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># ditto (?? &#39;+&#39;?)</span>
</span><span id="LexFormats-1623"><a href="#LexFormats-1623"><span class="linenos">1623</span></a>    <span class="p">(</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span> <span class="p">(</span><span class="n">var1_oy_as_in_toy</span><span class="p">,</span><span class="s1">&#39;oy&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1624"><a href="#LexFormats-1624"><span class="linenos">1624</span></a>    <span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1625"><a href="#LexFormats-1625"><span class="linenos">1625</span></a>    <span class="p">(</span><span class="s1">&#39;sh&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1626"><a href="#LexFormats-1626"><span class="linenos">1626</span></a>    <span class="p">(</span><span class="n">var1_t</span><span class="p">,</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1627"><a href="#LexFormats-1627"><span class="linenos">1627</span></a>    <span class="p">(</span><span class="s1">&#39;th&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1628"><a href="#LexFormats-1628"><span class="linenos">1628</span></a>    <span class="p">(</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1629"><a href="#LexFormats-1629"><span class="linenos">1629</span></a>    <span class="p">(</span><span class="n">var1_oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1630"><a href="#LexFormats-1630"><span class="linenos">1630</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1631"><a href="#LexFormats-1631"><span class="linenos">1631</span></a>     <span class="p">(</span><span class="n">var1_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1632"><a href="#LexFormats-1632"><span class="linenos">1632</span></a>     <span class="p">(</span><span class="n">var2_oo_as_in_food</span><span class="p">,</span><span class="s1">&#39;oo&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1633"><a href="#LexFormats-1633"><span class="linenos">1633</span></a>     <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1634"><a href="#LexFormats-1634"><span class="linenos">1634</span></a>     <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1635"><a href="#LexFormats-1635"><span class="linenos">1635</span></a>     <span class="p">(</span><span class="n">var2_close_to_or</span><span class="p">,</span><span class="s1">&#39;or&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1636"><a href="#LexFormats-1636"><span class="linenos">1636</span></a>     <span class="p">(</span><span class="n">var1_w</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1637"><a href="#LexFormats-1637"><span class="linenos">1637</span></a>    <span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1638"><a href="#LexFormats-1638"><span class="linenos">1638</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1639"><a href="#LexFormats-1639"><span class="linenos">1639</span></a>     <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;-$&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)],</span>
</span><span id="LexFormats-1640"><a href="#LexFormats-1640"><span class="linenos">1640</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="LexFormats-1641"><a href="#LexFormats-1641"><span class="linenos">1641</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1642"><a href="#LexFormats-1642"><span class="linenos">1642</span></a>
</span><span id="LexFormats-1643"><a href="#LexFormats-1643"><span class="linenos">1643</span></a>  <span class="s2">&quot;braille-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1644"><a href="#LexFormats-1644"><span class="linenos">1644</span></a>    <span class="s2">&quot;IPA symbols in Braille (2008 BANA standard).  By default Braille ASCII is output; if you prefer to see the Braille dots via Unicode, set the BRAILLE_UNICODE environment variable.&quot;</span><span class="p">,</span> <span class="c1"># BANA = Braille Authority of North America.  TODO: check if the UK accepted this standard.</span>
</span><span id="LexFormats-1645"><a href="#LexFormats-1645"><span class="linenos">1645</span></a>    <span class="c1"># TODO: add Unicode IPA signs that aren&#39;t used in English IPA, so we can do a general IPA conversion</span>
</span><span id="LexFormats-1646"><a href="#LexFormats-1646"><span class="linenos">1646</span></a>    <span class="p">(</span><span class="s1">&#39;_B&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1647"><a href="#LexFormats-1647"><span class="linenos">1647</span></a>    <span class="p">(</span><span class="s1">&#39;_2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1648"><a href="#LexFormats-1648"><span class="linenos">1648</span></a>    <span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1649"><a href="#LexFormats-1649"><span class="linenos">1649</span></a>    <span class="p">(</span><span class="s1">&#39;3&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="LexFormats-1650"><a href="#LexFormats-1650"><span class="linenos">1650</span></a>    <span class="p">(</span><span class="s1">&#39;*3&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1651"><a href="#LexFormats-1651"><span class="linenos">1651</span></a>    <span class="p">(</span><span class="s1">&#39;*#&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1652"><a href="#LexFormats-1652"><span class="linenos">1652</span></a>    <span class="p">(</span><span class="s1">&#39;A3&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1653"><a href="#LexFormats-1653"><span class="linenos">1653</span></a>    <span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1654"><a href="#LexFormats-1654"><span class="linenos">1654</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1655"><a href="#LexFormats-1655"><span class="linenos">1655</span></a>    <span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1656"><a href="#LexFormats-1656"><span class="linenos">1656</span></a>    <span class="p">(</span><span class="s1">&#39;4*&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1657"><a href="#LexFormats-1657"><span class="linenos">1657</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;*&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1658"><a href="#LexFormats-1658"><span class="linenos">1658</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1659"><a href="#LexFormats-1659"><span class="linenos">1659</span></a>    <span class="p">(</span><span class="s1">&#39;A(&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1660"><a href="#LexFormats-1660"><span class="linenos">1660</span></a>    <span class="p">(</span><span class="s1">&#39;%&lt;&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1661"><a href="#LexFormats-1661"><span class="linenos">1661</span></a>    <span class="p">(</span><span class="s1">&#39;5&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1662"><a href="#LexFormats-1662"><span class="linenos">1662</span></a>    <span class="p">(</span><span class="s1">&#39;53&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1663"><a href="#LexFormats-1663"><span class="linenos">1663</span></a>    <span class="p">(</span><span class="s1">&#39;5&quot;R.&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1664"><a href="#LexFormats-1664"><span class="linenos">1664</span></a>    <span class="p">(</span><span class="s1">&#39;A/&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1665"><a href="#LexFormats-1665"><span class="linenos">1665</span></a>    <span class="p">(</span><span class="s1">&#39;*E&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="LexFormats-1666"><a href="#LexFormats-1666"><span class="linenos">1666</span></a>    <span class="p">(</span><span class="s1">&#39;B&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1667"><a href="#LexFormats-1667"><span class="linenos">1667</span></a>    <span class="p">(</span><span class="s1">&#39;T:&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1668"><a href="#LexFormats-1668"><span class="linenos">1668</span></a>    <span class="p">(</span><span class="s1">&#39;T&quot;:.&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1669"><a href="#LexFormats-1669"><span class="linenos">1669</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1670"><a href="#LexFormats-1670"><span class="linenos">1670</span></a>    <span class="p">(</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1671"><a href="#LexFormats-1671"><span class="linenos">1671</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1672"><a href="#LexFormats-1672"><span class="linenos">1672</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1673"><a href="#LexFormats-1673"><span class="linenos">1673</span></a>    <span class="p">(</span><span class="s1">&#39;4&gt;3&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span> <span class="c1"># (from \u025c\u02d0; TODO: check what happens to \u025d)</span>
</span><span id="LexFormats-1674"><a href="#LexFormats-1674"><span class="linenos">1674</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;5&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1675"><a href="#LexFormats-1675"><span class="linenos">1675</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;#&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1676"><a href="#LexFormats-1676"><span class="linenos">1676</span></a>    <span class="p">(</span><span class="s1">&#39;E3&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1677"><a href="#LexFormats-1677"><span class="linenos">1677</span></a>    <span class="p">(</span><span class="s1">&#39;&gt;3&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1678"><a href="#LexFormats-1678"><span class="linenos">1678</span></a>    <span class="p">(</span><span class="s1">&#39;E5&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1679"><a href="#LexFormats-1679"><span class="linenos">1679</span></a>    <span class="p">(</span><span class="s1">&#39;E/&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1680"><a href="#LexFormats-1680"><span class="linenos">1680</span></a>    <span class="p">(</span><span class="s1">&#39;%/&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1681"><a href="#LexFormats-1681"><span class="linenos">1681</span></a>    <span class="p">(</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1682"><a href="#LexFormats-1682"><span class="linenos">1682</span></a>    <span class="p">(</span><span class="s1">&#39;G&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1683"><a href="#LexFormats-1683"><span class="linenos">1683</span></a>    <span class="p">(</span><span class="s1">&#39;H&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1684"><a href="#LexFormats-1684"><span class="linenos">1684</span></a>    <span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1685"><a href="#LexFormats-1685"><span class="linenos">1685</span></a>    <span class="p">(</span><span class="s1">&#39;0I&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1686"><a href="#LexFormats-1686"><span class="linenos">1686</span></a>    <span class="p">(</span><span class="s1">&#39;/5&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1687"><a href="#LexFormats-1687"><span class="linenos">1687</span></a>    <span class="p">(</span><span class="s1">&#39;/#&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="LexFormats-1688"><a href="#LexFormats-1688"><span class="linenos">1688</span></a>    <span class="p">(</span><span class="s1">&#39;/#5&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="LexFormats-1689"><a href="#LexFormats-1689"><span class="linenos">1689</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1690"><a href="#LexFormats-1690"><span class="linenos">1690</span></a>    <span class="p">(</span><span class="s1">&#39;I3&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1691"><a href="#LexFormats-1691"><span class="linenos">1691</span></a>    <span class="p">(</span><span class="s1">&#39;D!&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1692"><a href="#LexFormats-1692"><span class="linenos">1692</span></a>    <span class="p">(</span><span class="s1">&#39;K&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1693"><a href="#LexFormats-1693"><span class="linenos">1693</span></a>    <span class="p">(</span><span class="s1">&#39;X&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-1694"><a href="#LexFormats-1694"><span class="linenos">1694</span></a>    <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1695"><a href="#LexFormats-1695"><span class="linenos">1695</span></a>    <span class="p">(</span><span class="s1">&#39;D6L&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="LexFormats-1696"><a href="#LexFormats-1696"><span class="linenos">1696</span></a>    <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1697"><a href="#LexFormats-1697"><span class="linenos">1697</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1698"><a href="#LexFormats-1698"><span class="linenos">1698</span></a>    <span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1699"><a href="#LexFormats-1699"><span class="linenos">1699</span></a>    <span class="p">(</span><span class="s1">&#39;5(&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1700"><a href="#LexFormats-1700"><span class="linenos">1700</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1701"><a href="#LexFormats-1701"><span class="linenos">1701</span></a>    <span class="p">(</span><span class="s1">&#39;O(&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1702"><a href="#LexFormats-1702"><span class="linenos">1702</span></a>    <span class="p">(</span><span class="s1">&#39;50U&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1703"><a href="#LexFormats-1703"><span class="linenos">1703</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;/&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1704"><a href="#LexFormats-1704"><span class="linenos">1704</span></a>    <span class="p">(</span><span class="s1">&#39;O/&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1705"><a href="#LexFormats-1705"><span class="linenos">1705</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1706"><a href="#LexFormats-1706"><span class="linenos">1706</span></a>    <span class="p">(</span><span class="s1">&#39;#&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1707"><a href="#LexFormats-1707"><span class="linenos">1707</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1708"><a href="#LexFormats-1708"><span class="linenos">1708</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1709"><a href="#LexFormats-1709"><span class="linenos">1709</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1710"><a href="#LexFormats-1710"><span class="linenos">1710</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1711"><a href="#LexFormats-1711"><span class="linenos">1711</span></a>    <span class="p">(</span><span class="s1">&#39;6R&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="LexFormats-1712"><a href="#LexFormats-1712"><span class="linenos">1712</span></a>    <span class="p">(</span><span class="s1">&#39;.?&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1713"><a href="#LexFormats-1713"><span class="linenos">1713</span></a>    <span class="p">(</span><span class="s1">&#39;(5&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1714"><a href="#LexFormats-1714"><span class="linenos">1714</span></a>    <span class="p">(</span><span class="s1">&#39;(#&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1715"><a href="#LexFormats-1715"><span class="linenos">1715</span></a>    <span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1716"><a href="#LexFormats-1716"><span class="linenos">1716</span></a>    <span class="p">(</span><span class="s1">&#39;0U3&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1717"><a href="#LexFormats-1717"><span class="linenos">1717</span></a>    <span class="p">(</span><span class="s1">&#39;U3&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1718"><a href="#LexFormats-1718"><span class="linenos">1718</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1719"><a href="#LexFormats-1719"><span class="linenos">1719</span></a>    <span class="p">(</span><span class="s1">&#39;&lt;3&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1720"><a href="#LexFormats-1720"><span class="linenos">1720</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1721"><a href="#LexFormats-1721"><span class="linenos">1721</span></a>    <span class="p">(</span><span class="s1">&#39;O3&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1722"><a href="#LexFormats-1722"><span class="linenos">1722</span></a>    <span class="p">(</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1723"><a href="#LexFormats-1723"><span class="linenos">1723</span></a>    <span class="p">(</span><span class="s1">&#39;W&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1724"><a href="#LexFormats-1724"><span class="linenos">1724</span></a>    <span class="p">(</span><span class="s1">&#39;6W&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="LexFormats-1725"><a href="#LexFormats-1725"><span class="linenos">1725</span></a>    <span class="p">(</span><span class="s1">&#39;J&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1726"><a href="#LexFormats-1726"><span class="linenos">1726</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1727"><a href="#LexFormats-1727"><span class="linenos">1727</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1728"><a href="#LexFormats-1728"><span class="linenos">1728</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="LexFormats-1729"><a href="#LexFormats-1729"><span class="linenos">1729</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;BRAILLE_UNICODE&quot;</span><span class="p">,</span><span class="s2">&quot;words-ipa.txt&quot;</span><span class="p">,</span><span class="s2">&quot;words-ipa.brl&quot;</span><span class="p">),</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1730"><a href="#LexFormats-1730"><span class="linenos">1730</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1731"><a href="#LexFormats-1731"><span class="linenos">1731</span></a>    <span class="c1"># inline_format=&quot;,7%s7&#39;&quot;, # -&gt; do this in cleanup_func so it&#39;s included in BRAILLE_UNICODE if necessary</span>
</span><span id="LexFormats-1732"><a href="#LexFormats-1732"><span class="linenos">1732</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> = </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># ditto with the markers</span>
</span><span id="LexFormats-1733"><a href="#LexFormats-1733"><span class="linenos">1733</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1734"><a href="#LexFormats-1734"><span class="linenos">1734</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1735"><a href="#LexFormats-1735"><span class="linenos">1735</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1736"><a href="#LexFormats-1736"><span class="linenos">1736</span></a>    <span class="n">cleanup_func</span><span class="o">=</span><span class="k">lambda</span> <span class="n">r</span><span class="p">:</span><span class="n">ifset</span><span class="p">(</span><span class="s2">&quot;BRAILLE_UNICODE&quot;</span><span class="p">,</span><span class="n">ascii_braille_to_unicode</span><span class="p">,</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">)(</span><span class="s2">&quot;,7&quot;</span><span class="o">+</span><span class="n">r</span><span class="o">+</span><span class="s2">&quot;7&#39;&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1737"><a href="#LexFormats-1737"><span class="linenos">1737</span></a>    <span class="n">cvtOut_func</span><span class="o">=</span><span class="n">unicode_to_ascii_braille</span><span class="p">,</span>
</span><span id="LexFormats-1738"><a href="#LexFormats-1738"><span class="linenos">1738</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1739"><a href="#LexFormats-1739"><span class="linenos">1739</span></a>  
</span><span id="LexFormats-1740"><a href="#LexFormats-1740"><span class="linenos">1740</span></a>  <span class="s2">&quot;latex-ipa&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1741"><a href="#LexFormats-1741"><span class="linenos">1741</span></a>    <span class="s1">&#39;IPA symbols for typesetting in LaTeX using the &quot;tipa&quot; package&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1742"><a href="#LexFormats-1742"><span class="linenos">1742</span></a>    <span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span><span class="n">syllable_separator</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1743"><a href="#LexFormats-1743"><span class="linenos">1743</span></a>    <span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1744"><a href="#LexFormats-1744"><span class="linenos">1744</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textsecstress</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1745"><a href="#LexFormats-1745"><span class="linenos">1745</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">#&#39;</span><span class="p">,</span><span class="n">text_sharp</span><span class="p">),</span>
</span><span id="LexFormats-1746"><a href="#LexFormats-1746"><span class="linenos">1746</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">_&#39;</span><span class="p">,</span><span class="n">text_underline</span><span class="p">),</span>
</span><span id="LexFormats-1747"><a href="#LexFormats-1747"><span class="linenos">1747</span></a>    <span class="p">(</span><span class="s1">&#39;?&#39;</span><span class="p">,</span><span class="n">text_question</span><span class="p">),</span>
</span><span id="LexFormats-1748"><a href="#LexFormats-1748"><span class="linenos">1748</span></a>    <span class="p">(</span><span class="s1">&#39;!&#39;</span><span class="p">,</span><span class="n">text_exclamation</span><span class="p">),</span>
</span><span id="LexFormats-1749"><a href="#LexFormats-1749"><span class="linenos">1749</span></a>    <span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">,</span><span class="n">text_comma</span><span class="p">),</span>
</span><span id="LexFormats-1750"><a href="#LexFormats-1750"><span class="linenos">1750</span></a>    <span class="p">(</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1751"><a href="#LexFormats-1751"><span class="linenos">1751</span></a>    <span class="p">(</span><span class="s1">&#39;:&#39;</span><span class="p">,</span><span class="n">ipa_colon</span><span class="p">),</span>
</span><span id="LexFormats-1752"><a href="#LexFormats-1752"><span class="linenos">1752</span></a>    <span class="p">(</span><span class="s1">&#39;A:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1753"><a href="#LexFormats-1753"><span class="linenos">1753</span></a>    <span class="p">(</span><span class="s1">&#39;A</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1754"><a href="#LexFormats-1754"><span class="linenos">1754</span></a>    <span class="p">(</span><span class="s1">&#39;a:&#39;</span><span class="p">,</span><span class="n">var5_a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1755"><a href="#LexFormats-1755"><span class="linenos">1755</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1756"><a href="#LexFormats-1756"><span class="linenos">1756</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1757"><a href="#LexFormats-1757"><span class="linenos">1757</span></a>    <span class="p">(</span><span class="s1">&#39;6&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1758"><a href="#LexFormats-1758"><span class="linenos">1758</span></a>    <span class="p">(</span><span class="n">var1_o_as_in_orange</span><span class="p">,</span><span class="s1">&#39;A&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1759"><a href="#LexFormats-1759"><span class="linenos">1759</span></a>    <span class="p">(</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1760"><a href="#LexFormats-1760"><span class="linenos">1760</span></a>    <span class="p">(</span><span class="s1">&#39;aU&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1761"><a href="#LexFormats-1761"><span class="linenos">1761</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">O&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1762"><a href="#LexFormats-1762"><span class="linenos">1762</span></a>    <span class="p">(</span><span class="s1">&#39;@&#39;</span><span class="p">,</span><span class="n">a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1763"><a href="#LexFormats-1763"><span class="linenos">1763</span></a>    <span class="p">(</span><span class="s1">&#39;@:&#39;</span><span class="p">,</span><span class="n">e_as_in_herd</span><span class="p">),</span>
</span><span id="LexFormats-1764"><a href="#LexFormats-1764"><span class="linenos">1764</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textrhookschwa</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ago</span><span class="p">),</span>
</span><span id="LexFormats-1765"><a href="#LexFormats-1765"><span class="linenos">1765</span></a>    <span class="p">(</span><span class="s1">&#39;aI&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1766"><a href="#LexFormats-1766"><span class="linenos">1766</span></a>    <span class="p">(</span><span class="s1">&#39;Ae&#39;</span><span class="p">,</span><span class="n">var1_eye</span><span class="p">),</span>
</span><span id="LexFormats-1767"><a href="#LexFormats-1767"><span class="linenos">1767</span></a>    <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1768"><a href="#LexFormats-1768"><span class="linenos">1768</span></a>    <span class="p">(</span><span class="s1">&#39;tS&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1769"><a href="#LexFormats-1769"><span class="linenos">1769</span></a>    <span class="p">(</span><span class="s1">&#39;d&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1770"><a href="#LexFormats-1770"><span class="linenos">1770</span></a>    <span class="p">(</span><span class="s1">&#39;D&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1771"><a href="#LexFormats-1771"><span class="linenos">1771</span></a>    <span class="p">(</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1772"><a href="#LexFormats-1772"><span class="linenos">1772</span></a>    <span class="p">(</span><span class="s1">&#39;e&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1773"><a href="#LexFormats-1773"><span class="linenos">1773</span></a>    <span class="p">(</span><span class="s1">&#39;3:&#39;</span><span class="p">,</span><span class="n">ar_as_in_year</span><span class="p">),</span>
</span><span id="LexFormats-1774"><a href="#LexFormats-1774"><span class="linenos">1774</span></a>    <span class="p">(</span><span class="s1">&#39;E@&#39;</span><span class="p">,</span><span class="n">a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1775"><a href="#LexFormats-1775"><span class="linenos">1775</span></a>    <span class="p">(</span><span class="s1">&#39;E</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1776"><a href="#LexFormats-1776"><span class="linenos">1776</span></a>    <span class="p">(</span><span class="s1">&#39;e:&#39;</span><span class="p">,</span><span class="n">var2_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1777"><a href="#LexFormats-1777"><span class="linenos">1777</span></a>    <span class="p">(</span><span class="s1">&#39;E:&#39;</span><span class="p">,</span><span class="n">var3_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1778"><a href="#LexFormats-1778"><span class="linenos">1778</span></a>    <span class="p">(</span><span class="s1">&#39;e@&#39;</span><span class="p">,</span><span class="n">var4_a_as_in_air</span><span class="p">),</span>
</span><span id="LexFormats-1779"><a href="#LexFormats-1779"><span class="linenos">1779</span></a>    <span class="p">(</span><span class="s1">&#39;eI&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1780"><a href="#LexFormats-1780"><span class="linenos">1780</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">ae</span><span class="si">{}</span><span class="s1">I&#39;</span><span class="p">,</span><span class="n">var1_a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1781"><a href="#LexFormats-1781"><span class="linenos">1781</span></a>    <span class="p">(</span><span class="s1">&#39;f&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1782"><a href="#LexFormats-1782"><span class="linenos">1782</span></a>    <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1783"><a href="#LexFormats-1783"><span class="linenos">1783</span></a>    <span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1784"><a href="#LexFormats-1784"><span class="linenos">1784</span></a>    <span class="p">(</span><span class="s1">&#39;I&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1785"><a href="#LexFormats-1785"><span class="linenos">1785</span></a>    <span class="p">(</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="n">var1_i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1786"><a href="#LexFormats-1786"><span class="linenos">1786</span></a>    <span class="p">(</span><span class="s1">&#39;I@&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1787"><a href="#LexFormats-1787"><span class="linenos">1787</span></a>    <span class="p">(</span><span class="s1">&#39;I</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_ear</span><span class="p">),</span>
</span><span id="LexFormats-1788"><a href="#LexFormats-1788"><span class="linenos">1788</span></a>    <span class="p">(</span><span class="s1">&#39;I@</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var2_ear</span><span class="p">),</span> <span class="c1"># ?</span>
</span><span id="LexFormats-1789"><a href="#LexFormats-1789"><span class="linenos">1789</span></a>    <span class="p">(</span><span class="s1">&#39;i&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1790"><a href="#LexFormats-1790"><span class="linenos">1790</span></a>    <span class="p">(</span><span class="s1">&#39;i:&#39;</span><span class="p">,</span><span class="n">var1_e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1791"><a href="#LexFormats-1791"><span class="linenos">1791</span></a>    <span class="p">(</span><span class="s1">&#39;dZ&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1792"><a href="#LexFormats-1792"><span class="linenos">1792</span></a>    <span class="p">(</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1793"><a href="#LexFormats-1793"><span class="linenos">1793</span></a>    <span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">opt_scottish_loch</span><span class="p">),</span>
</span><span id="LexFormats-1794"><a href="#LexFormats-1794"><span class="linenos">1794</span></a>    <span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1795"><a href="#LexFormats-1795"><span class="linenos">1795</span></a>    <span class="p">(</span><span class="s1">&#39;d</span><span class="se">\\</span><span class="s1">textltilde</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_l</span><span class="p">),</span>
</span><span id="LexFormats-1796"><a href="#LexFormats-1796"><span class="linenos">1796</span></a>    <span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1797"><a href="#LexFormats-1797"><span class="linenos">1797</span></a>    <span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1798"><a href="#LexFormats-1798"><span class="linenos">1798</span></a>    <span class="p">(</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1799"><a href="#LexFormats-1799"><span class="linenos">1799</span></a>    <span class="p">(</span><span class="s1">&#39;@U&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1800"><a href="#LexFormats-1800"><span class="linenos">1800</span></a>    <span class="p">(</span><span class="s1">&#39;o&#39;</span><span class="p">,</span><span class="n">var1_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1801"><a href="#LexFormats-1801"><span class="linenos">1801</span></a>    <span class="p">(</span><span class="s1">&#39;oU&#39;</span><span class="p">,</span><span class="n">var2_o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1802"><a href="#LexFormats-1802"><span class="linenos">1802</span></a>    <span class="p">(</span><span class="s1">&#39;@0&#39;</span><span class="p">,</span><span class="n">var1_u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1803"><a href="#LexFormats-1803"><span class="linenos">1803</span></a>    <span class="p">(</span><span class="s1">&#39;OI&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1804"><a href="#LexFormats-1804"><span class="linenos">1804</span></a>    <span class="p">(</span><span class="s1">&#39;oI&#39;</span><span class="p">,</span><span class="n">var1_oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1805"><a href="#LexFormats-1805"><span class="linenos">1805</span></a>    <span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1806"><a href="#LexFormats-1806"><span class="linenos">1806</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1807"><a href="#LexFormats-1807"><span class="linenos">1807</span></a>    <span class="p">(</span><span class="n">var1_r</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1808"><a href="#LexFormats-1808"><span class="linenos">1808</span></a>    <span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1809"><a href="#LexFormats-1809"><span class="linenos">1809</span></a>    <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1810"><a href="#LexFormats-1810"><span class="linenos">1810</span></a>    <span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1811"><a href="#LexFormats-1811"><span class="linenos">1811</span></a>    <span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">,</span><span class="n">var1_t</span><span class="p">),</span>
</span><span id="LexFormats-1812"><a href="#LexFormats-1812"><span class="linenos">1812</span></a>    <span class="p">(</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span>
</span><span id="LexFormats-1813"><a href="#LexFormats-1813"><span class="linenos">1813</span></a>    <span class="p">(</span><span class="s1">&#39;U@&#39;</span><span class="p">,</span><span class="n">oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1814"><a href="#LexFormats-1814"><span class="linenos">1814</span></a>    <span class="p">(</span><span class="s1">&#39;U</span><span class="se">\\</span><span class="s1">textturnr</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_oor_as_in_poor</span><span class="p">),</span>
</span><span id="LexFormats-1815"><a href="#LexFormats-1815"><span class="linenos">1815</span></a>    <span class="p">(</span><span class="s1">&#39;U&#39;</span><span class="p">,</span><span class="n">opt_u_as_in_pull</span><span class="p">),</span>
</span><span id="LexFormats-1816"><a href="#LexFormats-1816"><span class="linenos">1816</span></a>    <span class="p">(</span><span class="s1">&#39;0:&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1817"><a href="#LexFormats-1817"><span class="linenos">1817</span></a>    <span class="p">(</span><span class="s1">&#39;u:&#39;</span><span class="p">,</span><span class="n">var1_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1818"><a href="#LexFormats-1818"><span class="linenos">1818</span></a>    <span class="p">(</span><span class="s1">&#39;u&#39;</span><span class="p">,</span><span class="n">var2_oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1819"><a href="#LexFormats-1819"><span class="linenos">1819</span></a>    <span class="p">(</span><span class="s1">&#39;O:&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1820"><a href="#LexFormats-1820"><span class="linenos">1820</span></a>    <span class="p">(</span><span class="n">var1_close_to_or</span><span class="p">,</span><span class="s1">&#39;O&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1821"><a href="#LexFormats-1821"><span class="linenos">1821</span></a>    <span class="p">(</span><span class="s1">&#39;o:&#39;</span><span class="p">,</span><span class="n">var2_close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1822"><a href="#LexFormats-1822"><span class="linenos">1822</span></a>    <span class="p">(</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="n">v</span><span class="p">),</span>
</span><span id="LexFormats-1823"><a href="#LexFormats-1823"><span class="linenos">1823</span></a>    <span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1824"><a href="#LexFormats-1824"><span class="linenos">1824</span></a>    <span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">textturnw</span><span class="si">{}</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">var1_w</span><span class="p">),</span>
</span><span id="LexFormats-1825"><a href="#LexFormats-1825"><span class="linenos">1825</span></a>    <span class="p">(</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1826"><a href="#LexFormats-1826"><span class="linenos">1826</span></a>    <span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1827"><a href="#LexFormats-1827"><span class="linenos">1827</span></a>    <span class="p">(</span><span class="s1">&#39;Z&#39;</span><span class="p">,</span><span class="n">ge_of_blige_etc</span><span class="p">),</span>
</span><span id="LexFormats-1828"><a href="#LexFormats-1828"><span class="linenos">1828</span></a>    <span class="p">(</span><span class="s1">&#39;P&#39;</span><span class="p">,</span><span class="n">glottal_stop</span><span class="p">),</span>
</span><span id="LexFormats-1829"><a href="#LexFormats-1829"><span class="linenos">1829</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-ipa.tex&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1830"><a href="#LexFormats-1830"><span class="linenos">1830</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;document&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1831"><a href="#LexFormats-1831"><span class="linenos">1831</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;\documentclass[12pt,a4paper]</span><span class="si">{article}</span><span class="s1"> \usepackage[safe]</span><span class="si">{tipa}</span><span class="s1"> \usepackage</span><span class="si">{longtable}</span><span class="s1"> \begin</span><span class="si">{document}</span><span class="s1"> \begin</span><span class="si">{longtable}{ll}</span><span class="s1">&#39;</span><span class="p">,</span>
</span><span id="LexFormats-1832"><a href="#LexFormats-1832"><span class="linenos">1832</span></a>    <span class="n">lex_entry_format</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> &amp; \textipa{</span><span class="si">%s</span><span class="s2">}</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1833"><a href="#LexFormats-1833"><span class="linenos">1833</span></a>    <span class="n">lex_footer</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;\end</span><span class="si">{longtable}</span><span class="s2">\end</span><span class="si">{document}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1834"><a href="#LexFormats-1834"><span class="linenos">1834</span></a>    <span class="n">inline_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\\</span><span class="s2">textipa{</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1835"><a href="#LexFormats-1835"><span class="linenos">1835</span></a>    <span class="n">inline_oneoff_header</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;% In preamble, put \usepackage[safe]</span><span class="si">{tipa}</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="c1"># (the [safe] part is recommended if you&#39;re mixing with other TeX)</span>
</span><span id="LexFormats-1836"><a href="#LexFormats-1836"><span class="linenos">1836</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1837"><a href="#LexFormats-1837"><span class="linenos">1837</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">&quot;</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1838"><a href="#LexFormats-1838"><span class="linenos">1838</span></a>    <span class="n">stress_comes_before_vowel</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1839"><a href="#LexFormats-1839"><span class="linenos">1839</span></a>    <span class="n">safe_to_drop_characters</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1840"><a href="#LexFormats-1840"><span class="linenos">1840</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1841"><a href="#LexFormats-1841"><span class="linenos">1841</span></a>
</span><span id="LexFormats-1842"><a href="#LexFormats-1842"><span class="linenos">1842</span></a>  <span class="s2">&quot;pinyin-approx&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1843"><a href="#LexFormats-1843"><span class="linenos">1843</span></a>    <span class="s2">&quot;Rough approximation using roughly the spelling rules of Chinese Pinyin (for getting Chinese-only voices to speak some English words - works with some words better than others)&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1844"><a href="#LexFormats-1844"><span class="linenos">1844</span></a>    <span class="p">(</span><span class="s1">&#39;4&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1845"><a href="#LexFormats-1845"><span class="linenos">1845</span></a>    <span class="p">(</span><span class="s1">&#39;2&#39;</span><span class="p">,</span><span class="n">secondary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1846"><a href="#LexFormats-1846"><span class="linenos">1846</span></a>    <span class="p">(</span><span class="s1">&#39;a5&#39;</span><span class="p">,</span><span class="n">a_as_in_ah</span><span class="p">),</span>
</span><span id="LexFormats-1847"><a href="#LexFormats-1847"><span class="linenos">1847</span></a>    <span class="p">(</span><span class="s1">&#39;ya5&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1848"><a href="#LexFormats-1848"><span class="linenos">1848</span></a>    <span class="p">(</span><span class="s1">&#39;e5&#39;</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">),</span>
</span><span id="LexFormats-1849"><a href="#LexFormats-1849"><span class="linenos">1849</span></a>    <span class="p">(</span><span class="s1">&#39;yo5&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1850"><a href="#LexFormats-1850"><span class="linenos">1850</span></a>    <span class="p">(</span><span class="s1">&#39;ao5&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span>
</span><span id="LexFormats-1851"><a href="#LexFormats-1851"><span class="linenos">1851</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="s1">&#39;e5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1852"><a href="#LexFormats-1852"><span class="linenos">1852</span></a>    <span class="p">(</span><span class="s1">&#39;ai5&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span>
</span><span id="LexFormats-1853"><a href="#LexFormats-1853"><span class="linenos">1853</span></a>    <span class="p">(</span><span class="s1">&#39;bu0&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span>
</span><span id="LexFormats-1854"><a href="#LexFormats-1854"><span class="linenos">1854</span></a>    <span class="p">(</span><span class="s1">&#39;che0&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span>
</span><span id="LexFormats-1855"><a href="#LexFormats-1855"><span class="linenos">1855</span></a>    <span class="p">(</span><span class="s1">&#39;de0&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span>
</span><span id="LexFormats-1856"><a href="#LexFormats-1856"><span class="linenos">1856</span></a>    <span class="p">(</span><span class="s1">&#39;ze0&#39;</span><span class="p">,</span><span class="n">th_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1857"><a href="#LexFormats-1857"><span class="linenos">1857</span></a>    <span class="p">(</span><span class="s1">&#39;ye5&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1858"><a href="#LexFormats-1858"><span class="linenos">1858</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="s1">&#39;ye5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1859"><a href="#LexFormats-1859"><span class="linenos">1859</span></a>    <span class="p">(</span><span class="s1">&#39;ei5&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span>
</span><span id="LexFormats-1860"><a href="#LexFormats-1860"><span class="linenos">1860</span></a>    <span class="p">(</span><span class="s1">&#39;fu0&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1861"><a href="#LexFormats-1861"><span class="linenos">1861</span></a>    <span class="p">(</span><span class="s1">&#39;ge0&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1862"><a href="#LexFormats-1862"><span class="linenos">1862</span></a>    <span class="p">(</span><span class="s1">&#39;he0&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span>
</span><span id="LexFormats-1863"><a href="#LexFormats-1863"><span class="linenos">1863</span></a>    <span class="p">(</span><span class="s1">&#39;yi5&#39;</span><span class="p">,</span><span class="n">i_as_in_it</span><span class="p">),</span>
</span><span id="LexFormats-1864"><a href="#LexFormats-1864"><span class="linenos">1864</span></a>    <span class="p">(</span><span class="s1">&#39;yi3re5&#39;</span><span class="p">,</span><span class="n">ear</span><span class="p">),</span>
</span><span id="LexFormats-1865"><a href="#LexFormats-1865"><span class="linenos">1865</span></a>    <span class="p">(</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="s1">&#39;yi5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1866"><a href="#LexFormats-1866"><span class="linenos">1866</span></a>    <span class="p">(</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span>
</span><span id="LexFormats-1867"><a href="#LexFormats-1867"><span class="linenos">1867</span></a>    <span class="p">(</span><span class="s1">&#39;ke0&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1868"><a href="#LexFormats-1868"><span class="linenos">1868</span></a>    <span class="p">(</span><span class="s1">&#39;le0&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span>
</span><span id="LexFormats-1869"><a href="#LexFormats-1869"><span class="linenos">1869</span></a>    <span class="p">(</span><span class="s1">&#39;me0&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1870"><a href="#LexFormats-1870"><span class="linenos">1870</span></a>    <span class="p">(</span><span class="s1">&#39;ne0&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1871"><a href="#LexFormats-1871"><span class="linenos">1871</span></a>    <span class="p">(</span><span class="s1">&#39;eng0&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1872"><a href="#LexFormats-1872"><span class="linenos">1872</span></a>    <span class="p">(</span><span class="s1">&#39;ou5&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span>
</span><span id="LexFormats-1873"><a href="#LexFormats-1873"><span class="linenos">1873</span></a>    <span class="p">(</span><span class="s1">&#39;ruo2yi5&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span>
</span><span id="LexFormats-1874"><a href="#LexFormats-1874"><span class="linenos">1874</span></a>    <span class="p">(</span><span class="s1">&#39;pu0&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1875"><a href="#LexFormats-1875"><span class="linenos">1875</span></a>    <span class="p">(</span><span class="s1">&#39;re0&#39;</span><span class="p">,</span><span class="n">r</span><span class="p">),</span>
</span><span id="LexFormats-1876"><a href="#LexFormats-1876"><span class="linenos">1876</span></a>    <span class="p">(</span><span class="s1">&#39;se0&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1877"><a href="#LexFormats-1877"><span class="linenos">1877</span></a>    <span class="p">(</span><span class="s1">&#39;she0&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1878"><a href="#LexFormats-1878"><span class="linenos">1878</span></a>    <span class="p">(</span><span class="s1">&#39;te0&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1879"><a href="#LexFormats-1879"><span class="linenos">1879</span></a>    <span class="p">(</span><span class="n">th_as_in_think</span><span class="p">,</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1880"><a href="#LexFormats-1880"><span class="linenos">1880</span></a>    <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="s1">&#39;wu5&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1881"><a href="#LexFormats-1881"><span class="linenos">1881</span></a>    <span class="p">(</span><span class="s1">&#39;yu5&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1882"><a href="#LexFormats-1882"><span class="linenos">1882</span></a>    <span class="p">(</span><span class="s1">&#39;huo5&#39;</span><span class="p">,</span><span class="n">close_to_or</span><span class="p">),</span>
</span><span id="LexFormats-1883"><a href="#LexFormats-1883"><span class="linenos">1883</span></a>    <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="s1">&#39;fu0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1884"><a href="#LexFormats-1884"><span class="linenos">1884</span></a>    <span class="p">(</span><span class="s1">&#39;wu0&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span>
</span><span id="LexFormats-1885"><a href="#LexFormats-1885"><span class="linenos">1885</span></a>    <span class="p">(</span><span class="s1">&#39;yu0&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1886"><a href="#LexFormats-1886"><span class="linenos">1886</span></a>    <span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="s1">&#39;ze0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1887"><a href="#LexFormats-1887"><span class="linenos">1887</span></a>    <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="s1">&#39;zhe0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1888"><a href="#LexFormats-1888"><span class="linenos">1888</span></a>    <span class="n">approximate_missing</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="LexFormats-1889"><a href="#LexFormats-1889"><span class="linenos">1889</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-pinyin-approx.txt&quot;</span><span class="p">,</span> <span class="c1"># write-only for now</span>
</span><span id="LexFormats-1890"><a href="#LexFormats-1890"><span class="linenos">1890</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1891"><a href="#LexFormats-1891"><span class="linenos">1891</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;Pinyin approxmations (very approximate!)</span><span class="se">\n</span><span class="s2">----------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1892"><a href="#LexFormats-1892"><span class="linenos">1892</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ~= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1893"><a href="#LexFormats-1893"><span class="linenos">1893</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1894"><a href="#LexFormats-1894"><span class="linenos">1894</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[</span>
</span><span id="LexFormats-1895"><a href="#LexFormats-1895"><span class="linenos">1895</span></a>      <span class="p">(</span><span class="s2">&quot;te0ye&quot;</span><span class="p">,</span><span class="s2">&quot;tie&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1896"><a href="#LexFormats-1896"><span class="linenos">1896</span></a>      <span class="p">(</span><span class="s2">&quot;e0e5&quot;</span><span class="p">,</span><span class="s2">&quot;e5&quot;</span><span class="p">),(</span><span class="s2">&quot;([^aeiou][uo])0e(5)&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1\2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1897"><a href="#LexFormats-1897"><span class="linenos">1897</span></a>      <span class="p">(</span><span class="s2">&quot;yu0y&quot;</span><span class="p">,</span><span class="s2">&quot;y&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1898"><a href="#LexFormats-1898"><span class="linenos">1898</span></a>      <span class="p">(</span><span class="s2">&quot;wu0yo5&quot;</span><span class="p">,</span><span class="s2">&quot;wo5&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1899"><a href="#LexFormats-1899"><span class="linenos">1899</span></a>      <span class="p">(</span><span class="s2">&quot;([bdfghklmnpwz])[euo]0ei&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ei&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1900"><a href="#LexFormats-1900"><span class="linenos">1900</span></a>      <span class="p">(</span><span class="s2">&quot;([bdghklmnpstwz])[euo]0ai&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ai&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1901"><a href="#LexFormats-1901"><span class="linenos">1901</span></a>      <span class="p">(</span><span class="s2">&quot;([ghklmnpstyz])[euo]0ya&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1a&quot;</span><span class="p">),(</span><span class="s2">&quot;([ghklmnpstz])a([0-5]*)ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1an\2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1902"><a href="#LexFormats-1902"><span class="linenos">1902</span></a>      <span class="p">(</span><span class="s2">&quot;([bdfghklmnpstwyz])[euo]0a([1-5])&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1a\2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1903"><a href="#LexFormats-1903"><span class="linenos">1903</span></a>      <span class="p">(</span><span class="s2">&quot;([bdjlmnpt])[euo]0yi&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1i&quot;</span><span class="p">),(</span><span class="s2">&quot;([bjlmnp])i([1-5]*)ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1in\2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1904"><a href="#LexFormats-1904"><span class="linenos">1904</span></a>      <span class="p">(</span><span class="s2">&quot;([zs])he0ei&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1hei&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1905"><a href="#LexFormats-1905"><span class="linenos">1905</span></a>      <span class="p">(</span><span class="s2">&quot;([dfghklmnprstyz])[euo]0ou&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ou&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1906"><a href="#LexFormats-1906"><span class="linenos">1906</span></a>      <span class="p">(</span><span class="s2">&quot;([dghklnrst])[euo]0huo&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1uo&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1907"><a href="#LexFormats-1907"><span class="linenos">1907</span></a>      <span class="p">(</span><span class="s2">&quot;([bfpm])[euo]0huo&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1o&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1908"><a href="#LexFormats-1908"><span class="linenos">1908</span></a>      <span class="p">(</span><span class="s2">&quot;([bdghklmnprstyz])[euo]0ao&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ao&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1909"><a href="#LexFormats-1909"><span class="linenos">1909</span></a>      <span class="p">(</span><span class="s2">&quot;([zcs])h[eu]0ao&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1hao&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1910"><a href="#LexFormats-1910"><span class="linenos">1910</span></a>      <span class="p">(</span><span class="s2">&quot;re0r&quot;</span><span class="p">,</span><span class="s2">&quot;r&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1911"><a href="#LexFormats-1911"><span class="linenos">1911</span></a>      <span class="p">(</span><span class="s2">&quot;zhe0ne0&quot;</span><span class="p">,</span><span class="s2">&quot;zhun5&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1912"><a href="#LexFormats-1912"><span class="linenos">1912</span></a>      <span class="p">(</span><span class="s2">&quot;54&quot;</span><span class="p">,</span><span class="s2">&quot;4&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1913"><a href="#LexFormats-1913"><span class="linenos">1913</span></a>      <span class="p">(</span><span class="s2">&quot;52&quot;</span><span class="p">,</span><span class="s2">&quot;2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1914"><a href="#LexFormats-1914"><span class="linenos">1914</span></a>      <span class="p">(</span><span class="s2">&quot;([bdjlmnpty])i([1-9])eng0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1ing\2&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1915"><a href="#LexFormats-1915"><span class="linenos">1915</span></a>      <span class="p">(</span><span class="s2">&quot;ya([1-9])eng0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yang\1&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1916"><a href="#LexFormats-1916"><span class="linenos">1916</span></a>      <span class="p">(</span><span class="s2">&quot;ya([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;an\1&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1917"><a href="#LexFormats-1917"><span class="linenos">1917</span></a>      <span class="p">(</span><span class="s2">&quot;ye([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yan\1&quot;</span><span class="p">),(</span><span class="s2">&quot;([wr])[eu]0yan&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;\1en&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1918"><a href="#LexFormats-1918"><span class="linenos">1918</span></a>      <span class="p">(</span><span class="s2">&quot;yi([1-9])ne0&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;yin\1&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1919"><a href="#LexFormats-1919"><span class="linenos">1919</span></a>      
</span><span id="LexFormats-1920"><a href="#LexFormats-1920"><span class="linenos">1920</span></a>      <span class="p">(</span><span class="s2">&quot;yu0&quot;</span><span class="p">,</span><span class="s2">&quot;yu5&quot;</span><span class="p">),(</span><span class="s2">&quot;eng0&quot;</span><span class="p">,</span><span class="s2">&quot;eng5&quot;</span><span class="p">),</span> <span class="c1"># they won&#39;t work unvoiced anyway</span>
</span><span id="LexFormats-1921"><a href="#LexFormats-1921"><span class="linenos">1921</span></a>      <span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;5&quot;</span><span class="p">),</span> <span class="c1"># comment out if the synth supports &#39;tone 0 for unvoiced&#39;</span>
</span><span id="LexFormats-1922"><a href="#LexFormats-1922"><span class="linenos">1922</span></a>      <span class="c1">#(&quot;[euo]0&quot;,&quot;0&quot;), # comment in if it expects consonants only when doing that</span>
</span><span id="LexFormats-1923"><a href="#LexFormats-1923"><span class="linenos">1923</span></a>    <span class="p">],</span>
</span><span id="LexFormats-1924"><a href="#LexFormats-1924"><span class="linenos">1924</span></a>  <span class="p">),</span>
</span><span id="LexFormats-1925"><a href="#LexFormats-1925"><span class="linenos">1925</span></a>
</span><span id="LexFormats-1926"><a href="#LexFormats-1926"><span class="linenos">1926</span></a>  <span class="s2">&quot;kana-approx&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-1927"><a href="#LexFormats-1927"><span class="linenos">1927</span></a>  <span class="s2">&quot;Rough approximation using kana (for getting Japanese computer voices to speak some English words - works with some words better than others).  Set KANA_TYPE environment variable to hiragana or katakana (which can affect the sounds of some voices); default is hiragana&quot;</span><span class="p">,</span> <span class="c1"># for example on Mac OS 10.7+ (with Japanese voice installed in System Preferences) try PHONES_PIPE_COMMAND=&#39;say -v Kyoko&#39; (this voice has a built-in converter from English as well, but lexconvert --phones kana-approx can work better with some complex words, although the built-in converter does seem to have access to slightly more phonemes and can therefore produce words like &quot;to&quot; better).  Default is hiragana because I find hiragana easier to read than katakana, although the Kyoko voice does seem to be able to say &#39;v&#39; a little better when using kata.  Mac OS 10.7+&#39;s Korean voices (Yuna and Narae) can also read kana, and you could try doing a makeVariantDic and adding in some Korean jamo letters for them (you&#39;d be pushed to represent everything in jamo but kana+jamo seems more hopeful in theory), but again some words work better than others (not all phonetic combinations are supported and some words aren&#39;t clear at all).</span>
</span><span id="LexFormats-1928"><a href="#LexFormats-1928"><span class="linenos">1928</span></a>    <span class="c1"># This kana-approx format is &#39;write-only&#39; for now (see comment in cleanup_regexps re possible reversal)</span>
</span><span id="LexFormats-1929"><a href="#LexFormats-1929"><span class="linenos">1929</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">primary_stress</span><span class="p">),</span>
</span><span id="LexFormats-1930"><a href="#LexFormats-1930"><span class="linenos">1930</span></a>    <span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;KANA_MORE_EMPH&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># set KANA_MORE_EMPH environment variable if you want to try doubling the secondary-stressed vowels as well (doesn&#39;t always work very well; if it did, I&#39;d put this line in a makeVariantDic called kana-approx-moreEmph or something)</span>
</span><span id="LexFormats-1931"><a href="#LexFormats-1931"><span class="linenos">1931</span></a>    <span class="c1"># The following Unicode codepoints are hiragana; KANA_TYPE is handled by cleanup_func below</span>
</span><span id="LexFormats-1932"><a href="#LexFormats-1932"><span class="linenos">1932</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_apple</span><span class="p">),</span>
</span><span id="LexFormats-1933"><a href="#LexFormats-1933"><span class="linenos">1933</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_eat</span><span class="p">),</span>
</span><span id="LexFormats-1934"><a href="#LexFormats-1934"><span class="linenos">1934</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oo_as_in_food</span><span class="p">),</span>
</span><span id="LexFormats-1935"><a href="#LexFormats-1935"><span class="linenos">1935</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">e_as_in_them</span><span class="p">),</span>
</span><span id="LexFormats-1936"><a href="#LexFormats-1936"><span class="linenos">1936</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_orange</span><span class="p">),</span>
</span><span id="LexFormats-1937"><a href="#LexFormats-1937"><span class="linenos">1937</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">eye</span><span class="p">),</span> <span class="c1"># ai</span>
</span><span id="LexFormats-1938"><a href="#LexFormats-1938"><span class="linenos">1938</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_now</span><span class="p">),</span> <span class="c1"># ao</span>
</span><span id="LexFormats-1939"><a href="#LexFormats-1939"><span class="linenos">1939</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">a_as_in_ate</span><span class="p">),</span> <span class="c1"># ei</span>
</span><span id="LexFormats-1940"><a href="#LexFormats-1940"><span class="linenos">1940</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">oy_as_in_toy</span><span class="p">),</span> <span class="c1"># oi</span>
</span><span id="LexFormats-1941"><a href="#LexFormats-1941"><span class="linenos">1941</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">o_as_in_go</span><span class="p">),</span> <span class="c1"># ou</span>
</span><span id="LexFormats-1942"><a href="#LexFormats-1942"><span class="linenos">1942</span></a>    <span class="p">(</span><span class="n">a_as_in_ah</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1943"><a href="#LexFormats-1943"><span class="linenos">1943</span></a>    <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: \u3042, \u304a or \u3046 depending on the word?</span>
</span><span id="LexFormats-1944"><a href="#LexFormats-1944"><span class="linenos">1944</span></a>    <span class="p">(</span><span class="n">e_as_in_herd</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3042</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1945"><a href="#LexFormats-1945"><span class="linenos">1945</span></a>    <span class="p">(</span><span class="n">i_as_in_it</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1946"><a href="#LexFormats-1946"><span class="linenos">1946</span></a>    <span class="p">(</span><span class="n">u_as_in_but</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1947"><a href="#LexFormats-1947"><span class="linenos">1947</span></a>    <span class="p">(</span><span class="n">ar_as_in_year</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1948"><a href="#LexFormats-1948"><span class="linenos">1948</span></a>    <span class="p">(</span><span class="n">ear</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3044\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1949"><a href="#LexFormats-1949"><span class="linenos">1949</span></a>    <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3048</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1950"><a href="#LexFormats-1950"><span class="linenos">1950</span></a>    <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1951"><a href="#LexFormats-1951"><span class="linenos">1951</span></a>    <span class="p">(</span><span class="n">close_to_or</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304a\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># TODO: really?</span>
</span><span id="LexFormats-1952"><a href="#LexFormats-1952"><span class="linenos">1952</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3076</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">b</span><span class="p">),</span> <span class="c1"># bu (with vowel replacements later)</span>
</span><span id="LexFormats-1953"><a href="#LexFormats-1953"><span class="linenos">1953</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3061\u3047</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ch</span><span class="p">),</span> <span class="c1"># chu (ditto)</span>
</span><span id="LexFormats-1954"><a href="#LexFormats-1954"><span class="linenos">1954</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3065</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">d</span><span class="p">),</span> <span class="c1"># du (and so on)</span>
</span><span id="LexFormats-1955"><a href="#LexFormats-1955"><span class="linenos">1955</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">th_as_in_think</span><span class="p">),</span> <span class="p">(</span><span class="n">th_as_in_them</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1956"><a href="#LexFormats-1956"><span class="linenos">1956</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3075</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">f</span><span class="p">),</span>
</span><span id="LexFormats-1957"><a href="#LexFormats-1957"><span class="linenos">1957</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">g</span><span class="p">),</span>
</span><span id="LexFormats-1958"><a href="#LexFormats-1958"><span class="linenos">1958</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u306f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">h</span><span class="p">),</span> <span class="c1"># ha (as hu == fu)</span>
</span><span id="LexFormats-1959"><a href="#LexFormats-1959"><span class="linenos">1959</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3058\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">j_as_in_jump</span><span class="p">),</span> <span class="p">(</span><span class="n">ge_of_blige_etc</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3058\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1960"><a href="#LexFormats-1960"><span class="linenos">1960</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u304f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">),</span>
</span><span id="LexFormats-1961"><a href="#LexFormats-1961"><span class="linenos">1961</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308b</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">l</span><span class="p">),</span> <span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308b</span><span class="s1">&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">),</span>
</span><span id="LexFormats-1962"><a href="#LexFormats-1962"><span class="linenos">1962</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3080</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span>
</span><span id="LexFormats-1963"><a href="#LexFormats-1963"><span class="linenos">1963</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u306c</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">n</span><span class="p">),</span>
</span><span id="LexFormats-1964"><a href="#LexFormats-1964"><span class="linenos">1964</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3093\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">ng</span><span class="p">),</span>
</span><span id="LexFormats-1965"><a href="#LexFormats-1965"><span class="linenos">1965</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3077</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">p</span><span class="p">),</span>
</span><span id="LexFormats-1966"><a href="#LexFormats-1966"><span class="linenos">1966</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3059</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">s</span><span class="p">),</span>
</span><span id="LexFormats-1967"><a href="#LexFormats-1967"><span class="linenos">1967</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3057\u3085</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">sh</span><span class="p">),</span>
</span><span id="LexFormats-1968"><a href="#LexFormats-1968"><span class="linenos">1968</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3064</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">),</span>
</span><span id="LexFormats-1969"><a href="#LexFormats-1969"><span class="linenos">1969</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308f</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="c1"># use &#39;wa&#39; (as &#39;wu&#39; == &#39;u&#39;)</span>
</span><span id="LexFormats-1970"><a href="#LexFormats-1970"><span class="linenos">1970</span></a>    <span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;KANA_V_AS_W&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u308f</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3094</span><span class="s1">&#39;</span><span class="p">),</span><span class="kc">False</span><span class="p">),</span> <span class="c1"># TODO: document KANA_V_AS_W variable.  Is vu always supported? (it doesn&#39;t seem to show up in all fonts)</span>
</span><span id="LexFormats-1971"><a href="#LexFormats-1971"><span class="linenos">1971</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3086</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">y</span><span class="p">),</span>
</span><span id="LexFormats-1972"><a href="#LexFormats-1972"><span class="linenos">1972</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u305a</span><span class="s1">&#39;</span><span class="p">,</span><span class="n">z</span><span class="p">),</span>
</span><span id="LexFormats-1973"><a href="#LexFormats-1973"><span class="linenos">1973</span></a>    <span class="n">lex_filename</span><span class="o">=</span><span class="s2">&quot;words-kana-approx.txt&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1974"><a href="#LexFormats-1974"><span class="linenos">1974</span></a>    <span class="n">lex_type</span> <span class="o">=</span> <span class="s2">&quot;text&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1975"><a href="#LexFormats-1975"><span class="linenos">1975</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="s2">&quot;Kana approxmations (very approximate!)</span><span class="se">\n</span><span class="s2">--------------------------------------</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1976"><a href="#LexFormats-1976"><span class="linenos">1976</span></a>    <span class="n">lex_entry_format</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> ~= </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1977"><a href="#LexFormats-1977"><span class="linenos">1977</span></a>    <span class="n">word_separator</span><span class="o">=</span><span class="s2">&quot; &quot;</span><span class="p">,</span><span class="n">phoneme_separator</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
</span><span id="LexFormats-1978"><a href="#LexFormats-1978"><span class="linenos">1978</span></a>    <span class="n">clause_separator</span><span class="o">=</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3002\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span>
</span><span id="LexFormats-1979"><a href="#LexFormats-1979"><span class="linenos">1979</span></a>    <span class="n">cleanup_regexps</span><span class="o">=</span><span class="p">[(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c</span><span class="s2">$&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3093\u30fc</span><span class="s2">&quot;</span><span class="p">),</span> <span class="c1"># TODO: or u&quot;\u3093\u3093&quot; ?</span>
</span><span id="LexFormats-1980"><a href="#LexFormats-1980"><span class="linenos">1980</span></a>       <span class="c1"># now the vowel replacements (bu+a -&gt; ba, etc) (in most cases these can be reversed into cvtOut_regexps if you want to use the kana-approx table to convert hiragana into approximate English phonemes (plus add a (u&quot;\u3093\u30fc*&quot;,u&quot;\u306c&quot;) and perhaps de-doubling rules to convert back to emphasis) but the result is unlikely to be any good)</span>
</span><span id="LexFormats-1981"><a href="#LexFormats-1981"><span class="linenos">1981</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3070</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3073</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3079</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3076</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1982"><a href="#LexFormats-1982"><span class="linenos">1982</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1983"><a href="#LexFormats-1983"><span class="linenos">1983</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3060</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3062</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3067</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3069</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3065</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1984"><a href="#LexFormats-1984"><span class="linenos">1984</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3043\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066\u3087</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1985"><a href="#LexFormats-1985"><span class="linenos">1985</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3041</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3049</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1986"><a href="#LexFormats-1986"><span class="linenos">1986</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3072</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3075</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3078</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1987"><a href="#LexFormats-1987"><span class="linenos">1987</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3052</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3054</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3050</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1988"><a href="#LexFormats-1988"><span class="linenos">1988</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1989"><a href="#LexFormats-1989"><span class="linenos">1989</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3051</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3053</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u304f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1990"><a href="#LexFormats-1990"><span class="linenos">1990</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3089</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308b</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1991"><a href="#LexFormats-1991"><span class="linenos">1991</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307f</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3081</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3082</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3080</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1992"><a href="#LexFormats-1992"><span class="linenos">1992</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u306c</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1993"><a href="#LexFormats-1993"><span class="linenos">1993</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3071</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3074</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307a</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u307d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3077</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1994"><a href="#LexFormats-1994"><span class="linenos">1994</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3055</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305b</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305d</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3059</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1995"><a href="#LexFormats-1995"><span class="linenos">1995</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3083</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3087</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057\u3085\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3057</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1996"><a href="#LexFormats-1996"><span class="linenos">1996</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305f</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3061</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3066</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3068</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3064</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1997"><a href="#LexFormats-1997"><span class="linenos">1997</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3084</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3044\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3088</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3086</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1998"><a href="#LexFormats-1998"><span class="linenos">1998</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3056</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3058</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305c</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305e</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u305a</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-1999"><a href="#LexFormats-1999"><span class="linenos">1999</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3044</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046\u3043</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3046</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3048</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3046\u3047</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u304a</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u3092</span><span class="s2">&quot;</span><span class="p">),(</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f\u3042</span><span class="s2">&quot;</span><span class="p">,</span><span class="sa">u</span><span class="s2">&quot;</span><span class="se">\u308f</span><span class="s2">&quot;</span><span class="p">),</span>
</span><span id="LexFormats-2000"><a href="#LexFormats-2000"><span class="linenos">2000</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u3043\u3066\u3085</span><span class="s1">&#39;</span><span class="p">,</span> <span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3046\u3043\u3065</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># sounds a bit better for words like &#39;with&#39;</span>
</span><span id="LexFormats-2001"><a href="#LexFormats-2001"><span class="linenos">2001</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3085\u3046</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3085</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># and &#39;the&#39; (especially with a_as_in_ago mapping to u&#39;\u3046\u304a&#39;; it&#39;s hard to get a convincing &#39;the&#39; though, especially in isolation)</span>
</span><span id="LexFormats-2002"><a href="#LexFormats-2002"><span class="linenos">2002</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050\u3050</span><span class="s1">&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u3050</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># gugu -&gt; gu, sometimes comes up with &#39;gl-&#39; combinations</span>
</span><span id="LexFormats-2003"><a href="#LexFormats-2003"><span class="linenos">2003</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc\u30fc</span><span class="s1">+&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># in case we put 30fc in the table AND a stress mark has been applied to it</span>
</span><span id="LexFormats-2004"><a href="#LexFormats-2004"><span class="linenos">2004</span></a>       <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;^(.)$&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">1</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># lengthen any word that ends up as a single kana (otherwise can be clipped badly)</span>
</span><span id="LexFormats-2005"><a href="#LexFormats-2005"><span class="linenos">2005</span></a>    <span class="p">(</span><span class="sa">u</span><span class="s1">&#39;^([</span><span class="se">\u3042\u3070\u3060\u304c\u304b\u3089\u307e\u306a\u3071\u3055\u305f\u3084\u3056\u308f</span><span class="s1">]</span><span class="se">\u3044</span><span class="s1">)$&#39;</span><span class="p">,</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">1</span><span class="se">\u30fc</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1"># ditto for -ai (TODO: -ao might need lengthening sometimes?? depends on context.  -ei, -oi, -ou seem OK)</span>
</span><span id="LexFormats-2006"><a href="#LexFormats-2006"><span class="linenos">2006</span></a>    <span class="p">],</span>
</span><span id="LexFormats-2007"><a href="#LexFormats-2007"><span class="linenos">2007</span></a>    <span class="n">cleanup_func</span> <span class="o">=</span> <span class="n">hiragana_to_katakana</span>
</span><span id="LexFormats-2008"><a href="#LexFormats-2008"><span class="linenos">2008</span></a>  <span class="p">),</span>
</span><span id="LexFormats-2009"><a href="#LexFormats-2009"><span class="linenos">2009</span></a>  <span class="s2">&quot;names&quot;</span> <span class="p">:</span> <span class="n">makeDic</span><span class="p">(</span>
</span><span id="LexFormats-2010"><a href="#LexFormats-2010"><span class="linenos">2010</span></a>    <span class="s2">&quot;Lexconvert internal phoneme names (sometimes useful with the --phones option while developing new formats)&quot;</span><span class="p">,</span>
</span><span id="LexFormats-2011"><a href="#LexFormats-2011"><span class="linenos">2011</span></a>     <span class="o">*</span><span class="p">[(</span><span class="n">phName</span><span class="p">,</span><span class="n">phVal</span><span class="p">)</span> <span class="k">for</span> <span class="n">phName</span><span class="p">,</span><span class="n">phVal</span> <span class="ow">in</span> <span class="n">phonemes</span><span class="o">.</span><span class="n">items</span><span class="p">()])}</span>
</span></pre></div>


            <div class="docstring"><p>Makes the phoneme conversion tables of each format.
Each table has string to phoneme entries and phoneme
to string entries.  The string to phoneme entries are
used when converting OUT of that format, and the
phoneme to string entries are used when converting IN
(so you can recognise phonemes you don't support and
convert them to something else).  By default, a tuple
of the form (string,phoneme) will create entries in
BOTH directions; one-directional entries are created
via (string,phoneme,False) or (phoneme,string,False).
The makeDic function checks the keys are unique.</p>

<p>First parameter is always a description of the
format, then come the phoneme entries as described
above, then any additional settings:</p>

<p>stress_comes_before_vowel (default False means any
  stress mark goes AFTER the affected vowel; set to
  True if the format requires stress placed before)</p>

<p>word_separator (default same as phoneme_separator)
  phoneme_separator (default " ")
  clause_separator (default newline)</p>

<p>(For a special case, clause_separator can also be
   set to a function.  If that happens, the function
   will be called whenever lexconvert needs to output
   a list of (lists of words) in this format.  See
   bbcmicro for an example function clause_separator)</p>

<p>safe_to_drop_characters (default False, can be a
  string of safe characters or True = all; controls
  warnings when unrecognised characters are found)</p>

<p>approximate_missing (default False) - if True,
  makeDic will attempt to compensate for missing
  phonemes by approximating them to others, instead of
  warning about them.  This is useful for American codes
  that can't cope with all the British English phonemes.
  (Approximation is done automatically anyway in the
  case of variant phonemes; approximate_missing adds in
  some additional approximations - see comments in code)</p>

<p>cleanup_regexps (default none) - optional list of
  (search,replace) regular expressions to "clean up"
  after converting each word INTO this format
  cleanup_func (default none) - optional special-case
  function to pass result through after cleanup_regexps</p>

<p>cvtOut_regexps (default none) - optional list of
  (search,replace) regular expressions to "clean up"
  before starting to convert OUT of this format
  cvtOut_func (default none) - optional special-case
  function to pass through before any cvtOut_regexps</p>

<p>inline_format (default "%s") the format string for
  printing a word with --phones or --phones2phones
  (can be used to put markup around each word)
  (can also be a function taking the phonetic word
   and returning the resulting string, e.g. bbcmicro)</p>

<p>output_is_binary (default False) - True if the output
  is almost certainly unsuitable for a terminal; will
  cause lexconvert to refuse to print phonemes unless
  its standard output is redirected to a file or pipe
  (affects the --phones and --phones2phones options)</p>

<p>inline_header (default none) text to print first
    when outputting from --phones or --phones2phones
  inline_footer (default none) text to print last
  inline_oneoff_header (default none) text to print
    before inline_header on the first time only</p>

<p>lex_filename - filename of a lexicon file.  If this
  is not specified, there is no support for writing a
  lexicon in this format: there can still be READ
  support if you define lex_read_function to open the
  lexicon by itself, but otherwise the format can be
  used only with --phones and --phones2phones.</p>

<p>lex_entry_format - format string for writing each
  (word, pronunciation) entry to the lexicon file.
  This is also needed for lexicon-write support.</p>

<p>lex_header, lex_footer - optional strings to write
  at the beginning and at the end of the lexicon file
  (can also be functions that take the open file as a
   parameter, e.g. for bbcmicro; lex_footer is
   allowed to close the file if it needs to do
   something with it afterwards)</p>

<p>lex_word_case - optional "upper" or "lower" to
  force a particular case for lexicon words (not
  pronunciations - they're determined by the table).
  The default is to allow words to be in either case.</p>

<p>lex_type (default "") - used by the --formats
  option when summarising the support for each format</p>

<p>lex_read_function - Python function to READ the
  lexicon file and return a (word,phonemes) list.
  If this is not specified, there's no read support
  for lexicons in this format (but there can still be
  write support - see above - and you can still use
  --phones and --phones2phones).  If lex_filename is
  specified then this function will be given the open
  file as a parameter.</p>
</div>


                </section>
                <section id="mainopt_try">
                            <input id="mainopt_try-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_try</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_try-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_try"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_try-2023"><a href="#mainopt_try-2023"><span class="linenos">2023</span></a><span class="k">def</span> <span class="nf">mainopt_try</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_try-2024"><a href="#mainopt_try-2024"><span class="linenos">2024</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="mainopt_try-2025"><a href="#mainopt_try-2025"><span class="linenos">2025</span></a><span class="sd">Convert input from &lt;format&gt; into eSpeak and try it out.</span>
</span><span id="mainopt_try-2026"><a href="#mainopt_try-2026"><span class="linenos">2026</span></a><span class="sd">(Requires the &#39;espeak&#39; command.)</span>
</span><span id="mainopt_try-2027"><a href="#mainopt_try-2027"><span class="linenos">2027</span></a><span class="sd">E.g.: python lexconvert.py --try festival h @0 l ou1</span>
</span><span id="mainopt_try-2028"><a href="#mainopt_try-2028"><span class="linenos">2028</span></a><span class="sd"> or: python lexconvert.py --try unicode-ipa &#39;\\u02c8\\u0279\\u026adn\\u0329&#39; (for Unicode put &#39;\\uNNNN&#39; or UTF-8)&quot;&quot;&quot;</span>
</span><span id="mainopt_try-2029"><a href="#mainopt_try-2029"><span class="linenos">2029</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_try-2030"><a href="#mainopt_try-2030"><span class="linenos">2030</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_try-2031"><a href="#mainopt_try-2031"><span class="linenos">2031</span></a>   <span class="k">for</span> <span class="n">phones</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="mainopt_try-2032"><a href="#mainopt_try-2032"><span class="linenos">2032</span></a>      <span class="n">espeak</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">phones</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;espeak&#39;</span><span class="p">)</span>
</span><span id="mainopt_try-2033"><a href="#mainopt_try-2033"><span class="linenos">2033</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -x&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="mainopt_try-2034"><a href="#mainopt_try-2034"><span class="linenos">2034</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">espeak</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))</span> <span class="c1"># separate process each item for more responsiveness from the console (sending &#39;maybe&#39; to getInputText means won&#39;t lose efficiency if not read from console)</span>
</span></pre></div>


            <div class="docstring"><p>*<format> [<pronunciation>]
Convert input from <format> into eSpeak and try it out.
(Requires the 'espeak' command.)
E.g.: python lexconvert.py --try festival h @0 l ou1
 or: python lexconvert.py --try unicode-ipa '\u02c8\u0279\u026adn\u0329' (for Unicode put '\uNNNN' or UTF-8)</p>
</div>


                </section>
                <section id="mainopt_trymac">
                            <input id="mainopt_trymac-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_trymac</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_trymac-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_trymac"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_trymac-2036"><a href="#mainopt_trymac-2036"><span class="linenos">2036</span></a><span class="k">def</span> <span class="nf">mainopt_trymac</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_trymac-2037"><a href="#mainopt_trymac-2037"><span class="linenos">2037</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="mainopt_trymac-2038"><a href="#mainopt_trymac-2038"><span class="linenos">2038</span></a><span class="sd">Convert phonemes from &lt;format&gt; into Mac and try it using the Mac OS &#39;say&#39; command&quot;&quot;&quot;</span>
</span><span id="mainopt_trymac-2039"><a href="#mainopt_trymac-2039"><span class="linenos">2039</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_trymac-2040"><a href="#mainopt_trymac-2040"><span class="linenos">2040</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_trymac-2041"><a href="#mainopt_trymac-2041"><span class="linenos">2041</span></a>   <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="mainopt_trymac-2042"><a href="#mainopt_trymac-2042"><span class="linenos">2042</span></a>      <span class="n">mac</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;mac&#39;</span><span class="p">)</span>
</span><span id="mainopt_trymac-2043"><a href="#mainopt_trymac-2043"><span class="linenos">2043</span></a>      <span class="n">toSay</span> <span class="o">=</span> <span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;mac&quot;</span><span class="p">,</span><span class="n">mac</span><span class="p">)</span>
</span><span id="mainopt_trymac-2044"><a href="#mainopt_trymac-2044"><span class="linenos">2044</span></a>      <span class="nb">print</span><span class="p">(</span><span class="n">as_printable</span><span class="p">(</span><span class="n">toSay</span><span class="p">))</span>
</span><span id="mainopt_trymac-2045"><a href="#mainopt_trymac-2045"><span class="linenos">2045</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v Vicki&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="mainopt_trymac-2046"><a href="#mainopt_trymac-2046"><span class="linenos">2046</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">toSay</span><span class="p">)</span> <span class="c1"># Need to specify a voice because the default voice might not be able to take Apple phonemes.  Vicki has been available since 10.3, as has the &#39;say&#39; command (previous versions need osascript, see Gradint&#39;s code)</span>
</span></pre></div>


            <div class="docstring"><p>*<format> [<pronunciation>]
Convert phonemes from <format> into Mac and try it using the Mac OS 'say' command</p>
</div>


                </section>
                <section id="mainopt_trymac_uk">
                            <input id="mainopt_trymac_uk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_trymac_uk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_trymac_uk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_trymac_uk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_trymac_uk-2048"><a href="#mainopt_trymac_uk-2048"><span class="linenos">2048</span></a><span class="k">def</span> <span class="nf">mainopt_trymac_uk</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_trymac_uk-2049"><a href="#mainopt_trymac_uk-2049"><span class="linenos">2049</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;pronunciation&gt;]</span>
</span><span id="mainopt_trymac_uk-2050"><a href="#mainopt_trymac_uk-2050"><span class="linenos">2050</span></a><span class="sd">Convert phonemes from &lt;format&gt; and try it with Mac OS British voices (see --mac-uk for details)&quot;&quot;&quot;</span>
</span><span id="mainopt_trymac_uk-2051"><a href="#mainopt_trymac_uk-2051"><span class="linenos">2051</span></a>   <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;--trymac-uk has not been tested with Python 3, I don&#39;t want to risk messing up your system files, please use Python 2&quot;</span>
</span><span id="mainopt_trymac_uk-2052"><a href="#mainopt_trymac_uk-2052"><span class="linenos">2052</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_trymac_uk-2053"><a href="#mainopt_trymac_uk-2053"><span class="linenos">2053</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_trymac_uk-2054"><a href="#mainopt_trymac_uk-2054"><span class="linenos">2054</span></a>   <span class="k">for</span> <span class="n">resp</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="nb">format</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="mainopt_trymac_uk-2055"><a href="#mainopt_trymac_uk-2055"><span class="linenos">2055</span></a>     <span class="n">macuk</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">resp</span><span class="p">,</span><span class="nb">format</span><span class="p">,</span><span class="s1">&#39;mac-uk&#39;</span><span class="p">)</span>
</span><span id="mainopt_trymac_uk-2056"><a href="#mainopt_trymac_uk-2056"><span class="linenos">2056</span></a>     <span class="n">m</span> <span class="o">=</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span>
</span><span id="mainopt_trymac_uk-2057"><a href="#mainopt_trymac_uk-2057"><span class="linenos">2057</span></a>     <span class="k">try</span><span class="p">:</span>
</span><span id="mainopt_trymac_uk-2058"><a href="#mainopt_trymac_uk-2058"><span class="linenos">2058</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">speakPhones</span><span class="p">(</span><span class="n">macuk</span><span class="o">.</span><span class="n">split</span><span class="p">())</span>
</span><span id="mainopt_trymac_uk-2059"><a href="#mainopt_trymac_uk-2059"><span class="linenos">2059</span></a>      <span class="k">finally</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="mainopt_trymac_uk-2060"><a href="#mainopt_trymac_uk-2060"><span class="linenos">2060</span></a>     <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="mainopt_trymac_uk-2061"><a href="#mainopt_trymac_uk-2061"><span class="linenos">2061</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interrupted</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>*<format> [<pronunciation>]
Convert phonemes from <format> and try it with Mac OS British voices (see --mac-uk for details)</p>
</div>


                </section>
                <section id="mainopt_phones">
                            <input id="mainopt_phones-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_phones</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_phones-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_phones"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_phones-2063"><a href="#mainopt_phones-2063"><span class="linenos">2063</span></a><span class="k">def</span> <span class="nf">mainopt_phones</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_phones-2064"><a href="#mainopt_phones-2064"><span class="linenos">2064</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;words&gt;]</span>
</span><span id="mainopt_phones-2065"><a href="#mainopt_phones-2065"><span class="linenos">2065</span></a><span class="sd">Use eSpeak to convert text to phonemes, and then convert the phonemes to format &#39;format&#39;.</span>
</span><span id="mainopt_phones-2066"><a href="#mainopt_phones-2066"><span class="linenos">2066</span></a><span class="sd">E.g.: python lexconvert.py --phones unicode-ipa This is a test sentence.</span>
</span><span id="mainopt_phones-2067"><a href="#mainopt_phones-2067"><span class="linenos">2067</span></a><span class="sd">Set environment variable PHONES_PIPE_COMMAND to an additional command to which to write the phones as well as standard output.  (If standard input is a terminal then this will be done separately after each line.)</span>
</span><span id="mainopt_phones-2068"><a href="#mainopt_phones-2068"><span class="linenos">2068</span></a><span class="sd">(Some commercial speech synthesizers do not work well when driven entirely from phonemes, because their internal format is different and is optimised for normal text.)</span>
</span><span id="mainopt_phones-2069"><a href="#mainopt_phones-2069"><span class="linenos">2069</span></a><span class="sd">Set format to &#39;all&#39; if you want to see the phonemes in ALL supported formats.&quot;&quot;&quot;</span>
</span><span id="mainopt_phones-2070"><a href="#mainopt_phones-2070"><span class="linenos">2070</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_phones-2071"><a href="#mainopt_phones-2071"><span class="linenos">2071</span></a>   <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The &#39;example&#39; format cannot be used with --phones; try --convert, or did you mean --phones festival&quot;</span> <span class="c1"># could allow example anyway as it&#39;s basically Festival, but save confusion as eSpeak might not generate the same phonemes if our example words haven&#39;t been installed in the system&#39;s eSpeak.  (Still allow it to be used in --try etc though.)</span>
</span><span id="mainopt_phones-2072"><a href="#mainopt_phones-2072"><span class="linenos">2072</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_phones-2073"><a href="#mainopt_phones-2073"><span class="linenos">2073</span></a>   <span class="n">hadOneoff</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="mainopt_phones-2074"><a href="#mainopt_phones-2074"><span class="linenos">2074</span></a>   <span class="k">for</span> <span class="n">response</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="mainopt_phones-2075"><a href="#mainopt_phones-2075"><span class="linenos">2075</span></a>    <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">response</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)))</span> <span class="c1"># (remove any 2032 and b7 pronunciation marks before passing to eSpeak)</span>
</span><span id="mainopt_phones-2076"><a href="#mainopt_phones-2076"><span class="linenos">2076</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="mainopt_phones-2077"><a href="#mainopt_phones-2077"><span class="linenos">2077</span></a>    <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</span><span id="mainopt_phones-2078"><a href="#mainopt_phones-2078"><span class="linenos">2078</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="nb">format</span><span class="p">]</span>
</span><span id="mainopt_phones-2079"><a href="#mainopt_phones-2079"><span class="linenos">2079</span></a>    <span class="k">for</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
</span><span id="mainopt_phones-2080"><a href="#mainopt_phones-2080"><span class="linenos">2080</span></a>       <span class="k">def</span> <span class="nf">out</span><span class="p">(</span><span class="n">doOneoff</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
</span><span id="mainopt_phones-2081"><a href="#mainopt_phones-2081"><span class="linenos">2081</span></a>          <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">writeFormatHeader</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="mainopt_phones-2082"><a href="#mainopt_phones-2082"><span class="linenos">2082</span></a>          <span class="k">if</span> <span class="n">doOneoff</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_oneoff_header&quot;</span><span class="p">)))</span>
</span><span id="mainopt_phones-2083"><a href="#mainopt_phones-2083"><span class="linenos">2083</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_header&quot;</span><span class="p">)))</span>
</span><span id="mainopt_phones-2084"><a href="#mainopt_phones-2084"><span class="linenos">2084</span></a>          <span class="n">output_clauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">response</span><span class="p">),</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="nb">format</span><span class="p">))</span>
</span><span id="mainopt_phones-2085"><a href="#mainopt_phones-2085"><span class="linenos">2085</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_footer&quot;</span><span class="p">)))</span>
</span><span id="mainopt_phones-2086"><a href="#mainopt_phones-2086"><span class="linenos">2086</span></a>          <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="mainopt_phones-2087"><a href="#mainopt_phones-2087"><span class="linenos">2087</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># in case it&#39;s being piped</span>
</span><span id="mainopt_phones-2088"><a href="#mainopt_phones-2088"><span class="linenos">2088</span></a>       <span class="n">out</span><span class="p">(</span><span class="ow">not</span> <span class="n">hadOneoff</span><span class="p">)</span> <span class="p">;</span> <span class="n">hadOneoff</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="mainopt_phones-2089"><a href="#mainopt_phones-2089"><span class="linenos">2089</span></a>       <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;PHONES_PIPE_COMMAND&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="mainopt_phones-2090"><a href="#mainopt_phones-2090"><span class="linenos">2090</span></a>          <span class="n">o</span><span class="p">,</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PHONES_PIPE_COMMAND&quot;</span><span class="p">],</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="mainopt_phones-2091"><a href="#mainopt_phones-2091"><span class="linenos">2091</span></a>          <span class="n">out</span><span class="p">()</span>
</span><span id="mainopt_phones-2092"><a href="#mainopt_phones-2092"><span class="linenos">2092</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span> <span class="o">=</span> <span class="n">o</span>
</span></pre></div>


            <div class="docstring"><p>*<format> [<words>]
Use eSpeak to convert text to phonemes, and then convert the phonemes to format 'format'.
E.g.: python lexconvert.py --phones unicode-ipa This is a test sentence.
Set environment variable PHONES_PIPE_COMMAND to an additional command to which to write the phones as well as standard output.  (If standard input is a terminal then this will be done separately after each line.)
(Some commercial speech synthesizers do not work well when driven entirely from phonemes, because their internal format is different and is optimised for normal text.)
Set format to 'all' if you want to see the phonemes in ALL supported formats.</p>
</div>


                </section>
                <section id="mainopt_ruby">
                            <input id="mainopt_ruby-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_ruby</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_ruby-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_ruby"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_ruby-2094"><a href="#mainopt_ruby-2094"><span class="linenos">2094</span></a><span class="k">def</span> <span class="nf">mainopt_ruby</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_ruby-2095"><a href="#mainopt_ruby-2095"><span class="linenos">2095</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format&gt; [&lt;words&gt;]</span>
</span><span id="mainopt_ruby-2096"><a href="#mainopt_ruby-2096"><span class="linenos">2096</span></a><span class="sd">Like --phones but outputs the result as HTML RUBY markup, with each word&#39;s pronunciation symbols placed above the corresponding English word.</span>
</span><span id="mainopt_ruby-2097"><a href="#mainopt_ruby-2097"><span class="linenos">2097</span></a><span class="sd">E.g.: python lexconvert.py --ruby unicode-ipa This is a test sentence.</span>
</span><span id="mainopt_ruby-2098"><a href="#mainopt_ruby-2098"><span class="linenos">2098</span></a><span class="sd">This option is made more complicated by the fact that different versions of eSpeak may space the phoneme output differently, for example when handling numbers; if your eSpeak version is not recognised then all numbers are unannotated. Anyway you are advised not to rely on this option working with the new development NG versions of eSpeak. If the version you have behaves unexpectedly, words and phonemes output might lose synchronisation. However this option is believed to be stable when used with simple text and the original eSpeak.</span>
</span><span id="mainopt_ruby-2099"><a href="#mainopt_ruby-2099"><span class="linenos">2099</span></a><span class="sd">You can optionally set the RUBY_GRADINT_CGI environment variable to the URL of an instance of Gradint Web Edition to generate audio links for each word.  If doing this in a Web Adjuster filter, see comments in the lexconvert source for setup details.&quot;&quot;&quot;</span>
</span><span id="mainopt_ruby-2100"><a href="#mainopt_ruby-2100"><span class="linenos">2100</span></a>   <span class="c1"># htmlFilter with --htmlText of course.  Set separator to two newlines and copy the generated &#39;h5a&#39; function (from a manual run or the lexconvert source) into Adjuster&#39;s headAppend option (but don&#39;t expect HTML5 audio to work from Adjuster&#39;s submitBookmarklet option; pronunciation links will take you off the page if it doesn&#39;t).</span>
</span><span id="mainopt_ruby-2101"><a href="#mainopt_ruby-2101"><span class="linenos">2101</span></a>   <span class="c1"># Use double newlines as single newlines are used in the h5a script; adding that script via bookmarklet doesn&#39;t always run it</span>
</span><span id="mainopt_ruby-2102"><a href="#mainopt_ruby-2102"><span class="linenos">2102</span></a>   <span class="nb">format</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_ruby-2103"><a href="#mainopt_ruby-2103"><span class="linenos">2103</span></a>   <span class="k">if</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The &#39;example&#39; format cannot be used with --ruby; did you mean festival?&quot;</span> <span class="c1"># as above</span>
</span><span id="mainopt_ruby-2104"><a href="#mainopt_ruby-2104"><span class="linenos">2104</span></a>   <span class="k">elif</span> <span class="nb">format</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;The --phones all option cannot be used with --ruby&quot;</span> <span class="c1"># (well you could implement it if you want but the resulting ruby would be quite unwieldy)</span>
</span><span id="mainopt_ruby-2105"><a href="#mainopt_ruby-2105"><span class="linenos">2105</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="nb">format</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_ruby-2106"><a href="#mainopt_ruby-2106"><span class="linenos">2106</span></a>   <span class="n">text</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2019</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00a0</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">))</span>
</span><span id="mainopt_ruby-2107"><a href="#mainopt_ruby-2107"><span class="linenos">2107</span></a>   <span class="c1"># eSpeak&#39;s basic idea of an alphabetical word (most versions?) -</span>
</span><span id="mainopt_ruby-2108"><a href="#mainopt_ruby-2108"><span class="linenos">2108</span></a>   <span class="n">wordRegexps</span> <span class="o">=</span> <span class="p">[</span><span class="sa">r</span><span class="s2">&quot;(?:[A-Z]+[&#39;?-])*(?:(?:(?&lt;![A-z.])(?:[A-z]\.)+[A-z](?![A-z.]))|[A-Z]+[a-z](?![A-z])|[A-Z][A-Z]+(?![a-z][A-z])|[A-Z]?(?:[a-z][&#39;?-]?)+|[A-Z])&quot;</span><span class="p">]</span>
</span><span id="mainopt_ruby-2109"><a href="#mainopt_ruby-2109"><span class="linenos">2109</span></a>   <span class="c1"># A dot, when not part of an elipses, followed by a letter is pronounced &quot;dot&quot;, and two of them are pronounced &quot;dot dot&quot;:</span>
</span><span id="mainopt_ruby-2110"><a href="#mainopt_ruby-2110"><span class="linenos">2110</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;!\.\.)\.(?=[A-z])|(?&lt;!\.)\.(?=\.[A-z])&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2111"><a href="#mainopt_ruby-2111"><span class="linenos">2111</span></a>   <span class="c1"># ! followed by a letter is pronounced &quot;exclamation&quot;, and .! is &quot;dotexclamation&quot;; @ symbols similarly; copyright</span>
</span><span id="mainopt_ruby-2112"><a href="#mainopt_ruby-2112"><span class="linenos">2112</span></a>   <span class="n">atEtc</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;(?:[@!:]|</span><span class="se">\u00a9</span><span class="s2">)*&quot;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2113"><a href="#mainopt_ruby-2113"><span class="linenos">2113</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?[!@]+(?=[A-z])|(?&lt;![A-z])@&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">atEtc</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;(?![A-z])|&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0xa9</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">atEtc</span><span class="p">)</span>
</span><span id="mainopt_ruby-2114"><a href="#mainopt_ruby-2114"><span class="linenos">2114</span></a>   <span class="c1"># : between numbers if NOT followed by 2 digits:</span>
</span><span id="mainopt_ruby-2115"><a href="#mainopt_ruby-2115"><span class="linenos">2115</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![A-z]):(?![A-z]|[0-9][0-9])&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2116"><a href="#mainopt_ruby-2116"><span class="linenos">2116</span></a>   <span class="c1"># - between numbers</span>
</span><span id="mainopt_ruby-2117"><a href="#mainopt_ruby-2117"><span class="linenos">2117</span></a>   <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9])-(?=[0-9])&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2118"><a href="#mainopt_ruby-2118"><span class="linenos">2118</span></a>   <span class="c1"># TODO: if you paste in (e.g.) CJK characters, eSpeak will say &quot;symbol-symbol-symbol&quot; etc, but this is not accounted for by the above regexp so it&#39;ll go onto following words.</span>
</span><span id="mainopt_ruby-2119"><a href="#mainopt_ruby-2119"><span class="linenos">2119</span></a>   <span class="n">vLine</span> <span class="o">=</span> <span class="n">espeak_version_line</span><span class="p">()</span>
</span><span id="mainopt_ruby-2120"><a href="#mainopt_ruby-2120"><span class="linenos">2120</span></a>   <span class="k">if</span> <span class="s2">&quot;1.45.&quot;</span> <span class="ow">in</span> <span class="n">vLine</span><span class="p">:</span>
</span><span id="mainopt_ruby-2121"><a href="#mainopt_ruby-2121"><span class="linenos">2121</span></a>      <span class="c1"># This seems to work in eSpeak 1.45:</span>
</span><span id="mainopt_ruby-2122"><a href="#mainopt_ruby-2122"><span class="linenos">2122</span></a>      <span class="c1"># (TODO: test leading 0s &amp; leading decimal)</span>
</span><span id="mainopt_ruby-2123"><a href="#mainopt_ruby-2123"><span class="linenos">2123</span></a>      <span class="c1"># a number of 4 digits or less (with any number of digits after the decimal point) is grouped as 1 word:</span>
</span><span id="mainopt_ruby-2124"><a href="#mainopt_ruby-2124"><span class="linenos">2124</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])[0-9]{1,4}(?:\.[0-9]+)?(?!,?[0-9])&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2125"><a href="#mainopt_ruby-2125"><span class="linenos">2125</span></a>      <span class="c1"># and a number of 1 to 3 digits with any number of 000 or ,000 groups, with optional decimal point followed by any number of digits, OR when placed before an integer number of 3-digit groups, is grouped as 1 word:</span>
</span><span id="mainopt_ruby-2126"><a href="#mainopt_ruby-2126"><span class="linenos">2126</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[0-9]{1,3}(?:,?000)*(?:\.[0-9]+)?,?(?=(?:,?[0-9]{3,3})*,?(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2127"><a href="#mainopt_ruby-2127"><span class="linenos">2127</span></a>      <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="mainopt_ruby-2128"><a href="#mainopt_ruby-2128"><span class="linenos">2128</span></a>   <span class="k">elif</span> <span class="s2">&quot;1.48.&quot;</span> <span class="ow">in</span> <span class="n">vLine</span><span class="p">:</span>
</span><span id="mainopt_ruby-2129"><a href="#mainopt_ruby-2129"><span class="linenos">2129</span></a>      <span class="c1"># In eSpeak 1.48 the groups are smaller.</span>
</span><span id="mainopt_ruby-2130"><a href="#mainopt_ruby-2130"><span class="linenos">2130</span></a>      <span class="c1"># Decimal point and everything after it = individual</span>
</span><span id="mainopt_ruby-2131"><a href="#mainopt_ruby-2131"><span class="linenos">2131</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9])\.(?=[0-9])&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2132"><a href="#mainopt_ruby-2132"><span class="linenos">2132</span></a>      <span class="k">for</span> <span class="n">places</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">25</span><span class="p">):</span> <span class="c1"># TODO: really want unbounded, but (?&lt;=...) is fixed-length</span>
</span><span id="mainopt_ruby-2133"><a href="#mainopt_ruby-2133"><span class="linenos">2133</span></a>         <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9]\.&quot;</span><span class="o">+</span><span class="s2">&quot;[0-9]&quot;</span><span class="o">*</span><span class="n">places</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;)[0-9]&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2134"><a href="#mainopt_ruby-2134"><span class="linenos">2134</span></a>      <span class="c1"># Number with a leading dot grouped as 1 word:</span>
</span><span id="mainopt_ruby-2135"><a href="#mainopt_ruby-2135"><span class="linenos">2135</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])\.[0-9]+&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2136"><a href="#mainopt_ruby-2136"><span class="linenos">2136</span></a>      <span class="c1"># TODO: leading 0s (0000048 goes to 0 000 048)</span>
</span><span id="mainopt_ruby-2137"><a href="#mainopt_ruby-2137"><span class="linenos">2137</span></a>      <span class="c1"># For normal numbers:</span>
</span><span id="mainopt_ruby-2138"><a href="#mainopt_ruby-2138"><span class="linenos">2138</span></a>      <span class="c1"># A null string w. 3 or 6 digits to go and digits b4 shld match for &#39;thousand&#39;, &#39;million&#39; (unless 3+ digits are leading 0s, or fewer than 3 leading 0s and whole thing begins with a 0, or it&#39;s part of a decimal expansion, in which case different rules apply, but (?&lt;=...) must be fixed-length, so we need another one of these awful loops) :</span>
</span><span id="mainopt_ruby-2139"><a href="#mainopt_ruby-2139"><span class="linenos">2139</span></a>      <span class="k">for</span> <span class="n">prevDigits</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
</span><span id="mainopt_ruby-2140"><a href="#mainopt_ruby-2140"><span class="linenos">2140</span></a>         <span class="k">for</span> <span class="n">beforeThat</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;^&quot;</span><span class="p">,</span><span class="sa">r</span><span class="s2">&quot;[^.0-9,]&quot;</span><span class="p">]:</span> <span class="c1"># beginning of string, or something OTHER than a decimal point / num</span>
</span><span id="mainopt_ruby-2141"><a href="#mainopt_ruby-2141"><span class="linenos">2141</span></a>            <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=&quot;</span><span class="o">+</span><span class="n">beforeThat</span><span class="o">+</span><span class="s2">&quot;[1-9]&quot;</span><span class="o">+</span><span class="s2">&quot;[0-9,]&quot;</span><span class="o">*</span><span class="n">prevDigits</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;)(?&lt;!,)(?&lt;!000)(?# empty string )(?=(?:,?(?:[0-9]{3,3}))+(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2142"><a href="#mainopt_ruby-2142"><span class="linenos">2142</span></a>      <span class="c1"># 1-9 (not 0) with 2, 5 or 8 etc digits to go = &quot;N-hundred-and&quot; :</span>
</span><span id="mainopt_ruby-2143"><a href="#mainopt_ruby-2143"><span class="linenos">2143</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;[1-9](?=[0-9][0-9](?:,?(?:[0-9]{3,3}))*(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2144"><a href="#mainopt_ruby-2144"><span class="linenos">2144</span></a>      <span class="c1"># + 0 with 2 digits to go when preceded by digits = &quot;and&quot;, as long as followed by at least one non-0:</span>
</span><span id="mainopt_ruby-2145"><a href="#mainopt_ruby-2145"><span class="linenos">2145</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;=[0-9,])0(?=(?:[0-9][1-9]|[1-9][0-9])(?:[^0-9,]|$))&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2146"><a href="#mainopt_ruby-2146"><span class="linenos">2146</span></a>      <span class="c1"># 1 or 2 digits with 0,3,6.. to go = &quot;seventy-six&quot; or whatever, as long as they&#39;re not both 0 :</span>
</span><span id="mainopt_ruby-2147"><a href="#mainopt_ruby-2147"><span class="linenos">2147</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?:0[1-9]|[1-9][0-9]?)(?=(?:,?(?:[0-9]{3,3}))*(?:[^0-9]|$))&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2148"><a href="#mainopt_ruby-2148"><span class="linenos">2148</span></a>      <span class="c1"># 0 by itself (not preceded by digits) = &quot;nought&quot; :</span>
</span><span id="mainopt_ruby-2149"><a href="#mainopt_ruby-2149"><span class="linenos">2149</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(?&lt;![0-9])0(?=[^0-9]|$)&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2150"><a href="#mainopt_ruby-2150"><span class="linenos">2150</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])(?:of|on|in|that|with|for|was) (?:the|a)(?= )&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2151"><a href="#mainopt_ruby-2151"><span class="linenos">2151</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?:Of|On|In|That|With|For|Was) (?:the|a)(?= )&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2152"><a href="#mainopt_ruby-2152"><span class="linenos">2152</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])not a(?= )&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2153"><a href="#mainopt_ruby-2153"><span class="linenos">2153</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?&lt;=[^A-Za-z0-9_-])(?:some|that) one(?= )&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2154"><a href="#mainopt_ruby-2154"><span class="linenos">2154</span></a>      <span class="n">wordRegexps</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="s2">&quot;(?:Some|That) one(?= )&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2155"><a href="#mainopt_ruby-2155"><span class="linenos">2155</span></a>      <span class="n">text2</span> <span class="o">=</span> <span class="n">text</span>
</span><span id="mainopt_ruby-2156"><a href="#mainopt_ruby-2156"><span class="linenos">2156</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">text2</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\.?[0-9]+&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">)</span> <span class="c1"># unknown eSpeak version: don&#39;t annotate the numbers</span>
</span><span id="mainopt_ruby-2157"><a href="#mainopt_ruby-2157"><span class="linenos">2157</span></a>   <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">text2</span><span class="p">)</span>
</span><span id="mainopt_ruby-2158"><a href="#mainopt_ruby-2158"><span class="linenos">2158</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="mainopt_ruby-2159"><a href="#mainopt_ruby-2159"><span class="linenos">2159</span></a>   <span class="n">gradint_cgi</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;RUBY_GRADINT_CGI&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2160"><a href="#mainopt_ruby-2160"><span class="linenos">2160</span></a>   <span class="k">if</span> <span class="n">gradint_cgi</span><span class="p">:</span>
</span><span id="mainopt_ruby-2161"><a href="#mainopt_ruby-2161"><span class="linenos">2161</span></a>      <span class="n">linkStart</span><span class="p">,</span><span class="n">linkEnd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">gradint_cgi</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;?js=[[&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">w</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%25&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;%26&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">))</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;]]&amp;jsl=en&quot; onclick=&quot;return h5a(this);&quot;&gt;&#39;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="s1">&#39;&lt;/a&gt;&#39;</span>
</span><span id="mainopt_ruby-2162"><a href="#mainopt_ruby-2162"><span class="linenos">2162</span></a>      <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;&quot;&quot;&lt;script&gt;&lt;!-- // HTML5-audio function</span>
</span><span id="mainopt_ruby-2163"><a href="#mainopt_ruby-2163"><span class="linenos">2163</span></a><span class="s2">function h5a(link) {</span>
</span><span id="mainopt_ruby-2164"><a href="#mainopt_ruby-2164"><span class="linenos">2164</span></a><span class="s2"> if (document.createElement) {</span>
</span><span id="mainopt_ruby-2165"><a href="#mainopt_ruby-2165"><span class="linenos">2165</span></a><span class="s2">   var ae = document.createElement(&#39;audio&#39;);</span>
</span><span id="mainopt_ruby-2166"><a href="#mainopt_ruby-2166"><span class="linenos">2166</span></a><span class="s2">   if (ae.canPlayType &amp;&amp; function(s){return s!=&quot;&quot; &amp;&amp; s!=&quot;no&quot;}(ae.canPlayType(&#39;audio/mpeg&#39;))) {</span>
</span><span id="mainopt_ruby-2167"><a href="#mainopt_ruby-2167"><span class="linenos">2167</span></a><span class="s2">     ae.setAttribute(&#39;src&#39;, link.href);</span>
</span><span id="mainopt_ruby-2168"><a href="#mainopt_ruby-2168"><span class="linenos">2168</span></a><span class="s2">     ae.play(); return false;</span>
</span><span id="mainopt_ruby-2169"><a href="#mainopt_ruby-2169"><span class="linenos">2169</span></a><span class="s2">   } else if (ae.canPlayType &amp;&amp; function(s){return s!=&quot;&quot; &amp;&amp; s!=&quot;no&quot;}(ae.canPlayType(&#39;audio/ogg&#39;))) {</span>
</span><span id="mainopt_ruby-2170"><a href="#mainopt_ruby-2170"><span class="linenos">2170</span></a><span class="s2">     ae.setAttribute(&#39;src&#39;, link.href+&quot;&amp;filetype=ogg&quot;);</span>
</span><span id="mainopt_ruby-2171"><a href="#mainopt_ruby-2171"><span class="linenos">2171</span></a><span class="s2">     ae.play(); return false; }</span>
</span><span id="mainopt_ruby-2172"><a href="#mainopt_ruby-2172"><span class="linenos">2172</span></a><span class="s2"> } return true; }</span>
</span><span id="mainopt_ruby-2173"><a href="#mainopt_ruby-2173"><span class="linenos">2173</span></a><span class="s2">//--&gt;&lt;/script&gt;&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2174"><a href="#mainopt_ruby-2174"><span class="linenos">2174</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">linkStart</span><span class="p">,</span><span class="n">linkEnd</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">w</span><span class="p">:</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">),</span> <span class="s2">&quot;&quot;</span>
</span><span id="mainopt_ruby-2175"><a href="#mainopt_ruby-2175"><span class="linenos">2175</span></a>   <span class="n">rubyList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="mainopt_ruby-2176"><a href="#mainopt_ruby-2176"><span class="linenos">2176</span></a>   <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">response</span><span class="p">):</span>
</span><span id="mainopt_ruby-2177"><a href="#mainopt_ruby-2177"><span class="linenos">2177</span></a>      <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">:</span>
</span><span id="mainopt_ruby-2178"><a href="#mainopt_ruby-2178"><span class="linenos">2178</span></a>         <span class="n">converted</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="nb">format</span><span class="p">)</span>
</span><span id="mainopt_ruby-2179"><a href="#mainopt_ruby-2179"><span class="linenos">2179</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">converted</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># e.g. a lone _:_:</span>
</span><span id="mainopt_ruby-2180"><a href="#mainopt_ruby-2180"><span class="linenos">2180</span></a>         <span class="n">m</span> <span class="o">=</span> <span class="n">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">converted</span><span class="p">)</span>
</span><span id="mainopt_ruby-2181"><a href="#mainopt_ruby-2181"><span class="linenos">2181</span></a>         <span class="n">rubyList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">linkStart</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">m</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span><span class="n">m</span><span class="p">))</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">linkEnd</span><span class="p">,</span><span class="n">w</span><span class="p">))</span>
</span><span id="mainopt_ruby-2182"><a href="#mainopt_ruby-2182"><span class="linenos">2182</span></a>   <span class="n">rubyList</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span> <span class="c1"># so can pop() left-to-right order</span>
</span><span id="mainopt_ruby-2183"><a href="#mainopt_ruby-2183"><span class="linenos">2183</span></a>   <span class="c1"># Write out re.sub ourselves, because (1) some versions of the library (e.g. on 2.7.12) try to do some things in-place, and we&#39;re using previous-context regexps that aren&#39;t compatible with previous things having been already &lt;ruby&gt;&#39;ified, and (2) if we match a 0-length string, re.finditer won&#39;t ALSO return a non-0 length match starting in the same place, and we want both (so we&#39;re using wordRegexps as a list rather than an | expression)</span>
</span><span id="mainopt_ruby-2184"><a href="#mainopt_ruby-2184"><span class="linenos">2184</span></a>   <span class="n">matches</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="mainopt_ruby-2185"><a href="#mainopt_ruby-2185"><span class="linenos">2185</span></a>   <span class="n">debug</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># if True, will add ruby title=(index of the regexp that matched)</span>
</span><span id="mainopt_ruby-2186"><a href="#mainopt_ruby-2186"><span class="linenos">2186</span></a>   <span class="n">debugCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="mainopt_ruby-2187"><a href="#mainopt_ruby-2187"><span class="linenos">2187</span></a>   <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">wordRegexps</span><span class="p">:</span>
</span><span id="mainopt_ruby-2188"><a href="#mainopt_ruby-2188"><span class="linenos">2188</span></a>      <span class="k">for</span> <span class="n">match</span> <span class="ow">in</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">text</span><span class="p">):</span>
</span><span id="mainopt_ruby-2189"><a href="#mainopt_ruby-2189"><span class="linenos">2189</span></a>         <span class="n">matches</span><span class="p">[(</span><span class="n">match</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">match</span><span class="o">.</span><span class="n">end</span><span class="p">())]</span> <span class="o">=</span> <span class="n">debugCount</span>
</span><span id="mainopt_ruby-2190"><a href="#mainopt_ruby-2190"><span class="linenos">2190</span></a>      <span class="n">debugCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="mainopt_ruby-2191"><a href="#mainopt_ruby-2191"><span class="linenos">2191</span></a>   <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="mainopt_ruby-2192"><a href="#mainopt_ruby-2192"><span class="linenos">2192</span></a>   <span class="k">def</span> <span class="nf">cmpFunc</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
</span><span id="mainopt_ruby-2193"><a href="#mainopt_ruby-2193"><span class="linenos">2193</span></a>      <span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">e1</span><span class="p">),(</span><span class="n">s2</span><span class="p">,</span><span class="n">e2</span><span class="p">)</span> <span class="o">=</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span>
</span><span id="mainopt_ruby-2194"><a href="#mainopt_ruby-2194"><span class="linenos">2194</span></a>      <span class="k">if</span> <span class="n">s1</span><span class="o">&lt;</span><span class="n">s2</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="mainopt_ruby-2195"><a href="#mainopt_ruby-2195"><span class="linenos">2195</span></a>      <span class="k">if</span> <span class="n">s1</span><span class="o">&gt;</span><span class="n">s2</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="mainopt_ruby-2196"><a href="#mainopt_ruby-2196"><span class="linenos">2196</span></a>      <span class="k">if</span> <span class="n">e1</span><span class="o">&gt;</span><span class="n">e2</span><span class="p">:</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="mainopt_ruby-2197"><a href="#mainopt_ruby-2197"><span class="linenos">2197</span></a>      <span class="k">if</span> <span class="n">e1</span><span class="o">&lt;</span><span class="n">e2</span><span class="p">:</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="mainopt_ruby-2198"><a href="#mainopt_ruby-2198"><span class="linenos">2198</span></a>      <span class="k">return</span> <span class="mi">0</span>
</span><span id="mainopt_ruby-2199"><a href="#mainopt_ruby-2199"><span class="linenos">2199</span></a>   <span class="k">for</span> <span class="n">start</span><span class="p">,</span><span class="n">end</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">matches</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span><span class="n">cmpFunc</span><span class="p">):</span>
</span><span id="mainopt_ruby-2200"><a href="#mainopt_ruby-2200"><span class="linenos">2200</span></a>      <span class="k">if</span> <span class="n">start</span><span class="o">&lt;</span><span class="n">i</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># overlap??</span>
</span><span id="mainopt_ruby-2201"><a href="#mainopt_ruby-2201"><span class="linenos">2201</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">start</span><span class="p">])</span>
</span><span id="mainopt_ruby-2202"><a href="#mainopt_ruby-2202"><span class="linenos">2202</span></a>      <span class="k">if</span> <span class="n">start</span><span class="o">==</span><span class="n">end</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="s2">&quot;&amp;nbsp;&quot;</span>
</span><span id="mainopt_ruby-2203"><a href="#mainopt_ruby-2203"><span class="linenos">2203</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">m</span> <span class="o">=</span> <span class="n">text</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;amp;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&lt;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&amp;lt;&quot;</span><span class="p">,</span><span class="n">text</span><span class="p">))</span>
</span><span id="mainopt_ruby-2204"><a href="#mainopt_ruby-2204"><span class="linenos">2204</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">rt</span> <span class="o">=</span> <span class="n">rubyList</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
</span><span id="mainopt_ruby-2205"><a href="#mainopt_ruby-2205"><span class="linenos">2205</span></a>      <span class="k">except</span><span class="p">:</span> <span class="n">rt</span> <span class="o">=</span> <span class="s2">&quot;ERROR&quot;</span> <span class="c1"># we&#39;ve lost synchronisation</span>
</span><span id="mainopt_ruby-2206"><a href="#mainopt_ruby-2206"><span class="linenos">2206</span></a>      <span class="k">if</span> <span class="n">debug</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; title=&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">matches</span><span class="p">[(</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)]))</span>
</span><span id="mainopt_ruby-2207"><a href="#mainopt_ruby-2207"><span class="linenos">2207</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">title</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2208"><a href="#mainopt_ruby-2208"><span class="linenos">2208</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;ruby&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">title</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt;&lt;rb&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">m</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rb&gt;&lt;rt&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">rt</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rt&gt;&lt;/ruby&gt;&quot;</span><span class="p">))</span>
</span><span id="mainopt_ruby-2209"><a href="#mainopt_ruby-2209"><span class="linenos">2209</span></a>      <span class="n">i</span> <span class="o">=</span> <span class="n">end</span>
</span><span id="mainopt_ruby-2210"><a href="#mainopt_ruby-2210"><span class="linenos">2210</span></a>   <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">text</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="mainopt_ruby-2211"><a href="#mainopt_ruby-2211"><span class="linenos">2211</span></a>   <span class="k">while</span> <span class="n">rubyList</span><span class="p">:</span> <span class="c1"># oops, lost synchronisation the other way (TODO: show this per-paragraph? but don&#39;t call eSpeak too many times if processing many short paragraphs)</span>
</span><span id="mainopt_ruby-2212"><a href="#mainopt_ruby-2212"><span class="linenos">2212</span></a>      <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;ruby&gt;&lt;rb&gt;ERROR&lt;/rb&gt;&lt;rt&gt;&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">rubyList</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&lt;/rt&gt;&lt;/ruby&gt;&quot;</span><span class="p">))</span>
</span><span id="mainopt_ruby-2213"><a href="#mainopt_ruby-2213"><span class="linenos">2213</span></a>   <span class="n">out</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
</span><span id="mainopt_ruby-2214"><a href="#mainopt_ruby-2214"><span class="linenos">2214</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">out</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)):</span> <span class="n">out</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="mainopt_ruby-2215"><a href="#mainopt_ruby-2215"><span class="linenos">2215</span></a>   <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>*<format> [<words>]
Like --phones but outputs the result as HTML RUBY markup, with each word's pronunciation symbols placed above the corresponding English word.
E.g.: python lexconvert.py --ruby unicode-ipa This is a test sentence.
This option is made more complicated by the fact that different versions of eSpeak may space the phoneme output differently, for example when handling numbers; if your eSpeak version is not recognised then all numbers are unannotated. Anyway you are advised not to rely on this option working with the new development NG versions of eSpeak. If the version you have behaves unexpectedly, words and phonemes output might lose synchronisation. However this option is believed to be stable when used with simple text and the original eSpeak.
You can optionally set the RUBY_GRADINT_CGI environment variable to the URL of an instance of Gradint Web Edition to generate audio links for each word.  If doing this in a Web Adjuster filter, see comments in the lexconvert source for setup details.</p>
</div>


                </section>
                <section id="pipeThroughEspeak">
                            <input id="pipeThroughEspeak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">pipeThroughEspeak</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">inpt</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="pipeThroughEspeak-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#pipeThroughEspeak"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="pipeThroughEspeak-2217"><a href="#pipeThroughEspeak-2217"><span class="linenos">2217</span></a><span class="k">def</span> <span class="nf">pipeThroughEspeak</span><span class="p">(</span><span class="n">inpt</span><span class="p">):</span>
</span><span id="pipeThroughEspeak-2218"><a href="#pipeThroughEspeak-2218"><span class="linenos">2218</span></a>   <span class="s2">&quot;Writes inpt to espeak -q -x (in chunks if necessary) and returns the result&quot;</span>
</span><span id="pipeThroughEspeak-2219"><a href="#pipeThroughEspeak-2219"><span class="linenos">2219</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span><span class="o">==</span><span class="nb">bytes</span>
</span><span id="pipeThroughEspeak-2220"><a href="#pipeThroughEspeak-2220"><span class="linenos">2220</span></a>   <span class="n">bufsize</span> <span class="o">=</span> <span class="mi">8192</span> <span class="c1"># careful not to set this too big, as the OS might limit it (TODO can we check?)</span>
</span><span id="pipeThroughEspeak-2221"><a href="#pipeThroughEspeak-2221"><span class="linenos">2221</span></a>   <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="pipeThroughEspeak-2222"><a href="#pipeThroughEspeak-2222"><span class="linenos">2222</span></a>   <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">bufsize</span><span class="p">:</span>
</span><span id="pipeThroughEspeak-2223"><a href="#pipeThroughEspeak-2223"><span class="linenos">2223</span></a>      <span class="n">splitAt</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bufsize</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="pipeThroughEspeak-2224"><a href="#pipeThroughEspeak-2224"><span class="linenos">2224</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">splitAt</span><span class="p">:</span> <span class="c1"># no newline, try to split on space</span>
</span><span id="pipeThroughEspeak-2225"><a href="#pipeThroughEspeak-2225"><span class="linenos">2225</span></a>         <span class="n">splitAt</span> <span class="o">=</span> <span class="n">inpt</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">bufsize</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="pipeThroughEspeak-2226"><a href="#pipeThroughEspeak-2226"><span class="linenos">2226</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">splitAt</span><span class="p">:</span>
</span><span id="pipeThroughEspeak-2227"><a href="#pipeThroughEspeak-2227"><span class="linenos">2227</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Note: had to split eSpeak input and couldn&#39;t find a newline or space to do it on</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="pipeThroughEspeak-2228"><a href="#pipeThroughEspeak-2228"><span class="linenos">2228</span></a>            <span class="n">splitAt</span> <span class="o">=</span> <span class="n">bufsize</span>
</span><span id="pipeThroughEspeak-2229"><a href="#pipeThroughEspeak-2229"><span class="linenos">2229</span></a>      <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">inpt</span><span class="p">[:</span><span class="n">splitAt</span><span class="p">])</span>
</span><span id="pipeThroughEspeak-2230"><a href="#pipeThroughEspeak-2230"><span class="linenos">2230</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="s1">&#39;command&#39;</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="pipeThroughEspeak-2231"><a href="#pipeThroughEspeak-2231"><span class="linenos">2231</span></a>      <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">response</span><span class="p">)</span> <span class="p">;</span> <span class="n">inpt</span><span class="o">=</span><span class="n">inpt</span><span class="p">[</span><span class="n">splitAt</span><span class="p">:]</span>
</span><span id="pipeThroughEspeak-2232"><a href="#pipeThroughEspeak-2232"><span class="linenos">2232</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">w</span><span class="p">,</span><span class="n">r</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen4</span><span class="p">(</span><span class="s2">&quot;espeak -q -x&quot;</span><span class="p">,</span><span class="n">bufsize</span><span class="o">=</span><span class="n">bufsize</span><span class="p">)</span> <span class="c1"># Python 2</span>
</span><span id="pipeThroughEspeak-2233"><a href="#pipeThroughEspeak-2233"><span class="linenos">2233</span></a>   <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="c1"># Python 3</span>
</span><span id="pipeThroughEspeak-2234"><a href="#pipeThroughEspeak-2234"><span class="linenos">2234</span></a>      <span class="kn">import</span> <span class="nn">subprocess</span>
</span><span id="pipeThroughEspeak-2235"><a href="#pipeThroughEspeak-2235"><span class="linenos">2235</span></a>      <span class="n">proc</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">Popen</span><span class="p">([</span><span class="s1">&#39;espeak&#39;</span><span class="p">,</span><span class="s1">&#39;-q&#39;</span><span class="p">,</span><span class="s1">&#39;-x&#39;</span><span class="p">],</span><span class="n">stdin</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">,</span><span class="n">stdout</span><span class="o">=</span><span class="n">subprocess</span><span class="o">.</span><span class="n">PIPE</span><span class="p">)</span>
</span><span id="pipeThroughEspeak-2236"><a href="#pipeThroughEspeak-2236"><span class="linenos">2236</span></a>      <span class="n">w</span> <span class="o">=</span> <span class="n">proc</span><span class="o">.</span><span class="n">stdin</span>
</span><span id="pipeThroughEspeak-2237"><a href="#pipeThroughEspeak-2237"><span class="linenos">2237</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="pipeThroughEspeak-2238"><a href="#pipeThroughEspeak-2238"><span class="linenos">2238</span></a>   <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
</span><span id="pipeThroughEspeak-2239"><a href="#pipeThroughEspeak-2239"><span class="linenos">2239</span></a>      <span class="n">getBuf</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span> <span class="p">;</span> <span class="n">w</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="pipeThroughEspeak-2240"><a href="#pipeThroughEspeak-2240"><span class="linenos">2240</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">r</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="pipeThroughEspeak-2241"><a href="#pipeThroughEspeak-2241"><span class="linenos">2241</span></a>   <span class="k">else</span><span class="p">:</span> <span class="c1"># Python 3</span>
</span><span id="pipeThroughEspeak-2242"><a href="#pipeThroughEspeak-2242"><span class="linenos">2242</span></a>      <span class="n">w</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">inpt</span><span class="p">)</span>
</span><span id="pipeThroughEspeak-2243"><a href="#pipeThroughEspeak-2243"><span class="linenos">2243</span></a>      <span class="n">out</span><span class="p">,</span><span class="n">err</span><span class="o">=</span><span class="n">proc</span><span class="o">.</span><span class="n">communicate</span><span class="p">()</span>
</span><span id="pipeThroughEspeak-2244"><a href="#pipeThroughEspeak-2244"><span class="linenos">2244</span></a>      <span class="n">r</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="pipeThroughEspeak-2245"><a href="#pipeThroughEspeak-2245"><span class="linenos">2245</span></a>      <span class="k">if</span> <span class="n">out</span><span class="p">:</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">out</span>
</span><span id="pipeThroughEspeak-2246"><a href="#pipeThroughEspeak-2246"><span class="linenos">2246</span></a>      <span class="k">if</span> <span class="n">err</span><span class="p">:</span> <span class="n">r</span> <span class="o">+=</span> <span class="n">err</span>
</span><span id="pipeThroughEspeak-2247"><a href="#pipeThroughEspeak-2247"><span class="linenos">2247</span></a>   <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span> <span class="o">+</span> <span class="n">r</span>
</span></pre></div>


            <div class="docstring"><p>Writes inpt to espeak -q -x (in chunks if necessary) and returns the result</p>
</div>


                </section>
                <section id="espeak_version_line">
                            <input id="espeak_version_line-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">espeak_version_line</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="espeak_version_line-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#espeak_version_line"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="espeak_version_line-2249"><a href="#espeak_version_line-2249"><span class="linenos">2249</span></a><span class="k">def</span> <span class="nf">espeak_version_line</span><span class="p">():</span> <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -h 2&gt;&amp;1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span></pre></div>


    

                </section>
                <section id="writeFormatHeader">
                            <input id="writeFormatHeader-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">writeFormatHeader</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="writeFormatHeader-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#writeFormatHeader"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="writeFormatHeader-2251"><a href="#writeFormatHeader-2251"><span class="linenos">2251</span></a><span class="k">def</span> <span class="nf">writeFormatHeader</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
</span><span id="writeFormatHeader-2252"><a href="#writeFormatHeader-2252"><span class="linenos">2252</span></a>   <span class="s2">&quot;Writes a header for &#39;format&#39; when outputting in all formats.  Assumes the output MIGHT end up being more than one line.&quot;</span>
</span><span id="writeFormatHeader-2253"><a href="#writeFormatHeader-2253"><span class="linenos">2253</span></a>   <span class="k">global</span> <span class="n">writeFormatHeader_called</span>
</span><span id="writeFormatHeader-2254"><a href="#writeFormatHeader-2254"><span class="linenos">2254</span></a>   <span class="k">if</span> <span class="n">writeFormatHeader_called</span><span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="writeFormatHeader-2255"><a href="#writeFormatHeader-2255"><span class="linenos">2255</span></a>   <span class="nb">print</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span>
</span><span id="writeFormatHeader-2256"><a href="#writeFormatHeader-2256"><span class="linenos">2256</span></a>   <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span>
</span><span id="writeFormatHeader-2257"><a href="#writeFormatHeader-2257"><span class="linenos">2257</span></a>   <span class="n">writeFormatHeader_called</span> <span class="o">=</span> <span class="kc">True</span>
</span></pre></div>


            <div class="docstring"><p>Writes a header for 'format' when outputting in all formats.  Assumes the output MIGHT end up being more than one line.</p>
</div>


                </section>
                <section id="writeFormatHeader_called">
                    <div class="attr variable">
            <span class="name">writeFormatHeader_called</span>        =
<span class="default_value">False</span>

        
    </div>
    <a class="headerlink" href="#writeFormatHeader_called"></a>
    
    

                </section>
                <section id="mainopt_check_variants">
                            <input id="mainopt_check_variants-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_check_variants</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_check_variants-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_check_variants"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_check_variants-2260"><a href="#mainopt_check_variants-2260"><span class="linenos">2260</span></a><span class="k">def</span> <span class="nf">mainopt_check_variants</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_check_variants-2261"><a href="#mainopt_check_variants-2261"><span class="linenos">2261</span></a>   <span class="c1"># undocumented (won&#39;t appear in help text)</span>
</span><span id="mainopt_check_variants-2262"><a href="#mainopt_check_variants-2262"><span class="linenos">2262</span></a>   <span class="n">groups</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="mainopt_check_variants-2263"><a href="#mainopt_check_variants-2263"><span class="linenos">2263</span></a>   <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">[</span><span class="s1">&#39;espeak&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="mainopt_check_variants-2264"><a href="#mainopt_check_variants-2264"><span class="linenos">2264</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">:</span>
</span><span id="mainopt_check_variants-2265"><a href="#mainopt_check_variants-2265"><span class="linenos">2265</span></a>         <span class="n">intV</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="mainopt_check_variants-2266"><a href="#mainopt_check_variants-2266"><span class="linenos">2266</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="n">intV</span> <span class="ow">in</span> <span class="n">consonants</span><span class="p">:</span>
</span><span id="mainopt_check_variants-2267"><a href="#mainopt_check_variants-2267"><span class="linenos">2267</span></a>            <span class="n">groups</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">intV</span><span class="p">,[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">v</span><span class="p">,</span><span class="n">k</span><span class="p">))</span>
</span><span id="mainopt_check_variants-2268"><a href="#mainopt_check_variants-2268"><span class="linenos">2268</span></a>   <span class="n">i</span> <span class="o">=</span> <span class="n">groups</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="mainopt_check_variants-2269"><a href="#mainopt_check_variants-2269"><span class="linenos">2269</span></a>   <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">i</span><span class="p">:</span>
</span><span id="mainopt_check_variants-2270"><a href="#mainopt_check_variants-2270"><span class="linenos">2270</span></a>      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="mainopt_check_variants-2271"><a href="#mainopt_check_variants-2271"><span class="linenos">2271</span></a>      <span class="n">v</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="mainopt_check_variants-2272"><a href="#mainopt_check_variants-2272"><span class="linenos">2272</span></a>      <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="mainopt_check_variants-2273"><a href="#mainopt_check_variants-2273"><span class="linenos">2273</span></a>         <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Group &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">))</span>
</span><span id="mainopt_check_variants-2274"><a href="#mainopt_check_variants-2274"><span class="linenos">2274</span></a>         <span class="n">es</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -x&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="mainopt_check_variants-2275"><a href="#mainopt_check_variants-2275"><span class="linenos">2275</span></a>         <span class="n">getBuf</span><span class="p">(</span><span class="n">es</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">w</span> <span class="ow">in</span> <span class="n">v</span><span class="p">]))</span>
</span><span id="mainopt_check_variants-2276"><a href="#mainopt_check_variants-2276"><span class="linenos">2276</span></a>         <span class="k">del</span> <span class="n">es</span>
</span><span id="mainopt_check_variants-2277"><a href="#mainopt_check_variants-2277"><span class="linenos">2277</span></a>         <span class="k">if</span> <span class="ow">not</span> <span class="nb">int</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Again? 1/0: &quot;</span><span class="p">))):</span> <span class="k">break</span>
</span></pre></div>


    

                </section>
                <section id="mainopt_check_for_similar_formats">
                            <input id="mainopt_check_for_similar_formats-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_check_for_similar_formats</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_check_for_similar_formats-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_check_for_similar_formats"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_check_for_similar_formats-2279"><a href="#mainopt_check_for_similar_formats-2279"><span class="linenos">2279</span></a><span class="k">def</span> <span class="nf">mainopt_check_for_similar_formats</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_check_for_similar_formats-2280"><a href="#mainopt_check_for_similar_formats-2280"><span class="linenos">2280</span></a>   <span class="c1"># undocumented (won&#39;t appear in help text)</span>
</span><span id="mainopt_check_for_similar_formats-2281"><a href="#mainopt_check_for_similar_formats-2281"><span class="linenos">2281</span></a>   <span class="n">items</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="mainopt_check_for_similar_formats-2282"><a href="#mainopt_check_for_similar_formats-2282"><span class="linenos">2282</span></a>   <span class="k">while</span> <span class="n">items</span><span class="p">:</span>
</span><span id="mainopt_check_for_similar_formats-2283"><a href="#mainopt_check_for_similar_formats-2283"><span class="linenos">2283</span></a>      <span class="n">k1</span><span class="p">,</span><span class="n">dic1</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="mainopt_check_for_similar_formats-2284"><a href="#mainopt_check_for_similar_formats-2284"><span class="linenos">2284</span></a>      <span class="k">for</span> <span class="n">k2</span><span class="p">,</span><span class="n">dic2</span> <span class="ow">in</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]:</span>
</span><span id="mainopt_check_for_similar_formats-2285"><a href="#mainopt_check_for_similar_formats-2285"><span class="linenos">2285</span></a>         <span class="n">diff</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="mainopt_check_for_similar_formats-2286"><a href="#mainopt_check_for_similar_formats-2286"><span class="linenos">2286</span></a>         <span class="k">for</span> <span class="n">kk</span><span class="p">,</span><span class="n">vv</span> <span class="ow">in</span> <span class="n">dic1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="mainopt_check_for_similar_formats-2287"><a href="#mainopt_check_for_similar_formats-2287"><span class="linenos">2287</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">kk</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="mainopt_check_for_similar_formats-2288"><a href="#mainopt_check_for_similar_formats-2288"><span class="linenos">2288</span></a>            <span class="k">if</span> <span class="n">kk</span><span class="o">==</span><span class="n">syllable_separator</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="mainopt_check_for_similar_formats-2289"><a href="#mainopt_check_for_similar_formats-2289"><span class="linenos">2289</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">dic2</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">kk</span><span class="p">,</span><span class="s2">&quot;!&quot;</span><span class="o">+</span><span class="n">vv</span><span class="p">)</span><span class="o">==</span><span class="n">vv</span><span class="p">:</span> <span class="n">diff</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="mainopt_check_for_similar_formats-2290"><a href="#mainopt_check_for_similar_formats-2290"><span class="linenos">2290</span></a>         <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">diff</span><span class="p">,</span><span class="n">k1</span><span class="p">,</span><span class="n">k2</span><span class="p">))</span>
</span><span id="mainopt_check_for_similar_formats-2291"><a href="#mainopt_check_for_similar_formats-2291"><span class="linenos">2291</span></a>      <span class="n">items</span> <span class="o">=</span> <span class="n">items</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="mainopt_check_for_similar_formats-2292"><a href="#mainopt_check_for_similar_formats-2292"><span class="linenos">2292</span></a>   <span class="n">r</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="p">;</span> <span class="n">had</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="mainopt_check_for_similar_formats-2293"><a href="#mainopt_check_for_similar_formats-2293"><span class="linenos">2293</span></a>   <span class="k">for</span> <span class="n">diffs</span><span class="p">,</span><span class="n">format1</span><span class="p">,</span><span class="n">format2</span> <span class="ow">in</span> <span class="n">r</span><span class="p">:</span>
</span><span id="mainopt_check_for_similar_formats-2294"><a href="#mainopt_check_for_similar_formats-2294"><span class="linenos">2294</span></a>      <span class="k">if</span> <span class="n">format1</span> <span class="ow">in</span> <span class="n">had</span> <span class="ow">and</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">had</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="mainopt_check_for_similar_formats-2295"><a href="#mainopt_check_for_similar_formats-2295"><span class="linenos">2295</span></a>      <span class="n">had</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">format1</span><span class="p">)</span> <span class="p">;</span> <span class="n">had</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span>
</span><span id="mainopt_check_for_similar_formats-2296"><a href="#mainopt_check_for_similar_formats-2296"><span class="linenos">2296</span></a>      <span class="k">if</span> <span class="s2">&quot;names&quot;</span> <span class="ow">in</span> <span class="n">had</span><span class="p">:</span> <span class="k">break</span>
</span><span id="mainopt_check_for_similar_formats-2297"><a href="#mainopt_check_for_similar_formats-2297"><span class="linenos">2297</span></a>      <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">diffs</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; phoneme differences between &quot;</span><span class="o">+</span><span class="n">format1</span><span class="o">+</span><span class="s2">&quot; and &quot;</span><span class="o">+</span><span class="n">format2</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="festival_group_stress">
                            <input id="festival_group_stress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">festival_group_stress</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="festival_group_stress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#festival_group_stress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="festival_group_stress-2299"><a href="#festival_group_stress-2299"><span class="linenos">2299</span></a><span class="k">def</span> <span class="nf">festival_group_stress</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="festival_group_stress-2300"><a href="#festival_group_stress-2300"><span class="linenos">2300</span></a>   <span class="s2">&quot;Special-case cleanup_func for the Festival format&quot;</span>
</span><span id="festival_group_stress-2301"><a href="#festival_group_stress-2301"><span class="linenos">2301</span></a>   <span class="c1"># TODO: do we ever need to add extra consonants to the</span>
</span><span id="festival_group_stress-2302"><a href="#festival_group_stress-2302"><span class="linenos">2302</span></a>   <span class="c1"># previous group instead of the next group?  (not sure</span>
</span><span id="festival_group_stress-2303"><a href="#festival_group_stress-2303"><span class="linenos">2303</span></a>   <span class="c1"># what difference it makes to the synthesis, but it</span>
</span><span id="festival_group_stress-2304"><a href="#festival_group_stress-2304"><span class="linenos">2304</span></a>   <span class="c1"># might make the entry a bit more readable)</span>
</span><span id="festival_group_stress-2305"><a href="#festival_group_stress-2305"><span class="linenos">2305</span></a>   <span class="n">groups</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">thisGroup</span> <span class="o">=</span> <span class="p">[[],</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span> <span class="c1"># phon,stress,complete</span>
</span><span id="festival_group_stress-2306"><a href="#festival_group_stress-2306"><span class="linenos">2306</span></a>   <span class="k">for</span> <span class="n">phon</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="festival_group_stress-2307"><a href="#festival_group_stress-2307"><span class="linenos">2307</span></a>      <span class="k">if</span> <span class="n">phon</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="s1">&#39;1&#39;</span><span class="p">,</span><span class="s1">&#39;2&#39;</span><span class="p">]:</span>
</span><span id="festival_group_stress-2308"><a href="#festival_group_stress-2308"><span class="linenos">2308</span></a>         <span class="k">if</span> <span class="n">groups</span> <span class="ow">and</span> <span class="n">phon</span> <span class="o">&gt;=</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]:</span>
</span><span id="festival_group_stress-2309"><a href="#festival_group_stress-2309"><span class="linenos">2309</span></a>            <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="n">phon</span>
</span><span id="festival_group_stress-2310"><a href="#festival_group_stress-2310"><span class="linenos">2310</span></a>         <span class="k">continue</span>
</span><span id="festival_group_stress-2311"><a href="#festival_group_stress-2311"><span class="linenos">2311</span></a>      <span class="n">thisGroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">phon</span><span class="p">)</span>
</span><span id="festival_group_stress-2312"><a href="#festival_group_stress-2312"><span class="linenos">2312</span></a>      <span class="k">if</span> <span class="n">phon</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s1">&#39;aeiou@&#39;</span><span class="p">:</span>
</span><span id="festival_group_stress-2313"><a href="#festival_group_stress-2313"><span class="linenos">2313</span></a>         <span class="n">thisGroup</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="kc">True</span>
</span><span id="festival_group_stress-2314"><a href="#festival_group_stress-2314"><span class="linenos">2314</span></a>         <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
</span><span id="festival_group_stress-2315"><a href="#festival_group_stress-2315"><span class="linenos">2315</span></a>         <span class="n">thisGroup</span> <span class="o">=</span> <span class="p">[[],</span><span class="s1">&#39;0&#39;</span><span class="p">,</span><span class="kc">False</span><span class="p">]</span>
</span><span id="festival_group_stress-2316"><a href="#festival_group_stress-2316"><span class="linenos">2316</span></a>   <span class="k">if</span> <span class="n">thisGroup</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">groups</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisGroup</span><span class="p">)</span>
</span><span id="festival_group_stress-2317"><a href="#festival_group_stress-2317"><span class="linenos">2317</span></a>   <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">]:</span>
</span><span id="festival_group_stress-2318"><a href="#festival_group_stress-2318"><span class="linenos">2318</span></a>      <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="festival_group_stress-2319"><a href="#festival_group_stress-2319"><span class="linenos">2319</span></a>      <span class="k">del</span> <span class="n">groups</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="festival_group_stress-2320"><a href="#festival_group_stress-2320"><span class="linenos">2320</span></a>   <span class="k">return</span> <span class="s2">&quot;(&quot;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="s2">&quot;((&quot;</span><span class="o">+</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">g</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;) &#39;</span><span class="o">+</span><span class="n">g</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span> <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Special-case cleanup_func for the Festival format</p>
</div>


                </section>
                <section id="mainopt_convert">
                            <input id="mainopt_convert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_convert</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_convert-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_convert"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_convert-2322"><a href="#mainopt_convert-2322"><span class="linenos">2322</span></a><span class="k">def</span> <span class="nf">mainopt_convert</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_convert-2323"><a href="#mainopt_convert-2323"><span class="linenos">2323</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;from-format&gt; &lt;to-format&gt;</span>
</span><span id="mainopt_convert-2324"><a href="#mainopt_convert-2324"><span class="linenos">2324</span></a><span class="sd">Convert a user lexicon (generally from its default filename; if this cannot be found then lexconvert will tell you what it should be).</span>
</span><span id="mainopt_convert-2325"><a href="#mainopt_convert-2325"><span class="linenos">2325</span></a><span class="sd">E.g.: python lexconvert.py --convert festival cepstral&quot;&quot;&quot;</span>
</span><span id="mainopt_convert-2326"><a href="#mainopt_convert-2326"><span class="linenos">2326</span></a>   <span class="n">fromFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_convert-2327"><a href="#mainopt_convert-2327"><span class="linenos">2327</span></a>   <span class="n">toFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
</span><span id="mainopt_convert-2328"><a href="#mainopt_convert-2328"><span class="linenos">2328</span></a>   <span class="k">if</span> <span class="n">fromFormat</span><span class="o">==</span><span class="n">toFormat</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot convert a lexicon to its own format (that could result in it being truncated)&quot;</span>
</span><span id="mainopt_convert-2329"><a href="#mainopt_convert-2329"><span class="linenos">2329</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot permanently save a Mac-UK lexicon; please use the --mac-uk option to read text&quot;</span>
</span><span id="mainopt_convert-2330"><a href="#mainopt_convert-2330"><span class="linenos">2330</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Cannot overwrite the built-in example lexicon&quot;</span>
</span><span id="mainopt_convert-2331"><a href="#mainopt_convert-2331"><span class="linenos">2331</span></a>   <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="p">[</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">]:</span>
</span><span id="mainopt_convert-2332"><a href="#mainopt_convert-2332"><span class="linenos">2332</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_convert-2333"><a href="#mainopt_convert-2333"><span class="linenos">2333</span></a>   <span class="k">try</span><span class="p">:</span>
</span><span id="mainopt_convert-2334"><a href="#mainopt_convert-2334"><span class="linenos">2334</span></a>      <span class="n">fname</span><span class="o">=</span><span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span>
</span><span id="mainopt_convert-2335"><a href="#mainopt_convert-2335"><span class="linenos">2335</span></a>      <span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">)</span> <span class="c1"># convert_user_lexicon will need this</span>
</span><span id="mainopt_convert-2336"><a href="#mainopt_convert-2336"><span class="linenos">2336</span></a>   <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">fname</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="mainopt_convert-2337"><a href="#mainopt_convert-2337"><span class="linenos">2337</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">fname</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Write support for lexicons of format &#39;</span><span class="si">%s</span><span class="s2">&#39; not yet implemented (need at least lex_filename and lex_entry_format); try using --phones or --phones2phones options instead&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toFormat</span><span class="p">,)</span>
</span><span id="mainopt_convert-2338"><a href="#mainopt_convert-2338"><span class="linenos">2338</span></a>   <span class="k">if</span> <span class="n">toFormat</span><span class="o">==</span><span class="s2">&quot;espeak&quot;</span><span class="p">:</span>
</span><span id="mainopt_convert-2339"><a href="#mainopt_convert-2339"><span class="linenos">2339</span></a>      <span class="k">assert</span> <span class="n">fname</span><span class="o">==</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span> <span class="s2">&quot;If you changed eSpeak&#39;s lex_filename in the table you also need to change the code below&quot;</span>
</span><span id="mainopt_convert-2340"><a href="#mainopt_convert-2340"><span class="linenos">2340</span></a>      <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;mv en_extra en_extra~ &amp;&amp; (grep </span><span class="se">\&quot;</span><span class="s2"> // </span><span class="se">\&quot;</span><span class="s2"> en_extra~ || true) &gt; en_extra&quot;</span><span class="p">):</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning: en_extra not found, making a new one</span><span class="se">\n</span><span class="s2">(espeak compile will probably fail in this directory)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># otherwise keep the commented entries, so can incrementally update the user lexicon only</span>
</span><span id="mainopt_convert-2341"><a href="#mainopt_convert-2341"><span class="linenos">2341</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_convert-2342"><a href="#mainopt_convert-2342"><span class="linenos">2342</span></a>   <span class="k">else</span><span class="p">:</span>
</span><span id="mainopt_convert-2343"><a href="#mainopt_convert-2343"><span class="linenos">2343</span></a>      <span class="n">l</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="mainopt_convert-2344"><a href="#mainopt_convert-2344"><span class="linenos">2344</span></a>      <span class="k">try</span><span class="p">:</span>
</span><span id="mainopt_convert-2345"><a href="#mainopt_convert-2345"><span class="linenos">2345</span></a>         <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_convert-2346"><a href="#mainopt_convert-2346"><span class="linenos">2346</span></a>         <span class="n">l</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="mainopt_convert-2347"><a href="#mainopt_convert-2347"><span class="linenos">2347</span></a>         <span class="k">del</span> <span class="n">f</span>
</span><span id="mainopt_convert-2348"><a href="#mainopt_convert-2348"><span class="linenos">2348</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="mainopt_convert-2349"><a href="#mainopt_convert-2349"><span class="linenos">2349</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">l</span><span class="p">,</span> <span class="s2">&quot;File &quot;</span><span class="o">+</span><span class="n">replHome</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; already exists and is not empty; are you sure you want to overwrite it?  (Delete it first if so)&quot;</span> <span class="c1"># (if you run with python -O then this is ignored, as are some other checks so be careful)</span>
</span><span id="mainopt_convert-2350"><a href="#mainopt_convert-2350"><span class="linenos">2350</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_convert-2351"><a href="#mainopt_convert-2351"><span class="linenos">2351</span></a>   <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Writing </span><span class="si">%s</span><span class="s2"> lexicon entries to </span><span class="si">%s</span><span class="s2"> file </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>
</span><span id="mainopt_convert-2352"><a href="#mainopt_convert-2352"><span class="linenos">2352</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">convert_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="mainopt_convert-2353"><a href="#mainopt_convert-2353"><span class="linenos">2353</span></a>   <span class="k">except</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="mainopt_convert-2354"><a href="#mainopt_convert-2354"><span class="linenos">2354</span></a>     <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; - error, deleting &quot;</span><span class="o">+</span><span class="n">fname</span><span class="p">)</span>
</span><span id="mainopt_convert-2355"><a href="#mainopt_convert-2355"><span class="linenos">2355</span></a>     <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">fname</span><span class="p">)</span> <span class="p">;</span> <span class="k">raise</span>
</span></pre></div>


            <div class="docstring"><p>*<from-format> <to-format>
Convert a user lexicon (generally from its default filename; if this cannot be found then lexconvert will tell you what it should be).
E.g.: python lexconvert.py --convert festival cepstral</p>
</div>


                </section>
                <section id="mainopt_festival_dictionary_to_espeak">
                            <input id="mainopt_festival_dictionary_to_espeak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_festival_dictionary_to_espeak</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_festival_dictionary_to_espeak-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_festival_dictionary_to_espeak"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_festival_dictionary_to_espeak-2357"><a href="#mainopt_festival_dictionary_to_espeak-2357"><span class="linenos">2357</span></a><span class="k">def</span> <span class="nf">mainopt_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2358"><a href="#mainopt_festival_dictionary_to_espeak-2358"><span class="linenos">2358</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;&lt;location&gt;</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2359"><a href="#mainopt_festival_dictionary_to_espeak-2359"><span class="linenos">2359</span></a><span class="sd">Convert the Festival Oxford Advanced Learners Dictionary (OALD) pronunciation lexicon to eSpeak.</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2360"><a href="#mainopt_festival_dictionary_to_espeak-2360"><span class="linenos">2360</span></a><span class="sd">You need to specify the location of the OALD file in &lt;location&gt;,</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2361"><a href="#mainopt_festival_dictionary_to_espeak-2361"><span class="linenos">2361</span></a><span class="sd">e.g. for Debian festlex-oald package: python lexconvert.py --festival-dictionary-to-espeak /usr/share/festival/dicts/oald/all.scm</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2362"><a href="#mainopt_festival_dictionary_to_espeak-2362"><span class="linenos">2362</span></a><span class="sd">or if you can&#39;t install the Debian package, try downloading http://ftp.debian.org/debian/pool/non-free/f/festlex-oald/festlex-oald_1.4.0.orig.tar.gz, unpack it into /tmp, and do: python lexconvert.py --festival-dictionary-to-espeak /tmp/festival/lib/dicts/oald/oald-0.4.out</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2363"><a href="#mainopt_festival_dictionary_to_espeak-2363"><span class="linenos">2363</span></a><span class="sd">In all cases you need to cd to the eSpeak source directory before running this.  en_extra will be overwritten.  Converter will also read your ~/.festivalrc if it exists.  (You can later incrementally update from ~/.festivalrc using the --convert option; the entries from the system dictionary will not be overwritten in this case.)  Specify --without-check to bypass checking the existing eSpeak pronunciation for OALD entries (much faster, but makes a larger file and in some cases compromises the pronunciation quality).&quot;&quot;&quot;</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2364"><a href="#mainopt_festival_dictionary_to_espeak-2364"><span class="linenos">2364</span></a>   <span class="k">try</span><span class="p">:</span> <span class="n">festival_location</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2365"><a href="#mainopt_festival_dictionary_to_espeak-2365"><span class="linenos">2365</span></a>   <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: --festival-dictionary-to-espeak must be followed by the location of the festival OALD file (see help text)&quot;</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2366"><a href="#mainopt_festival_dictionary_to_espeak-2366"><span class="linenos">2366</span></a>   <span class="k">try</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2367"><a href="#mainopt_festival_dictionary_to_espeak-2367"><span class="linenos">2367</span></a>   <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: The specified OALD location &#39;&quot;</span><span class="o">+</span><span class="n">festival_location</span><span class="o">+</span><span class="s2">&quot;&#39; could not be opened&quot;</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2368"><a href="#mainopt_festival_dictionary_to_espeak-2368"><span class="linenos">2368</span></a>   <span class="k">try</span><span class="p">:</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_list&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2369"><a href="#mainopt_festival_dictionary_to_espeak-2369"><span class="linenos">2369</span></a>   <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;Error: en_list could not be opened (did you remember to cd to the eSpeak dictsource directory first?&quot;</span>
</span><span id="mainopt_festival_dictionary_to_espeak-2370"><a href="#mainopt_festival_dictionary_to_espeak-2370"><span class="linenos">2370</span></a>   <span class="n">convert_system_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span><span class="ow">not</span> <span class="s1">&#39;--without-check&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">,</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;test -e ~/.festivalrc&quot;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p><location>
Convert the Festival Oxford Advanced Learners Dictionary (OALD) pronunciation lexicon to eSpeak.
You need to specify the location of the OALD file in <location>,
e.g. for Debian festlex-oald package: python lexconvert.py --festival-dictionary-to-espeak /usr/share/festival/dicts/oald/all.scm
or if you can't install the Debian package, try downloading <a href="http://ftp.debian.org/debian/pool/non-free/f/festlex-oald/festlex-oald_1.4.0.orig.tar.gz">http://ftp.debian.org/debian/pool/non-free/f/festlex-oald/festlex-oald_1.4.0.orig.tar.gz</a>, unpack it into /tmp, and do: python lexconvert.py --festival-dictionary-to-espeak /tmp/festival/lib/dicts/oald/oald-0.4.out
In all cases you need to cd to the eSpeak source directory before running this.  en_extra will be overwritten.  Converter will also read your ~/.festivalrc if it exists.  (You can later incrementally update from ~/.festivalrc using the --convert option; the entries from the system dictionary will not be overwritten in this case.)  Specify --without-check to bypass checking the existing eSpeak pronunciation for OALD entries (much faster, but makes a larger file and in some cases compromises the pronunciation quality).</p>
</div>


                </section>
                <section id="mainopt_syllables">
                            <input id="mainopt_syllables-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_syllables</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_syllables-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_syllables"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_syllables-2372"><a href="#mainopt_syllables-2372"><span class="linenos">2372</span></a><span class="k">def</span> <span class="nf">mainopt_syllables</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_syllables-2373"><a href="#mainopt_syllables-2373"><span class="linenos">2373</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;[&lt;words&gt;]</span>
</span><span id="mainopt_syllables-2374"><a href="#mainopt_syllables-2374"><span class="linenos">2374</span></a><span class="sd">Attempt to break &#39;words&#39; into syllables for music lyrics (uses espeak to determine how many syllables are needed)&quot;&quot;&quot;</span>
</span><span id="mainopt_syllables-2375"><a href="#mainopt_syllables-2375"><span class="linenos">2375</span></a>   <span class="c1"># As explained on mainopt_ruby&#39;s help text, espeak -x output can&#39;t be relied on to always put a space between every input word.  Rather than try to guess what espeak is going to do, here we simply put a newline after every input word instead.  This might affect eSpeak&#39;s output (so not recommended for mainopt_ruby), but it should be OK for just counting the syllables.  (Also, the assumption that the input words have been taken from song lyrics usefully rules out certain awkward punctuation cases.)</span>
</span><span id="mainopt_syllables-2376"><a href="#mainopt_syllables-2376"><span class="linenos">2376</span></a>   <span class="k">for</span> <span class="n">txt</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="s2">&quot;word(s)&quot;</span><span class="p">,</span><span class="s1">&#39;maybe&#39;</span><span class="p">):</span>
</span><span id="mainopt_syllables-2377"><a href="#mainopt_syllables-2377"><span class="linenos">2377</span></a>      <span class="n">words</span><span class="o">=</span><span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</span><span id="mainopt_syllables-2378"><a href="#mainopt_syllables-2378"><span class="linenos">2378</span></a>      <span class="n">response</span> <span class="o">=</span> <span class="n">pipeThroughEspeak</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;!&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)))</span>
</span><span id="mainopt_syllables-2379"><a href="#mainopt_syllables-2379"><span class="linenos">2379</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span> <span class="ow">and</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;command&#39;</span><span class="p">)</span> <span class="ow">in</span> <span class="n">response</span><span class="p">:</span> <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># &#39;bad cmd&#39; / &#39;cmd not found&#39;</span>
</span><span id="mainopt_syllables-2380"><a href="#mainopt_syllables-2380"><span class="linenos">2380</span></a>      <span class="n">rrr</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="mainopt_syllables-2381"><a href="#mainopt_syllables-2381"><span class="linenos">2381</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">hyphenate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">sylcount</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="s2">&quot;example&quot;</span><span class="p">)))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">line</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="n">rrr</span><span class="p">))]))</span>
</span><span id="mainopt_syllables-2382"><a href="#mainopt_syllables-2382"><span class="linenos">2382</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># in case piped</span>
</span></pre></div>


            <div class="docstring"><p>[<words>]
Attempt to break 'words' into syllables for music lyrics (uses espeak to determine how many syllables are needed)</p>
</div>


                </section>
                <section id="wordSeparator">
                            <input id="wordSeparator-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">wordSeparator</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="wordSeparator-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#wordSeparator"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="wordSeparator-2384"><a href="#wordSeparator-2384"><span class="linenos">2384</span></a><span class="k">def</span> <span class="nf">wordSeparator</span><span class="p">(</span><span class="nb">format</span><span class="p">):</span>
</span><span id="wordSeparator-2385"><a href="#wordSeparator-2385"><span class="linenos">2385</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Returns the effective word separator of format (remembering that it defaults to same as phoneme_separator&quot;&quot;&quot;</span>
</span><span id="wordSeparator-2386"><a href="#wordSeparator-2386"><span class="linenos">2386</span></a>   <span class="k">return</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;word_separator&quot;</span><span class="p">,</span><span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;phoneme_separator&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns the effective word separator of format (remembering that it defaults to same as phoneme_separator</p>
</div>


                </section>
                <section id="mainopt_phones2phones">
                            <input id="mainopt_phones2phones-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_phones2phones</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_phones2phones-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_phones2phones"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_phones2phones-2388"><a href="#mainopt_phones2phones-2388"><span class="linenos">2388</span></a><span class="k">def</span> <span class="nf">mainopt_phones2phones</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_phones2phones-2389"><a href="#mainopt_phones2phones-2389"><span class="linenos">2389</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;*&lt;format1&gt; &lt;format2&gt; [&lt;phonemes in format1&gt;]</span>
</span><span id="mainopt_phones2phones-2390"><a href="#mainopt_phones2phones-2390"><span class="linenos">2390</span></a><span class="sd">Perform a one-off conversion of phonemes from format1 to format2 (format2 can be &#39;all&#39; if you want)&quot;&quot;&quot;</span> <span class="c1"># If format1 is &#39;example&#39; and you don&#39;t specify phonemes, we take the words from the example lexicon.  But don&#39;t say that in the help string because it might confuse the issue about phonemes being optional on the command line and prompted for if not specified and stdin is not piped in all formats other than &#39;example&#39;.</span>
</span><span id="mainopt_phones2phones-2391"><a href="#mainopt_phones2phones-2391"><span class="linenos">2391</span></a>   <span class="n">format1</span><span class="p">,</span><span class="n">format2</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
</span><span id="mainopt_phones2phones-2392"><a href="#mainopt_phones2phones-2392"><span class="linenos">2392</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">format1</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">format1</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_phones2phones-2393"><a href="#mainopt_phones2phones-2393"><span class="linenos">2393</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">lexFormats</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">format2</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_phones2phones-2394"><a href="#mainopt_phones2phones-2394"><span class="linenos">2394</span></a>   <span class="k">if</span> <span class="n">format1</span><span class="o">==</span><span class="s2">&quot;example&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span><span class="o">&lt;=</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">:</span>
</span><span id="mainopt_phones2phones-2395"><a href="#mainopt_phones2phones-2395"><span class="linenos">2395</span></a>     <span class="k">if</span> <span class="n">stdin_is_terminal</span><span class="p">():</span> <span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="mainopt_phones2phones-2396"><a href="#mainopt_phones2phones-2396"><span class="linenos">2396</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">txt</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># and it might still be &quot;&quot;</span>
</span><span id="mainopt_phones2phones-2397"><a href="#mainopt_phones2phones-2397"><span class="linenos">2397</span></a>     <span class="k">if</span> <span class="n">txt</span><span class="p">:</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="n">format1</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span>
</span><span id="mainopt_phones2phones-2398"><a href="#mainopt_phones2phones-2398"><span class="linenos">2398</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span><span class="o">=</span><span class="p">[[</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getSetting</span><span class="p">(</span><span class="s1">&#39;example&#39;</span><span class="p">,</span><span class="s1">&#39;lex_read_function&#39;</span><span class="p">)()]</span>
</span><span id="mainopt_phones2phones-2399"><a href="#mainopt_phones2phones-2399"><span class="linenos">2399</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span> <span class="o">=</span> <span class="n">parseIntoWordsAndClauses</span><span class="p">(</span><span class="n">format1</span><span class="p">,</span><span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">3</span><span class="p">,</span><span class="s2">&quot;phonemes in &quot;</span><span class="o">+</span><span class="n">format1</span><span class="o">+</span><span class="s2">&quot; format&quot;</span><span class="p">))</span>
</span><span id="mainopt_phones2phones-2400"><a href="#mainopt_phones2phones-2400"><span class="linenos">2400</span></a>   <span class="k">if</span> <span class="n">format2</span><span class="o">==</span><span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">)</span>
</span><span id="mainopt_phones2phones-2401"><a href="#mainopt_phones2phones-2401"><span class="linenos">2401</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">formats</span> <span class="o">=</span> <span class="p">[</span><span class="n">format2</span><span class="p">]</span>
</span><span id="mainopt_phones2phones-2402"><a href="#mainopt_phones2phones-2402"><span class="linenos">2402</span></a>   <span class="k">for</span> <span class="n">format2</span> <span class="ow">in</span> <span class="n">formats</span><span class="p">:</span>
</span><span id="mainopt_phones2phones-2403"><a href="#mainopt_phones2phones-2403"><span class="linenos">2403</span></a>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">formats</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">writeFormatHeader</span><span class="p">(</span><span class="n">format2</span><span class="p">)</span>
</span><span id="mainopt_phones2phones-2404"><a href="#mainopt_phones2phones-2404"><span class="linenos">2404</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="s2">&quot;inline_header&quot;</span><span class="p">)))</span>
</span><span id="mainopt_phones2phones-2405"><a href="#mainopt_phones2phones-2405"><span class="linenos">2405</span></a>     <span class="n">output_clauses</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">clauses</span><span class="p">,</span><span class="n">format1</span><span class="p">,</span><span class="n">format2</span><span class="p">))</span>
</span><span id="mainopt_phones2phones-2406"><a href="#mainopt_phones2phones-2406"><span class="linenos">2406</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">format2</span><span class="p">,</span><span class="s2">&quot;inline_footer&quot;</span><span class="p">)))</span> <span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>*<format1> <format2> [<phonemes in format1>]
Perform a one-off conversion of phonemes from format1 to format2 (format2 can be 'all' if you want)</p>
</div>


                </section>
                <section id="parseIntoWordsAndClauses">
                            <input id="parseIntoWordsAndClauses-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parseIntoWordsAndClauses</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span>, </span><span class="param"><span class="n">phones</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parseIntoWordsAndClauses-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parseIntoWordsAndClauses"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parseIntoWordsAndClauses-2408"><a href="#parseIntoWordsAndClauses-2408"><span class="linenos">2408</span></a><span class="k">def</span> <span class="nf">parseIntoWordsAndClauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">phones</span><span class="p">):</span>
</span><span id="parseIntoWordsAndClauses-2409"><a href="#parseIntoWordsAndClauses-2409"><span class="linenos">2409</span></a>   <span class="s2">&quot;Returns list of clauses, each of which is a list of words, assuming &#39;phones&#39; are in format &#39;format&#39;&quot;</span>
</span><span id="parseIntoWordsAndClauses-2410"><a href="#parseIntoWordsAndClauses-2410"><span class="linenos">2410</span></a>   <span class="n">wordSep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;word_separator&quot;</span><span class="p">)</span> <span class="c1"># don&#39;t use wordSeparator() here - we&#39;re splitting, not joining, so we don&#39;t want it to default to phoneme_separator</span>
</span><span id="parseIntoWordsAndClauses-2411"><a href="#parseIntoWordsAndClauses-2411"><span class="linenos">2411</span></a>   <span class="n">clauseSep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;clause_separator&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="parseIntoWordsAndClauses-2412"><a href="#parseIntoWordsAndClauses-2412"><span class="linenos">2412</span></a>   <span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">sep</span><span class="p">):</span>
</span><span id="parseIntoWordsAndClauses-2413"><a href="#parseIntoWordsAndClauses-2413"><span class="linenos">2413</span></a>      <span class="k">if</span> <span class="n">sep</span><span class="o">==</span><span class="s2">&quot; &quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">None</span> <span class="c1"># &quot; &quot; means ANY whitespace (TODO: document this?)</span>
</span><span id="parseIntoWordsAndClauses-2414"><a href="#parseIntoWordsAndClauses-2414"><span class="linenos">2414</span></a>      <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="n">sep</span><span class="p">,</span><span class="n">phones</span><span class="p">)</span>
</span><span id="parseIntoWordsAndClauses-2415"><a href="#parseIntoWordsAndClauses-2415"><span class="linenos">2415</span></a>   <span class="k">if</span> <span class="n">clauseSep</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">clauseSep</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span>
</span><span id="parseIntoWordsAndClauses-2416"><a href="#parseIntoWordsAndClauses-2416"><span class="linenos">2416</span></a>      <span class="n">clauses</span> <span class="o">=</span> <span class="n">phones</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">clauseSep</span><span class="p">))</span>
</span><span id="parseIntoWordsAndClauses-2417"><a href="#parseIntoWordsAndClauses-2417"><span class="linenos">2417</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span> <span class="o">=</span> <span class="p">[</span><span class="n">phones</span><span class="p">]</span>
</span><span id="parseIntoWordsAndClauses-2418"><a href="#parseIntoWordsAndClauses-2418"><span class="linenos">2418</span></a>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">clauses</span><span class="p">)):</span>
</span><span id="parseIntoWordsAndClauses-2419"><a href="#parseIntoWordsAndClauses-2419"><span class="linenos">2419</span></a>      <span class="k">if</span> <span class="n">wordSep</span><span class="p">:</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">s</span><span class="p">(</span><span class="n">wordSep</span><span class="p">))</span>
</span><span id="parseIntoWordsAndClauses-2420"><a href="#parseIntoWordsAndClauses-2420"><span class="linenos">2420</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
</span><span id="parseIntoWordsAndClauses-2421"><a href="#parseIntoWordsAndClauses-2421"><span class="linenos">2421</span></a>      <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span> <span class="n">clauses</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
</span><span id="parseIntoWordsAndClauses-2422"><a href="#parseIntoWordsAndClauses-2422"><span class="linenos">2422</span></a>   <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="p">,</span><span class="n">clauses</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns list of clauses, each of which is a list of words, assuming 'phones' are in format 'format'</p>
</div>


                </section>
                <section id="mainopt_mac_uk">
                            <input id="mainopt_mac_uk-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_mac_uk</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_mac_uk-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_mac_uk"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_mac_uk-2424"><a href="#mainopt_mac_uk-2424"><span class="linenos">2424</span></a><span class="k">def</span> <span class="nf">mainopt_mac_uk</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_mac_uk-2425"><a href="#mainopt_mac_uk-2425"><span class="linenos">2425</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;&lt;from-format&gt; [&lt;text&gt;]</span>
</span><span id="mainopt_mac_uk-2426"><a href="#mainopt_mac_uk-2426"><span class="linenos">2426</span></a><span class="sd">Speak text in Mac OS 10.7+ British voices while using a lexicon converted in from &lt;from-format&gt;. As these voices do not have user-modifiable lexicons, lexconvert must binary-patch your system&#39;s master lexicon; this is at your own risk! (Superuser privileges are needed the first time. A backup of the system file is made, and all changes are restored on normal exit but if you force-quit then you might need to restore the backup manually. Text speaking needs to be under lexconvert&#39;s control because it usually has to change the input words to make them fit the available space in the binary lexicon.) By default the Daniel voice is used; Emily or Serena can be selected by setting the MACUK_VOICE environment variable.&quot;&quot;&quot;</span>
</span><span id="mainopt_mac_uk-2427"><a href="#mainopt_mac_uk-2427"><span class="linenos">2427</span></a>   <span class="c1"># If you have xterm etc, then text will also be printed, with words from the altered lexicon underlined.</span>
</span><span id="mainopt_mac_uk-2428"><a href="#mainopt_mac_uk-2428"><span class="linenos">2428</span></a>   <span class="k">assert</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;--mac-uk has not been tested with Python 3, I don&#39;t want to risk messing up your system files, please use Python 2&quot;</span>
</span><span id="mainopt_mac_uk-2429"><a href="#mainopt_mac_uk-2429"><span class="linenos">2429</span></a>   <span class="n">fromFormat</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
</span><span id="mainopt_mac_uk-2430"><a href="#mainopt_mac_uk-2430"><span class="linenos">2430</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">fromFormat</span> <span class="ow">in</span> <span class="n">lexFormats</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;No such format &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (use --formats to see a list of formats)&quot;</span>
</span><span id="mainopt_mac_uk-2431"><a href="#mainopt_mac_uk-2431"><span class="linenos">2431</span></a>   <span class="n">lex</span> <span class="o">=</span> <span class="n">get_macuk_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span>
</span><span id="mainopt_mac_uk-2432"><a href="#mainopt_mac_uk-2432"><span class="linenos">2432</span></a>   <span class="k">try</span><span class="p">:</span>
</span><span id="mainopt_mac_uk-2433"><a href="#mainopt_mac_uk-2433"><span class="linenos">2433</span></a>      <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">getInputText</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="s2">&quot;text&quot;</span><span class="p">,</span><span class="kc">True</span><span class="p">):</span>
</span><span id="mainopt_mac_uk-2434"><a href="#mainopt_mac_uk-2434"><span class="linenos">2434</span></a>         <span class="n">m</span> <span class="o">=</span> <span class="n">MacBritish_System_Lexicon</span><span class="p">(</span><span class="n">line</span><span class="p">,</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MACUK_VOICE&quot;</span><span class="p">,</span><span class="s2">&quot;Daniel&quot;</span><span class="p">))</span>
</span><span id="mainopt_mac_uk-2435"><a href="#mainopt_mac_uk-2435"><span class="linenos">2435</span></a>         <span class="k">try</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">readWithLex</span><span class="p">(</span><span class="n">lex</span><span class="p">)</span>
</span><span id="mainopt_mac_uk-2436"><a href="#mainopt_mac_uk-2436"><span class="linenos">2436</span></a>         <span class="k">finally</span><span class="p">:</span> <span class="n">m</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="mainopt_mac_uk-2437"><a href="#mainopt_mac_uk-2437"><span class="linenos">2437</span></a>   <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span><span id="mainopt_mac_uk-2438"><a href="#mainopt_mac_uk-2438"><span class="linenos">2438</span></a>      <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Interrupted</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p><from-format> [<text>]
Speak text in Mac OS 10.7+ British voices while using a lexicon converted in from <from-format>. As these voices do not have user-modifiable lexicons, lexconvert must binary-patch your system's master lexicon; this is at your own risk! (Superuser privileges are needed the first time. A backup of the system file is made, and all changes are restored on normal exit but if you force-quit then you might need to restore the backup manually. Text speaking needs to be under lexconvert's control because it usually has to change the input words to make them fit the available space in the binary lexicon.) By default the Daniel voice is used; Emily or Serena can be selected by setting the MACUK_VOICE environment variable.</p>
</div>


                </section>
                <section id="Counter">
                            <input id="Counter-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Counter</span>:

                <label class="view-source-button" for="Counter-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Counter"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Counter-2440"><a href="#Counter-2440"><span class="linenos">2440</span></a><span class="k">class</span> <span class="nc">Counter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="Counter-2441"><a href="#Counter-2441"><span class="linenos">2441</span></a>    <span class="s2">&quot;A simple class with two static members, count and subcount, for use by the consonant(), vowel() and other() functions&quot;</span>
</span><span id="Counter-2442"><a href="#Counter-2442"><span class="linenos">2442</span></a>    <span class="n">c</span><span class="o">=</span><span class="n">sc</span><span class="o">=</span><span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>A simple class with two static members, count and subcount, for use by the consonant(), vowel() and other() functions</p>
</div>


                            <div id="Counter.c" class="classattr">
                                <div class="attr variable">
            <span class="name">c</span>        =
<span class="default_value">53</span>

        
    </div>
    <a class="headerlink" href="#Counter.c"></a>
    
    

                            </div>
                            <div id="Counter.sc" class="classattr">
                                <div class="attr variable">
            <span class="name">sc</span>        =
<span class="default_value">0</span>

        
    </div>
    <a class="headerlink" href="#Counter.sc"></a>
    
    

                            </div>
                </section>
                <section id="other">
                            <input id="other-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">other</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="other-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#other"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="other-2443"><a href="#other-2443"><span class="linenos">2443</span></a><span class="k">def</span> <span class="nf">other</span><span class="p">():</span>
</span><span id="other-2444"><a href="#other-2444"><span class="linenos">2444</span></a>    <span class="s2">&quot;Used by Phonemes() when creating something that is neither a vowel nor a consonant, e.g. a stress mark&quot;</span>
</span><span id="other-2445"><a href="#other-2445"><span class="linenos">2445</span></a>    <span class="n">Counter</span><span class="o">.</span><span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="k">return</span> <span class="n">Counter</span><span class="o">.</span><span class="n">c</span>
</span></pre></div>


            <div class="docstring"><p>Used by Phonemes() when creating something that is neither a vowel nor a consonant, e.g. a stress mark</p>
</div>


                </section>
                <section id="consonants">
                    <div class="attr variable">
            <span class="name">consonants</span>        =
<span class="default_value">{9, 10, 11, 12, 16, 17, 18, 22, 23, 24, 25, 26, 27, 31, 32, 33, 34, 35, 36, 41, 42, 43, 44, 45}</span>

        
    </div>
    <a class="headerlink" href="#consonants"></a>
    
    

                </section>
                <section id="mainVowels">
                    <div class="attr variable">
            <span class="name">mainVowels</span>        =
<span class="default_value">{1, 2, 3, 4, 5, 6, 7, 8, 13, 14, 15, 19, 20, 21, 28, 30, 37, 39, 40}</span>

        
    </div>
    <a class="headerlink" href="#mainVowels"></a>
    
    

                </section>
                <section id="consonant">
                            <input id="consonant-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">consonant</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="consonant-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#consonant"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="consonant-2447"><a href="#consonant-2447"><span class="linenos">2447</span></a><span class="k">def</span> <span class="nf">consonant</span><span class="p">():</span>
</span><span id="consonant-2448"><a href="#consonant-2448"><span class="linenos">2448</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a consonant&quot;</span>
</span><span id="consonant-2449"><a href="#consonant-2449"><span class="linenos">2449</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="p">;</span> <span class="n">consonants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">r</span>
</span></pre></div>


            <div class="docstring"><p>Used by Phonemes() when creating a consonant</p>
</div>


                </section>
                <section id="vowel">
                            <input id="vowel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">vowel</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="vowel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#vowel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="vowel-2450"><a href="#vowel-2450"><span class="linenos">2450</span></a><span class="k">def</span> <span class="nf">vowel</span><span class="p">():</span>
</span><span id="vowel-2451"><a href="#vowel-2451"><span class="linenos">2451</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a vowel&quot;</span>
</span><span id="vowel-2452"><a href="#vowel-2452"><span class="linenos">2452</span></a>    <span class="n">r</span> <span class="o">=</span> <span class="n">other</span><span class="p">()</span> <span class="p">;</span> <span class="n">mainVowels</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">r</span>
</span></pre></div>


            <div class="docstring"><p>Used by Phonemes() when creating a vowel</p>
</div>


                </section>
                <section id="opt_vowel">
                            <input id="opt_vowel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">opt_vowel</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="opt_vowel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#opt_vowel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="opt_vowel-2453"><a href="#opt_vowel-2453"><span class="linenos">2453</span></a><span class="k">def</span> <span class="nf">opt_vowel</span><span class="p">():</span>
</span><span id="opt_vowel-2454"><a href="#opt_vowel-2454"><span class="linenos">2454</span></a>    <span class="s2">&quot;Used by Phonemes() when creating an optional vowel (one that has no warning issued if some format doesn&#39;t support it)&quot;</span>
</span><span id="opt_vowel-2455"><a href="#opt_vowel-2455"><span class="linenos">2455</span></a>    <span class="k">return</span> <span class="n">other</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Used by Phonemes() when creating an optional vowel (one that has no warning issued if some format doesn't support it)</p>
</div>


                </section>
                <section id="variant">
                            <input id="variant-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">variant</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="variant-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#variant"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="variant-2456"><a href="#variant-2456"><span class="linenos">2456</span></a><span class="k">def</span> <span class="nf">variant</span><span class="p">():</span>
</span><span id="variant-2457"><a href="#variant-2457"><span class="linenos">2457</span></a>    <span class="s2">&quot;Used by Phonemes() when creating a variant of the just-defined vowel/consonant/etc&quot;</span>
</span><span id="variant-2458"><a href="#variant-2458"><span class="linenos">2458</span></a>    <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="variant-2459"><a href="#variant-2459"><span class="linenos">2459</span></a>    <span class="k">while</span> <span class="nb">str</span><span class="p">(</span><span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="p">)</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;0&#39;</span><span class="p">):</span> <span class="n">Counter</span><span class="o">.</span><span class="n">sc</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="variant-2460"><a href="#variant-2460"><span class="linenos">2460</span></a>    <span class="k">return</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%d</span><span class="s1">.</span><span class="si">%d</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Counter</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">Counter</span><span class="o">.</span><span class="n">sc</span><span class="p">))</span>
</span><span id="variant-2461"><a href="#variant-2461"><span class="linenos">2461</span></a>    <span class="c1"># the 0 is so we can say _, name = variant()</span>
</span><span id="variant-2462"><a href="#variant-2462"><span class="linenos">2462</span></a>    <span class="c1"># so as to get some extra indentation</span>
</span></pre></div>


            <div class="docstring"><p>Used by Phonemes() when creating a variant of the just-defined vowel/consonant/etc</p>
</div>


                </section>
                <section id="ifset">
                            <input id="ifset-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ifset</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">var</span>, </span><span class="param"><span class="n">a</span>, </span><span class="param"><span class="n">b</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ifset-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ifset"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ifset-2464"><a href="#ifset-2464"><span class="linenos">2464</span></a><span class="k">def</span> <span class="nf">ifset</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">b</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="ifset-2465"><a href="#ifset-2465"><span class="linenos">2465</span></a>   <span class="s2">&quot;Checks the environment variable var; if it is set (non-empty), return a, otherwise return b.  Used in LexFormats to create tables with variations set by the environment.&quot;</span>
</span><span id="ifset-2466"><a href="#ifset-2466"><span class="linenos">2466</span></a>   <span class="kn">import</span> <span class="nn">os</span>
</span><span id="ifset-2467"><a href="#ifset-2467"><span class="linenos">2467</span></a>   <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">var</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">a</span>
</span><span id="ifset-2468"><a href="#ifset-2468"><span class="linenos">2468</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">b</span>
</span></pre></div>


            <div class="docstring"><p>Checks the environment variable var; if it is set (non-empty), return a, otherwise return b.  Used in LexFormats to create tables with variations set by the environment.</p>
</div>


                </section>
                <section id="speakjet">
                            <input id="speakjet-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">speakjet</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">symbol</span>, </span><span class="param"><span class="n">opcode</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="speakjet-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#speakjet"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="speakjet-2470"><a href="#speakjet-2470"><span class="linenos">2470</span></a><span class="k">def</span> <span class="nf">speakjet</span><span class="p">(</span><span class="n">symbol</span><span class="p">,</span><span class="n">opcode</span><span class="p">):</span>
</span><span id="speakjet-2471"><a href="#speakjet-2471"><span class="linenos">2471</span></a>   <span class="s2">&quot;Special-case function for the Speakjet table&quot;</span>
</span><span id="speakjet-2472"><a href="#speakjet-2472"><span class="linenos">2472</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">opcode</span><span class="p">)</span><span class="o">==</span><span class="nb">int</span>
</span><span id="speakjet-2473"><a href="#speakjet-2473"><span class="linenos">2473</span></a>   <span class="k">if</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_BINARY&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
</span><span id="speakjet-2474"><a href="#speakjet-2474"><span class="linenos">2474</span></a>      <span class="k">assert</span> <span class="ow">not</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_SYM&#39;</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Cannot set both SPEAKJET_SYM and SPEAKJET_BINARY&quot;</span>
</span><span id="speakjet-2475"><a href="#speakjet-2475"><span class="linenos">2475</span></a>      <span class="k">return</span> <span class="nb">chr</span><span class="p">(</span><span class="n">opcode</span><span class="p">)</span>
</span><span id="speakjet-2476"><a href="#speakjet-2476"><span class="linenos">2476</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ifset</span><span class="p">(</span><span class="s1">&#39;SPEAKJET_SYM&#39;</span><span class="p">,</span><span class="n">symbol</span><span class="p">,</span><span class="nb">str</span><span class="p">(</span><span class="n">opcode</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function for the Speakjet table</p>
</div>


                </section>
                <section id="makeDic">
                            <input id="makeDic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeDic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">doc</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="makeDic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#makeDic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="makeDic-2478"><a href="#makeDic-2478"><span class="linenos">2478</span></a><span class="k">def</span> <span class="nf">makeDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="makeDic-2479"><a href="#makeDic-2479"><span class="linenos">2479</span></a>    <span class="s2">&quot;Make a dictionary with a doc string, default-bidirectional mappings and extra settings; see LexFormats for how this is used.&quot;</span>
</span><span id="makeDic-2480"><a href="#makeDic-2480"><span class="linenos">2480</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">==</span><span class="nb">str</span><span class="p">,</span> <span class="s2">&quot;doc must be a string&quot;</span>
</span><span id="makeDic-2481"><a href="#makeDic-2481"><span class="linenos">2481</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">duplicates</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="makeDic-2482"><a href="#makeDic-2482"><span class="linenos">2482</span></a>    <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">args</span><span class="p">:</span>
</span><span id="makeDic-2483"><a href="#makeDic-2483"><span class="linenos">2483</span></a>        <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">)</span>
</span><span id="makeDic-2484"><a href="#makeDic-2484"><span class="linenos">2484</span></a>        <span class="n">k</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="makeDic-2485"><a href="#makeDic-2485"><span class="linenos">2485</span></a>        <span class="k">if</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
</span><span id="makeDic-2486"><a href="#makeDic-2486"><span class="linenos">2486</span></a>        <span class="n">v</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="makeDic-2487"><a href="#makeDic-2487"><span class="linenos">2487</span></a>        <span class="k">assert</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">])</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]),</span> <span class="s2">&quot;Wrong types &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; (did you forget a _, before calling variant() or something?)&quot;</span>
</span><span id="makeDic-2488"><a href="#makeDic-2488"><span class="linenos">2488</span></a>        <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="makeDic-2489"><a href="#makeDic-2489"><span class="linenos">2489</span></a>        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="makeDic-2490"><a href="#makeDic-2490"><span class="linenos">2490</span></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span> <span class="n">bidir</span><span class="o">=</span><span class="n">a</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
</span><span id="makeDic-2491"><a href="#makeDic-2491"><span class="linenos">2491</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">bidir</span><span class="o">=</span><span class="kc">True</span>
</span><span id="makeDic-2492"><a href="#makeDic-2492"><span class="linenos">2492</span></a>        <span class="k">if</span> <span class="n">bidir</span><span class="p">:</span>
</span><span id="makeDic-2493"><a href="#makeDic-2493"><span class="linenos">2493</span></a>            <span class="c1"># (k,v,True) = both (k,v) and (v,k)</span>
</span><span id="makeDic-2494"><a href="#makeDic-2494"><span class="linenos">2494</span></a>            <span class="k">if</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">duplicates</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</span><span id="makeDic-2495"><a href="#makeDic-2495"><span class="linenos">2495</span></a>            <span class="n">d</span><span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="o">=</span> <span class="n">k</span>
</span><span id="makeDic-2496"><a href="#makeDic-2496"><span class="linenos">2496</span></a>    <span class="k">assert</span> <span class="ow">not</span> <span class="n">duplicates</span><span class="p">,</span> <span class="s2">&quot; Duplicate key(s) in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="nb">repr</span><span class="p">(</span><span class="n">dup</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot; (=&quot;</span><span class="o">+</span><span class="n">g</span><span class="o">+</span><span class="s2">&quot;)&quot;</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="n">dup</span><span class="p">))</span> <span class="k">for</span> <span class="n">dup</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">duplicates</span><span class="p">)))</span><span class="o">+</span><span class="s2">&quot;. Did you forget a ,False to suppress bidirectional mapping?&quot;</span> <span class="c1"># by the way, Python does not detect duplicate keys in {...} notation - it just lets you overwrite</span>
</span><span id="makeDic-2497"><a href="#makeDic-2497"><span class="linenos">2497</span></a>    <span class="n">missing</span> <span class="o">=</span> <span class="p">[</span><span class="n">l</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">consonants</span><span class="p">)</span><span class="o">+</span><span class="nb">list</span><span class="p">(</span><span class="n">mainVowels</span><span class="p">))</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">d</span><span class="p">]</span>
</span><span id="makeDic-2498"><a href="#makeDic-2498"><span class="linenos">2498</span></a>    <span class="c1"># did_approx = False</span>
</span><span id="makeDic-2499"><a href="#makeDic-2499"><span class="linenos">2499</span></a>    <span class="k">if</span> <span class="n">missing</span> <span class="ow">and</span> <span class="s1">&#39;approximate_missing&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="makeDic-2500"><a href="#makeDic-2500"><span class="linenos">2500</span></a>      <span class="k">for</span> <span class="n">miss</span><span class="p">,</span><span class="n">approxTo</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="makeDic-2501"><a href="#makeDic-2501"><span class="linenos">2501</span></a>          <span class="c1"># TODO: put this table somewhere else?</span>
</span><span id="makeDic-2502"><a href="#makeDic-2502"><span class="linenos">2502</span></a>          <span class="c1"># (If the thing on the right is just 1 item, we could make the thing on the left a variant of it.  But that might not be a good idea unless they&#39;re really very close, since if it&#39;s a variant then the substitution is done without warning even if approximate_missing is not set.)</span>
</span><span id="makeDic-2503"><a href="#makeDic-2503"><span class="linenos">2503</span></a>          <span class="p">(</span><span class="n">a_as_in_ago</span><span class="p">,</span> <span class="p">[</span><span class="n">u_as_in_but</span><span class="p">]),</span>
</span><span id="makeDic-2504"><a href="#makeDic-2504"><span class="linenos">2504</span></a>          <span class="p">(</span><span class="n">a_as_in_air</span><span class="p">,</span> <span class="p">[</span><span class="n">e_as_in_them</span><span class="p">,</span><span class="n">r</span><span class="p">]),</span>
</span><span id="makeDic-2505"><a href="#makeDic-2505"><span class="linenos">2505</span></a>          <span class="p">(</span><span class="n">ear</span><span class="p">,</span> <span class="p">[</span><span class="n">e_as_in_eat</span><span class="p">,</span><span class="n">u_as_in_but</span><span class="p">]),</span>
</span><span id="makeDic-2506"><a href="#makeDic-2506"><span class="linenos">2506</span></a>          <span class="p">(</span><span class="n">oor_as_in_poor</span><span class="p">,</span> <span class="p">[</span><span class="n">close_to_or</span><span class="p">]),</span> <span class="c1"># TODO: ,r?</span>
</span><span id="makeDic-2507"><a href="#makeDic-2507"><span class="linenos">2507</span></a>          <span class="p">(</span><span class="n">a_as_in_ah</span><span class="p">,[</span><span class="n">a_as_in_apple</span><span class="p">]),</span> <span class="c1"># this seems to be missing in some American voices (DecTalk, Keynote, SAM); TODO: is this the best approximation we can do?</span>
</span><span id="makeDic-2508"><a href="#makeDic-2508"><span class="linenos">2508</span></a>          <span class="p">]:</span>
</span><span id="makeDic-2509"><a href="#makeDic-2509"><span class="linenos">2509</span></a>        <span class="k">if</span> <span class="n">miss</span> <span class="ow">in</span> <span class="n">missing</span> <span class="ow">and</span> <span class="nb">all</span><span class="p">(</span><span class="n">x</span> <span class="ow">in</span> <span class="n">d</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">approxTo</span><span class="p">):</span>
</span><span id="makeDic-2510"><a href="#makeDic-2510"><span class="linenos">2510</span></a>          <span class="n">d</span><span class="p">[</span><span class="n">miss</span><span class="p">]</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">kwargs</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;phoneme_separator&quot;</span><span class="p">,</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">d</span><span class="p">[</span><span class="n">approxTo</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">approxTo</span><span class="p">)</span>
</span><span id="makeDic-2511"><a href="#makeDic-2511"><span class="linenos">2511</span></a>          <span class="c1"># did_approx = True</span>
</span><span id="makeDic-2512"><a href="#makeDic-2512"><span class="linenos">2512</span></a>          <span class="n">missing</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">miss</span><span class="p">)</span>
</span><span id="makeDic-2513"><a href="#makeDic-2513"><span class="linenos">2513</span></a>    <span class="c1"># if did_approx: doc=&quot;(approx.) &quot;+doc # and see also the code in makeVariantDic.  Commenting out because this is misleading: the formats where we didn&#39;t do a did_approx might also contain approximations of some kind.  Incidentally there are some British English voices that need approximate_missing (e.g. Apollo 2)</span>
</span><span id="makeDic-2514"><a href="#makeDic-2514"><span class="linenos">2514</span></a>    <span class="n">d</span><span class="p">[(</span><span class="s2">&quot;settings&quot;</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">doc</span>
</span><span id="makeDic-2515"><a href="#makeDic-2515"><span class="linenos">2515</span></a>    <span class="k">if</span> <span class="n">missing</span><span class="p">:</span>
</span><span id="makeDic-2516"><a href="#makeDic-2516"><span class="linenos">2516</span></a>       <span class="kn">import</span> <span class="nn">sys</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;WARNING: Some non-optional vowels/consonants are missing from &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">The following are missing: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">g</span> <span class="k">for</span> <span class="n">g</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">val</span><span class="o">==</span><span class="n">m</span><span class="p">)</span> <span class="k">for</span> <span class="n">m</span> <span class="ow">in</span> <span class="n">missing</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="makeDic-2517"><a href="#makeDic-2517"><span class="linenos">2517</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">d</span><span class="p">[(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">v</span>
</span><span id="makeDic-2518"><a href="#makeDic-2518"><span class="linenos">2518</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;cleanup_regexps&#39;</span><span class="p">),[]))</span><span class="o">==</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;cleanup_regexps must be a list&quot;</span> <span class="c1"># not one tuple</span>
</span><span id="makeDic-2519"><a href="#makeDic-2519"><span class="linenos">2519</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;cvtOut_regexps&#39;</span><span class="p">),[]))</span><span class="o">==</span><span class="nb">list</span><span class="p">,</span> <span class="s2">&quot;cvtOut_regexps must be a list&quot;</span> <span class="c1"># not one tuple</span>
</span><span id="makeDic-2520"><a href="#makeDic-2520"><span class="linenos">2520</span></a>    <span class="n">wsep</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;word_separator&#39;</span><span class="p">),</span><span class="kc">None</span><span class="p">)</span>
</span><span id="makeDic-2521"><a href="#makeDic-2521"><span class="linenos">2521</span></a>    <span class="n">psep</span> <span class="o">=</span> <span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="s1">&#39;phoneme_separator&#39;</span><span class="p">),</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="makeDic-2522"><a href="#makeDic-2522"><span class="linenos">2522</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">wsep</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="k">assert</span> <span class="ow">not</span> <span class="n">wsep</span> <span class="ow">in</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;word_separator duplicates with a key in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="makeDic-2523"><a href="#makeDic-2523"><span class="linenos">2523</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">psep</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="k">assert</span> <span class="ow">not</span> <span class="n">psep</span> <span class="ow">in</span> <span class="n">d</span><span class="p">,</span> <span class="s2">&quot;phoneme_separator duplicates with a key (did you forget to change the default, or to add a ,False somewhere?) in &quot;</span><span class="o">+</span><span class="nb">repr</span><span class="p">(</span><span class="n">doc</span><span class="p">)</span>
</span><span id="makeDic-2524"><a href="#makeDic-2524"><span class="linenos">2524</span></a>    <span class="k">global</span> <span class="n">lastDictionaryMade</span> <span class="p">;</span> <span class="n">lastDictionaryMade</span> <span class="o">=</span> <span class="n">d</span>
</span><span id="makeDic-2525"><a href="#makeDic-2525"><span class="linenos">2525</span></a>    <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Make a dictionary with a doc string, default-bidirectional mappings and extra settings; see LexFormats for how this is used.</p>
</div>


                </section>
                <section id="makeVariantDic">
                            <input id="makeVariantDic-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">makeVariantDic</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">doc</span>, </span><span class="param"><span class="o">*</span><span class="n">args</span>, </span><span class="param"><span class="o">**</span><span class="n">kwargs</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="makeVariantDic-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#makeVariantDic"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="makeVariantDic-2526"><a href="#makeVariantDic-2526"><span class="linenos">2526</span></a><span class="k">def</span> <span class="nf">makeVariantDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span id="makeVariantDic-2527"><a href="#makeVariantDic-2527"><span class="linenos">2527</span></a>    <span class="s2">&quot;Like makeDic but create a new &#39;variant&#39; version of the last-made dictionary, modifying some phonemes and settings (and giving it a new doc string) but keeping everything else the same.  Any list settings (e.g. cleanup_regexps) are ADDED to by the variant; other settings and phonemes are REPLACED if they are specified in the variant.  If you don&#39;t want subsequent variants to inherit the changes made by this variant, add noInherit=True to the keyword args.&quot;</span>
</span><span id="makeVariantDic-2528"><a href="#makeVariantDic-2528"><span class="linenos">2528</span></a>    <span class="k">global</span> <span class="n">lastDictionaryMade</span>
</span><span id="makeVariantDic-2529"><a href="#makeVariantDic-2529"><span class="linenos">2529</span></a>    <span class="n">ldmOld</span> <span class="o">=</span> <span class="n">lastDictionaryMade</span>
</span><span id="makeVariantDic-2530"><a href="#makeVariantDic-2530"><span class="linenos">2530</span></a>    <span class="n">toUpdate</span> <span class="o">=</span> <span class="n">lastDictionaryMade</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="makeVariantDic-2531"><a href="#makeVariantDic-2531"><span class="linenos">2531</span></a>    <span class="k">global</span> <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span>
</span><span id="makeVariantDic-2532"><a href="#makeVariantDic-2532"><span class="linenos">2532</span></a>    <span class="n">oldV</span><span class="p">,</span><span class="n">oldC</span> <span class="o">=</span> <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span>
</span><span id="makeVariantDic-2533"><a href="#makeVariantDic-2533"><span class="linenos">2533</span></a>    <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c1"># so makeDic doesn&#39;t complain if some vowels/consonants are missing</span>
</span><span id="makeVariantDic-2534"><a href="#makeVariantDic-2534"><span class="linenos">2534</span></a>    <span class="k">if</span> <span class="s1">&#39;noInherit&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
</span><span id="makeVariantDic-2535"><a href="#makeVariantDic-2535"><span class="linenos">2535</span></a>       <span class="n">noInherit</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noInherit&#39;</span><span class="p">]</span>
</span><span id="makeVariantDic-2536"><a href="#makeVariantDic-2536"><span class="linenos">2536</span></a>       <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;noInherit&#39;</span><span class="p">]</span>
</span><span id="makeVariantDic-2537"><a href="#makeVariantDic-2537"><span class="linenos">2537</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">noInherit</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="makeVariantDic-2538"><a href="#makeVariantDic-2538"><span class="linenos">2538</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="n">makeDic</span><span class="p">(</span><span class="n">doc</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span id="makeVariantDic-2539"><a href="#makeVariantDic-2539"><span class="linenos">2539</span></a>    <span class="k">if</span> <span class="n">noInherit</span><span class="p">:</span> <span class="n">lastDictionaryMade</span> <span class="o">=</span> <span class="n">ldmOld</span>
</span><span id="makeVariantDic-2540"><a href="#makeVariantDic-2540"><span class="linenos">2540</span></a>    <span class="n">mainVowels</span><span class="p">,</span><span class="n">consonants</span> <span class="o">=</span> <span class="n">oldV</span><span class="p">,</span><span class="n">oldC</span>
</span><span id="makeVariantDic-2541"><a href="#makeVariantDic-2541"><span class="linenos">2541</span></a>    <span class="c1"># if toUpdate[(&quot;settings&quot;,&quot;doc&quot;)].startswith(&quot;(approx.) &quot;) and not d[(&quot;settings&quot;,&quot;doc&quot;)].startswith(&quot;(approx.) &quot;): d[(&quot;settings&quot;,&quot;doc&quot;)]=&quot;(approx.) &quot;+d[(&quot;settings&quot;,&quot;doc&quot;)] # TODO: always?</span>
</span><span id="makeVariantDic-2542"><a href="#makeVariantDic-2542"><span class="linenos">2542</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">toUpdate</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="makeVariantDic-2543"><a href="#makeVariantDic-2543"><span class="linenos">2543</span></a>       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">d</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">v</span><span class="o">+</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="makeVariantDic-2544"><a href="#makeVariantDic-2544"><span class="linenos">2544</span></a>    <span class="n">toUpdate</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="n">toUpdate</span>
</span></pre></div>


            <div class="docstring"><p>Like makeDic but create a new 'variant' version of the last-made dictionary, modifying some phonemes and settings (and giving it a new doc string) but keeping everything else the same.  Any list settings (e.g. cleanup_regexps) are ADDED to by the variant; other settings and phonemes are REPLACED if they are specified in the variant.  If you don't want subsequent variants to inherit the changes made by this variant, add noInherit=True to the keyword args.</p>
</div>


                </section>
                <section id="getSetting">
                            <input id="getSetting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getSetting</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">formatName</span>, </span><span class="param"><span class="n">settingName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="getSetting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#getSetting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="getSetting-2545"><a href="#getSetting-2545"><span class="linenos">2545</span></a><span class="k">def</span> <span class="nf">getSetting</span><span class="p">(</span><span class="n">formatName</span><span class="p">,</span><span class="n">settingName</span><span class="p">):</span>
</span><span id="getSetting-2546"><a href="#getSetting-2546"><span class="linenos">2546</span></a>  <span class="s2">&quot;Gets a setting from lexFormats, exception if not there&quot;</span>
</span><span id="getSetting-2547"><a href="#getSetting-2547"><span class="linenos">2547</span></a>  <span class="k">return</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">formatName</span><span class="p">][(</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">settingName</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Gets a setting from lexFormats, exception if not there</p>
</div>


                </section>
                <section id="checkSetting">
                            <input id="checkSetting-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">checkSetting</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">formatName</span>, </span><span class="param"><span class="n">settingName</span>, </span><span class="param"><span class="n">default</span><span class="o">=</span><span class="s1">&#39;&#39;</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="checkSetting-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#checkSetting"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="checkSetting-2548"><a href="#checkSetting-2548"><span class="linenos">2548</span></a><span class="k">def</span> <span class="nf">checkSetting</span><span class="p">(</span><span class="n">formatName</span><span class="p">,</span><span class="n">settingName</span><span class="p">,</span><span class="n">default</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="checkSetting-2549"><a href="#checkSetting-2549"><span class="linenos">2549</span></a>  <span class="s2">&quot;Gets a setting from lexFormats, default if not there&quot;</span>
</span><span id="checkSetting-2550"><a href="#checkSetting-2550"><span class="linenos">2550</span></a>  <span class="k">return</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">formatName</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">((</span><span class="s1">&#39;settings&#39;</span><span class="p">,</span><span class="n">settingName</span><span class="p">),</span><span class="n">default</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Gets a setting from lexFormats, default if not there</p>
</div>


                </section>
                <section id="getBuf">
                            <input id="getBuf-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getBuf</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">f</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="getBuf-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#getBuf"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="getBuf-2568"><a href="#getBuf-2568"><span class="linenos">2568</span></a><span class="k">def</span> <span class="nf">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
</span><span id="getBuf-2569"><a href="#getBuf-2569"><span class="linenos">2569</span></a>   <span class="s2">&quot;Return a buffer to which bytes may be written, for Python 2 and 3 compatibility&quot;</span>
</span><span id="getBuf-2570"><a href="#getBuf-2570"><span class="linenos">2570</span></a>   <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">f</span><span class="o">.</span><span class="n">buffer</span> <span class="c1"># Python 3</span>
</span><span id="getBuf-2571"><a href="#getBuf-2571"><span class="linenos">2571</span></a>   <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span> <span class="k">return</span> <span class="n">f</span> <span class="c1"># Python 2</span>
</span></pre></div>


            <div class="docstring"><p>Return a buffer to which bytes may be written, for Python 2 and 3 compatibility</p>
</div>


                </section>
                <section id="make_dictionary">
                            <input id="make_dictionary-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">make_dictionary</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">sourceName</span>, </span><span class="param"><span class="n">destName</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="make_dictionary-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#make_dictionary"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="make_dictionary-2574"><a href="#make_dictionary-2574"><span class="linenos">2574</span></a><span class="k">def</span> <span class="nf">make_dictionary</span><span class="p">(</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">):</span>
</span><span id="make_dictionary-2575"><a href="#make_dictionary-2575"><span class="linenos">2575</span></a>    <span class="s2">&quot;Uses lexFormats to make a mapping dictionary from a particular source format to a particular dest format, and also sets module variables for that particular conversion (TODO: put those module vars into an object in case someone wants to use this code in a multithreaded server)&quot;</span>
</span><span id="make_dictionary-2576"><a href="#make_dictionary-2576"><span class="linenos">2576</span></a>    <span class="k">global</span> <span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">,</span><span class="n">cached_dict</span>
</span><span id="make_dictionary-2577"><a href="#make_dictionary-2577"><span class="linenos">2577</span></a>    <span class="k">if</span> <span class="p">(</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">):</span> <span class="k">return</span> <span class="n">cached_dict</span>
</span><span id="make_dictionary-2578"><a href="#make_dictionary-2578"><span class="linenos">2578</span></a>    <span class="n">source</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">sourceName</span><span class="p">]</span>
</span><span id="make_dictionary-2579"><a href="#make_dictionary-2579"><span class="linenos">2579</span></a>    <span class="n">dest</span> <span class="o">=</span> <span class="n">lexFormats</span><span class="p">[</span><span class="n">destName</span><span class="p">]</span>
</span><span id="make_dictionary-2580"><a href="#make_dictionary-2580"><span class="linenos">2580</span></a>    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="make_dictionary-2581"><a href="#make_dictionary-2581"><span class="linenos">2581</span></a>    <span class="k">global</span> <span class="n">dest_consonants</span> <span class="p">;</span> <span class="n">dest_consonants</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span><span id="make_dictionary-2582"><a href="#make_dictionary-2582"><span class="linenos">2582</span></a>    <span class="k">global</span> <span class="n">dest_syllable_sep</span> <span class="p">;</span> <span class="n">dest_syllable_sep</span> <span class="o">=</span> <span class="n">dest</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="make_dictionary-2583"><a href="#make_dictionary-2583"><span class="linenos">2583</span></a>    <span class="k">global</span> <span class="n">implicit_vowel_before_NL</span>
</span><span id="make_dictionary-2584"><a href="#make_dictionary-2584"><span class="linenos">2584</span></a>    <span class="n">implicit_vowel_before_NL</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="make_dictionary-2585"><a href="#make_dictionary-2585"><span class="linenos">2585</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">source</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="make_dictionary-2586"><a href="#make_dictionary-2586"><span class="linenos">2586</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">==</span><span class="nb">tuple</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># settings</span>
</span><span id="make_dictionary-2587"><a href="#make_dictionary-2587"><span class="linenos">2587</span></a>      <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># (num-&gt;string entries are for converting IN to source; we want the string-&gt;num entries for converting out)</span>
</span><span id="make_dictionary-2588"><a href="#make_dictionary-2588"><span class="linenos">2588</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span> <span class="n">v</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="c1"># (try the main version of a variant)</span>
</span><span id="make_dictionary-2589"><a href="#make_dictionary-2589"><span class="linenos">2589</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># (haven&#39;t got it - will have to ignore or break into parts)</span>
</span><span id="make_dictionary-2590"><a href="#make_dictionary-2590"><span class="linenos">2590</span></a>      <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]</span>
</span><span id="make_dictionary-2591"><a href="#make_dictionary-2591"><span class="linenos">2591</span></a>      <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">dest</span><span class="p">[</span><span class="n">v</span><span class="p">]</span>
</span><span id="make_dictionary-2592"><a href="#make_dictionary-2592"><span class="linenos">2592</span></a>      <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="ow">in</span> <span class="n">consonants</span><span class="p">:</span> <span class="n">dest_consonants</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">])</span>
</span><span id="make_dictionary-2593"><a href="#make_dictionary-2593"><span class="linenos">2593</span></a>      <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="n">e_as_in_herd</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">implicit_vowel_before_NL</span> <span class="ow">or</span> <span class="n">v</span><span class="o">==</span><span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="p">)):</span> <span class="c1"># TODO: or u_as_in_but ?  used by festival and some other synths before words ending &#39;n&#39; or &#39;l&#39; (see usage of implicit_vowel_before_NL later)</span>
</span><span id="make_dictionary-2594"><a href="#make_dictionary-2594"><span class="linenos">2594</span></a>        <span class="n">implicit_vowel_before_NL</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="make_dictionary-2595"><a href="#make_dictionary-2595"><span class="linenos">2595</span></a>      <span class="n">d</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="make_dictionary-2596"><a href="#make_dictionary-2596"><span class="linenos">2596</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">d</span><span class="p">[</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">k</span><span class="p">)]</span> <span class="o">=</span> <span class="n">d</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
</span><span id="make_dictionary-2597"><a href="#make_dictionary-2597"><span class="linenos">2597</span></a>      <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="make_dictionary-2598"><a href="#make_dictionary-2598"><span class="linenos">2598</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="make_dictionary-2599"><a href="#make_dictionary-2599"><span class="linenos">2599</span></a>       <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">()):</span> <span class="n">d</span><span class="p">,</span><span class="n">dest_consonants</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="nb">set</span><span class="p">(</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">)</span> <span class="c1"># Python 2: if ANY dest are Unicode, make them ALL Unicode</span>
</span><span id="make_dictionary-2600"><a href="#make_dictionary-2600"><span class="linenos">2600</span></a>    <span class="k">except</span> <span class="ne">UnicodeDecodeError</span><span class="p">:</span> <span class="n">d</span><span class="p">,</span><span class="n">dest_consonants</span><span class="o">=</span><span class="nb">dict</span><span class="p">((</span><span class="n">k</span><span class="p">,</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">v</span><span class="p">))</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span><span class="nb">set</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">)</span> <span class="c1"># ... or make them ALL byte-strings if some were binary and not readable as UTF-8</span>
</span><span id="make_dictionary-2601"><a href="#make_dictionary-2601"><span class="linenos">2601</span></a>    <span class="n">cached_sourceName</span><span class="p">,</span><span class="n">cached_destName</span><span class="p">,</span><span class="n">cached_dict</span><span class="o">=</span><span class="n">sourceName</span><span class="p">,</span><span class="n">destName</span><span class="p">,</span><span class="n">d</span>
</span><span id="make_dictionary-2602"><a href="#make_dictionary-2602"><span class="linenos">2602</span></a>    <span class="k">return</span> <span class="n">d</span>
</span></pre></div>


            <div class="docstring"><p>Uses lexFormats to make a mapping dictionary from a particular source format to a particular dest format, and also sets module variables for that particular conversion (TODO: put those module vars into an object in case someone wants to use this code in a multithreaded server)</p>
</div>


                </section>
                <section id="warnedAlready">
                    <div class="attr variable">
            <span class="name">warnedAlready</span>        =
<span class="default_value">set()</span>

        
    </div>
    <a class="headerlink" href="#warnedAlready"></a>
    
    

                </section>
                <section id="convert">
                            <input id="convert-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span>, </span><span class="param"><span class="n">source</span>, </span><span class="param"><span class="n">dest</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="convert-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert-2605"><a href="#convert-2605"><span class="linenos">2605</span></a><span class="k">def</span> <span class="nf">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">):</span>
</span><span id="convert-2606"><a href="#convert-2606"><span class="linenos">2606</span></a>    <span class="s2">&quot;Convert pronunc from source to dest.  pronunc can be a string or a list; if a list then we&#39;ll recurse on each of the list elements and return a new list (this is meant for batch-converting clauses etc)&quot;</span>
</span><span id="convert-2607"><a href="#convert-2607"><span class="linenos">2607</span></a>    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">,</span><span class="nb">list</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="convert-2608"><a href="#convert-2608"><span class="linenos">2608</span></a>    <span class="k">if</span> <span class="n">source</span><span class="o">==</span><span class="n">dest</span><span class="p">:</span> <span class="k">return</span> <span class="n">pronunc</span> <span class="c1"># essential for --try experimentation with codes not yet supported by lexconvert</span>
</span><span id="convert-2609"><a href="#convert-2609"><span class="linenos">2609</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">==</span><span class="nb">list</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">convert</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">)</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="p">]</span>
</span><span id="convert-2610"><a href="#convert-2610"><span class="linenos">2610</span></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s1">&#39;cvtOut_func&#39;</span><span class="p">)</span>
</span><span id="convert-2611"><a href="#convert-2611"><span class="linenos">2611</span></a>    <span class="k">if</span> <span class="n">func</span><span class="p">:</span> <span class="n">pronunc</span><span class="o">=</span><span class="n">func</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="convert-2612"><a href="#convert-2612"><span class="linenos">2612</span></a>    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s1">&#39;cvtOut_regexps&#39;</span><span class="p">):</span>
</span><span id="convert-2613"><a href="#convert-2613"><span class="linenos">2613</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="convert-2614"><a href="#convert-2614"><span class="linenos">2614</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">toAddAfter</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="convert-2615"><a href="#convert-2615"><span class="linenos">2615</span></a>    <span class="n">dictionary</span> <span class="o">=</span> <span class="n">make_dictionary</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="n">dest</span><span class="p">)</span>
</span><span id="convert-2616"><a href="#convert-2616"><span class="linenos">2616</span></a>    <span class="n">maxLen</span><span class="o">=</span><span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
</span><span id="convert-2617"><a href="#convert-2617"><span class="linenos">2617</span></a>    <span class="n">debugInfo</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="convert-2618"><a href="#convert-2618"><span class="linenos">2618</span></a>    <span class="n">separator</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;phoneme_separator&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
</span><span id="convert-2619"><a href="#convert-2619"><span class="linenos">2619</span></a>    <span class="n">safe_to_drop</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;safe_to_drop_characters&quot;</span><span class="p">)</span>
</span><span id="convert-2620"><a href="#convert-2620"><span class="linenos">2620</span></a>    <span class="k">while</span> <span class="n">pronunc</span><span class="p">:</span>
</span><span id="convert-2621"><a href="#convert-2621"><span class="linenos">2621</span></a>        <span class="k">for</span> <span class="n">lettersToTry</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">maxLen</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
</span><span id="convert-2622"><a href="#convert-2622"><span class="linenos">2622</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">lettersToTry</span><span class="p">:</span>
</span><span id="convert-2623"><a href="#convert-2623"><span class="linenos">2623</span></a>              <span class="k">if</span> <span class="n">safe_to_drop</span><span class="o">==</span><span class="kc">True</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="convert-2624"><a href="#convert-2624"><span class="linenos">2624</span></a>              <span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">safe_to_drop</span><span class="p">)</span> <span class="ow">or</span> <span class="ow">not</span> <span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="n">safe_to_drop</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span><span class="n">debugInfo</span><span class="p">)</span> <span class="ow">in</span> <span class="n">warnedAlready</span><span class="p">:</span>
</span><span id="convert-2625"><a href="#convert-2625"><span class="linenos">2625</span></a>                 <span class="n">warnedAlready</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">],</span><span class="n">debugInfo</span><span class="p">))</span>
</span><span id="convert-2626"><a href="#convert-2626"><span class="linenos">2626</span></a>               <span class="c1">#   sys.stderr.write(&quot;Warning: ignoring &quot;+source+&quot; character &quot;+repr(pronunc[:1])+debugInfo+&quot; (unsupported in &quot;+dest+&quot;)\n&quot;)</span>
</span><span id="convert-2627"><a href="#convert-2627"><span class="linenos">2627</span></a>              <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># ignore</span>
</span><span id="convert-2628"><a href="#convert-2628"><span class="linenos">2628</span></a>            <span class="k">elif</span> <span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dictionary</span><span class="p">:</span>
</span><span id="convert-2629"><a href="#convert-2629"><span class="linenos">2629</span></a>                <span class="n">debugInfo</span><span class="o">=</span><span class="s2">&quot; after &quot;</span><span class="o">+</span><span class="n">as_printable</span><span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">])</span>
</span><span id="convert-2630"><a href="#convert-2630"><span class="linenos">2630</span></a>                <span class="n">toAdd</span><span class="o">=</span><span class="n">dictionary</span><span class="p">[</span><span class="n">pronunc</span><span class="p">[:</span><span class="n">lettersToTry</span><span class="p">]]</span>
</span><span id="convert-2631"><a href="#convert-2631"><span class="linenos">2631</span></a>                <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">],</span> <span class="nb">type</span><span class="p">(</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="convert-2632"><a href="#convert-2632"><span class="linenos">2632</span></a>                <span class="n">isStressMark</span><span class="o">=</span><span class="p">(</span><span class="n">toAdd</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">primary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">secondary_stress</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">)])</span>
</span><span id="convert-2633"><a href="#convert-2633"><span class="linenos">2633</span></a>                <span class="k">if</span> <span class="n">toAdd</span><span class="o">==</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">lexFormats</span><span class="p">[</span><span class="n">dest</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">syllable_separator</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">),</span><span class="n">toAdd</span><span class="p">):</span> <span class="k">pass</span>
</span><span id="convert-2634"><a href="#convert-2634"><span class="linenos">2634</span></a>                <span class="k">elif</span> <span class="n">isStressMark</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span>
</span><span id="convert-2635"><a href="#convert-2635"><span class="linenos">2635</span></a>                    <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span> <span class="n">toAdd</span><span class="p">,</span> <span class="n">toAddAfter</span> <span class="o">=</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">),</span><span class="n">toAdd</span> <span class="c1"># move stress marks from before vowel to after</span>
</span><span id="convert-2636"><a href="#convert-2636"><span class="linenos">2636</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="c1"># stress is already after, but:</span>
</span><span id="convert-2637"><a href="#convert-2637"><span class="linenos">2637</span></a>                        <span class="c1"># With Cepstral synth (and kana-approx), stress mark should be placed EXACTLY after the vowel and not any later.  Might as well do this for others also.</span>
</span><span id="convert-2638"><a href="#convert-2638"><span class="linenos">2638</span></a>                        <span class="n">r</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
</span><span id="convert-2639"><a href="#convert-2639"><span class="linenos">2639</span></a>                        <span class="k">while</span> <span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;*added&quot;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="n">r</span><span class="p">])):</span> <span class="n">r</span> <span class="o">-=</span> <span class="mi">1</span> <span class="c1"># (if that raises IndexError then the input had a stress mark before any vowel) (&quot;*added&quot; condition is there so that implicit vowels don&#39;t get the stress)</span>
</span><span id="convert-2640"><a href="#convert-2640"><span class="linenos">2640</span></a>                        <span class="n">ret</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span> <span class="p">;</span> <span class="n">toAdd</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="convert-2641"><a href="#convert-2641"><span class="linenos">2641</span></a>                <span class="k">elif</span> <span class="n">isStressMark</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">source</span><span class="p">,</span><span class="s2">&quot;stress_comes_before_vowel&quot;</span><span class="p">):</span> <span class="c1"># it&#39;s a stress mark that should be moved from after the vowel to before it</span>
</span><span id="convert-2642"><a href="#convert-2642"><span class="linenos">2642</span></a>                    <span class="n">i</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="convert-2643"><a href="#convert-2643"><span class="linenos">2643</span></a>                    <span class="k">while</span> <span class="n">i</span> <span class="ow">and</span> <span class="p">(</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">or</span> <span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;*added&quot;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]))):</span> <span class="n">i</span> <span class="o">-=</span> <span class="mi">1</span>
</span><span id="convert-2644"><a href="#convert-2644"><span class="linenos">2644</span></a>                    <span class="k">if</span> <span class="n">i</span><span class="p">:</span> <span class="n">i</span><span class="o">-=</span><span class="mi">1</span>
</span><span id="convert-2645"><a href="#convert-2645"><span class="linenos">2645</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="convert-2646"><a href="#convert-2646"><span class="linenos">2646</span></a>                    <span class="k">if</span> <span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">dest_syllable_sep</span><span class="p">,</span><span class="n">toAdd</span><span class="p">))</span> <span class="c1"># (TODO: this assumes stress marks are at end of syllable rather than immediately after vowel; correct for Festival; check others; probably a harmless assumption though; mac-uk is better with syllable separators although espeak basically ignores them)</span>
</span><span id="convert-2647"><a href="#convert-2647"><span class="linenos">2647</span></a>                    <span class="n">toAdd</span> <span class="o">=</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span>
</span><span id="convert-2648"><a href="#convert-2648"><span class="linenos">2648</span></a>                <span class="c1"># attempt to sort out the festival dictionary&#39;s (and other&#39;s) implicit_vowel_before_NL</span>
</span><span id="convert-2649"><a href="#convert-2649"><span class="linenos">2649</span></a>                <span class="k">elif</span> <span class="n">implicit_vowel_before_NL</span> <span class="ow">and</span> <span class="n">ret</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="p">[</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)]</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">implicit_vowel_before_NL</span><span class="p">,</span><span class="n">toAdd</span><span class="p">)</span><span class="o">+</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">toAdd</span><span class="p">))</span>
</span><span id="convert-2650"><a href="#convert-2650"><span class="linenos">2650</span></a>                <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]))</span> <span class="ow">and</span> <span class="n">toAdd</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAdd</span> <span class="ow">in</span> <span class="n">dest_consonants</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAdd</span><span class="o">==</span><span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="k">del</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="convert-2651"><a href="#convert-2651"><span class="linenos">2651</span></a>                <span class="k">if</span> <span class="n">toAdd</span><span class="p">:</span>
</span><span id="convert-2652"><a href="#convert-2652"><span class="linenos">2652</span></a>                    <span class="c1"># Add it, but if toAdd is multiple phonemes, try to put toAddAfter after the FIRST phoneme</span>
</span><span id="convert-2653"><a href="#convert-2653"><span class="linenos">2653</span></a>                    <span class="k">if</span> <span class="n">separator</span><span class="p">:</span> <span class="n">toAddList</span><span class="o">=</span><span class="n">toAdd</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">separator</span><span class="p">)</span>
</span><span id="convert-2654"><a href="#convert-2654"><span class="linenos">2654</span></a>                    <span class="k">else</span><span class="p">:</span> <span class="n">toAddList</span> <span class="o">=</span> <span class="p">[</span><span class="n">toAdd</span><span class="p">]</span> <span class="c1"># TODO: won&#39;t work for formats that don&#39;t have a phoneme separator (doesn&#39;t really matter for eSpeak though)</span>
</span><span id="convert-2655"><a href="#convert-2655"><span class="linenos">2655</span></a>                    <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddList</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="convert-2656"><a href="#convert-2656"><span class="linenos">2656</span></a>                    <span class="k">if</span> <span class="n">toAddAfter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">toAddList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">dest_consonants</span><span class="p">:</span>
</span><span id="convert-2657"><a href="#convert-2657"><span class="linenos">2657</span></a>                        <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddAfter</span><span class="p">)</span>
</span><span id="convert-2658"><a href="#convert-2658"><span class="linenos">2658</span></a>                        <span class="n">toAddAfter</span><span class="o">=</span><span class="kc">None</span>
</span><span id="convert-2659"><a href="#convert-2659"><span class="linenos">2659</span></a>                    <span class="n">ret</span> <span class="o">+=</span> <span class="n">toAddList</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="convert-2660"><a href="#convert-2660"><span class="linenos">2660</span></a>                <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="n">lettersToTry</span><span class="p">:]</span>
</span><span id="convert-2661"><a href="#convert-2661"><span class="linenos">2661</span></a>                <span class="k">break</span>
</span><span id="convert-2662"><a href="#convert-2662"><span class="linenos">2662</span></a>    <span class="k">if</span> <span class="n">toAddAfter</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">toAddAfter</span><span class="p">)</span>
</span><span id="convert-2663"><a href="#convert-2663"><span class="linenos">2663</span></a>    <span class="k">if</span> <span class="n">ret</span> <span class="ow">and</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">dest_syllable_sep</span><span class="p">:</span> <span class="k">del</span> <span class="n">ret</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># spurious syllable separator at end</span>
</span><span id="convert-2664"><a href="#convert-2664"><span class="linenos">2664</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">ret</span><span class="p">:</span> <span class="n">ret</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="convert-2665"><a href="#convert-2665"><span class="linenos">2665</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">ret</span><span class="o">=</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">separator</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;*added&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="n">ret</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
</span><span id="convert-2666"><a href="#convert-2666"><span class="linenos">2666</span></a>    <span class="k">for</span> <span class="n">s</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;cleanup_regexps&#39;</span><span class="p">):</span>
</span><span id="convert-2667"><a href="#convert-2667"><span class="linenos">2667</span></a>      <span class="n">ret</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">ret</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">ret</span><span class="p">),</span><span class="n">ret</span><span class="p">)</span>
</span><span id="convert-2668"><a href="#convert-2668"><span class="linenos">2668</span></a>    <span class="n">func</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">dest</span><span class="p">,</span><span class="s1">&#39;cleanup_func&#39;</span><span class="p">)</span>
</span><span id="convert-2669"><a href="#convert-2669"><span class="linenos">2669</span></a>    <span class="k">if</span> <span class="n">func</span><span class="p">:</span> <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span>
</span><span id="convert-2670"><a href="#convert-2670"><span class="linenos">2670</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">ret</span>
</span></pre></div>


            <div class="docstring"><p>Convert pronunc from source to dest.  pronunc can be a string or a list; if a list then we'll recurse on each of the list elements and return a new list (this is meant for batch-converting clauses etc)</p>
</div>


                </section>
                <section id="unicode_preprocess">
                            <input id="unicode_preprocess-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unicode_preprocess</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="unicode_preprocess-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#unicode_preprocess"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="unicode_preprocess-2672"><a href="#unicode_preprocess-2672"><span class="linenos">2672</span></a><span class="k">def</span> <span class="nf">unicode_preprocess</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="unicode_preprocess-2673"><a href="#unicode_preprocess-2673"><span class="linenos">2673</span></a>   <span class="s2">&quot;Special-case cvtOut_func for unicode-ipa: tries to catch </span><span class="se">\\</span><span class="s2">uNNNN etc&quot;</span>
</span><span id="unicode_preprocess-2674"><a href="#unicode_preprocess-2674"><span class="linenos">2674</span></a>   <span class="k">if</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">u&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pronunc</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">maybe_bytes</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">)</span> <span class="ow">in</span> <span class="n">pronunc</span><span class="p">:</span> <span class="c1"># maybe \uNNNN copied from Gecko on X11, can just evaluate it to get the unicode</span>
</span><span id="unicode_preprocess-2675"><a href="#unicode_preprocess-2675"><span class="linenos">2675</span></a>      <span class="c1"># (NB make sure to quote the \&#39;s if pasing in on the command line)</span>
</span><span id="unicode_preprocess-2676"><a href="#unicode_preprocess-2676"><span class="linenos">2676</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">pronunc</span><span class="o">=</span><span class="nb">eval</span><span class="p">(</span><span class="s1">&#39;u&quot;&#39;</span><span class="o">+</span><span class="n">pronunc</span><span class="o">+</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="unicode_preprocess-2677"><a href="#unicode_preprocess-2677"><span class="linenos">2677</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="unicode_preprocess-2678"><a href="#unicode_preprocess-2678"><span class="linenos">2678</span></a>   <span class="k">else</span><span class="p">:</span> <span class="c1"># see if it makes sense as utf-8</span>
</span><span id="unicode_preprocess-2679"><a href="#unicode_preprocess-2679"><span class="linenos">2679</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">pronunc</span> <span class="o">=</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="unicode_preprocess-2680"><a href="#unicode_preprocess-2680"><span class="linenos">2680</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="unicode_preprocess-2681"><a href="#unicode_preprocess-2681"><span class="linenos">2681</span></a>   <span class="k">return</span> <span class="n">pronunc</span>
</span></pre></div>


            <div class="docstring"><p>Special-case cvtOut_func for unicode-ipa: tries to catch \uNNNN etc</p>
</div>


                </section>
                <section id="ascii_braille_to_unicode">
                            <input id="ascii_braille_to_unicode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ascii_braille_to_unicode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">a</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="ascii_braille_to_unicode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#ascii_braille_to_unicode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="ascii_braille_to_unicode-2683"><a href="#ascii_braille_to_unicode-2683"><span class="linenos">2683</span></a><span class="k">def</span> <span class="nf">ascii_braille_to_unicode</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
</span><span id="ascii_braille_to_unicode-2684"><a href="#ascii_braille_to_unicode-2684"><span class="linenos">2684</span></a>  <span class="s2">&quot;Special-case cleanup_func for braille-ipa (set by braille-ipa if BRAILLE_UNICODE is set).  Converts Braille ASCII to Unicode dot patterns.&quot;</span>
</span><span id="ascii_braille_to_unicode-2685"><a href="#ascii_braille_to_unicode-2685"><span class="linenos">2685</span></a>  <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot; A1B&#39;K2L@CIF/MSP</span><span class="se">\&quot;</span><span class="s2">E3H9O6R^DJG&gt;NTQ,*5&lt;-U8V.%[$+X!&amp;;:4</span><span class="se">\\</span><span class="s2">0Z7(_?W]#Y)=&quot;</span><span class="p">),[</span><span class="n">unichr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x2800</span><span class="p">,</span><span class="mh">0x2840</span><span class="p">)]))</span>
</span><span id="ascii_braille_to_unicode-2686"><a href="#ascii_braille_to_unicode-2686"><span class="linenos">2686</span></a>  <span class="k">return</span> <span class="sa">u</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Special-case cleanup_func for braille-ipa (set by braille-ipa if BRAILLE_UNICODE is set).  Converts Braille ASCII to Unicode dot patterns.</p>
</div>


                </section>
                <section id="unicode_to_ascii_braille">
                            <input id="unicode_to_ascii_braille-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">unicode_to_ascii_braille</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">u</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="unicode_to_ascii_braille-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#unicode_to_ascii_braille"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="unicode_to_ascii_braille-2687"><a href="#unicode_to_ascii_braille-2687"><span class="linenos">2687</span></a><span class="k">def</span> <span class="nf">unicode_to_ascii_braille</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
</span><span id="unicode_to_ascii_braille-2688"><a href="#unicode_to_ascii_braille-2688"><span class="linenos">2688</span></a>  <span class="n">d</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="n">unichr</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mh">0x2800</span><span class="p">,</span><span class="mh">0x2840</span><span class="p">)],</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot; A1B&#39;K2L@CIF/MSP</span><span class="se">\&quot;</span><span class="s2">E3H9O6R^DJG&gt;NTQ,*5&lt;-U8V.%[$+X!&amp;;:4</span><span class="se">\\</span><span class="s2">0Z7(_?W]#Y)=&quot;</span><span class="p">)))</span>
</span><span id="unicode_to_ascii_braille-2689"><a href="#unicode_to_ascii_braille-2689"><span class="linenos">2689</span></a>  <span class="n">r</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">c</span><span class="p">,</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">as_unicode</span><span class="p">(</span><span class="n">u</span><span class="p">)))</span>
</span><span id="unicode_to_ascii_braille-2690"><a href="#unicode_to_ascii_braille-2690"><span class="linenos">2690</span></a>  <span class="k">if</span> <span class="n">r</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;,7&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">r</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;7&#39;&quot;</span><span class="p">):</span> <span class="n">r</span><span class="o">=</span><span class="n">r</span><span class="p">[</span><span class="mi">2</span><span class="p">:</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
</span><span id="unicode_to_ascii_braille-2691"><a href="#unicode_to_ascii_braille-2691"><span class="linenos">2691</span></a>  <span class="k">return</span> <span class="n">r</span>
</span></pre></div>


    

                </section>
                <section id="hiragana_to_katakana">
                            <input id="hiragana_to_katakana-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hiragana_to_katakana</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">u</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="hiragana_to_katakana-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#hiragana_to_katakana"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="hiragana_to_katakana-2693"><a href="#hiragana_to_katakana-2693"><span class="linenos">2693</span></a><span class="k">def</span> <span class="nf">hiragana_to_katakana</span><span class="p">(</span><span class="n">u</span><span class="p">):</span>
</span><span id="hiragana_to_katakana-2694"><a href="#hiragana_to_katakana-2694"><span class="linenos">2694</span></a>   <span class="s2">&quot;Special-case cleanup_func for kana-approx; converts all hiragana characters in unicode string &#39;u&#39; into katakana if KANA_TYPE is set to anything beginning with a &#39;k&#39;&quot;</span>
</span><span id="hiragana_to_katakana-2695"><a href="#hiragana_to_katakana-2695"><span class="linenos">2695</span></a>   <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">u</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span>
</span><span id="hiragana_to_katakana-2696"><a href="#hiragana_to_katakana-2696"><span class="linenos">2696</span></a>   <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;KANA_TYPE&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;k&quot;</span><span class="p">):</span> <span class="k">return</span> <span class="n">u</span>
</span><span id="hiragana_to_katakana-2697"><a href="#hiragana_to_katakana-2697"><span class="linenos">2697</span></a>   <span class="n">u</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span><span id="hiragana_to_katakana-2698"><a href="#hiragana_to_katakana-2698"><span class="linenos">2698</span></a>   <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">u</span><span class="p">)):</span>
</span><span id="hiragana_to_katakana-2699"><a href="#hiragana_to_katakana-2699"><span class="linenos">2699</span></a>      <span class="k">if</span> <span class="mh">0x3041</span> <span class="o">&lt;=</span> <span class="nb">ord</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mh">0x3096</span><span class="p">:</span>
</span><span id="hiragana_to_katakana-2700"><a href="#hiragana_to_katakana-2700"><span class="linenos">2700</span></a>         <span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">unichr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">u</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="mh">0x60</span><span class="p">)</span>
</span><span id="hiragana_to_katakana-2701"><a href="#hiragana_to_katakana-2701"><span class="linenos">2701</span></a>   <span class="k">return</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Special-case cleanup_func for kana-approx; converts all hiragana characters in unicode string 'u' into katakana if KANA_TYPE is set to anything beginning with a 'k'</p>
</div>


                </section>
                <section id="espeak_probably_right_already">
                            <input id="espeak_probably_right_already-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">espeak_probably_right_already</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">existing_pronunc</span>, </span><span class="param"><span class="n">new_pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="espeak_probably_right_already-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#espeak_probably_right_already"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="espeak_probably_right_already-2703"><a href="#espeak_probably_right_already-2703"><span class="linenos">2703</span></a><span class="k">def</span> <span class="nf">espeak_probably_right_already</span><span class="p">(</span><span class="n">existing_pronunc</span><span class="p">,</span><span class="n">new_pronunc</span><span class="p">):</span>
</span><span id="espeak_probably_right_already-2704"><a href="#espeak_probably_right_already-2704"><span class="linenos">2704</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Used by convert_system_festival_dictionary_to_espeak to compare a &quot;new&quot; pronunciation with eSpeak&#39;s existing pronunciation.  As the transcription from OALD to eSpeak is only approximate, it could be that our new pronunciation is not identical to the existing one but the existing one is actually correct; try to detect when this happens by checking if the pronunciations are the same after some simplifications.&quot;&quot;&quot;</span>
</span><span id="espeak_probably_right_already-2705"><a href="#espeak_probably_right_already-2705"><span class="linenos">2705</span></a>    <span class="k">if</span> <span class="n">existing_pronunc</span><span class="o">==</span><span class="n">new_pronunc</span><span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
</span><span id="espeak_probably_right_already-2706"><a href="#espeak_probably_right_already-2706"><span class="linenos">2706</span></a>    <span class="k">def</span> <span class="nf">simplify</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span> <span class="k">return</span> \
</span><span id="espeak_probably_right_already-2707"><a href="#espeak_probably_right_already-2707"><span class="linenos">2707</span></a>        <span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;%&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2708"><a href="#espeak_probably_right_already-2708"><span class="linenos">2708</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;a2&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2709"><a href="#espeak_probably_right_already-2709"><span class="linenos">2709</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;3&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2710"><a href="#espeak_probably_right_already-2710"><span class="linenos">2710</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;L&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;l&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2711"><a href="#espeak_probably_right_already-2711"><span class="linenos">2711</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;I2&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2712"><a href="#espeak_probably_right_already-2712"><span class="linenos">2712</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;I&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;i:@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2713"><a href="#espeak_probably_right_already-2713"><span class="linenos">2713</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2714"><a href="#espeak_probably_right_already-2714"><span class="linenos">2714</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;z&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2715"><a href="#espeak_probably_right_already-2715"><span class="linenos">2715</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;aa&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2716"><a href="#espeak_probably_right_already-2716"><span class="linenos">2716</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;A:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2717"><a href="#espeak_probably_right_already-2717"><span class="linenos">2717</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2718"><a href="#espeak_probably_right_already-2718"><span class="linenos">2718</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;o@&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;O:&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span> \
</span><span id="espeak_probably_right_already-2719"><a href="#espeak_probably_right_already-2719"><span class="linenos">2719</span></a>        <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;r-&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">),</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="s2">&quot;r&quot;</span><span class="p">,</span><span class="n">pronunc</span><span class="p">))</span>
</span><span id="espeak_probably_right_already-2720"><a href="#espeak_probably_right_already-2720"><span class="linenos">2720</span></a>    <span class="c1"># TODO: rewrite @ to 3 whenever not followed by a vowel?</span>
</span><span id="espeak_probably_right_already-2721"><a href="#espeak_probably_right_already-2721"><span class="linenos">2721</span></a>    <span class="k">if</span> <span class="n">as_printable</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">existing_pronunc</span><span class="p">))</span><span class="o">==</span><span class="n">as_printable</span><span class="p">(</span><span class="n">simplify</span><span class="p">(</span><span class="n">new_pronunc</span><span class="p">)):</span> <span class="k">return</span> <span class="kc">True</span> <span class="c1"># almost the same, and festival @/a2 etc seems to be a bit ambiguous so leave it alone</span>
</span></pre></div>


            <div class="docstring"><p>Used by convert_system_festival_dictionary_to_espeak to compare a "new" pronunciation with eSpeak's existing pronunciation.  As the transcription from OALD to eSpeak is only approximate, it could be that our new pronunciation is not identical to the existing one but the existing one is actually correct; try to detect when this happens by checking if the pronunciations are the same after some simplifications.</p>
</div>


                </section>
                <section id="parse_festival_dict">
                            <input id="parse_festival_dict-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">parse_festival_dict</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">festival_location</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="parse_festival_dict-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#parse_festival_dict"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="parse_festival_dict-2723"><a href="#parse_festival_dict-2723"><span class="linenos">2723</span></a><span class="k">def</span> <span class="nf">parse_festival_dict</span><span class="p">(</span><span class="n">festival_location</span><span class="p">):</span>
</span><span id="parse_festival_dict-2724"><a href="#parse_festival_dict-2724"><span class="linenos">2724</span></a>    <span class="s2">&quot;For OALD; yields word,part-of-speech,pronunciation&quot;</span>
</span><span id="parse_festival_dict-2725"><a href="#parse_festival_dict-2725"><span class="linenos">2725</span></a>    <span class="n">ret</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="parse_festival_dict-2726"><a href="#parse_festival_dict-2726"><span class="linenos">2726</span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">open</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">):</span>
</span><span id="parse_festival_dict-2727"><a href="#parse_festival_dict-2727"><span class="linenos">2727</span></a>        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span><span id="parse_festival_dict-2728"><a href="#parse_festival_dict-2728"><span class="linenos">2728</span></a>        <span class="k">if</span> <span class="s2">&quot;((pos&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;((pos&quot;</span><span class="p">)]</span>
</span><span id="parse_festival_dict-2729"><a href="#parse_festival_dict-2729"><span class="linenos">2729</span></a>        <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;( &quot;&#39;</span><span class="p">):</span> <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
</span><span id="parse_festival_dict-2730"><a href="#parse_festival_dict-2730"><span class="linenos">2730</span></a>        <span class="n">line</span><span class="o">=</span><span class="n">line</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;(&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;)&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="parse_festival_dict-2731"><a href="#parse_festival_dict-2731"><span class="linenos">2731</span></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="parse_festival_dict-2732"><a href="#parse_festival_dict-2732"><span class="linenos">2732</span></a>            <span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pronunc</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</span><span id="parse_festival_dict-2733"><a href="#parse_festival_dict-2733"><span class="linenos">2733</span></a>        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># malformed line</span>
</span><span id="parse_festival_dict-2734"><a href="#parse_festival_dict-2734"><span class="linenos">2734</span></a>        <span class="k">if</span> <span class="n">pos</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span><span class="s1">&#39;v&#39;</span><span class="p">,</span><span class="s1">&#39;a&#39;</span><span class="p">,</span><span class="s1">&#39;cc&#39;</span><span class="p">,</span><span class="s1">&#39;dt&#39;</span><span class="p">,</span><span class="s1">&#39;in&#39;</span><span class="p">,</span><span class="s1">&#39;j&#39;</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="s1">&#39;nil&#39;</span><span class="p">,</span><span class="s1">&#39;prp&#39;</span><span class="p">,</span><span class="s1">&#39;uh&#39;</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># two or more words</span>
</span><span id="parse_festival_dict-2735"><a href="#parse_festival_dict-2735"><span class="linenos">2735</span></a>        <span class="k">yield</span> <span class="p">(</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">pos</span><span class="p">,</span> <span class="n">pronunc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>For OALD; yields word,part-of-speech,pronunciation</p>
</div>


                </section>
                <section id="Message">
                            <input id="Message-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Message</span><wbr>(<span class="base">builtins.Exception</span>):

                <label class="view-source-button" for="Message-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Message"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Message-2737"><a href="#Message-2737"><span class="linenos">2737</span></a><span class="k">class</span> <span class="nc">Message</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span> <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>Common base class for all non-exit exceptions.</p>
</div>


                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt>builtins.Exception</dt>
                                <dd id="Message.__init__" class="function">Exception</dd>

            </div>
            <div><dt>builtins.BaseException</dt>
                                <dd id="Message.with_traceback" class="function">with_traceback</dd>
                <dd id="Message.args" class="variable">args</dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="convert_system_festival_dictionary_to_espeak">
                            <input id="convert_system_festival_dictionary_to_espeak-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_system_festival_dictionary_to_espeak</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">festival_location</span>,</span><span class="param">	<span class="n">check_existing_pronunciation</span>,</span><span class="param">	<span class="n">add_user_dictionary_also</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="convert_system_festival_dictionary_to_espeak-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert_system_festival_dictionary_to_espeak"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert_system_festival_dictionary_to_espeak-2738"><a href="#convert_system_festival_dictionary_to_espeak-2738"><span class="linenos">2738</span></a><span class="k">def</span> <span class="nf">convert_system_festival_dictionary_to_espeak</span><span class="p">(</span><span class="n">festival_location</span><span class="p">,</span><span class="n">check_existing_pronunciation</span><span class="p">,</span><span class="n">add_user_dictionary_also</span><span class="p">):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2739"><a href="#convert_system_festival_dictionary_to_espeak-2739"><span class="linenos">2739</span></a>    <span class="s2">&quot;See mainopt_festival_dictionary_to_espeak&quot;</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2740"><a href="#convert_system_festival_dictionary_to_espeak-2740"><span class="linenos">2740</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;mv en_extra en_extra~&quot;</span><span class="p">)</span> <span class="c1"># start with blank &#39;extra&#39; dictionary</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2741"><a href="#convert_system_festival_dictionary_to_espeak-2741"><span class="linenos">2741</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span> <span class="c1"># so that the pronunciation we&#39;re checking against is not influenced by a previous version of en_extra</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2742"><a href="#convert_system_festival_dictionary_to_espeak-2742"><span class="linenos">2742</span></a>    <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2743"><a href="#convert_system_festival_dictionary_to_espeak-2743"><span class="linenos">2743</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Reading dictionary lists&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2744"><a href="#convert_system_festival_dictionary_to_espeak-2744"><span class="linenos">2744</span></a>    <span class="n">wordDic</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">ambiguous</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2745"><a href="#convert_system_festival_dictionary_to_espeak-2745"><span class="linenos">2745</span></a>    <span class="n">el</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_list&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2746"><a href="#convert_system_festival_dictionary_to_espeak-2746"><span class="linenos">2746</span></a>    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">maybe_bytes</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^[a-z]* *\$&#39;</span><span class="p">,</span><span class="n">x</span><span class="p">),</span><span class="n">x</span><span class="p">),</span><span class="n">getBuf</span><span class="p">(</span><span class="n">el</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">))):</span> <span class="n">ambiguous</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]]</span><span class="o">=</span><span class="n">ambiguous</span><span class="p">[</span><span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;s&#39;</span><span class="p">)]</span><span class="o">=</span><span class="kc">True</span> <span class="c1"># this stops the code below from overriding anything already in espeak&#39;s en_list.  If taking out then you need to think carefully about words like &quot;a&quot;, &quot;the&quot; etc.</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2747"><a href="#convert_system_festival_dictionary_to_espeak-2747"><span class="linenos">2747</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">pronunc</span> <span class="ow">in</span> <span class="n">parse_festival_dict</span><span class="p">(</span><span class="n">festival_location</span><span class="p">):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2748"><a href="#convert_system_festival_dictionary_to_espeak-2748"><span class="linenos">2748</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;i@ 0 @ 0&quot;</span><span class="p">,</span><span class="s2">&quot;ii ou 2 &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;i@ 0 u 0&quot;</span><span class="p">,</span><span class="s2">&quot;ii ou &quot;</span><span class="p">)</span> <span class="c1"># (hack for OALD&#39;s &quot;radio&quot;/&quot;video&quot;/&quot;stereo&quot;/&quot;embryo&quot; etc)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2749"><a href="#convert_system_festival_dictionary_to_espeak-2749"><span class="linenos">2749</span></a>        <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;0&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># 0&#39;s not necessary, and OALD sometimes puts them in wrong places, confusing the converter</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2750"><a href="#convert_system_festival_dictionary_to_espeak-2750"><span class="linenos">2750</span></a>        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;mosquitoes&#39;</span><span class="p">]:</span> <span class="k">continue</span> <span class="c1"># OALD bug (TODO: any others?)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2751"><a href="#convert_system_festival_dictionary_to_espeak-2751"><span class="linenos">2751</span></a>        <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">wordDic</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">==</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2752"><a href="#convert_system_festival_dictionary_to_espeak-2752"><span class="linenos">2752</span></a>            <span class="n">ambiguous</span><span class="p">[</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)]</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2753"><a href="#convert_system_festival_dictionary_to_espeak-2753"><span class="linenos">2753</span></a>            <span class="k">del</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="c1"># better not go there</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2754"><a href="#convert_system_festival_dictionary_to_espeak-2754"><span class="linenos">2754</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ambiguous</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2755"><a href="#convert_system_festival_dictionary_to_espeak-2755"><span class="linenos">2755</span></a>            <span class="n">wordDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">pronunc</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2756"><a href="#convert_system_festival_dictionary_to_espeak-2756"><span class="linenos">2756</span></a>    <span class="n">toDel</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2757"><a href="#convert_system_festival_dictionary_to_espeak-2757"><span class="linenos">2757</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2758"><a href="#convert_system_festival_dictionary_to_espeak-2758"><span class="linenos">2758</span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Checking existing pronunciation&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2759"><a href="#convert_system_festival_dictionary_to_espeak-2759"><span class="linenos">2759</span></a>        <span class="n">proc</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -q -x -v en-rp &gt; /tmp/.pronunc 2&gt;&amp;1&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2760"><a href="#convert_system_festival_dictionary_to_espeak-2760"><span class="linenos">2760</span></a>        <span class="n">wList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2761"><a href="#convert_system_festival_dictionary_to_espeak-2761"><span class="linenos">2761</span></a>    <span class="n">progressCount</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">oldPercent</span><span class="o">=-</span><span class="mi">1</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2762"><a href="#convert_system_festival_dictionary_to_espeak-2762"><span class="linenos">2762</span></a>    <span class="n">itemList</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wordDic</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2763"><a href="#convert_system_festival_dictionary_to_espeak-2763"><span class="linenos">2763</span></a>    <span class="c1"># Make sure it&#39;s NOT sorted, to ensure eSpeak doesn&#39;t</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2764"><a href="#convert_system_festival_dictionary_to_espeak-2764"><span class="linenos">2764</span></a>    <span class="c1"># cache pronunciation of previous word when add suffix</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2765"><a href="#convert_system_festival_dictionary_to_espeak-2765"><span class="linenos">2765</span></a>    <span class="c1"># (which can subtly change eSpeak&#39;s pronunciation in</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2766"><a href="#convert_system_festival_dictionary_to_espeak-2766"><span class="linenos">2766</span></a>    <span class="c1"># some versions of eSpeak, leading to</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2767"><a href="#convert_system_festival_dictionary_to_espeak-2767"><span class="linenos">2767</span></a>    <span class="c1"># Python 2/3 differences as Python 3 sorts by default) :</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2768"><a href="#convert_system_festival_dictionary_to_espeak-2768"><span class="linenos">2768</span></a>    <span class="n">itemList</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2769"><a href="#convert_system_festival_dictionary_to_espeak-2769"><span class="linenos">2769</span></a>    <span class="n">i0</span><span class="p">,</span><span class="n">i1</span> <span class="o">=</span> <span class="n">itemList</span><span class="p">[:</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)],</span><span class="n">itemList</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">itemList</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">):]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2770"><a href="#convert_system_festival_dictionary_to_espeak-2770"><span class="linenos">2770</span></a>    <span class="n">itemList</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2771"><a href="#convert_system_festival_dictionary_to_espeak-2771"><span class="linenos">2771</span></a>    <span class="k">while</span> <span class="n">i0</span> <span class="ow">or</span> <span class="n">i1</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2772"><a href="#convert_system_festival_dictionary_to_espeak-2772"><span class="linenos">2772</span></a>       <span class="k">if</span> <span class="n">i0</span><span class="p">:</span> <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i0</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2773"><a href="#convert_system_festival_dictionary_to_espeak-2773"><span class="linenos">2773</span></a>       <span class="k">if</span> <span class="n">i1</span><span class="p">:</span> <span class="n">itemList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i1</span><span class="o">.</span><span class="n">pop</span><span class="p">())</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2774"><a href="#convert_system_festival_dictionary_to_espeak-2774"><span class="linenos">2774</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">itemList</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2775"><a href="#convert_system_festival_dictionary_to_espeak-2775"><span class="linenos">2775</span></a>        <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2776"><a href="#convert_system_festival_dictionary_to_espeak-2776"><span class="linenos">2776</span></a>            <span class="n">percent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">progressCount</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">wordDic</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2777"><a href="#convert_system_festival_dictionary_to_espeak-2777"><span class="linenos">2777</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">percent</span><span class="o">==</span><span class="n">oldPercent</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;%</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2778"><a href="#convert_system_festival_dictionary_to_espeak-2778"><span class="linenos">2778</span></a>            <span class="n">oldPercent</span><span class="o">=</span><span class="n">percent</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2779"><a href="#convert_system_festival_dictionary_to_espeak-2779"><span class="linenos">2779</span></a>            <span class="n">progressCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2780"><a href="#convert_system_festival_dictionary_to_espeak-2780"><span class="linenos">2780</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[A-Za-z]*$&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">):</span> <span class="c1"># (some versions of eSpeak also OK with &quot;-&quot;, but not all)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2781"><a href="#convert_system_festival_dictionary_to_espeak-2781"><span class="linenos">2781</span></a>            <span class="c1"># contains special characters - better not go there</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2782"><a href="#convert_system_festival_dictionary_to_espeak-2782"><span class="linenos">2782</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2783"><a href="#convert_system_festival_dictionary_to_espeak-2783"><span class="linenos">2783</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;plaque&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">word</span> <span class="ow">in</span> <span class="s2">&quot;friday saturday sunday tuesday thursday yesterday&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">():</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2784"><a href="#convert_system_festival_dictionary_to_espeak-2784"><span class="linenos">2784</span></a>            <span class="c1"># hack to accept eSpeak&#39;s pl&#39;ak instead of pl&#39;A:k - order was reversed in the March 2009 draft</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2785"><a href="#convert_system_festival_dictionary_to_espeak-2785"><span class="linenos">2785</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2786"><a href="#convert_system_festival_dictionary_to_espeak-2786"><span class="linenos">2786</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;s&quot;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">wordDic</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2787"><a href="#convert_system_festival_dictionary_to_espeak-2787"><span class="linenos">2787</span></a>            <span class="c1"># unnecessary plural (espeak will pick up on them anyway)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2788"><a href="#convert_system_festival_dictionary_to_espeak-2788"><span class="linenos">2788</span></a>            <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2789"><a href="#convert_system_festival_dictionary_to_espeak-2789"><span class="linenos">2789</span></a>        <span class="k">elif</span> <span class="n">word</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">&quot;quarter&quot;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span> <span class="n">toDel</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="c1"># don&#39;t like festival&#39;s pronunciation of those (TODO: also &#39;memorial&#39; why start with [m&#39;I])</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2790"><a href="#convert_system_festival_dictionary_to_espeak-2790"><span class="linenos">2790</span></a>        <span class="k">elif</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2791"><a href="#convert_system_festival_dictionary_to_espeak-2791"><span class="linenos">2791</span></a>            <span class="n">getBuf</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2792"><a href="#convert_system_festival_dictionary_to_espeak-2792"><span class="linenos">2792</span></a>            <span class="n">proc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># so the progress indicator works</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2793"><a href="#convert_system_festival_dictionary_to_espeak-2793"><span class="linenos">2793</span></a>            <span class="n">wList</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2794"><a href="#convert_system_festival_dictionary_to_espeak-2794"><span class="linenos">2794</span></a>    <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2795"><a href="#convert_system_festival_dictionary_to_espeak-2795"><span class="linenos">2795</span></a>        <span class="n">proc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span> <span class="p">;</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2796"><a href="#convert_system_festival_dictionary_to_espeak-2796"><span class="linenos">2796</span></a>        <span class="n">oldPronDic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2797"><a href="#convert_system_festival_dictionary_to_espeak-2797"><span class="linenos">2797</span></a>        <span class="n">tp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/.pronunc&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2798"><a href="#convert_system_festival_dictionary_to_espeak-2798"><span class="linenos">2798</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">wList</span><span class="p">,</span><span class="n">getBuf</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span> <span class="n">oldPronDic</span><span class="p">[</span><span class="n">k</span><span class="p">]</span><span class="o">=</span><span class="n">v</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2799"><a href="#convert_system_festival_dictionary_to_espeak-2799"><span class="linenos">2799</span></a>    <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">toDel</span><span class="p">:</span> <span class="k">del</span> <span class="n">wordDic</span><span class="p">[</span><span class="n">w</span><span class="p">]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2800"><a href="#convert_system_festival_dictionary_to_espeak-2800"><span class="linenos">2800</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Doing the conversion&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2801"><a href="#convert_system_festival_dictionary_to_espeak-2801"><span class="linenos">2801</span></a>    <span class="n">lines_output</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2802"><a href="#convert_system_festival_dictionary_to_espeak-2802"><span class="linenos">2802</span></a>    <span class="n">total_lines</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2803"><a href="#convert_system_festival_dictionary_to_espeak-2803"><span class="linenos">2803</span></a>    <span class="n">not_output_because_ok</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2804"><a href="#convert_system_festival_dictionary_to_espeak-2804"><span class="linenos">2804</span></a>    <span class="n">items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">wordDic</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="p">;</span> <span class="n">items</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># necessary because of the hacks below which check for the presence of truncated versions of the word (want to have decided whether or not to output those truncated versions before reaching the hacks)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2805"><a href="#convert_system_festival_dictionary_to_espeak-2805"><span class="linenos">2805</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">pos</span><span class="p">)</span> <span class="ow">in</span> <span class="n">items</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2806"><a href="#convert_system_festival_dictionary_to_espeak-2806"><span class="linenos">2806</span></a>        <span class="n">total_lines</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2807"><a href="#convert_system_festival_dictionary_to_espeak-2807"><span class="linenos">2807</span></a>        <span class="n">new_e_pronunc</span> <span class="o">=</span> <span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="s2">&quot;festival&quot;</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2808"><a href="#convert_system_festival_dictionary_to_espeak-2808"><span class="linenos">2808</span></a>        <span class="k">if</span> <span class="n">new_e_pronunc</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;-&#39;</span> <span class="ow">in</span> <span class="n">word</span><span class="p">:</span> <span class="n">new_e_pronunc</span><span class="o">=</span><span class="n">new_e_pronunc</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;,&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># if 2 primary accents then make the first one a secondary (except on hyphenated words)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2809"><a href="#convert_system_festival_dictionary_to_espeak-2809"><span class="linenos">2809</span></a>        <span class="c1"># TODO if not en-rp? - if (word.endswith(&quot;y&quot;) or word.endswith(&quot;ie&quot;)) and new_e_pronunc.endswith(&quot;i:&quot;): new_e_pronunc=new_e_pronunc[:-2]+&quot;I&quot;</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2810"><a href="#convert_system_festival_dictionary_to_espeak-2810"><span class="linenos">2810</span></a>        <span class="n">unrelated_word</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2811"><a href="#convert_system_festival_dictionary_to_espeak-2811"><span class="linenos">2811</span></a>        <span class="k">if</span> <span class="n">check_existing_pronunciation</span><span class="p">:</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="n">oldPronDic</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2812"><a href="#convert_system_festival_dictionary_to_espeak-2812"><span class="linenos">2812</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2813"><a href="#convert_system_festival_dictionary_to_espeak-2813"><span class="linenos">2813</span></a>        <span class="k">if</span> <span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;e&#39;</span> <span class="ow">and</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="n">wordDic</span><span class="p">:</span> <span class="n">unrelated_word</span><span class="p">,</span> <span class="n">espeakPronunc</span> <span class="o">=</span> <span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="s2">&quot;&quot;</span> <span class="c1"># hack: if word ends with &#39;e&#39; and dropping the &#39;e&#39; leaves a valid word that&#39;s also in the dictionary, we DON&#39;T want to drop this word on the grounds that espeak already gets it right, because if we do then adding &#39;s&#39; to this word may cause espeak to add &#39;s&#39; to the OTHER word (&#39;-es&#39; rule).</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2814"><a href="#convert_system_festival_dictionary_to_espeak-2814"><span class="linenos">2814</span></a>        <span class="k">if</span> <span class="n">espeak_probably_right_already</span><span class="p">(</span><span class="n">espeakPronunc</span><span class="p">,</span><span class="n">new_e_pronunc</span><span class="p">):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2815"><a href="#convert_system_festival_dictionary_to_espeak-2815"><span class="linenos">2815</span></a>            <span class="n">not_output_because_ok</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2816"><a href="#convert_system_festival_dictionary_to_espeak-2816"><span class="linenos">2816</span></a>            <span class="k">continue</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2817"><a href="#convert_system_festival_dictionary_to_espeak-2817"><span class="linenos">2817</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">unrelated_word</span><span class="p">:</span> <span class="n">lines_output</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2818"><a href="#convert_system_festival_dictionary_to_espeak-2818"><span class="linenos">2818</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">new_e_pronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; // from Festival&#39;s (&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2819"><a href="#convert_system_festival_dictionary_to_espeak-2819"><span class="linenos">2819</span></a>        <span class="k">if</span> <span class="n">espeakPronunc</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;, not [[&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">espeakPronunc</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;]]&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2820"><a href="#convert_system_festival_dictionary_to_espeak-2820"><span class="linenos">2820</span></a>        <span class="k">elif</span> <span class="n">unrelated_word</span><span class="p">:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; (here to stop espeak&#39;s affix rules getting confused by Festival&#39;s </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">unrelated_word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2821"><a href="#convert_system_festival_dictionary_to_espeak-2821"><span class="linenos">2821</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2822"><a href="#convert_system_festival_dictionary_to_espeak-2822"><span class="linenos">2822</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Corrected(?) </span><span class="si">%d</span><span class="s2"> entries out of </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">lines_output</span><span class="p">,</span><span class="n">total_lines</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2823"><a href="#convert_system_festival_dictionary_to_espeak-2823"><span class="linenos">2823</span></a>    <span class="k">if</span> <span class="n">add_user_dictionary_also</span><span class="p">:</span> <span class="n">convert_user_lexicon</span><span class="p">(</span><span class="s2">&quot;festival&quot;</span><span class="p">,</span><span class="s2">&quot;espeak&quot;</span><span class="p">,</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2824"><a href="#convert_system_festival_dictionary_to_espeak-2824"><span class="linenos">2824</span></a>    <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2825"><a href="#convert_system_festival_dictionary_to_espeak-2825"><span class="linenos">2825</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2826"><a href="#convert_system_festival_dictionary_to_espeak-2826"><span class="linenos">2826</span></a>    <span class="k">if</span> <span class="n">not_output_because_ok</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2827"><a href="#convert_system_festival_dictionary_to_espeak-2827"><span class="linenos">2827</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Checking for unwanted side-effects of those corrections&quot;</span><span class="p">)</span> <span class="c1"># e.g. terrible as Terr + ible, inducing as in+Duce+ing</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2828"><a href="#convert_system_festival_dictionary_to_espeak-2828"><span class="linenos">2828</span></a>      <span class="n">proc</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="s2">&quot;espeak -q -x -v en-rp &gt; /tmp/.pronunc 2&gt;&amp;1&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2829"><a href="#convert_system_festival_dictionary_to_espeak-2829"><span class="linenos">2829</span></a>      <span class="n">progressCount</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2830"><a href="#convert_system_festival_dictionary_to_espeak-2830"><span class="linenos">2830</span></a>      <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">not_output_because_ok</span><span class="p">:</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2831"><a href="#convert_system_festival_dictionary_to_espeak-2831"><span class="linenos">2831</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">proc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span> <span class="p">;</span> <span class="n">proc</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2832"><a href="#convert_system_festival_dictionary_to_espeak-2832"><span class="linenos">2832</span></a>          <span class="n">percent</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">progressCount</span><span class="o">*</span><span class="mi">100</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">not_output_because_ok</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2833"><a href="#convert_system_festival_dictionary_to_espeak-2833"><span class="linenos">2833</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">percent</span><span class="o">==</span><span class="n">oldPercent</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">percent</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;%</span><span class="se">\r</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2834"><a href="#convert_system_festival_dictionary_to_espeak-2834"><span class="linenos">2834</span></a>          <span class="n">oldPercent</span> <span class="o">=</span> <span class="n">percent</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2835"><a href="#convert_system_festival_dictionary_to_espeak-2835"><span class="linenos">2835</span></a>          <span class="n">progressCount</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2836"><a href="#convert_system_festival_dictionary_to_espeak-2836"><span class="linenos">2836</span></a>      <span class="n">proc</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2837"><a href="#convert_system_festival_dictionary_to_espeak-2837"><span class="linenos">2837</span></a>      <span class="n">outFile</span><span class="o">=</span><span class="nb">open</span><span class="p">(</span><span class="s2">&quot;en_extra&quot;</span><span class="p">,</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># append to it</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2838"><a href="#convert_system_festival_dictionary_to_espeak-2838"><span class="linenos">2838</span></a>      <span class="n">tp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;/tmp/.pronunc&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2839"><a href="#convert_system_festival_dictionary_to_espeak-2839"><span class="linenos">2839</span></a>      <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pronunc</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">not_output_because_ok</span><span class="p">,</span><span class="n">getBuf</span><span class="p">(</span><span class="n">tp</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2840"><a href="#convert_system_festival_dictionary_to_espeak-2840"><span class="linenos">2840</span></a>        <span class="n">pronunc</span> <span class="o">=</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2841"><a href="#convert_system_festival_dictionary_to_espeak-2841"><span class="linenos">2841</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">pronunc</span><span class="o">==</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">espeak_probably_right_already</span><span class="p">(</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">],</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2842"><a href="#convert_system_festival_dictionary_to_espeak-2842"><span class="linenos">2842</span></a>          <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">+</span><span class="n">oldPronDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; // (undo affix-side-effect from previous words that gave </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">+</span><span class="n">pronunc</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">))</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2843"><a href="#convert_system_festival_dictionary_to_espeak-2843"><span class="linenos">2843</span></a>      <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2844"><a href="#convert_system_festival_dictionary_to_espeak-2844"><span class="linenos">2844</span></a>      <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;espeak --compile=en&quot;</span><span class="p">)</span>
</span><span id="convert_system_festival_dictionary_to_espeak-2845"><a href="#convert_system_festival_dictionary_to_espeak-2845"><span class="linenos">2845</span></a>    <span class="k">return</span> <span class="n">not_output_because_ok</span>
</span></pre></div>


            <div class="docstring"><p>See mainopt_festival_dictionary_to_espeak</p>
</div>


                </section>
                <section id="read_user_lexicon">
                            <input id="read_user_lexicon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">read_user_lexicon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fromFormat</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="read_user_lexicon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#read_user_lexicon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="read_user_lexicon-2847"><a href="#read_user_lexicon-2847"><span class="linenos">2847</span></a><span class="k">def</span> <span class="nf">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">):</span>
</span><span id="read_user_lexicon-2848"><a href="#read_user_lexicon-2848"><span class="linenos">2848</span></a>    <span class="s2">&quot;Calls the appropriate lex_read_function, opening lex_filename first if supplied&quot;</span>
</span><span id="read_user_lexicon-2849"><a href="#read_user_lexicon-2849"><span class="linenos">2849</span></a>    <span class="n">readFunction</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;lex_read_function&quot;</span><span class="p">)</span>
</span><span id="read_user_lexicon-2850"><a href="#read_user_lexicon-2850"><span class="linenos">2850</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">readFunction</span><span class="p">:</span> <span class="k">raise</span> <span class="n">Message</span><span class="p">(</span><span class="s2">&quot;Reading from &#39;</span><span class="si">%s</span><span class="s2">&#39; lexicon file not yet implemented (no lex_read_function); try using --phones or --phones2phones options instead&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fromFormat</span><span class="p">,))</span>
</span><span id="read_user_lexicon-2851"><a href="#read_user_lexicon-2851"><span class="linenos">2851</span></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="read_user_lexicon-2852"><a href="#read_user_lexicon-2852"><span class="linenos">2852</span></a>       <span class="n">lexFilename</span> <span class="o">=</span> <span class="n">getSetting</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span>
</span><span id="read_user_lexicon-2853"><a href="#read_user_lexicon-2853"><span class="linenos">2853</span></a>       <span class="k">if</span> <span class="n">lexFilename</span><span class="o">==</span><span class="kc">None</span><span class="p">:</span> <span class="n">lexfile</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># e.g. the example lexicon</span>
</span><span id="read_user_lexicon-2854"><a href="#read_user_lexicon-2854"><span class="linenos">2854</span></a>       <span class="k">else</span><span class="p">:</span>
</span><span id="read_user_lexicon-2855"><a href="#read_user_lexicon-2855"><span class="linenos">2855</span></a>          <span class="n">lexfile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">lexFilename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="read_user_lexicon-2856"><a href="#read_user_lexicon-2856"><span class="linenos">2856</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;LEXCONVERT_OMIT_READING_FROM&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Reading from &quot;</span><span class="o">+</span><span class="n">lexFilename</span><span class="p">)</span> <span class="c1"># TODO: document LEXCONVERT_OMIT_READING_FROM (might be useful for the --mac-uk option)</span>
</span><span id="read_user_lexicon-2857"><a href="#read_user_lexicon-2857"><span class="linenos">2857</span></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span> <span class="n">lexfile</span> <span class="o">=</span> <span class="kc">None</span> <span class="c1"># lex_read_function without lex_filename is allowed, if the read function can take null param and fetch the lexicon itself</span>
</span><span id="read_user_lexicon-2858"><a href="#read_user_lexicon-2858"><span class="linenos">2858</span></a>    <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span> <span class="k">raise</span> <span class="n">Message</span><span class="p">(</span><span class="n">fromFormat</span><span class="o">+</span><span class="s2">&quot;&#39;s lexicon is expected to be in a file called &quot;</span><span class="o">+</span><span class="n">replHome</span><span class="p">(</span><span class="n">lexFilename</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; which could not be read - please fix and try again&quot;</span><span class="p">)</span>
</span><span id="read_user_lexicon-2859"><a href="#read_user_lexicon-2859"><span class="linenos">2859</span></a>    <span class="k">return</span> <span class="n">readFunction</span><span class="p">(</span><span class="n">lexfile</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Calls the appropriate lex_read_function, opening lex_filename first if supplied</p>
</div>


                </section>
                <section id="replHome">
                            <input id="replHome-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">replHome</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fname</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="replHome-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#replHome"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="replHome-2861"><a href="#replHome-2861"><span class="linenos">2861</span></a><span class="k">def</span> <span class="nf">replHome</span><span class="p">(</span><span class="n">fname</span><span class="p">):</span>
</span><span id="replHome-2862"><a href="#replHome-2862"><span class="linenos">2862</span></a>   <span class="s2">&quot;Format fname for printing, substituting ~ for HOME if appropriate&quot;</span>
</span><span id="replHome-2863"><a href="#replHome-2863"><span class="linenos">2863</span></a>   <span class="n">h</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;HOME&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="replHome-2864"><a href="#replHome-2864"><span class="linenos">2864</span></a>   <span class="k">if</span> <span class="n">h</span> <span class="ow">and</span> <span class="n">fname</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">os</span><span class="o">.</span><span class="n">sep</span><span class="p">):</span>
</span><span id="replHome-2865"><a href="#replHome-2865"><span class="linenos">2865</span></a>      <span class="k">return</span> <span class="s2">&quot;~&quot;</span><span class="o">+</span><span class="n">fname</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">):]</span>
</span><span id="replHome-2866"><a href="#replHome-2866"><span class="linenos">2866</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">fname</span>
</span></pre></div>


            <div class="docstring"><p>Format fname for printing, substituting ~ for HOME if appropriate</p>
</div>


                </section>
                <section id="get_macuk_lexicon">
                            <input id="get_macuk_lexicon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">get_macuk_lexicon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fromFormat</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="get_macuk_lexicon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#get_macuk_lexicon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="get_macuk_lexicon-2868"><a href="#get_macuk_lexicon-2868"><span class="linenos">2868</span></a><span class="k">def</span> <span class="nf">get_macuk_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">):</span>
</span><span id="get_macuk_lexicon-2869"><a href="#get_macuk_lexicon-2869"><span class="linenos">2869</span></a>    <span class="s2">&quot;Converts lexicon from fromFormat and returns a list suitable for MacBritish_System_Lexicon&#39;s readWithLex&quot;</span>
</span><span id="get_macuk_lexicon-2870"><a href="#get_macuk_lexicon-2870"><span class="linenos">2870</span></a>    <span class="k">return</span> <span class="p">[(</span><span class="n">word</span><span class="p">,</span><span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">fromFormat</span><span class="p">,</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="n">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Converts lexicon from fromFormat and returns a list suitable for MacBritish_System_Lexicon's readWithLex</p>
</div>


                </section>
                <section id="as_utf8">
                            <input id="as_utf8-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_utf8</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="as_utf8-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#as_utf8"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="as_utf8-2872"><a href="#as_utf8-2872"><span class="linenos">2872</span></a><span class="k">def</span> <span class="nf">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="as_utf8-2873"><a href="#as_utf8-2873"><span class="linenos">2873</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="as_utf8-2874"><a href="#as_utf8-2874"><span class="linenos">2874</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span></pre></div>


    

                </section>
                <section id="as_unicode">
                            <input id="as_unicode-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_unicode</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="as_unicode-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#as_unicode"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="as_unicode-2875"><a href="#as_unicode-2875"><span class="linenos">2875</span></a><span class="k">def</span> <span class="nf">as_unicode</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="as_unicode-2876"><a href="#as_unicode-2876"><span class="linenos">2876</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="as_unicode-2877"><a href="#as_unicode-2877"><span class="linenos">2877</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="maybe_bytes">
                            <input id="maybe_bytes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">maybe_bytes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span>, </span><span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="maybe_bytes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#maybe_bytes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="maybe_bytes-2878"><a href="#maybe_bytes-2878"><span class="linenos">2878</span></a><span class="k">def</span> <span class="nf">maybe_bytes</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">i</span><span class="p">):</span>
</span><span id="maybe_bytes-2879"><a href="#maybe_bytes-2879"><span class="linenos">2879</span></a>   <span class="s2">&quot;Python 2/3 compatibility: convert s to bytes if i is bytes&quot;</span>
</span><span id="maybe_bytes-2880"><a href="#maybe_bytes-2880"><span class="linenos">2880</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="maybe_bytes-2881"><a href="#maybe_bytes-2881"><span class="linenos">2881</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Python 2/3 compatibility: convert s to bytes if i is bytes</p>
</div>


                </section>
                <section id="as_printable">
                            <input id="as_printable-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">as_printable</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">s</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="as_printable-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#as_printable"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="as_printable-2882"><a href="#as_printable-2882"><span class="linenos">2882</span></a><span class="k">def</span> <span class="nf">as_printable</span><span class="p">(</span><span class="n">s</span><span class="p">):</span>
</span><span id="as_printable-2883"><a href="#as_printable-2883"><span class="linenos">2883</span></a>   <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
</span><span id="as_printable-2884"><a href="#as_printable-2884"><span class="linenos">2884</span></a>   <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span></pre></div>


    

                </section>
                <section id="convert_user_lexicon">
                            <input id="convert_user_lexicon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">convert_user_lexicon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fromFormat</span>, </span><span class="param"><span class="n">toFormat</span>, </span><span class="param"><span class="n">outFile</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="convert_user_lexicon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#convert_user_lexicon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="convert_user_lexicon-2886"><a href="#convert_user_lexicon-2886"><span class="linenos">2886</span></a><span class="k">def</span> <span class="nf">convert_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">,</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="convert_user_lexicon-2887"><a href="#convert_user_lexicon-2887"><span class="linenos">2887</span></a>    <span class="s2">&quot;See mainopt_convert&quot;</span>
</span><span id="convert_user_lexicon-2888"><a href="#convert_user_lexicon-2888"><span class="linenos">2888</span></a>    <span class="n">lex</span> <span class="o">=</span> <span class="n">read_user_lexicon</span><span class="p">(</span><span class="n">fromFormat</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2889"><a href="#convert_user_lexicon-2889"><span class="linenos">2889</span></a>    <span class="n">lex_header</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_header&quot;</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2890"><a href="#convert_user_lexicon-2890"><span class="linenos">2890</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">lex_header</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">lex_header</span><span class="p">))</span>
</span><span id="convert_user_lexicon-2891"><a href="#convert_user_lexicon-2891"><span class="linenos">2891</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">lex_header</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2892"><a href="#convert_user_lexicon-2892"><span class="linenos">2892</span></a>    <span class="n">entryFormat</span><span class="o">=</span><span class="n">getSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2893"><a href="#convert_user_lexicon-2893"><span class="linenos">2893</span></a>    <span class="n">wordCase</span><span class="o">=</span><span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_word_case&quot;</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2894"><a href="#convert_user_lexicon-2894"><span class="linenos">2894</span></a>    <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="n">pronunc</span> <span class="ow">in</span> <span class="n">lex</span><span class="p">:</span>
</span><span id="convert_user_lexicon-2895"><a href="#convert_user_lexicon-2895"><span class="linenos">2895</span></a>        <span class="n">pronunc</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">convert</span><span class="p">(</span><span class="n">pronunc</span><span class="p">,</span><span class="n">fromFormat</span><span class="p">,</span><span class="n">toFormat</span><span class="p">))</span>
</span><span id="convert_user_lexicon-2896"><a href="#convert_user_lexicon-2896"><span class="linenos">2896</span></a>        <span class="k">if</span> <span class="n">wordCase</span><span class="o">==</span><span class="s2">&quot;upper&quot;</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
</span><span id="convert_user_lexicon-2897"><a href="#convert_user_lexicon-2897"><span class="linenos">2897</span></a>        <span class="k">elif</span> <span class="n">wordCase</span><span class="o">==</span><span class="s2">&quot;lower&quot;</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="convert_user_lexicon-2898"><a href="#convert_user_lexicon-2898"><span class="linenos">2898</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">entryFormat</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">word</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)))</span> <span class="c1"># will work in Python 3.6, but not in Python 3.4 (e.g. on jessie) which cannot do % on byte-strings</span>
</span><span id="convert_user_lexicon-2899"><a href="#convert_user_lexicon-2899"><span class="linenos">2899</span></a>    <span class="n">footer</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">toFormat</span><span class="p">,</span><span class="s2">&quot;lex_footer&quot;</span><span class="p">)</span>
</span><span id="convert_user_lexicon-2900"><a href="#convert_user_lexicon-2900"><span class="linenos">2900</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">footer</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">footer</span><span class="p">))</span>
</span><span id="convert_user_lexicon-2901"><a href="#convert_user_lexicon-2901"><span class="linenos">2901</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">footer</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>See mainopt_convert</p>
</div>


                </section>
                <section id="bbcMicro_partPhonemeCount">
                            <input id="bbcMicro_partPhonemeCount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bbcMicro_partPhonemeCount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bbcMicro_partPhonemeCount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bbcMicro_partPhonemeCount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bbcMicro_partPhonemeCount-2903"><a href="#bbcMicro_partPhonemeCount-2903"><span class="linenos">2903</span></a><span class="k">def</span> <span class="nf">bbcMicro_partPhonemeCount</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="bbcMicro_partPhonemeCount-2904"><a href="#bbcMicro_partPhonemeCount-2904"><span class="linenos">2904</span></a><span class="w">   </span><span class="sd">&quot;&quot;&quot;Returns the number of &#39;part phonemes&#39; (at least that&#39;s what I&#39;m calling them) for the BBC Micro phonemes in pronunc.  The *SPEAK command cannot take more than 117 part-phonemes at a time before saying &quot;Line too long&quot;, and in some cases it takes less than that (I&#39;m not sure why); 115 is a safer limit.&quot;&quot;&quot;</span>
</span><span id="bbcMicro_partPhonemeCount-2905"><a href="#bbcMicro_partPhonemeCount-2905"><span class="linenos">2905</span></a>   <span class="n">partCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">pronunc0</span> <span class="o">=</span> <span class="n">pronunc</span>
</span><span id="bbcMicro_partPhonemeCount-2906"><a href="#bbcMicro_partPhonemeCount-2906"><span class="linenos">2906</span></a>   <span class="k">while</span> <span class="n">pronunc</span><span class="p">:</span>
</span><span id="bbcMicro_partPhonemeCount-2907"><a href="#bbcMicro_partPhonemeCount-2907"><span class="linenos">2907</span></a>      <span class="n">found</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="bbcMicro_partPhonemeCount-2908"><a href="#bbcMicro_partPhonemeCount-2908"><span class="linenos">2908</span></a>      <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="s1">&#39; ,AA,AE,AH,AI,AO,AW,AY,B,CH,CT,DH,DUX,D,EE,EH,ER,F,G,/H,IH,IX,IY,J,K,L,M,NX,N,OW,OL,OY,O,P,R,SH,S,TH,T,UH,/UL,/U,UW,UX,V,W,Y,ZH,Z&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;,&#39;</span><span class="p">):</span> <span class="c1"># phonemes and space count, but pitch numbers do not count</span>
</span><span id="bbcMicro_partPhonemeCount-2909"><a href="#bbcMicro_partPhonemeCount-2909"><span class="linenos">2909</span></a>         <span class="k">if</span> <span class="n">pronunc</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">p</span><span class="p">)):</span>
</span><span id="bbcMicro_partPhonemeCount-2910"><a href="#bbcMicro_partPhonemeCount-2910"><span class="linenos">2910</span></a>            <span class="n">partCount</span> <span class="o">+=</span> <span class="p">{</span>
</span><span id="bbcMicro_partPhonemeCount-2911"><a href="#bbcMicro_partPhonemeCount-2911"><span class="linenos">2911</span></a>               <span class="c1"># *SPEAK can take 117 of most single-letter phonemes, or 116 (limited by the 232+6-character input limit) of most 2-letter phonemes</span>
</span><span id="bbcMicro_partPhonemeCount-2912"><a href="#bbcMicro_partPhonemeCount-2912"><span class="linenos">2912</span></a>               <span class="s1">&#39;AW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;IY&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;OW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;OL&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;UW&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span><span class="s1">&#39;/UL&#39;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="c1"># *SPEAK can take 58 of these</span>
</span><span id="bbcMicro_partPhonemeCount-2913"><a href="#bbcMicro_partPhonemeCount-2913"><span class="linenos">2913</span></a>               <span class="s1">&#39;DUX&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;AY&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;CH&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;J&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="s1">&#39;OY&#39;</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="c1"># *SPEAK can take 39 of these</span>
</span><span id="bbcMicro_partPhonemeCount-2914"><a href="#bbcMicro_partPhonemeCount-2914"><span class="linenos">2914</span></a>               <span class="s1">&#39;CT&#39;</span><span class="p">:</span><span class="mi">4</span><span class="p">,</span> <span class="c1"># *SPEAK can take 29 of these</span>
</span><span id="bbcMicro_partPhonemeCount-2915"><a href="#bbcMicro_partPhonemeCount-2915"><span class="linenos">2915</span></a>            <span class="p">}</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">p</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="bbcMicro_partPhonemeCount-2916"><a href="#bbcMicro_partPhonemeCount-2916"><span class="linenos">2916</span></a>            <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">p</span><span class="p">):]</span> <span class="p">;</span> <span class="n">found</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="k">break</span>
</span><span id="bbcMicro_partPhonemeCount-2917"><a href="#bbcMicro_partPhonemeCount-2917"><span class="linenos">2917</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">found</span><span class="p">:</span>
</span><span id="bbcMicro_partPhonemeCount-2918"><a href="#bbcMicro_partPhonemeCount-2918"><span class="linenos">2918</span></a>         <span class="k">assert</span> <span class="n">as_printable</span><span class="p">(</span><span class="n">pronunc</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span> <span class="ow">in</span> <span class="s1">&#39;12345678&#39;</span><span class="p">,</span><span class="s2">&quot;Unrecognised BBC Micro phoneme at &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot; in &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">pronunc0</span><span class="p">)</span>
</span><span id="bbcMicro_partPhonemeCount-2919"><a href="#bbcMicro_partPhonemeCount-2919"><span class="linenos">2919</span></a>         <span class="n">pronunc</span><span class="o">=</span><span class="n">pronunc</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="bbcMicro_partPhonemeCount-2920"><a href="#bbcMicro_partPhonemeCount-2920"><span class="linenos">2920</span></a>   <span class="k">return</span> <span class="n">partCount</span>
</span></pre></div>


            <div class="docstring"><p>Returns the number of 'part phonemes' (at least that's what I'm calling them) for the BBC Micro phonemes in pronunc.  The *SPEAK command cannot take more than 117 part-phonemes at a time before saying "Line too long", and in some cases it takes less than that (I'm not sure why); 115 is a safer limit.</p>
</div>


                </section>
                <section id="markup_inline_word">
                            <input id="markup_inline_word-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">markup_inline_word</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span>, </span><span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="markup_inline_word-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#markup_inline_word"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="markup_inline_word-2922"><a href="#markup_inline_word-2922"><span class="linenos">2922</span></a><span class="k">def</span> <span class="nf">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="markup_inline_word-2923"><a href="#markup_inline_word-2923"><span class="linenos">2923</span></a>    <span class="s2">&quot;Returns pronunc with any necessary markup for putting it in a text (using the inline_format setting)&quot;</span>
</span><span id="markup_inline_word-2924"><a href="#markup_inline_word-2924"><span class="linenos">2924</span></a>    <span class="n">pronunc</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="c1"># UTF-8 output - ok for pasting into Firefox etc *IF* the terminal/X11 understands utf-8 (otherwise redirect to a file, point the browser at it, and set encoding to utf-8, or try --convert&#39;ing which will o/p HTML)</span>
</span><span id="markup_inline_word-2925"><a href="#markup_inline_word-2925"><span class="linenos">2925</span></a>    <span class="nb">format</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;inline_format&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="markup_inline_word-2926"><a href="#markup_inline_word-2926"><span class="linenos">2926</span></a>    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span>
</span><span id="markup_inline_word-2927"><a href="#markup_inline_word-2927"><span class="linenos">2927</span></a>       <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="nb">format</span><span class="p">)</span><span class="o">==</span><span class="n">unicode</span><span class="p">:</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># see above</span>
</span><span id="markup_inline_word-2928"><a href="#markup_inline_word-2928"><span class="linenos">2928</span></a>       <span class="k">return</span> <span class="nb">format</span> <span class="o">%</span> <span class="n">pronunc</span>
</span><span id="markup_inline_word-2929"><a href="#markup_inline_word-2929"><span class="linenos">2929</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="nb">format</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns pronunc with any necessary markup for putting it in a text (using the inline_format setting)</p>
</div>


                </section>
                <section id="markup_doubleTalk_word">
                            <input id="markup_doubleTalk_word-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">markup_doubleTalk_word</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="markup_doubleTalk_word-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#markup_doubleTalk_word"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="markup_doubleTalk_word-2930"><a href="#markup_doubleTalk_word-2930"><span class="linenos">2930</span></a><span class="k">def</span> <span class="nf">markup_doubleTalk_word</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="markup_doubleTalk_word-2931"><a href="#markup_doubleTalk_word-2931"><span class="linenos">2931</span></a>   <span class="s2">&quot;Special-case function set as inline_format in doubletalk (checks environment variables for command code)&quot;</span>
</span><span id="markup_doubleTalk_word-2932"><a href="#markup_doubleTalk_word-2932"><span class="linenos">2932</span></a>   <span class="n">cmd</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;DTALK_COMMAND_CODE&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="markup_doubleTalk_word-2933"><a href="#markup_doubleTalk_word-2933"><span class="linenos">2933</span></a>   <span class="k">if</span> <span class="n">cmd</span><span class="p">:</span> <span class="n">cmd</span><span class="o">=</span><span class="nb">chr</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">cmd</span><span class="p">))</span>
</span><span id="markup_doubleTalk_word-2934"><a href="#markup_doubleTalk_word-2934"><span class="linenos">2934</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">cmd</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
</span><span id="markup_doubleTalk_word-2935"><a href="#markup_doubleTalk_word-2935"><span class="linenos">2935</span></a>   <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2">D</span><span class="si">%s%s</span><span class="s2">T&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span><span class="n">cmd</span><span class="p">,</span><span class="n">pronunc</span><span class="p">,</span><span class="n">cmd</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function set as inline_format in doubletalk (checks environment variables for command code)</p>
</div>


                </section>
                <section id="markup_bbcMicro_word">
                            <input id="markup_bbcMicro_word-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">markup_bbcMicro_word</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">pronunc</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="markup_bbcMicro_word-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#markup_bbcMicro_word"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="markup_bbcMicro_word-2936"><a href="#markup_bbcMicro_word-2936"><span class="linenos">2936</span></a><span class="k">def</span> <span class="nf">markup_bbcMicro_word</span><span class="p">(</span><span class="n">pronunc</span><span class="p">):</span>
</span><span id="markup_bbcMicro_word-2937"><a href="#markup_bbcMicro_word-2937"><span class="linenos">2937</span></a>   <span class="s2">&quot;Special-case function set as inline_format in bbcmicro.  Begins a new *SPEAK command when necessary.  See also write_bbcmicro_phones.&quot;</span>
</span><span id="markup_bbcMicro_word-2938"><a href="#markup_bbcMicro_word-2938"><span class="linenos">2938</span></a>   <span class="k">global</span> <span class="n">bbc_partsSoFar</span><span class="p">,</span><span class="n">bbc_charsSoFar</span>
</span><span id="markup_bbcMicro_word-2939"><a href="#markup_bbcMicro_word-2939"><span class="linenos">2939</span></a>   <span class="n">thisPartCount</span> <span class="o">=</span> <span class="n">bbcMicro_partPhonemeCount</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span>
</span><span id="markup_bbcMicro_word-2940"><a href="#markup_bbcMicro_word-2940"><span class="linenos">2940</span></a>   <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bbc_partsSoFar</span> <span class="ow">or</span> <span class="n">bbc_partsSoFar</span><span class="o">+</span><span class="n">thisPartCount</span> <span class="o">&gt;</span> <span class="mi">115</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">bbc_charsSoFar</span> <span class="ow">or</span> <span class="n">bbc_charsSoFar</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">238</span><span class="p">):</span> <span class="c1"># 238 is max len of BBC BASIC prompt (both the immediate prompt and the one with line number supplied by AUTO, in both BASIC II and BASIC IV); re other limit see bbcMicro_partPhonemeCount</span>
</span><span id="markup_bbcMicro_word-2941"><a href="#markup_bbcMicro_word-2941"><span class="linenos">2941</span></a>      <span class="k">if</span> <span class="n">bbc_charsSoFar</span><span class="p">:</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="markup_bbcMicro_word-2942"><a href="#markup_bbcMicro_word-2942"><span class="linenos">2942</span></a>      <span class="k">else</span><span class="p">:</span> <span class="n">r</span><span class="o">=</span><span class="s2">&quot;&quot;</span>
</span><span id="markup_bbcMicro_word-2943"><a href="#markup_bbcMicro_word-2943"><span class="linenos">2943</span></a>      <span class="n">cmd</span><span class="o">=</span><span class="s2">&quot;*SPEAK&quot;</span> <span class="c1"># (could add a space if want to make it more readable, at the expense of an extra keystroke in the paste buffer; by the way, when not using the ROM version you must use *SPEAK not OS.(&quot;SPEAK&quot;), at least on a Model B; seems OSCLI doesn&#39;t go through quite the same vectors as star)</span>
</span><span id="markup_bbcMicro_word-2944"><a href="#markup_bbcMicro_word-2944"><span class="linenos">2944</span></a>      <span class="n">bbc_charsSoFar</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">cmd</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 for the space that&#39;ll be after this word if we don&#39;t start a new line</span>
</span><span id="markup_bbcMicro_word-2945"><a href="#markup_bbcMicro_word-2945"><span class="linenos">2945</span></a>      <span class="n">bbc_partsSoFar</span> <span class="o">=</span> <span class="n">thisPartCount</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># ditto</span>
</span><span id="markup_bbcMicro_word-2946"><a href="#markup_bbcMicro_word-2946"><span class="linenos">2946</span></a>      <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="n">r</span><span class="o">+</span><span class="n">cmd</span><span class="p">)</span><span class="o">+</span><span class="n">pronunc</span>
</span><span id="markup_bbcMicro_word-2947"><a href="#markup_bbcMicro_word-2947"><span class="linenos">2947</span></a>   <span class="k">else</span><span class="p">:</span>
</span><span id="markup_bbcMicro_word-2948"><a href="#markup_bbcMicro_word-2948"><span class="linenos">2948</span></a>      <span class="n">bbc_charsSoFar</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pronunc</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
</span><span id="markup_bbcMicro_word-2949"><a href="#markup_bbcMicro_word-2949"><span class="linenos">2949</span></a>      <span class="n">bbc_partsSoFar</span> <span class="o">+=</span> <span class="n">thisPartCount</span><span class="o">+</span><span class="mi">1</span>
</span><span id="markup_bbcMicro_word-2950"><a href="#markup_bbcMicro_word-2950"><span class="linenos">2950</span></a>      <span class="k">return</span> <span class="n">pronunc</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function set as inline_format in bbcmicro.  Begins a new *SPEAK command when necessary.  See also write_bbcmicro_phones.</p>
</div>


                </section>
                <section id="sylcount">
                            <input id="sylcount-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sylcount</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">example_format_festival</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sylcount-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sylcount"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sylcount-2953"><a href="#sylcount-2953"><span class="linenos">2953</span></a><span class="k">def</span> <span class="nf">sylcount</span><span class="p">(</span><span class="n">example_format_festival</span><span class="p">):</span>
</span><span id="sylcount-2954"><a href="#sylcount-2954"><span class="linenos">2954</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Tries to count the number of syllables in a Festival string (see mainopt_syllables).  We treat @ as counting the same as the previous syllable (e.g. &quot;fire&quot;, &quot;power&quot;), but this can vary in different songs, so the result will likely need a bit of proofreading.&quot;&quot;&quot;</span>
</span><span id="sylcount-2955"><a href="#sylcount-2955"><span class="linenos">2955</span></a>  <span class="n">count</span> <span class="o">=</span> <span class="n">inVowel</span> <span class="o">=</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sylcount-2956"><a href="#sylcount-2956"><span class="linenos">2956</span></a>  <span class="n">festival</span> <span class="o">=</span> <span class="n">example_format_festival</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="c1"># no brackets, emphasis by vowels, but spaces between each syllable</span>
</span><span id="sylcount-2957"><a href="#sylcount-2957"><span class="linenos">2957</span></a>  <span class="k">for</span> <span class="n">phone</span><span class="p">,</span><span class="n">i</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">festival</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">festival</span><span class="p">))):</span>
</span><span id="sylcount-2958"><a href="#sylcount-2958"><span class="linenos">2958</span></a>    <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">:</span> <span class="n">inVowel</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># unconditionally start new syllable</span>
</span><span id="sylcount-2959"><a href="#sylcount-2959"><span class="linenos">2959</span></a>    <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;aeiou@12&quot;</span><span class="p">:</span>
</span><span id="sylcount-2960"><a href="#sylcount-2960"><span class="linenos">2960</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">inVowel</span><span class="p">:</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="sylcount-2961"><a href="#sylcount-2961"><span class="linenos">2961</span></a>      <span class="k">elif</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;@&quot;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">hadAt</span><span class="p">:</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># (e.g. &quot;loyal&quot;, but NOT &#39;1&#39;, e.g. &quot;world&quot;)</span>
</span><span id="sylcount-2962"><a href="#sylcount-2962"><span class="linenos">2962</span></a>      <span class="k">if</span> <span class="s2">&quot;@&quot;</span> <span class="ow">in</span> <span class="n">phone</span><span class="p">:</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># for words like &quot;cheerful&quot; (&quot;i@ 1 @&quot; counts as one)</span>
</span><span id="sylcount-2963"><a href="#sylcount-2963"><span class="linenos">2963</span></a>      <span class="n">inVowel</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="sylcount-2964"><a href="#sylcount-2964"><span class="linenos">2964</span></a>      <span class="k">if</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;@&quot;</span> <span class="ow">and</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">3</span> <span class="ow">and</span> <span class="n">festival</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span><span class="n">i</span><span class="p">]</span><span class="o">==</span><span class="p">[</span><span class="s2">&quot;ai&quot;</span><span class="p">,</span><span class="s2">&quot;1&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">festival</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span><span class="s2">&quot;h&quot;</span><span class="p">]:</span> <span class="c1"># special rule for higher, Messiah, etc - like &quot;fire&quot; but usually 2 syllables</span>
</span><span id="sylcount-2965"><a href="#sylcount-2965"><span class="linenos">2965</span></a>        <span class="n">maybeCount</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="sylcount-2966"><a href="#sylcount-2966"><span class="linenos">2966</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="sylcount-2967"><a href="#sylcount-2967"><span class="linenos">2967</span></a>      <span class="k">if</span> <span class="ow">not</span> <span class="n">phone</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="ow">in</span> <span class="s2">&quot;drz&quot;</span><span class="p">:</span> <span class="n">count</span> <span class="o">+=</span> <span class="n">maybeCount</span> <span class="c1"># not &#39;r/z&#39; e.g. &quot;ours&quot;, &quot;fired&quot; usually 1 syllable in songs, &quot;desirable&quot; usually 4 not 5</span>
</span><span id="sylcount-2968"><a href="#sylcount-2968"><span class="linenos">2968</span></a>      <span class="c1"># TODO steward?  y u@ 1 d but usally 2 syllables</span>
</span><span id="sylcount-2969"><a href="#sylcount-2969"><span class="linenos">2969</span></a>      <span class="n">inVowel</span> <span class="o">=</span> <span class="n">maybeCount</span> <span class="o">=</span> <span class="n">hadAt</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="sylcount-2970"><a href="#sylcount-2970"><span class="linenos">2970</span></a>  <span class="k">return</span> <span class="n">count</span>
</span></pre></div>


            <div class="docstring"><p>Tries to count the number of syllables in a Festival string (see mainopt_syllables).  We treat @ as counting the same as the previous syllable (e.g. "fire", "power"), but this can vary in different songs, so the result will likely need a bit of proofreading.</p>
</div>


                </section>
                <section id="hyphenate">
                            <input id="hyphenate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">hyphenate</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">word</span>, </span><span class="param"><span class="n">numSyls</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="hyphenate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#hyphenate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="hyphenate-2971"><a href="#hyphenate-2971"><span class="linenos">2971</span></a><span class="k">def</span> <span class="nf">hyphenate</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">numSyls</span><span class="p">):</span>
</span><span id="hyphenate-2972"><a href="#hyphenate-2972"><span class="linenos">2972</span></a>  <span class="s2">&quot;See mainopt_syllables&quot;</span>
</span><span id="hyphenate-2973"><a href="#hyphenate-2973"><span class="linenos">2973</span></a>  <span class="n">orig</span> <span class="o">=</span> <span class="n">word</span>
</span><span id="hyphenate-2974"><a href="#hyphenate-2974"><span class="linenos">2974</span></a>  <span class="k">try</span><span class="p">:</span> <span class="n">word</span><span class="p">,</span><span class="n">isu8</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">),</span><span class="kc">True</span>
</span><span id="hyphenate-2975"><a href="#hyphenate-2975"><span class="linenos">2975</span></a>  <span class="k">except</span><span class="p">:</span> <span class="n">isu8</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="hyphenate-2976"><a href="#hyphenate-2976"><span class="linenos">2976</span></a>  <span class="n">pre</span><span class="o">=</span><span class="p">[]</span> <span class="p">;</span> <span class="n">post</span><span class="o">=</span><span class="p">[]</span>
</span><span id="hyphenate-2977"><a href="#hyphenate-2977"><span class="linenos">2977</span></a>  <span class="k">while</span> <span class="n">word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;a&#39;</span><span class="o">&lt;=</span><span class="n">word</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">&lt;=</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
</span><span id="hyphenate-2978"><a href="#hyphenate-2978"><span class="linenos">2978</span></a>    <span class="n">pre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span> <span class="p">;</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="hyphenate-2979"><a href="#hyphenate-2979"><span class="linenos">2979</span></a>  <span class="k">while</span> <span class="n">word</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;a&#39;</span><span class="o">&lt;=</span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">&lt;=</span><span class="s1">&#39;z&#39;</span><span class="p">:</span>
</span><span id="hyphenate-2980"><a href="#hyphenate-2980"><span class="linenos">2980</span></a>    <span class="n">post</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">word</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:])</span> <span class="p">;</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="hyphenate-2981"><a href="#hyphenate-2981"><span class="linenos">2981</span></a>  <span class="k">if</span> <span class="n">numSyls</span><span class="o">&gt;</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">):</span> <span class="k">return</span> <span class="n">orig</span> <span class="c1"># probably numbers or something</span>
</span><span id="hyphenate-2982"><a href="#hyphenate-2982"><span class="linenos">2982</span></a>  <span class="n">l</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">word</span><span class="p">)</span><span class="o">+</span><span class="n">numSyls</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="n">numSyls</span><span class="p">)</span> <span class="p">;</span> <span class="n">syls</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="hyphenate-2983"><a href="#hyphenate-2983"><span class="linenos">2983</span></a>  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">numSyls</span><span class="p">):</span>
</span><span id="hyphenate-2984"><a href="#hyphenate-2984"><span class="linenos">2984</span></a>    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="n">numSyls</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span> <span class="n">syls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">l</span><span class="p">:])</span>
</span><span id="hyphenate-2985"><a href="#hyphenate-2985"><span class="linenos">2985</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">syls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">word</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">l</span><span class="p">:(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">l</span><span class="p">])</span>
</span><span id="hyphenate-2986"><a href="#hyphenate-2986"><span class="linenos">2986</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
</span><span id="hyphenate-2987"><a href="#hyphenate-2987"><span class="linenos">2987</span></a>      <span class="k">if</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">):</span>
</span><span id="hyphenate-2988"><a href="#hyphenate-2988"><span class="linenos">2988</span></a>        <span class="c1"># repeated consonant at start - put one on previous</span>
</span><span id="hyphenate-2989"><a href="#hyphenate-2989"><span class="linenos">2989</span></a>        <span class="c1"># (or hyphen at start - move it to the previous)</span>
</span><span id="hyphenate-2990"><a href="#hyphenate-2990"><span class="linenos">2990</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span>
</span><span id="hyphenate-2991"><a href="#hyphenate-2991"><span class="linenos">2991</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="hyphenate-2992"><a href="#hyphenate-2992"><span class="linenos">2992</span></a>      <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;-&#39;</span><span class="p">:</span>
</span><span id="hyphenate-2993"><a href="#hyphenate-2993"><span class="linenos">2993</span></a>        <span class="c1"># better move this splitpoint after that hyphen (TODO: move more than one character?)</span>
</span><span id="hyphenate-2994"><a href="#hyphenate-2994"><span class="linenos">2994</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">2</span><span class="p">]</span>
</span><span id="hyphenate-2995"><a href="#hyphenate-2995"><span class="linenos">2995</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="mi">2</span><span class="p">:]</span>
</span><span id="hyphenate-2996"><a href="#hyphenate-2996"><span class="linenos">2996</span></a>      <span class="k">elif</span> <span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">)</span> \
</span><span id="hyphenate-2997"><a href="#hyphenate-2997"><span class="linenos">2997</span></a>            <span class="ow">or</span> <span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiouy&quot;</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">))</span> \
</span><span id="hyphenate-2998"><a href="#hyphenate-2998"><span class="linenos">2998</span></a>            <span class="ow">and</span> <span class="nb">list</span><span class="p">(</span><span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="s2">&quot;aeiou&quot;</span><span class="p">,</span><span class="nb">list</span><span class="p">(</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))):</span>
</span><span id="hyphenate-2999"><a href="#hyphenate-2999"><span class="linenos">2999</span></a>        <span class="c1"># repeated consonant at end - put one on next</span>
</span><span id="hyphenate-3000"><a href="#hyphenate-3000"><span class="linenos">3000</span></a>        <span class="c1"># or vowel on right: move a letter over (sometimes the right thing to do...)</span>
</span><span id="hyphenate-3001"><a href="#hyphenate-3001"><span class="linenos">3001</span></a>        <span class="c1"># (unless doing so leaves no vowels)</span>
</span><span id="hyphenate-3002"><a href="#hyphenate-3002"><span class="linenos">3002</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="hyphenate-3003"><a href="#hyphenate-3003"><span class="linenos">3003</span></a>        <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">syls</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">][:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="hyphenate-3004"><a href="#hyphenate-3004"><span class="linenos">3004</span></a>  <span class="n">word</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pre</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;- &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">syls</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">post</span><span class="p">)</span>
</span><span id="hyphenate-3005"><a href="#hyphenate-3005"><span class="linenos">3005</span></a>  <span class="k">if</span> <span class="n">isu8</span><span class="p">:</span> <span class="n">word</span><span class="o">=</span><span class="n">word</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="hyphenate-3006"><a href="#hyphenate-3006"><span class="linenos">3006</span></a>  <span class="k">return</span> <span class="n">word</span>
</span></pre></div>


            <div class="docstring"><p>See mainopt_syllables</p>
</div>


                </section>
                <section id="macSayCommand">
                            <input id="macSayCommand-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">macSayCommand</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="macSayCommand-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#macSayCommand"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="macSayCommand-3008"><a href="#macSayCommand-3008"><span class="linenos">3008</span></a><span class="k">def</span> <span class="nf">macSayCommand</span><span class="p">():</span>
</span><span id="macSayCommand-3009"><a href="#macSayCommand-3009"><span class="linenos">3009</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return the environment variable SAY_COMMAND if it is set and if it is non-empty, otherwise return &quot;say&quot;.</span>
</span><span id="macSayCommand-3010"><a href="#macSayCommand-3010"><span class="linenos">3010</span></a><span class="sd">  E.g. SAY_COMMAND=&quot;say -o file.aiff&quot; (TODO: document this in the help text?)</span>
</span><span id="macSayCommand-3011"><a href="#macSayCommand-3011"><span class="linenos">3011</span></a><span class="sd">  In Gradint you can set (e.g. if you have a ~/.festivalrc) extra_speech=[(&quot;en&quot;,&quot;python lexconvert.py --mac-uk festival&quot;)] ; extra_speech_tofile=[(&quot;en&quot;,&#39;echo %s | SAY_COMMAND=&quot;say -o /tmp/said.aiff&quot; python lexconvert.py --mac-uk festival &amp;&amp; sox /tmp/said.aiff /tmp/said.wav&#39;,&quot;/tmp/said.wav&quot;)]&quot;&quot;&quot;</span>
</span><span id="macSayCommand-3012"><a href="#macSayCommand-3012"><span class="linenos">3012</span></a>  <span class="n">s</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SAY_COMMAND&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="macSayCommand-3013"><a href="#macSayCommand-3013"><span class="linenos">3013</span></a>  <span class="k">if</span> <span class="n">s</span><span class="p">:</span> <span class="k">return</span> <span class="n">s</span>
</span><span id="macSayCommand-3014"><a href="#macSayCommand-3014"><span class="linenos">3014</span></a>  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="s2">&quot;say&quot;</span>
</span></pre></div>


            <div class="docstring"><p>Return the environment variable SAY_COMMAND if it is set and if it is non-empty, otherwise return "say".
E.g. SAY_COMMAND="say -o file.aiff" (TODO: document this in the help text?)
In Gradint you can set (e.g. if you have a ~/.festivalrc) extra_speech=[("en","python lexconvert.py --mac-uk festival")] ; extra_speech_tofile=[("en",'echo %s | SAY_COMMAND="say -o /tmp/said.aiff" python lexconvert.py --mac-uk festival &amp;&amp; sox /tmp/said.aiff /tmp/said.wav',"/tmp/said.wav")]</p>
</div>


                </section>
                <section id="stdin_is_terminal">
                            <input id="stdin_is_terminal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stdin_is_terminal</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="stdin_is_terminal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stdin_is_terminal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stdin_is_terminal-3016"><a href="#stdin_is_terminal-3016"><span class="linenos">3016</span></a><span class="k">def</span> <span class="nf">stdin_is_terminal</span><span class="p">():</span>
</span><span id="stdin_is_terminal-3017"><a href="#stdin_is_terminal-3017"><span class="linenos">3017</span></a>   <span class="s2">&quot;Returns True if it seems the standard input is connected to a terminal (rather than piped from a file etc)&quot;</span>
</span><span id="stdin_is_terminal-3018"><a href="#stdin_is_terminal-3018"><span class="linenos">3018</span></a>   <span class="k">return</span> <span class="p">(</span><span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">,</span><span class="s2">&quot;isatty&quot;</span><span class="p">))</span> <span class="ow">or</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">isatty</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>Returns True if it seems the standard input is connected to a terminal (rather than piped from a file etc)</p>
</div>


                </section>
                <section id="getInputText">
                            <input id="getInputText-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">getInputText</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span>, </span><span class="param"><span class="n">prompt</span>, </span><span class="param"><span class="n">as_iterable</span><span class="o">=</span><span class="kc">False</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="getInputText-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#getInputText"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="getInputText-3020"><a href="#getInputText-3020"><span class="linenos">3020</span></a><span class="k">def</span> <span class="nf">getInputText</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">prompt</span><span class="p">,</span><span class="n">as_iterable</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span><span id="getInputText-3021"><a href="#getInputText-3021"><span class="linenos">3021</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Gets text either from the command line or from standard input.  Issue prompt if there&#39;s nothing on the command line and standard input is connected to a tty instead of a pipe or file.  If as_iterable, return an iterable object over the lines instead of reading and returning all text at once.  If as_iterable==&#39;maybe&#39;, return the iterable but if not reading from a tty then read everything into one item.&quot;&quot;&quot;</span>
</span><span id="getInputText-3022"><a href="#getInputText-3022"><span class="linenos">3022</span></a>  <span class="n">txt</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">:])</span>
</span><span id="getInputText-3023"><a href="#getInputText-3023"><span class="linenos">3023</span></a>  <span class="k">if</span> <span class="n">txt</span><span class="p">:</span>
</span><span id="getInputText-3024"><a href="#getInputText-3024"><span class="linenos">3024</span></a>    <span class="k">if</span> <span class="n">as_iterable</span><span class="o">==</span><span class="s1">&#39;maybe&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">txt</span><span class="p">]</span>
</span><span id="getInputText-3025"><a href="#getInputText-3025"><span class="linenos">3025</span></a>    <span class="k">elif</span> <span class="n">as_iterable</span><span class="p">:</span> <span class="k">return</span> <span class="n">txt</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span><span id="getInputText-3026"><a href="#getInputText-3026"><span class="linenos">3026</span></a>    <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">txt</span>
</span><span id="getInputText-3027"><a href="#getInputText-3027"><span class="linenos">3027</span></a>  <span class="k">if</span> <span class="n">stdin_is_terminal</span><span class="p">():</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Enter &quot;</span><span class="o">+</span><span class="n">prompt</span><span class="o">+</span><span class="s2">&quot; (EOF when done)</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="getInputText-3028"><a href="#getInputText-3028"><span class="linenos">3028</span></a>  <span class="k">elif</span> <span class="n">as_iterable</span><span class="o">==</span><span class="s1">&#39;maybe&#39;</span><span class="p">:</span> <span class="k">return</span> <span class="p">[</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()]</span>
</span><span id="getInputText-3029"><a href="#getInputText-3029"><span class="linenos">3029</span></a>  <span class="k">if</span> <span class="n">as_iterable</span><span class="p">:</span> <span class="k">return</span> <span class="n">my_xreadlines</span><span class="p">()</span>
</span><span id="getInputText-3030"><a href="#getInputText-3030"><span class="linenos">3030</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="getInputText-3031"><a href="#getInputText-3031"><span class="linenos">3031</span></a>     <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="getInputText-3032"><a href="#getInputText-3032"><span class="linenos">3032</span></a>     <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SystemExit</span>
</span></pre></div>


            <div class="docstring"><p>Gets text either from the command line or from standard input.  Issue prompt if there's nothing on the command line and standard input is connected to a tty instead of a pipe or file.  If as_iterable, return an iterable object over the lines instead of reading and returning all text at once.  If as_iterable=='maybe', return the iterable but if not reading from a tty then read everything into one item.</p>
</div>


                </section>
                <section id="my_xreadlines">
                            <input id="my_xreadlines-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">my_xreadlines</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="my_xreadlines-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#my_xreadlines"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="my_xreadlines-3036"><a href="#my_xreadlines-3036"><span class="linenos">3036</span></a><span class="k">def</span> <span class="nf">my_xreadlines</span><span class="p">():</span>
</span><span id="my_xreadlines-3037"><a href="#my_xreadlines-3037"><span class="linenos">3037</span></a>   <span class="s2">&quot;On some platforms this might be a bit more responsive than sys.stdin.xreadlines&quot;</span>
</span><span id="my_xreadlines-3038"><a href="#my_xreadlines-3038"><span class="linenos">3038</span></a>   <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span><span id="my_xreadlines-3039"><a href="#my_xreadlines-3039"><span class="linenos">3039</span></a>      <span class="k">try</span><span class="p">:</span> <span class="k">yield</span> <span class="n">raw_input</span><span class="p">()</span>
</span><span id="my_xreadlines-3040"><a href="#my_xreadlines-3040"><span class="linenos">3040</span></a>      <span class="k">except</span> <span class="ne">EOFError</span><span class="p">:</span> <span class="k">return</span>
</span><span id="my_xreadlines-3041"><a href="#my_xreadlines-3041"><span class="linenos">3041</span></a>      <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">SystemExit</span>
</span></pre></div>


            <div class="docstring"><p>On some platforms this might be a bit more responsive than sys.stdin.xreadlines</p>
</div>


                </section>
                <section id="output_clauses">
                            <input id="output_clauses-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">output_clauses</span><span class="signature pdoc-code condensed">(<span class="param"><span class="nb">format</span>, </span><span class="param"><span class="n">clauses</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="output_clauses-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#output_clauses"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="output_clauses-3043"><a href="#output_clauses-3043"><span class="linenos">3043</span></a><span class="k">def</span> <span class="nf">output_clauses</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">clauses</span><span class="p">):</span>
</span><span id="output_clauses-3044"><a href="#output_clauses-3044"><span class="linenos">3044</span></a>   <span class="s2">&quot;Writes out clauses and words in format &#39;format&#39; (clauses is a list of lists of words in the phones of &#39;format&#39;).  By default, calls markup_inline_word and join as appropriate.  If however the format&#39;s &#39;clause_separator&#39; has been set to a special case, calls that.&quot;</span>
</span><span id="output_clauses-3045"><a href="#output_clauses-3045"><span class="linenos">3045</span></a>   <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;output_is_binary&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">,</span><span class="s2">&quot;isatty&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span>
</span><span id="output_clauses-3046"><a href="#output_clauses-3046"><span class="linenos">3046</span></a>      <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This is a binary format - not writing to terminal.</span><span class="se">\n</span><span class="s2">Please direct output to a file or pipe.&quot;</span><span class="p">)</span>
</span><span id="output_clauses-3047"><a href="#output_clauses-3047"><span class="linenos">3047</span></a>      <span class="k">return</span>
</span><span id="output_clauses-3048"><a href="#output_clauses-3048"><span class="linenos">3048</span></a>   <span class="n">clause_sep</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="s2">&quot;clause_separator&quot;</span><span class="p">,</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="output_clauses-3049"><a href="#output_clauses-3049"><span class="linenos">3049</span></a>   <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">clause_sep</span><span class="p">)</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">bytes</span><span class="p">,</span><span class="n">unicode</span><span class="p">]:</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">clause_sep</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="n">wordSeparator</span><span class="p">(</span><span class="nb">format</span><span class="p">))</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="nb">format</span><span class="p">,</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">)</span> <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">))</span>
</span><span id="output_clauses-3050"><a href="#output_clauses-3050"><span class="linenos">3050</span></a>   <span class="k">else</span><span class="p">:</span> <span class="n">clause_sep</span><span class="p">(</span><span class="n">clauses</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Writes out clauses and words in format 'format' (clauses is a list of lists of words in the phones of 'format').  By default, calls markup_inline_word and join as appropriate.  If however the format's 'clause_separator' has been set to a special case, calls that.</p>
</div>


                </section>
                <section id="write_bbcmicro_phones">
                            <input id="write_bbcmicro_phones-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">write_bbcmicro_phones</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">clauses</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="write_bbcmicro_phones-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#write_bbcmicro_phones"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="write_bbcmicro_phones-3051"><a href="#write_bbcmicro_phones-3051"><span class="linenos">3051</span></a><span class="k">def</span> <span class="nf">write_bbcmicro_phones</span><span class="p">(</span><span class="n">clauses</span><span class="p">):</span>
</span><span id="write_bbcmicro_phones-3052"><a href="#write_bbcmicro_phones-3052"><span class="linenos">3052</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as clause_separator in bbcmicro format.  Must be a special case because it needs to track any extra keystrokes to avoid &quot;Line too long&quot;.  And while we&#39;re at it, we might as well start a new *SPEAK command with each clause, using the natural brief delay between commands; this should minimise the occurrence of additional delays in arbitrary places.  Also calls print_bbc_warnings&quot;&quot;&quot;</span>
</span><span id="write_bbcmicro_phones-3053"><a href="#write_bbcmicro_phones-3053"><span class="linenos">3053</span></a>  <span class="n">totalKeystrokes</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="write_bbcmicro_phones-3054"><a href="#write_bbcmicro_phones-3054"><span class="linenos">3054</span></a>  <span class="k">for</span> <span class="n">clause</span> <span class="ow">in</span> <span class="n">clauses</span><span class="p">:</span>
</span><span id="write_bbcmicro_phones-3055"><a href="#write_bbcmicro_phones-3055"><span class="linenos">3055</span></a>    <span class="k">global</span> <span class="n">bbc_charsSoFar</span> <span class="p">;</span> <span class="n">bbc_charsSoFar</span><span class="o">=</span><span class="mi">0</span>
</span><span id="write_bbcmicro_phones-3056"><a href="#write_bbcmicro_phones-3056"><span class="linenos">3056</span></a>    <span class="n">l</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">markup_inline_word</span><span class="p">(</span><span class="s2">&quot;bbcmicro&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">clause</span><span class="p">])</span>
</span><span id="write_bbcmicro_phones-3057"><a href="#write_bbcmicro_phones-3057"><span class="linenos">3057</span></a>    <span class="n">getBuf</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">l</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">),</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)))</span>
</span><span id="write_bbcmicro_phones-3058"><a href="#write_bbcmicro_phones-3058"><span class="linenos">3058</span></a>    <span class="n">totalKeystrokes</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">l</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span> <span class="p">;</span> <span class="n">lines</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="write_bbcmicro_phones-3059"><a href="#write_bbcmicro_phones-3059"><span class="linenos">3059</span></a>  <span class="n">print_bbc_warnings</span><span class="p">(</span><span class="n">totalKeystrokes</span><span class="p">,</span><span class="n">lines</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function set as clause_separator in bbcmicro format.  Must be a special case because it needs to track any extra keystrokes to avoid "Line too long".  And while we're at it, we might as well start a new *SPEAK command with each clause, using the natural brief delay between commands; this should minimise the occurrence of additional delays in arbitrary places.  Also calls print_bbc_warnings</p>
</div>


                </section>
                <section id="print_bbc_warnings">
                            <input id="print_bbc_warnings-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_bbc_warnings</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">keyCount</span>, </span><span class="param"><span class="n">lineCount</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="print_bbc_warnings-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#print_bbc_warnings"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="print_bbc_warnings-3060"><a href="#print_bbc_warnings-3060"><span class="linenos">3060</span></a><span class="k">def</span> <span class="nf">print_bbc_warnings</span><span class="p">(</span><span class="n">keyCount</span><span class="p">,</span><span class="n">lineCount</span><span class="p">):</span>
</span><span id="print_bbc_warnings-3061"><a href="#print_bbc_warnings-3061"><span class="linenos">3061</span></a>  <span class="s2">&quot;Print any relevant size warnings regarding sending &#39;keyCount&#39; keys in &#39;lineCount&#39; lines to the BBC Micro&quot;</span>
</span><span id="print_bbc_warnings-3062"><a href="#print_bbc_warnings-3062"><span class="linenos">3062</span></a>  <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="c1"># try to keep in sync if someone&#39;s doing 2&gt;&amp;1 | less</span>
</span><span id="print_bbc_warnings-3063"><a href="#print_bbc_warnings-3063"><span class="linenos">3063</span></a>  <span class="n">limits_exceeded</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">severe</span><span class="o">=</span><span class="mi">0</span>
</span><span id="print_bbc_warnings-3064"><a href="#print_bbc_warnings-3064"><span class="linenos">3064</span></a>  <span class="k">if</span> <span class="n">keyCount</span> <span class="o">&gt;=</span> <span class="mi">32768</span><span class="p">:</span>
</span><span id="print_bbc_warnings-3065"><a href="#print_bbc_warnings-3065"><span class="linenos">3065</span></a>    <span class="n">severe</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BeebEm 32K keystroke limit&quot;</span><span class="p">)</span> <span class="c1"># At least in version 3, the clipboard is defined in beebwin.h as a char of size 32768 and its bounds are not checked.  Additionally, if you script a second paste before the first has finished (or if you try to use BeebEm&#39;s Copy command) then the first paste will be interrupted.  So if you really want to make BeebEm read more then I suggest setting a printer destination file, putting a VDU 2,10,3 after each batch of commands, and waiting for that \n to appear in that printer file before sending the next batch, or perhaps write a set of programs to a disk image and have them CHAIN each other or whatever.</span>
</span><span id="print_bbc_warnings-3066"><a href="#print_bbc_warnings-3066"><span class="linenos">3066</span></a>  <span class="n">shadow_himem</span><span class="o">=</span><span class="mh">0x8000</span> <span class="c1"># if using a &#39;shadow mode&#39; on the Master/B+/Integra-B (modes 128-135, which leave all main RAM free)</span>
</span><span id="print_bbc_warnings-3067"><a href="#print_bbc_warnings-3067"><span class="linenos">3067</span></a>  <span class="n">mode7_himem</span><span class="o">=</span><span class="mh">0x7c00</span> <span class="c1"># (40x25 characters = 1000 bytes, by default starting at 7c00 with 24 bytes spare at the top, but the scrolling system uses the full 1024 bytes and can tell the video controller to start rendering at any one of them; if you get Jeremy Ruston&#39;s book and program the VIDC yourself then you could fix it at 7c18 if you really want, or just set HIMEM=&amp;8000 and don&#39;t touch the screen, but that doesn&#39;t give you very much more room)</span>
</span><span id="print_bbc_warnings-3068"><a href="#print_bbc_warnings-3068"><span class="linenos">3068</span></a>  <span class="n">default_speech_loc</span><span class="o">=</span><span class="mh">0x5500</span>
</span><span id="print_bbc_warnings-3069"><a href="#print_bbc_warnings-3069"><span class="linenos">3069</span></a>  <span class="n">overhead_per_program_line</span> <span class="o">=</span> <span class="mi">4</span>
</span><span id="print_bbc_warnings-3070"><a href="#print_bbc_warnings-3070"><span class="linenos">3070</span></a>  <span class="k">for</span> <span class="n">page</span><span class="p">,</span><span class="n">model</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="print_bbc_warnings-3071"><a href="#print_bbc_warnings-3071"><span class="linenos">3071</span></a>        <span class="p">(</span><span class="mh">0x1900</span><span class="p">,</span><span class="s2">&quot;Model B&quot;</span><span class="p">),</span> <span class="c1"># with Acorn DFS (a reasonable assumption although alternate DFS ROMs are different)</span>
</span><span id="print_bbc_warnings-3072"><a href="#print_bbc_warnings-3072"><span class="linenos">3072</span></a>        <span class="p">(</span><span class="mh">0xE00</span><span class="p">,</span><span class="s2">&quot;Master&quot;</span><span class="p">)]:</span> <span class="c1"># (the Master has 8k of special paged-in &quot;filing system RAM&quot;, so doesn&#39;t need 2816 bytes of main RAM for DFS)</span>
</span><span id="print_bbc_warnings-3073"><a href="#print_bbc_warnings-3073"><span class="linenos">3073</span></a>     <span class="n">top</span> <span class="o">=</span> <span class="n">page</span><span class="o">+</span><span class="n">keyCount</span><span class="o">+</span><span class="n">lineCount</span><span class="o">*</span><span class="p">(</span><span class="n">overhead_per_program_line</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">2</span> <span class="c1"># the -1 is because keyCount includes a carriage return at the end of each line</span>
</span><span id="print_bbc_warnings-3074"><a href="#print_bbc_warnings-3074"><span class="linenos">3074</span></a>     <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s2">&quot;Master&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot; (use Speech&#39;s Sideways RAM version instead, e.g. *SRLOAD SP8000 8000 7 and reset, but sound quality might be worse)&quot;</span> <span class="c1"># I don&#39;t know why but SP8000 can play higher and more distorted than SPEECH, at least on emulation (and changing the emulation speed doesn&#39;t help, because that setting, at least in BeebEm3, just controls extra usleep every frame; it doesn&#39;t actually slow down the 6502 *between* frames; anyway timing of sound changes is done by CyclesToSamples stuff in beebsound.cc&#39;s SoundTrigger).  If on the Master you go into View (*WORD) and then try SP8000, it plays _lower_ than *SPEECH (even if you do *BASIC first) and *SAY can corrupt a View document; ViewSheet (*SHEET) doesn&#39;t seem to have this effect; neither does *TERMINAL but *SAY can confuse the terminal.</span>
</span><span id="print_bbc_warnings-3075"><a href="#print_bbc_warnings-3075"><span class="linenos">3075</span></a>     <span class="c1"># Re bank numbers, by default banks 4 to 7 are Sideways RAM (4*16k=64k) and I suppose filling up from 7 makes sense because banks 8-F are ROMs (ANFS,DFS,ViewSheet,Edit,BASIC,ADFS,View,Terminal; OS is a separate 16k so there&#39;s scope for 144k of supplied ROM).  Banks 0-3 are ROM expansion slots.  The &quot;128&quot; in the name &quot;Master 128&quot; comes from 32k main RAM, 64k Sideways RAM, 20k shadow RAM (for screen modes 128-135), 4k OS &quot;private RAM&quot; (paged on top of 8000-8FFF) and 8k filing system RAM (paged on top of C000-DFFF) = 128k.  Not sure what happened on the B+.</span>
</span><span id="print_bbc_warnings-3076"><a href="#print_bbc_warnings-3076"><span class="linenos">3076</span></a>     <span class="c1"># By the way BeebEm&#39;s beebsound.cc also shows us why SOUND was always out of tune especially in the higher pitches.  The 16-bit freqval given to the chip is 125000/freq and must be an integer, so the likely temperament in cents for non-PCM is given by [int(math.log(125000.0/math.ceil(125000/freq)/freq,2**(1.0/1200))) for freq in [440*((2**(1.0/12))**semi) for semi in range(-12*3+2,12*2+6)]] (the actual temperament will depend on the OS&#39;s implementation of mapping SOUND pitch values to freqval&#39;s, unless you program the chip directly, but this list is indicative and varies over 10% in the top 2 octaves)</span>
</span><span id="print_bbc_warnings-3077"><a href="#print_bbc_warnings-3077"><span class="linenos">3077</span></a>     <span class="c1"># Some other ROMs (e.g. Alan Blundell&#39;s &quot;Informant&quot; 1989) seem to result in a crash after the *SPEECH and/or *SPEAK commands complete, at least in some emulator configurations; this may or may not be resolved via timing adjustments or adjustments in the ROM order; not sure exactly what the problem is</span>
</span><span id="print_bbc_warnings-3078"><a href="#print_bbc_warnings-3078"><span class="linenos">3078</span></a>     <span class="k">else</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="s2">&quot; (Speech program will be overwritten unless relocated)&quot;</span> <span class="c1"># (could use Sideways RAM for it instead if you have it fitted, see above)</span>
</span><span id="print_bbc_warnings-3079"><a href="#print_bbc_warnings-3079"><span class="linenos">3079</span></a>     <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">default_speech_loc</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> TOP=&amp;</span><span class="si">%X</span><span class="s2"> limit</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">model</span><span class="p">,</span><span class="n">default_speech_loc</span><span class="p">,</span><span class="n">x</span><span class="p">))</span> <span class="c1"># The Speech program does nothing to stop your program (or its variables etc) from growing large enough to overwrite &amp;5500, nor does it stop the stack pointer (coming down from HIMEM) from overwriting &amp;72FF. For more safety on a Model B you could use RELOCAT to put Speech at &amp;5E00 and be sure to set HIMEM=&amp;5E00 before loading, but then you must avoid commands that change HIMEM, such as MODE (but selecting any non-shadow mode other than 7 will overwrite Speech anyway, although if you set the mode before loading Speech then it&#39;ll overwrite screen memory and still work as long as the affected part of the screen is undisturbed).  You can&#39;t do tricks like ditching the lexicon because RELOCAT won&#39;t let you go above 5E00 (unless you fix it, but I haven&#39;t looked in detail; if you can fix RELOCAT to go above 5E00 then you can create a lexicon-free Speech by taking the 1st 0x1560 bytes of SPEECH and append two * bytes, relocate to &amp;6600 and set HIMEM, but don&#39;t expect *SAY to work, unless you put a really small lexicon into the spare 144 bytes that are left - RELOCAT needs an xx00 address so you can&#39;t have those bytes at the bottom).  You could even relocate to &amp;6A00 and overwrite (non-shadow) screen memory if you don&#39;t mind the screen being filled with gibberish that you&#39;d better not erase! (well if you program the VIDC as mentioned above and you didn&#39;t re-add a small lexicon then you could get yourself 3.6 lines of usable Mode 7 display from the spare bytes but it&#39;s probably not worth the effort)</span>
</span><span id="print_bbc_warnings-3080"><a href="#print_bbc_warnings-3080"><span class="linenos">3080</span></a>     <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">mode7_himem</span><span class="p">:</span>
</span><span id="print_bbc_warnings-3081"><a href="#print_bbc_warnings-3081"><span class="linenos">3081</span></a>        <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s2">&quot;Master&quot;</span><span class="p">:</span>
</span><span id="print_bbc_warnings-3082"><a href="#print_bbc_warnings-3082"><span class="linenos">3082</span></a>           <span class="k">if</span> <span class="n">top</span> <span class="o">&gt;</span> <span class="n">shadow_himem</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; 32k HIMEM limit (even for shadow modes)&quot;</span><span class="p">)</span> <span class="c1"># TODO: maybe add instructions for using BAS128 on the B+ or Master; this sets PAGE=&amp;10000 and HIMEM=&amp;20000 (i.e. 64k for programs), which uses all 4 SRAM slots so you can&#39;t use SP8000 (unless it&#39;s on a real ROM); if using Speech in main memory you need to RELOCAT it to leave &amp;3000 upwards for Bas128 code; putting it at &amp;1900 for B+/DFS leaves you only 417 bytes for lexicon (which might not matter if you&#39;re using only *SPEECH: just create a shortened lexicon); putting it at &amp;E00 for Master allows space for the default 2204-byte lexicon with 1029 bytes to spare; TODO check if Bas128 uses any workspace between &amp;E00 and &amp;3000 though.  Alternatively (if you really want to store such a long program on the BBC) then you&#39;d better split it into several programs that CHAIN each other (as mentioned above).</span>
</span><span id="print_bbc_warnings-3083"><a href="#print_bbc_warnings-3083"><span class="linenos">3083</span></a>           <span class="k">else</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; Mode 7 HIMEM limit (use shadow modes 128-135)&quot;</span><span class="p">)</span>
</span><span id="print_bbc_warnings-3084"><a href="#print_bbc_warnings-3084"><span class="linenos">3084</span></a>        <span class="k">else</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">model</span><span class="o">+</span><span class="s2">&quot; Mode 7 HIMEM limit&quot;</span><span class="p">)</span> <span class="c1"># unless you overwrite the screen (see above) - let&#39;s assume the Model B hasn&#39;t been fitted with shadow modes (although the Integra-B add-on does give them to the Model B, and leaves PAGE at &amp;1900; B+ has shadow modes but I don&#39;t know what&#39;s supposed to happen to PAGE on it).  65C02 Tube doesn&#39;t help much (it&#39;ll try to run Speech on the coprocessor instead of the host, and this results in silence because it can&#39;t send its sound back across the Tube; don&#39;t know if there&#39;s a way to make it run on the host in these circumstances or what the host&#39;s memory map is like)</span>
</span><span id="print_bbc_warnings-3085"><a href="#print_bbc_warnings-3085"><span class="linenos">3085</span></a>  <span class="k">if</span> <span class="n">lineCount</span> <span class="o">&gt;</span> <span class="mi">32768</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;BBC BASIC line number limit&quot;</span><span class="p">)</span> <span class="c1"># and you wouldn&#39;t get this far without filling the memory, even with 128k (4 bytes per line)</span>
</span><span id="print_bbc_warnings-3086"><a href="#print_bbc_warnings-3086"><span class="linenos">3086</span></a>  <span class="k">elif</span> <span class="mi">10</span><span class="o">*</span><span class="n">lineCount</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">:</span> <span class="n">limits_exceeded</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;AUTO line number limit (try AUTO 0,1)&quot;</span><span class="p">)</span> <span class="c1"># (default AUTO increments in steps of 10; you can use AUTO 0,1 to start at 0 and increment in steps of 1.  BBC BASIC stores its line info in a compact form which allows a range of 0-32767.)</span>
</span><span id="print_bbc_warnings-3087"><a href="#print_bbc_warnings-3087"><span class="linenos">3087</span></a>  <span class="k">if</span> <span class="n">severe</span><span class="p">:</span> <span class="n">warning</span><span class="p">,</span><span class="n">after</span><span class="o">=</span><span class="s2">&quot;WARNING: &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span>
</span><span id="print_bbc_warnings-3088"><a href="#print_bbc_warnings-3088"><span class="linenos">3088</span></a>  <span class="k">else</span><span class="p">:</span> <span class="n">warning</span><span class="p">,</span><span class="n">after</span><span class="o">=</span><span class="s2">&quot;Note: &quot;</span><span class="p">,</span><span class="s2">&quot;It should still work if pasted into BeebEm as immediate commands. &quot;</span>
</span><span id="print_bbc_warnings-3089"><a href="#print_bbc_warnings-3089"><span class="linenos">3089</span></a>  <span class="n">after</span> <span class="o">=</span> <span class="s2">&quot;. &quot;</span><span class="o">+</span><span class="n">after</span><span class="o">+</span><span class="s2">&quot;See comments in lexconvert for more details.</span><span class="se">\n</span><span class="s2">&quot;</span>
</span><span id="print_bbc_warnings-3090"><a href="#print_bbc_warnings-3090"><span class="linenos">3090</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">limits_exceeded</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warning</span><span class="o">+</span><span class="s2">&quot;this text may be too big for the BBC Micro. The following limits were exceeded: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">limits_exceeded</span><span class="p">)</span><span class="o">+</span><span class="n">after</span><span class="p">)</span>
</span><span id="print_bbc_warnings-3091"><a href="#print_bbc_warnings-3091"><span class="linenos">3091</span></a>  <span class="k">elif</span> <span class="n">limits_exceeded</span><span class="p">:</span> <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">warning</span><span class="o">+</span><span class="s2">&quot;this text may be too big for the BBC Micro because it exceeds the &quot;</span><span class="o">+</span><span class="n">limits_exceeded</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">after</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print any relevant size warnings regarding sending 'keyCount' keys in 'lineCount' lines to the BBC Micro</p>
</div>


                </section>
                <section id="bbc_prepDefaultLex">
                            <input id="bbc_prepDefaultLex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bbc_prepDefaultLex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">outFile</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bbc_prepDefaultLex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bbc_prepDefaultLex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bbc_prepDefaultLex-3092"><a href="#bbc_prepDefaultLex-3092"><span class="linenos">3092</span></a><span class="k">def</span> <span class="nf">bbc_prepDefaultLex</span><span class="p">(</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="bbc_prepDefaultLex-3093"><a href="#bbc_prepDefaultLex-3093"><span class="linenos">3093</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as lex_header in bbcmicro format.  If SPEECH_DISK and MAKE_SPEECH_ROM is set, then read the ROM code from SPEECH_DISK and write to outFile (meant to go before the lexicon, to make a modified BBC Micro Speech ROM with custom lexicon)&quot;&quot;&quot;</span>
</span><span id="bbc_prepDefaultLex-3094"><a href="#bbc_prepDefaultLex-3094"><span class="linenos">3094</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="k">return</span>
</span><span id="bbc_prepDefaultLex-3095"><a href="#bbc_prepDefaultLex-3095"><span class="linenos">3095</span></a>  <span class="n">sd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SPEECH_DISK&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="bbc_prepDefaultLex-3096"><a href="#bbc_prepDefaultLex-3096"><span class="linenos">3096</span></a>  <span class="n">d</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span> <span class="c1"># if this fails, SPEECH_DISK was not set or was set incorrectly (it&#39;s required for MAKE_SPEECH_ROM)</span>
</span><span id="bbc_prepDefaultLex-3097"><a href="#bbc_prepDefaultLex-3097"><span class="linenos">3097</span></a>  <span class="n">i</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;LO&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;LP&#39;</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x80</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x82</span><span class="p">)</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mh">0x11</span><span class="p">))</span> <span class="c1"># start of SP8000 file (if this fails, it wasn&#39;t a Speech disk)</span>
</span><span id="bbc_prepDefaultLex-3098"><a href="#bbc_prepDefaultLex-3098"><span class="linenos">3098</span></a>  <span class="n">j</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&gt;OUS_&#39;</span><span class="p">),</span><span class="n">i</span><span class="p">)</span> <span class="c1"># start of lexicon (ditto)</span>
</span><span id="bbc_prepDefaultLex-3099"><a href="#bbc_prepDefaultLex-3099"><span class="linenos">3099</span></a>  <span class="k">assert</span> <span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">==</span><span class="mh">0x1683</span><span class="p">,</span> <span class="s2">&quot;Is this really an original disk image?&quot;</span>
</span><span id="bbc_prepDefaultLex-3100"><a href="#bbc_prepDefaultLex-3100"><span class="linenos">3100</span></a>  <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function set as lex_header in bbcmicro format.  If SPEECH_DISK and MAKE_SPEECH_ROM is set, then read the ROM code from SPEECH_DISK and write to outFile (meant to go before the lexicon, to make a modified BBC Micro Speech ROM with custom lexicon)</p>
</div>


                </section>
                <section id="bbc_appendDefaultLex">
                            <input id="bbc_appendDefaultLex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bbc_appendDefaultLex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">outFile</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bbc_appendDefaultLex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bbc_appendDefaultLex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bbc_appendDefaultLex-3101"><a href="#bbc_appendDefaultLex-3101"><span class="linenos">3101</span></a><span class="k">def</span> <span class="nf">bbc_appendDefaultLex</span><span class="p">(</span><span class="n">outFile</span><span class="p">):</span>
</span><span id="bbc_appendDefaultLex-3102"><a href="#bbc_appendDefaultLex-3102"><span class="linenos">3102</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Special-case function set as lex_footer in bbcmicro format.  If SPEECH_DISK is set, read Speech&#39;s default lexicon from it and append this to outFile.  Otherwise just write a terminating &gt;** to outFile.  In either case, check for exceeding 16k if we&#39;re MAKE_SPEECH_ROM, close the file and call print_bbclex_instructions.&quot;&quot;&quot;</span>
</span><span id="bbc_appendDefaultLex-3103"><a href="#bbc_appendDefaultLex-3103"><span class="linenos">3103</span></a>  <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SPEECH_DISK&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
</span><span id="bbc_appendDefaultLex-3104"><a href="#bbc_appendDefaultLex-3104"><span class="linenos">3104</span></a>     <span class="n">sd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s1">&#39;SPEECH_DISK&#39;</span><span class="p">],</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="bbc_appendDefaultLex-3105"><a href="#bbc_appendDefaultLex-3105"><span class="linenos">3105</span></a>     <span class="n">d</span><span class="o">=</span><span class="n">getBuf</span><span class="p">(</span><span class="n">sd</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="bbc_appendDefaultLex-3106"><a href="#bbc_appendDefaultLex-3106"><span class="linenos">3106</span></a>     <span class="n">i</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&gt;OUS_&#39;</span><span class="p">))</span> <span class="c1"># if this fails, it wasn&#39;t a Speech disk</span>
</span><span id="bbc_appendDefaultLex-3107"><a href="#bbc_appendDefaultLex-3107"><span class="linenos">3107</span></a>     <span class="n">j</span><span class="o">=</span><span class="n">d</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&gt;**&quot;</span><span class="p">),</span><span class="n">i</span><span class="p">)</span>
</span><span id="bbc_appendDefaultLex-3108"><a href="#bbc_appendDefaultLex-3108"><span class="linenos">3108</span></a>     <span class="k">assert</span> <span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="o">==</span><span class="mi">2201</span><span class="p">,</span> <span class="s2">&quot;Lexicon on SPEECH_DISK is wrong size (</span><span class="si">%d</span><span class="s2">). Is this really an original disk image?&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">j</span><span class="o">-</span><span class="n">i</span><span class="p">)</span>
</span><span id="bbc_appendDefaultLex-3109"><a href="#bbc_appendDefaultLex-3109"><span class="linenos">3109</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">outFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">d</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">j</span><span class="p">])</span>
</span><span id="bbc_appendDefaultLex-3110"><a href="#bbc_appendDefaultLex-3110"><span class="linenos">3110</span></a>     <span class="c1"># TODO: can we compress the BBC lexicon?  i.e. detect if a rule will happen anyway due to subsequent wildcard rules, and delete it if so (don&#39;t know how many bytes that would save)</span>
</span><span id="bbc_appendDefaultLex-3111"><a href="#bbc_appendDefaultLex-3111"><span class="linenos">3111</span></a>  <span class="n">outFile</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&gt;**&quot;</span><span class="p">)</span>
</span><span id="bbc_appendDefaultLex-3112"><a href="#bbc_appendDefaultLex-3112"><span class="linenos">3112</span></a>  <span class="n">fileLen</span> <span class="o">=</span> <span class="n">outFile</span><span class="o">.</span><span class="n">tell</span><span class="p">()</span>
</span><span id="bbc_appendDefaultLex-3113"><a href="#bbc_appendDefaultLex-3113"><span class="linenos">3113</span></a>  <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="n">fileLen</span> <span class="o">&lt;=</span> <span class="mi">16384</span><span class="p">,</span> <span class="s2">&quot;Speech ROM file got too big (</span><span class="si">%d</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="n">fileLen</span>
</span><span id="bbc_appendDefaultLex-3114"><a href="#bbc_appendDefaultLex-3114"><span class="linenos">3114</span></a>  <span class="n">outFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="bbc_appendDefaultLex-3115"><a href="#bbc_appendDefaultLex-3115"><span class="linenos">3115</span></a>  <span class="n">print_bbclex_instructions</span><span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="s2">&quot;bbcmicro&quot;</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">),</span><span class="n">fileLen</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Special-case function set as lex_footer in bbcmicro format.  If SPEECH_DISK is set, read Speech's default lexicon from it and append this to outFile.  Otherwise just write a terminating &gt;** to outFile.  In either case, check for exceeding 16k if we're MAKE_SPEECH_ROM, close the file and call print_bbclex_instructions.</p>
</div>


                </section>
                <section id="bbcshortest">
                            <input id="bbcshortest-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bbcshortest</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">n</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bbcshortest-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bbcshortest"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bbcshortest-3117"><a href="#bbcshortest-3117"><span class="linenos">3117</span></a><span class="k">def</span> <span class="nf">bbcshortest</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
</span><span id="bbcshortest-3118"><a href="#bbcshortest-3118"><span class="linenos">3118</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Convert integer n into the shortest possible number of BBC Micro keystrokes; prefer hex if and only if the extra &#39;&amp;&#39; keystroke won&#39;t make it any longer than its decimal equivalent&quot;&quot;&quot;</span>
</span><span id="bbcshortest-3119"><a href="#bbcshortest-3119"><span class="linenos">3119</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">))</span>
</span><span id="bbcshortest-3120"><a href="#bbcshortest-3120"><span class="linenos">3120</span></a>  <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&amp;</span><span class="si">%X</span><span class="s1">&#39;</span><span class="o">%</span><span class="n">n</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Convert integer n into the shortest possible number of BBC Micro keystrokes; prefer hex if and only if the extra '&amp;' keystroke won't make it any longer than its decimal equivalent</p>
</div>


                </section>
                <section id="bbcKeystrokes">
                            <input id="bbcKeystrokes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">bbcKeystrokes</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">data</span>, </span><span class="param"><span class="n">start</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="bbcKeystrokes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#bbcKeystrokes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="bbcKeystrokes-3121"><a href="#bbcKeystrokes-3121"><span class="linenos">3121</span></a><span class="k">def</span> <span class="nf">bbcKeystrokes</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">start</span><span class="p">):</span>
</span><span id="bbcKeystrokes-3122"><a href="#bbcKeystrokes-3122"><span class="linenos">3122</span></a>  <span class="s2">&quot;Return BBC BASIC keystrokes to put data into RAM starting at address start, without using the BASIC heap in the process (although we do use one of the page-4 integer variables to save some keystrokes).  Assumes the data is mostly ASCII so the $ operator is the least-keystrokes method of getting it in (rather than ? and ! operators, assembler EQUB/EQUW/EQUS, 6502 mnemonics, etc); we don&#39;t mind about overwriting the byte after with a CHR$(13).  Keystrokes are limited to ASCII for easier copy/paste.  See comments for more details.&quot;</span>
</span><span id="bbcKeystrokes-3123"><a href="#bbcKeystrokes-3123"><span class="linenos">3123</span></a>  <span class="c1"># Taken to the extreme, a &#39;find the least keystrokes&#39; function would be some kind of data compressor; we&#39;re not doing that here as we assume this is going to be used to poke in a lexicon, which is basically ASCII with a few CHR$(128)s thrown in; this &#39;$ operator&#39; method is highly likely to yield the least keystrokes for that kind of data, apart from setting and using temporary string variables, but then (1) you&#39;re in the realms of data compression and (2) you require heap memory, which might not be a good idea depending on where we&#39;re putting our lexicon.</span>
</span><span id="bbcKeystrokes-3124"><a href="#bbcKeystrokes-3124"><span class="linenos">3124</span></a>  <span class="c1"># I suppose it wouldn&#39;t hurt in most cases to have an A$=CHR$(128), but not doing this for now because you might be in a situation where you can&#39;t touch the heap at all (I&#39;m not sure where the workspace for assembling strings is though).</span>
</span><span id="bbcKeystrokes-3125"><a href="#bbcKeystrokes-3125"><span class="linenos">3125</span></a>  <span class="c1"># However, just to be pedantic about saving a few bytes, there is one thing we CAN do: if we have a lexicon with a lot of CHR$(128)s in it, let&#39;s set up BASIC&#39;s page-4 integer variables such that $A%=CHR$(128), saving 6 keystrokes per entry without needing the heap (an additional 1 keystroke per entry could be saved if we didn&#39;t mind putting an A$ on the heap).</span>
</span><span id="bbcKeystrokes-3126"><a href="#bbcKeystrokes-3126"><span class="linenos">3126</span></a>  <span class="n">use_int_hack</span> <span class="o">=</span> <span class="p">((</span><span class="n">start</span><span class="o">&gt;=</span><span class="mi">1030</span> <span class="ow">or</span> <span class="n">start</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">&lt;=</span><span class="mi">1026</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">128</span><span class="p">)))</span> <span class="o">&gt;=</span> <span class="mi">4</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3127"><a href="#bbcKeystrokes-3127"><span class="linenos">3127</span></a>  <span class="n">i</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">ret</span><span class="o">=</span><span class="p">[]</span>
</span><span id="bbcKeystrokes-3128"><a href="#bbcKeystrokes-3128"><span class="linenos">3128</span></a>  <span class="k">if</span> <span class="n">use_int_hack</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;A%=&amp;408:B%=&amp;D80:&quot;</span><span class="p">)</span> <span class="c1"># (@% is at &amp;400 and each is 4 byte LSB-MSB; $x reads to next 0D)</span>
</span><span id="bbcKeystrokes-3129"><a href="#bbcKeystrokes-3129"><span class="linenos">3129</span></a>  <span class="c1"># (If we&#39;re guaranteed to NOT be using Bas128 and therefore all memory addresses are effectively masked by &amp;FFFF, we can instead set A%=&amp;D800406 (using A%&#39;s low 2 bytes to point to A%&#39;s high 2 bytes) for a 1-off saving of 5 keystrokes and 1 page-4 variable, but this saving is not really worth the readability compromise and the risk posed by the possibility of Bas128 - I don&#39;t know how Bas128 treats addresses above &amp;1FFFF)</span>
</span><span id="bbcKeystrokes-3130"><a href="#bbcKeystrokes-3130"><span class="linenos">3130</span></a>  <span class="c1"># (An even &#39;nastier&#39; trick would be to put !13=&amp;D80 and then use $13, as those bytes are used by BASIC&#39;s random number generator, which presumably isn&#39;t called during the paste and we don&#39;t mind disrupting it; again I don&#39;t know about Bas128.  But you can&#39;t do it because BASIC gives a &quot;$ range&quot; error on anything below 256.)</span>
</span><span id="bbcKeystrokes-3131"><a href="#bbcKeystrokes-3131"><span class="linenos">3131</span></a>  <span class="c1"># (I suppose one thing you _could_ do is LOMEM=&amp;400:A$=CHR$(13) and end with LOMEM=TOP, which would overwrite 3 page-4 variables and let you use just A$ instead of $A%, saving keystrokes over A%=&amp;D800406 after 21 more lexicon words, at the expense of losing track of any variables you had on the heap.  But this is getting silly.)</span>
</span><span id="bbcKeystrokes-3132"><a href="#bbcKeystrokes-3132"><span class="linenos">3132</span></a>  <span class="k">else</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3133"><a href="#bbcKeystrokes-3133"><span class="linenos">3133</span></a>  <span class="n">bbc_max_line_len</span> <span class="o">=</span> <span class="mi">238</span>
</span><span id="bbcKeystrokes-3134"><a href="#bbcKeystrokes-3134"><span class="linenos">3134</span></a>  <span class="n">inQuote</span><span class="o">=</span><span class="n">needPlus</span><span class="o">=</span><span class="mi">0</span> <span class="p">;</span> <span class="n">needCmd</span><span class="o">=</span><span class="mi">1</span>
</span><span id="bbcKeystrokes-3135"><a href="#bbcKeystrokes-3135"><span class="linenos">3135</span></a>  <span class="k">while</span> <span class="n">i</span><span class="o">&lt;</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
</span><span id="bbcKeystrokes-3136"><a href="#bbcKeystrokes-3136"><span class="linenos">3136</span></a>    <span class="k">if</span> <span class="n">needCmd</span><span class="p">:</span>
</span><span id="bbcKeystrokes-3137"><a href="#bbcKeystrokes-3137"><span class="linenos">3137</span></a>       <span class="n">thisLine</span> <span class="o">+=</span> <span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;$&#39;</span><span class="p">)</span><span class="o">+</span><span class="n">bbcshortest</span><span class="p">(</span><span class="n">start</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;=&#39;</span><span class="p">))</span>
</span><span id="bbcKeystrokes-3138"><a href="#bbcKeystrokes-3138"><span class="linenos">3138</span></a>       <span class="n">inQuote</span><span class="o">=</span><span class="n">needPlus</span><span class="o">=</span><span class="n">needCmd</span><span class="o">=</span><span class="mi">0</span>
</span><span id="bbcKeystrokes-3139"><a href="#bbcKeystrokes-3139"><span class="linenos">3139</span></a>    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">):</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span> <span class="o">=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&quot;&#39;</span><span class="p">),</span><span class="mi">1</span> <span class="c1"># inQ MUST be 0 or 1, not False/True, because it&#39;s also used as &#39;len of necessary close quote&#39; below</span>
</span><span id="bbcKeystrokes-3140"><a href="#bbcKeystrokes-3140"><span class="linenos">3140</span></a>    <span class="k">elif</span> <span class="mi">32</span><span class="o">&lt;=</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">127</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span><span class="mi">1</span>
</span><span id="bbcKeystrokes-3141"><a href="#bbcKeystrokes-3141"><span class="linenos">3141</span></a>    <span class="k">elif</span> <span class="n">use_int_hack</span> <span class="ow">and</span> <span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="mi">128</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;$A%&quot;</span><span class="p">),</span><span class="mi">0</span>
</span><span id="bbcKeystrokes-3142"><a href="#bbcKeystrokes-3142"><span class="linenos">3142</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">c</span><span class="p">,</span><span class="n">inQ</span><span class="o">=</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;CHR$(&quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)),</span><span class="mi">0</span>
</span><span id="bbcKeystrokes-3143"><a href="#bbcKeystrokes-3143"><span class="linenos">3143</span></a>    <span class="n">addToLine</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">newNeedPlus</span> <span class="o">=</span> <span class="n">needPlus</span>
</span><span id="bbcKeystrokes-3144"><a href="#bbcKeystrokes-3144"><span class="linenos">3144</span></a>    <span class="k">if</span> <span class="n">inQ</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inQuote</span><span class="p">:</span>
</span><span id="bbcKeystrokes-3145"><a href="#bbcKeystrokes-3145"><span class="linenos">3145</span></a>       <span class="k">if</span> <span class="n">needPlus</span><span class="p">:</span> <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
</span><span id="bbcKeystrokes-3146"><a href="#bbcKeystrokes-3146"><span class="linenos">3146</span></a>       <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">))</span>
</span><span id="bbcKeystrokes-3147"><a href="#bbcKeystrokes-3147"><span class="linenos">3147</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">0</span>
</span><span id="bbcKeystrokes-3148"><a href="#bbcKeystrokes-3148"><span class="linenos">3148</span></a>    <span class="k">elif</span> <span class="n">inQuote</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">inQ</span><span class="p">:</span>
</span><span id="bbcKeystrokes-3149"><a href="#bbcKeystrokes-3149"><span class="linenos">3149</span></a>       <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;+&#39;</span><span class="p">))</span>
</span><span id="bbcKeystrokes-3150"><a href="#bbcKeystrokes-3150"><span class="linenos">3150</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># after what we&#39;ll add</span>
</span><span id="bbcKeystrokes-3151"><a href="#bbcKeystrokes-3151"><span class="linenos">3151</span></a>    <span class="k">elif</span> <span class="ow">not</span> <span class="n">inQ</span><span class="p">:</span>
</span><span id="bbcKeystrokes-3152"><a href="#bbcKeystrokes-3152"><span class="linenos">3152</span></a>       <span class="k">if</span> <span class="n">needPlus</span><span class="p">:</span> <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;+&#39;</span><span class="p">))</span>
</span><span id="bbcKeystrokes-3153"><a href="#bbcKeystrokes-3153"><span class="linenos">3153</span></a>       <span class="n">newNeedPlus</span><span class="o">=</span><span class="mi">1</span> <span class="c1"># after what we&#39;ll add</span>
</span><span id="bbcKeystrokes-3154"><a href="#bbcKeystrokes-3154"><span class="linenos">3154</span></a>    <span class="n">addToLine</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3155"><a href="#bbcKeystrokes-3155"><span class="linenos">3155</span></a>    <span class="n">addToLine</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">addToLine</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3156"><a href="#bbcKeystrokes-3156"><span class="linenos">3156</span></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">addToLine</span><span class="p">)</span><span class="o">+</span><span class="n">inQ</span> <span class="o">&gt;</span> <span class="n">bbc_max_line_len</span><span class="p">:</span> <span class="c1"># oops, we&#39;ve gone too far, back off and end prev line</span>
</span><span id="bbcKeystrokes-3157"><a href="#bbcKeystrokes-3157"><span class="linenos">3157</span></a>       <span class="k">if</span> <span class="n">inQuote</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3158"><a href="#bbcKeystrokes-3158"><span class="linenos">3158</span></a>       <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3159"><a href="#bbcKeystrokes-3159"><span class="linenos">3159</span></a>       <span class="n">thisLine</span><span class="o">=</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="n">needCmd</span><span class="o">=</span><span class="mi">1</span> <span class="p">;</span> <span class="k">continue</span>
</span><span id="bbcKeystrokes-3160"><a href="#bbcKeystrokes-3160"><span class="linenos">3160</span></a>    <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">addToLine</span> <span class="p">;</span> <span class="n">inQuote</span><span class="o">=</span><span class="n">inQ</span>
</span><span id="bbcKeystrokes-3161"><a href="#bbcKeystrokes-3161"><span class="linenos">3161</span></a>    <span class="n">needPlus</span><span class="o">=</span><span class="n">newNeedPlus</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span> <span class="p">;</span> <span class="n">start</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="bbcKeystrokes-3162"><a href="#bbcKeystrokes-3162"><span class="linenos">3162</span></a>  <span class="k">if</span> <span class="n">inQuote</span><span class="p">:</span> <span class="n">thisLine</span> <span class="o">+=</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;&quot;&#39;</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3163"><a href="#bbcKeystrokes-3163"><span class="linenos">3163</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">needCmd</span><span class="p">:</span> <span class="n">ret</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">thisLine</span><span class="p">)</span>
</span><span id="bbcKeystrokes-3164"><a href="#bbcKeystrokes-3164"><span class="linenos">3164</span></a>  <span class="k">return</span> <span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ret</span><span class="p">)</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return BBC BASIC keystrokes to put data into RAM starting at address start, without using the BASIC heap in the process (although we do use one of the page-4 integer variables to save some keystrokes).  Assumes the data is mostly ASCII so the $ operator is the least-keystrokes method of getting it in (rather than ? and ! operators, assembler EQUB/EQUW/EQUS, 6502 mnemonics, etc); we don't mind about overwriting the byte after with a CHR$(13).  Keystrokes are limited to ASCII for easier copy/paste.  See comments for more details.</p>
</div>


                </section>
                <section id="print_bbclex_instructions">
                            <input id="print_bbclex_instructions-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">print_bbclex_instructions</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">fname</span>, </span><span class="param"><span class="n">size</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="print_bbclex_instructions-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#print_bbclex_instructions"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="print_bbclex_instructions-3165"><a href="#print_bbclex_instructions-3165"><span class="linenos">3165</span></a><span class="k">def</span> <span class="nf">print_bbclex_instructions</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">size</span><span class="p">):</span>
</span><span id="print_bbclex_instructions-3166"><a href="#print_bbclex_instructions-3166"><span class="linenos">3166</span></a><span class="w"> </span><span class="sd">&quot;&quot;&quot;Print suitable instructions for a BBC Micro lexicon of the given filename and size (the exact nature of the instructions depends on the size).  If appropriate, create a .key file containing keystrokes for transferring to an emulator.&quot;&quot;&quot;</span>
</span><span id="print_bbclex_instructions-3167"><a href="#print_bbclex_instructions-3167"><span class="linenos">3167</span></a> <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;MAKE_SPEECH_ROM&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> (</span><span class="si">%d</span><span class="s2"> bytes, hex </span><span class="si">%X</span><span class="s2">) can now installed on an emulator (set in Roms.cfg or whatever), or loaded onto a chip.  The sound quality of this might be worse than that of the main-RAM version.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">))</span> <span class="c1"># (at least on emulation - see comment on sound quality above)</span>
</span><span id="print_bbclex_instructions-3168"><a href="#print_bbclex_instructions-3168"><span class="linenos">3168</span></a> <span class="k">else</span><span class="p">:</span>
</span><span id="print_bbclex_instructions-3169"><a href="#print_bbclex_instructions-3169"><span class="linenos">3169</span></a>  <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;The size of this lexicon is </span><span class="si">%d</span><span class="s2"> bytes (hex </span><span class="si">%X</span><span class="s2">)&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">size</span><span class="p">,</span><span class="n">size</span><span class="p">))</span> <span class="c1"># (the default lexicon is 2204 bytes)</span>
</span><span id="print_bbclex_instructions-3170"><a href="#print_bbclex_instructions-3170"><span class="linenos">3170</span></a>  <span class="n">bbcStart</span><span class="o">=</span><span class="kc">None</span>
</span><span id="print_bbclex_instructions-3171"><a href="#print_bbclex_instructions-3171"><span class="linenos">3171</span></a>  <span class="n">noSRAM_lex_offset</span><span class="o">=</span><span class="mh">0x155F</span> <span class="c1"># (on the BBC Micro, SRAM means Sideways RAM, not Static RAM as it does elsewhere; for clarity we&#39;d better say &quot;Sideways RAM&quot; in all output)</span>
</span><span id="print_bbclex_instructions-3172"><a href="#print_bbclex_instructions-3172"><span class="linenos">3172</span></a>  <span class="n">SRAM_lex_offset</span><span class="o">=</span><span class="mh">0x1683</span>
</span><span id="print_bbclex_instructions-3173"><a href="#print_bbclex_instructions-3173"><span class="linenos">3173</span></a>  <span class="n">SRAM_max</span><span class="o">=</span><span class="mh">0x4000</span> <span class="c1"># 16k</span>
</span><span id="print_bbclex_instructions-3174"><a href="#print_bbclex_instructions-3174"><span class="linenos">3174</span></a>  <span class="n">noSRAM_default_addr</span><span class="o">=</span><span class="mh">0x5500</span>
</span><span id="print_bbclex_instructions-3175"><a href="#print_bbclex_instructions-3175"><span class="linenos">3175</span></a>  <span class="n">noSRAM_min_addr</span><span class="o">=</span><span class="mh">0xE00</span> <span class="c1"># minimum supported by RELOCAT</span>
</span><span id="print_bbclex_instructions-3176"><a href="#print_bbclex_instructions-3176"><span class="linenos">3176</span></a>  <span class="n">page</span><span class="o">=</span><span class="mh">0x1900</span> <span class="c1"># or 0xE00 for Master (but OK to just leave this at 0x1900 regardless of model; it harmlessly increases the range where special_relocate_instructions &#39;kick in&#39;)</span>
</span><span id="print_bbclex_instructions-3177"><a href="#print_bbclex_instructions-3177"><span class="linenos">3177</span></a>  <span class="n">noSRAM_himem</span><span class="o">=</span><span class="mh">0x7c00</span> <span class="c1"># unless you&#39;re in a shadow mode or something (see comments on himem above), however leaving this at 0x7c00 is usually harmless (just causes the &#39;need to relocate&#39; to &#39;kick in&#39; earlier, although if memory is really full it might say &#39;too big&#39; 1k too early)</span>
</span><span id="print_bbclex_instructions-3178"><a href="#print_bbclex_instructions-3178"><span class="linenos">3178</span></a>  <span class="k">def</span> <span class="nf">special_relocate_instructions</span><span class="p">(</span><span class="n">reloc_addr</span><span class="p">):</span>
</span><span id="print_bbclex_instructions-3179"><a href="#print_bbclex_instructions-3179"><span class="linenos">3179</span></a>    <span class="n">pagemove_min</span><span class="p">,</span><span class="n">pagemove_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mh">0xE00</span><span class="p">,</span><span class="n">page</span><span class="o">-</span><span class="mh">0x1E00</span><span class="p">),</span> <span class="n">page</span><span class="o">+</span><span class="mh">0xE00</span> <span class="c1"># if relocating to within this range, must move PAGE before loading RELOCAT. RELOCAT&#39;s supported range is 0xE00 to 0x5E00, omitting (PAGE-&amp;1E00) to (PAGE+&amp;E00)</span>
</span><span id="print_bbclex_instructions-3180"><a href="#print_bbclex_instructions-3180"><span class="linenos">3180</span></a>    <span class="k">if</span> <span class="n">reloc_addr</span> <span class="o">&lt;</span> <span class="mh">0x1900</span><span class="p">:</span> <span class="n">extra</span><span class="o">=</span><span class="s2">&quot; On a Model B with Acorn DFS you won&#39;t be able to use the disk after relocating below &amp;1900, and you can&#39;t run star commands from tape so you have to initialise via CALL. (On a Master, DFS is not affected as it doesn&#39;t use &amp;E00-&amp;1900.)&quot;</span>
</span><span id="print_bbclex_instructions-3181"><a href="#print_bbclex_instructions-3181"><span class="linenos">3181</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">extra</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="print_bbclex_instructions-3182"><a href="#print_bbclex_instructions-3182"><span class="linenos">3182</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">pagemove_min</span><span class="o">&lt;=</span><span class="n">reloc_addr</span><span class="o">&lt;</span><span class="n">pagemove_max</span><span class="p">:</span>
</span><span id="print_bbclex_instructions-3183"><a href="#print_bbclex_instructions-3183"><span class="linenos">3183</span></a>      <span class="k">return</span> <span class="n">extra</span> <span class="c1"># no other special instructions needed</span>
</span><span id="print_bbclex_instructions-3184"><a href="#print_bbclex_instructions-3184"><span class="linenos">3184</span></a>    <span class="n">newpage</span> <span class="o">=</span> <span class="n">reloc_addr</span><span class="o">+</span><span class="mh">0x1E00</span>
</span><span id="print_bbclex_instructions-3185"><a href="#print_bbclex_instructions-3185"><span class="linenos">3185</span></a>    <span class="n">page_max</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="mh">0x5E00</span><span class="p">,</span><span class="n">noSRAM_default_addr</span><span class="o">-</span><span class="mh">0xE00</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3186"><a href="#print_bbclex_instructions-3186"><span class="linenos">3186</span></a>    <span class="k">if</span> <span class="n">newpage</span> <span class="o">&gt;</span> <span class="n">page_max</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span> <span class="c1"># &quot;Unfortunately RELOCAT can&#39;t put it at &amp;%X even with PAGE changes.&quot; % reloc_addr</span>
</span><span id="print_bbclex_instructions-3187"><a href="#print_bbclex_instructions-3187"><span class="linenos">3187</span></a>    <span class="k">return</span> <span class="s2">&quot; Please run RELOCAT with PAGE in the range of &amp;</span><span class="si">%X</span><span class="s2"> to &amp;</span><span class="si">%X</span><span class="s2"> for this relocation to work.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">newpage</span><span class="p">,</span><span class="n">page_max</span><span class="p">,</span><span class="n">extra</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3188"><a href="#print_bbclex_instructions-3188"><span class="linenos">3188</span></a>  <span class="k">if</span> <span class="n">noSRAM_default_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span><span class="o">+</span><span class="n">size</span> <span class="o">&gt;</span> <span class="n">noSRAM_himem</span><span class="p">:</span>
</span><span id="print_bbclex_instructions-3189"><a href="#print_bbclex_instructions-3189"><span class="linenos">3189</span></a>    <span class="n">reloc_addr</span> <span class="o">=</span> <span class="n">noSRAM_himem</span><span class="o">-</span><span class="n">noSRAM_lex_offset</span><span class="o">-</span><span class="n">size</span>
</span><span id="print_bbclex_instructions-3190"><a href="#print_bbclex_instructions-3190"><span class="linenos">3190</span></a>    <span class="n">reloc_addr</span> <span class="o">-=</span> <span class="p">(</span><span class="n">reloc_addr</span><span class="o">%</span><span class="mi">256</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3191"><a href="#print_bbclex_instructions-3191"><span class="linenos">3191</span></a>    <span class="k">if</span> <span class="n">reloc_addr</span> <span class="o">&gt;=</span> <span class="n">noSRAM_min_addr</span><span class="p">:</span>
</span><span id="print_bbclex_instructions-3192"><a href="#print_bbclex_instructions-3192"><span class="linenos">3192</span></a>      <span class="n">instr</span> <span class="o">=</span> <span class="n">special_relocate_instructions</span><span class="p">(</span><span class="n">reloc_addr</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3193"><a href="#print_bbclex_instructions-3193"><span class="linenos">3193</span></a>      <span class="k">if</span> <span class="n">instr</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in main RAM even with relocation, unless RELOCAT is rewritten to work from files.&quot;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3194"><a href="#print_bbclex_instructions-3194"><span class="linenos">3194</span></a>      <span class="k">else</span><span class="p">:</span>
</span><span id="print_bbclex_instructions-3195"><a href="#print_bbclex_instructions-3195"><span class="linenos">3195</span></a>        <span class="n">bbcStart</span> <span class="o">=</span> <span class="n">reloc_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span>
</span><span id="print_bbclex_instructions-3196"><a href="#print_bbclex_instructions-3196"><span class="linenos">3196</span></a>        <span class="n">reloc_call</span> <span class="o">=</span> <span class="n">reloc_addr</span> <span class="o">+</span> <span class="mh">0xB00</span>
</span><span id="print_bbclex_instructions-3197"><a href="#print_bbclex_instructions-3197"><span class="linenos">3197</span></a>        <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech at its default address of &amp;</span><span class="si">%X</span><span class="s2">, but you could use RELOCAT to put a version at &amp;</span><span class="si">%X</span><span class="s2"> and then initialise it with CALL </span><span class="si">%s</span><span class="s2"> (or do the suggested *SAVE, reset, and run *SP). Be sure to set HIMEM=&amp;</span><span class="si">%X</span><span class="s2">. Then *LOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> or change the relocated SP file from offset &amp;</span><span class="si">%X</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">noSRAM_default_addr</span><span class="p">,</span><span class="n">reloc_addr</span><span class="p">,</span><span class="n">bbcshortest</span><span class="p">(</span><span class="n">reloc_call</span><span class="p">),</span><span class="n">reloc_addr</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">noSRAM_lex_offset</span><span class="p">,</span><span class="n">instr</span><span class="p">))</span>
</span><span id="print_bbclex_instructions-3198"><a href="#print_bbclex_instructions-3198"><span class="linenos">3198</span></a>    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in main RAM even with relocation.&quot;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3199"><a href="#print_bbclex_instructions-3199"><span class="linenos">3199</span></a>  <span class="k">else</span><span class="p">:</span> <span class="c1"># fits at default location - no relocation needed</span>
</span><span id="print_bbclex_instructions-3200"><a href="#print_bbclex_instructions-3200"><span class="linenos">3200</span></a>    <span class="n">bbcStart</span> <span class="o">=</span> <span class="n">noSRAM_default_addr</span><span class="o">+</span><span class="n">noSRAM_lex_offset</span>
</span><span id="print_bbclex_instructions-3201"><a href="#print_bbclex_instructions-3201"><span class="linenos">3201</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can load this lexicon by *LOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> or change the SPEECH file from offset &amp;</span><span class="si">%X</span><span class="s2">. Suggest you also set HIMEM=&amp;</span><span class="si">%X</span><span class="s2"> for safety.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">noSRAM_lex_offset</span><span class="p">,</span><span class="n">noSRAM_default_addr</span><span class="p">))</span>
</span><span id="print_bbclex_instructions-3202"><a href="#print_bbclex_instructions-3202"><span class="linenos">3202</span></a>  <span class="k">if</span> <span class="n">bbcStart</span><span class="p">:</span> <span class="c1"># we managed to fit it into main RAM</span>
</span><span id="print_bbclex_instructions-3203"><a href="#print_bbclex_instructions-3203"><span class="linenos">3203</span></a>     <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3204"><a href="#print_bbclex_instructions-3204"><span class="linenos">3204</span></a>     <span class="n">keys</span> <span class="o">=</span> <span class="n">bbcKeystrokes</span><span class="p">(</span><span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(),</span><span class="n">bbcStart</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3205"><a href="#print_bbclex_instructions-3205"><span class="linenos">3205</span></a>     <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">fname</span><span class="o">+</span><span class="s2">&quot;.key&quot;</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3206"><a href="#print_bbclex_instructions-3206"><span class="linenos">3206</span></a>     <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3207"><a href="#print_bbclex_instructions-3207"><span class="linenos">3207</span></a>     <span class="k">del</span> <span class="n">f</span>
</span><span id="print_bbclex_instructions-3208"><a href="#print_bbclex_instructions-3208"><span class="linenos">3208</span></a>     <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;For ease of transfer to emulators etc, a self-contained keystroke file for putting </span><span class="si">%s</span><span class="s2"> data at &amp;</span><span class="si">%X</span><span class="s2"> has been written to </span><span class="si">%s</span><span class="s2">.key&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">bbcStart</span><span class="p">,</span><span class="n">fname</span><span class="p">))</span>
</span><span id="print_bbclex_instructions-3209"><a href="#print_bbclex_instructions-3209"><span class="linenos">3209</span></a>     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">keys</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">32767</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;(This file looks too big for BeebEm to paste though)&quot;</span><span class="p">)</span> <span class="c1"># see comments elsewhere</span>
</span><span id="print_bbclex_instructions-3210"><a href="#print_bbclex_instructions-3210"><span class="linenos">3210</span></a>  <span class="c1"># Instructions for replacing lex in SRAM:</span>
</span><span id="print_bbclex_instructions-3211"><a href="#print_bbclex_instructions-3211"><span class="linenos">3211</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="o">&gt;</span> <span class="n">SRAM_max</span><span class="o">-</span><span class="n">SRAM_lex_offset</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;This lexicon is too big for Speech in Sideways RAM.&quot;</span><span class="p">)</span> <span class="c1"># unless you can patch Speech to run in SRAM but read its lexicon from main RAM, or run in main RAM but page in multiple banks of SRAM for the lexicon (but even then there&#39;ll be a limit)</span>
</span><span id="print_bbclex_instructions-3212"><a href="#print_bbclex_instructions-3212"><span class="linenos">3212</span></a>  <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can load this lexicon into Sideways RAM by *SRLOAD </span><span class="si">%s</span><span class="s2"> </span><span class="si">%X</span><span class="s2"> 7 (or whichever bank number you&#39;re using), or change the SP8000 file from offset &amp;</span><span class="si">%X</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">fname</span><span class="p">,</span><span class="n">SRAM_lex_offset</span><span class="o">+</span><span class="mh">0x8000</span><span class="p">,</span><span class="n">SRAM_lex_offset</span><span class="p">))</span>
</span><span id="print_bbclex_instructions-3213"><a href="#print_bbclex_instructions-3213"><span class="linenos">3213</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;SPEECH_DISK&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">):</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;If you want to append the default lexicon to this one, set SPEECH_DISK to the image of the original Speech disk before running lexconvert, e.g. export SPEECH_DISK=/usr/local/BeebEm3/diskimg/Speech.ssd&quot;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3214"><a href="#print_bbclex_instructions-3214"><span class="linenos">3214</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="o">&lt;=</span> <span class="n">SRAM_max</span><span class="o">-</span><span class="n">SRAM_lex_offset</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;You can also set MAKE_SPEECH_ROM=1 (along with SPEECH_DISK) to create a SPEECH.ROM file instead&quot;</span><span class="p">)</span>
</span><span id="print_bbclex_instructions-3215"><a href="#print_bbclex_instructions-3215"><span class="linenos">3215</span></a> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;If you get &#39;Mistake in speech&#39; when testing some words, try starting with &#39;*SAY, &#39; (this seems to be a Speech bug)&quot;</span><span class="p">)</span> <span class="c1"># - can&#39;t track down which words it does and doesn&#39;t apply to</span>
</span><span id="print_bbclex_instructions-3216"><a href="#print_bbclex_instructions-3216"><span class="linenos">3216</span></a> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;It might be better to load your lexicon into eSpeak and use lexconvert&#39;s --phones option to drive the BBC with phonemes.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Print suitable instructions for a BBC Micro lexicon of the given filename and size (the exact nature of the instructions depends on the size).  If appropriate, create a .key file containing keystrokes for transferring to an emulator.</p>
</div>


                </section>
                <section id="mainopt_version">
                            <input id="mainopt_version-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mainopt_version</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">i</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="mainopt_version-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#mainopt_version"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="mainopt_version-3218"><a href="#mainopt_version-3218"><span class="linenos">3218</span></a><span class="k">def</span> <span class="nf">mainopt_version</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
</span><span id="mainopt_version-3219"><a href="#mainopt_version-3219"><span class="linenos">3219</span></a>   <span class="c1"># TODO: doc string for the help? (or would this option clutter it needlessly) - just print lexconvert&#39;s version number and nothing else</span>
</span><span id="mainopt_version-3220"><a href="#mainopt_version-3220"><span class="linenos">3220</span></a>   <span class="nb">print</span> <span class="p">(</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; - &quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
</span></pre></div>


    

                </section>
                <section id="main">
                            <input id="main-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">main</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="main-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#main"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="main-3222"><a href="#main-3222"><span class="linenos">3222</span></a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
</span><span id="main-3223"><a href="#main-3223"><span class="linenos">3223</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Introspect the module to find the mainopt_ functions, and either call one of them or print the help.  Returns the error code to send back to the OS.&quot;&quot;&quot;</span>
</span><span id="main-3224"><a href="#main-3224"><span class="linenos">3224</span></a>    <span class="k">def</span> <span class="nf">funcToOpt</span><span class="p">(</span><span class="n">n</span><span class="p">):</span> <span class="k">return</span> <span class="s2">&quot;--&quot;</span><span class="o">+</span><span class="n">n</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
</span><span id="main-3225"><a href="#main-3225"><span class="linenos">3225</span></a>    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="main-3226"><a href="#main-3226"><span class="linenos">3226</span></a>        <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;mainopt_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">funcToOpt</span><span class="p">(</span><span class="n">k</span><span class="p">)</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span>
</span><span id="main-3227"><a href="#main-3227"><span class="linenos">3227</span></a>           <span class="k">try</span><span class="p">:</span> <span class="n">msg</span> <span class="o">=</span> <span class="n">v</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">funcToOpt</span><span class="p">(</span><span class="n">k</span><span class="p">)))</span>
</span><span id="main-3228"><a href="#main-3228"><span class="linenos">3228</span></a>           <span class="k">except</span> <span class="n">Message</span><span class="p">:</span>
</span><span id="main-3229"><a href="#main-3229"><span class="linenos">3229</span></a>              <span class="c1"># Python 2.6+ can have &quot;except Message as e&quot;,</span>
</span><span id="main-3230"><a href="#main-3230"><span class="linenos">3230</span></a>              <span class="c1"># but Python 2.5 has to have &quot;except Message,e&quot;</span>
</span><span id="main-3231"><a href="#main-3231"><span class="linenos">3231</span></a>              <span class="c1"># which is disallowed in Python 3, so</span>
</span><span id="main-3232"><a href="#main-3232"><span class="linenos">3232</span></a>              <span class="n">msg</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">message</span>
</span><span id="main-3233"><a href="#main-3233"><span class="linenos">3233</span></a>           <span class="k">if</span> <span class="n">msg</span><span class="p">:</span>
</span><span id="main-3234"><a href="#main-3234"><span class="linenos">3234</span></a>              <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span>
</span><span id="main-3235"><a href="#main-3235"><span class="linenos">3235</span></a>              <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">msg</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="p">;</span> <span class="k">return</span> <span class="mi">1</span>
</span><span id="main-3236"><a href="#main-3236"><span class="linenos">3236</span></a>           <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="mi">0</span>
</span><span id="main-3237"><a href="#main-3237"><span class="linenos">3237</span></a>    <span class="n">html</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;--htmlhelp&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">)</span> <span class="c1"># (undocumented option used for my website, don&#39;t rely on it staying)</span>
</span><span id="main-3238"><a href="#main-3238"><span class="linenos">3238</span></a>    <span class="k">def</span> <span class="nf">htmlify</span><span class="p">(</span><span class="n">h</span><span class="p">):</span> <span class="k">return</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s1">&#39;(--[2A-Za-z-]*)&#39;</span><span class="p">,</span><span class="sa">r</span><span class="s1">&#39;&lt;kbd&gt;\1&lt;/kbd&gt;&#39;</span><span class="p">,</span><span class="n">h</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&amp;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;amp;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&lt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;lt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;&gt;&#39;</span><span class="p">,</span><span class="s1">&#39;&amp;gt;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;br&gt;&#39;</span><span class="p">))</span>
</span><span id="main-3239"><a href="#main-3239"><span class="linenos">3239</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">html</span><span class="p">:</span> <span class="n">htmlify</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="n">x</span>
</span><span id="main-3240"><a href="#main-3240"><span class="linenos">3240</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">htmlify</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">))</span>
</span><span id="main-3241"><a href="#main-3241"><span class="linenos">3241</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="n">missALine</span> <span class="o">=</span> <span class="s2">&quot;&lt;p&gt;&quot;</span>
</span><span id="main-3242"><a href="#main-3242"><span class="linenos">3242</span></a>    <span class="k">else</span><span class="p">:</span> <span class="n">missALine</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
</span><span id="main-3243"><a href="#main-3243"><span class="linenos">3243</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="main-3244"><a href="#main-3244"><span class="linenos">3244</span></a>    <span class="k">if</span> <span class="s1">&#39;--formats&#39;</span> <span class="ow">in</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">:</span> <span class="c1"># non-HTML mode only (format descriptions are included in HTML anyway, and don&#39;t worry about the capability summary)</span>
</span><span id="main-3245"><a href="#main-3245"><span class="linenos">3245</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats (and support levels):&quot;</span><span class="p">)</span>
</span><span id="main-3246"><a href="#main-3246"><span class="linenos">3246</span></a>       <span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">;</span> <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="main-3247"><a href="#main-3247"><span class="linenos">3247</span></a>       <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span>
</span><span id="main-3248"><a href="#main-3248"><span class="linenos">3248</span></a>          <span class="n">types</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="main-3249"><a href="#main-3249"><span class="linenos">3249</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;example&quot;</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;phones&quot;</span><span class="p">)</span>
</span><span id="main-3250"><a href="#main-3250"><span class="linenos">3250</span></a>          <span class="k">if</span> <span class="n">k</span><span class="o">==</span><span class="s2">&quot;mac-uk&quot;</span><span class="p">:</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;speaking&quot;</span><span class="p">)</span>
</span><span id="main-3251"><a href="#main-3251"><span class="linenos">3251</span></a>          <span class="k">else</span><span class="p">:</span>
</span><span id="main-3252"><a href="#main-3252"><span class="linenos">3252</span></a>             <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_read_function&quot;</span><span class="p">):</span> <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lex-read&quot;</span><span class="p">)</span>
</span><span id="main-3253"><a href="#main-3253"><span class="linenos">3253</span></a>             <span class="k">if</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_filename&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_entry_format&quot;</span><span class="p">):</span>
</span><span id="main-3254"><a href="#main-3254"><span class="linenos">3254</span></a>                <span class="n">ltype</span> <span class="o">=</span> <span class="n">checkSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;lex_type&quot;</span><span class="p">)</span>
</span><span id="main-3255"><a href="#main-3255"><span class="linenos">3255</span></a>                <span class="k">if</span> <span class="n">ltype</span><span class="p">:</span> <span class="n">ltype</span><span class="o">=</span><span class="s2">&quot; as &quot;</span><span class="o">+</span><span class="n">ltype</span>
</span><span id="main-3256"><a href="#main-3256"><span class="linenos">3256</span></a>                <span class="n">types</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;lex-write&quot;</span><span class="o">+</span><span class="n">ltype</span><span class="p">)</span>
</span><span id="main-3257"><a href="#main-3257"><span class="linenos">3257</span></a>          <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s2">&quot; (&quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">types</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;)&quot;</span><span class="p">)</span>
</span><span id="main-3258"><a href="#main-3258"><span class="linenos">3258</span></a>          <span class="nb">print</span> <span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">))</span>
</span><span id="main-3259"><a href="#main-3259"><span class="linenos">3259</span></a>       <span class="k">return</span> <span class="mi">0</span>
</span><span id="main-3260"><a href="#main-3260"><span class="linenos">3260</span></a>    <span class="k">elif</span> <span class="n">html</span><span class="p">:</span>
</span><span id="main-3261"><a href="#main-3261"><span class="linenos">3261</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats:&quot;</span><span class="p">)</span>
</span><span id="main-3262"><a href="#main-3262"><span class="linenos">3262</span></a>       <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;&lt;table id=&quot;formats&quot;&gt;&#39;</span><span class="p">)</span>
</span><span id="main-3263"><a href="#main-3263"><span class="linenos">3263</span></a>       <span class="n">keys</span><span class="o">=</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span> <span class="p">;</span> <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
</span><span id="main-3264"><a href="#main-3264"><span class="linenos">3264</span></a>       <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">keys</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s1">&#39;&lt;tr&gt;&lt;td valign=&quot;top&quot;&gt;&lt;nobr&gt;&#39;</span><span class="o">+</span><span class="n">k</span><span class="o">+</span><span class="s1">&#39;&lt;/nobr&gt;&lt;/td&gt;&lt;td valign=&quot;top&quot;&gt;&#39;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">getSetting</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="s2">&quot;doc&quot;</span><span class="p">))</span><span class="o">+</span><span class="s2">&quot;&lt;/td&gt;&lt;/tr&gt;&quot;</span><span class="p">)</span>
</span><span id="main-3265"><a href="#main-3265"><span class="linenos">3265</span></a>       <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;/table&gt;&lt;script&gt;&lt;!-- try to be more readable on some smartphones</span><span class="se">\n</span><span class="s2">if(((screen &amp;&amp; screen.width&lt;600) || navigator.userAgent.slice(-6)==</span><span class="se">\&quot;</span><span class="s2">Gecko/</span><span class="se">\&quot;</span><span class="s2"> /* UC Browser? */) &amp;&amp; document.getElementById &amp;&amp; document.getElementById(&#39;formats&#39;).outerHTML) document.getElementById(&#39;formats&#39;).outerHTML = document.getElementById(&#39;formats&#39;).outerHTML.replace(/&lt;table/g,&#39;&lt;dl&#39;).replace(/&lt;.table/g,&#39;&lt;&#39;+&#39;/dl&#39;).replace(/&lt;tr&gt;&lt;td/g,&#39;&lt;dt&#39;).replace(/&lt;.td&gt;&lt;td/g,&#39;&lt;&#39;+&#39;/dt&gt;&lt;dd&#39;).replace(/&lt;.td&gt;&lt;.tr/g,&#39;&lt;&#39;+&#39;/dd&#39;);</span><span class="se">\n</span><span class="s2">//--&gt;&lt;/script&gt;&quot;</span><span class="p">)</span>
</span><span id="main-3266"><a href="#main-3266"><span class="linenos">3266</span></a>    <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Available pronunciation formats: &quot;</span><span class="o">+</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">lexFormats</span><span class="o">.</span><span class="n">keys</span><span class="p">())))</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">(Use --formats to see their descriptions)&quot;</span><span class="p">)</span>
</span><span id="main-3267"><a href="#main-3267"><span class="linenos">3267</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="main-3268"><a href="#main-3268"><span class="linenos">3268</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;Program options:&quot;</span><span class="p">)</span>
</span><span id="main-3269"><a href="#main-3269"><span class="linenos">3269</span></a>    <span class="nb">print</span> <span class="p">(</span><span class="n">missALine</span><span class="p">)</span>
</span><span id="main-3270"><a href="#main-3270"><span class="linenos">3270</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;dl&gt;&quot;</span><span class="p">)</span>
</span><span id="main-3271"><a href="#main-3271"><span class="linenos">3271</span></a>    <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">opt</span><span class="p">,</span><span class="n">desc</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="ow">not</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">),</span><span class="n">k</span><span class="p">,</span><span class="n">v</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()]):</span>
</span><span id="main-3272"><a href="#main-3272"><span class="linenos">3272</span></a>       <span class="k">if</span> <span class="ow">not</span> <span class="n">opt</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;mainopt_&quot;</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="main-3273"><a href="#main-3273"><span class="linenos">3273</span></a>       <span class="n">opt</span> <span class="o">=</span> <span class="n">funcToOpt</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span>
</span><span id="main-3274"><a href="#main-3274"><span class="linenos">3274</span></a>       <span class="k">if</span> <span class="ow">not</span> <span class="n">desc</span><span class="p">:</span> <span class="k">continue</span> <span class="c1"># undocumented option</span>
</span><span id="main-3275"><a href="#main-3275"><span class="linenos">3275</span></a>       <span class="n">params</span><span class="p">,</span><span class="n">rest</span> <span class="o">=</span> <span class="n">desc</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="main-3276"><a href="#main-3276"><span class="linenos">3276</span></a>       <span class="k">if</span> <span class="n">params</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">):</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="main-3277"><a href="#main-3277"><span class="linenos">3277</span></a>       <span class="k">if</span> <span class="n">params</span><span class="p">:</span> <span class="n">opt</span> <span class="o">+=</span> <span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="n">params</span><span class="p">)</span>
</span><span id="main-3278"><a href="#main-3278"><span class="linenos">3278</span></a>       <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;dt&gt;&quot;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">opt</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/dt&gt;&lt;dd&gt;&quot;</span><span class="o">+</span><span class="n">htmlify</span><span class="p">(</span><span class="n">rest</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;&lt;/dd&gt;&quot;</span><span class="p">)</span>
</span><span id="main-3279"><a href="#main-3279"><span class="linenos">3279</span></a>       <span class="k">else</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="n">opt</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">rest</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="main-3280"><a href="#main-3280"><span class="linenos">3280</span></a>    <span class="k">if</span> <span class="n">html</span><span class="p">:</span> <span class="nb">print</span> <span class="p">(</span><span class="s2">&quot;&lt;/dl&gt;&quot;</span><span class="p">)</span>
</span><span id="main-3281"><a href="#main-3281"><span class="linenos">3281</span></a>    <span class="k">return</span> <span class="mi">0</span>
</span></pre></div>


            <div class="docstring"><p>Introspect the module to find the mainopt_ functions, and either call one of them or print the help.  Returns the error code to send back to the OS.</p>
</div>


                </section>
                <section id="catchSignals">
                            <input id="catchSignals-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">catchSignals</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="catchSignals-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#catchSignals"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="catchSignals-3284"><a href="#catchSignals-3284"><span class="linenos">3284</span></a><span class="k">def</span> <span class="nf">catchSignals</span><span class="p">():</span>
</span><span id="catchSignals-3285"><a href="#catchSignals-3285"><span class="linenos">3285</span></a>  <span class="s2">&quot;We had better try to catch all signals if using MacBritish_System_Lexicon so we can safely clean it up. We raise KeyboardInterrupt instead (need to catch this). Might not work with multithreaded code.&quot;</span>
</span><span id="catchSignals-3286"><a href="#catchSignals-3286"><span class="linenos">3286</span></a>  <span class="k">global</span> <span class="n">catchingSigs</span>
</span><span id="catchSignals-3287"><a href="#catchSignals-3287"><span class="linenos">3287</span></a>  <span class="k">if</span> <span class="n">catchingSigs</span><span class="p">:</span> <span class="k">return</span>
</span><span id="catchSignals-3288"><a href="#catchSignals-3288"><span class="linenos">3288</span></a>  <span class="n">catchingSigs</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="catchSignals-3289"><a href="#catchSignals-3289"><span class="linenos">3289</span></a>  <span class="kn">import</span> <span class="nn">signal</span>
</span><span id="catchSignals-3290"><a href="#catchSignals-3290"><span class="linenos">3290</span></a>  <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">sigNo</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
</span><span id="catchSignals-3291"><a href="#catchSignals-3291"><span class="linenos">3291</span></a>    <span class="k">global</span> <span class="n">inSigHandler</span>
</span><span id="catchSignals-3292"><a href="#catchSignals-3292"><span class="linenos">3292</span></a>    <span class="k">if</span> <span class="n">inSigHandler</span><span class="p">:</span> <span class="k">return</span>
</span><span id="catchSignals-3293"><a href="#catchSignals-3293"><span class="linenos">3293</span></a>    <span class="n">inSigHandler</span> <span class="o">=</span> <span class="kc">True</span>
</span><span id="catchSignals-3294"><a href="#catchSignals-3294"><span class="linenos">3294</span></a>    <span class="n">os</span><span class="o">.</span><span class="n">killpg</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getpgrp</span><span class="p">(),</span><span class="n">sigNo</span><span class="p">)</span>
</span><span id="catchSignals-3295"><a href="#catchSignals-3295"><span class="linenos">3295</span></a>    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Caught signal </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">sigNo</span><span class="p">)</span>
</span><span id="catchSignals-3296"><a href="#catchSignals-3296"><span class="linenos">3296</span></a>    <span class="k">raise</span> <span class="ne">KeyboardInterrupt</span>
</span><span id="catchSignals-3297"><a href="#catchSignals-3297"><span class="linenos">3297</span></a>  <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">xrange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">signal</span><span class="o">.</span><span class="n">NSIG</span><span class="p">):</span>
</span><span id="catchSignals-3298"><a href="#catchSignals-3298"><span class="linenos">3298</span></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">n</span> <span class="ow">in</span> <span class="p">[</span>
</span><span id="catchSignals-3299"><a href="#catchSignals-3299"><span class="linenos">3299</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGCHLD</span><span class="p">,</span> <span class="c1"># sent on subprocess completion</span>
</span><span id="catchSignals-3300"><a href="#catchSignals-3300"><span class="linenos">3300</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGTSTP</span><span class="p">,</span><span class="n">signal</span><span class="o">.</span><span class="n">SIGCONT</span><span class="p">,</span> <span class="c1"># Ctrl-Z / fg</span>
</span><span id="catchSignals-3301"><a href="#catchSignals-3301"><span class="linenos">3301</span></a>          <span class="n">signal</span><span class="o">.</span><span class="n">SIGWINCH</span><span class="p">,</span> <span class="c1"># window-size change</span>
</span><span id="catchSignals-3302"><a href="#catchSignals-3302"><span class="linenos">3302</span></a>    <span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">signal</span><span class="o">.</span><span class="n">getsignal</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">==</span><span class="n">signal</span><span class="o">.</span><span class="n">SIG_IGN</span><span class="p">:</span>
</span><span id="catchSignals-3303"><a href="#catchSignals-3303"><span class="linenos">3303</span></a>      <span class="k">try</span><span class="p">:</span> <span class="n">signal</span><span class="o">.</span><span class="n">signal</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">f</span><span class="p">)</span>
</span><span id="catchSignals-3304"><a href="#catchSignals-3304"><span class="linenos">3304</span></a>      <span class="k">except</span><span class="p">:</span> <span class="k">pass</span>
</span></pre></div>


            <div class="docstring"><p>We had better try to catch all signals if using MacBritish_System_Lexicon so we can safely clean it up. We raise KeyboardInterrupt instead (need to catch this). Might not work with multithreaded code.</p>
</div>


                </section>
                <section id="MacBritish_System_Lexicon">
                            <input id="MacBritish_System_Lexicon-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr class">
            
    <span class="def">class</span>
    <span class="name">MacBritish_System_Lexicon</span>:

                <label class="view-source-button" for="MacBritish_System_Lexicon-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon-3305"><a href="#MacBritish_System_Lexicon-3305"><span class="linenos">3305</span></a><span class="k">class</span> <span class="nc">MacBritish_System_Lexicon</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3306"><a href="#MacBritish_System_Lexicon-3306"><span class="linenos">3306</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Overwrites some of the pronunciations in the system</span>
</span><span id="MacBritish_System_Lexicon-3307"><a href="#MacBritish_System_Lexicon-3307"><span class="linenos">3307</span></a><span class="sd">    lexicon (after backing up the original).  Cannot</span>
</span><span id="MacBritish_System_Lexicon-3308"><a href="#MacBritish_System_Lexicon-3308"><span class="linenos">3308</span></a><span class="sd">    change the actual words in the system lexicon, so just</span>
</span><span id="MacBritish_System_Lexicon-3309"><a href="#MacBritish_System_Lexicon-3309"><span class="linenos">3309</span></a><span class="sd">    alters pronunciations of words you don&#39;t intend to use</span>
</span><span id="MacBritish_System_Lexicon-3310"><a href="#MacBritish_System_Lexicon-3310"><span class="linenos">3310</span></a><span class="sd">    so you can substitute these into your texts.</span>
</span><span id="MacBritish_System_Lexicon-3311"><a href="#MacBritish_System_Lexicon-3311"><span class="linenos">3311</span></a><span class="sd">    Restores the lexicon on close().&quot;&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon-3312"><a href="#MacBritish_System_Lexicon-3312"><span class="linenos">3312</span></a>    <span class="n">instances</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MacBritish_System_Lexicon-3313"><a href="#MacBritish_System_Lexicon-3313"><span class="linenos">3313</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">voice</span><span class="o">=</span><span class="s2">&quot;Daniel&quot;</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3314"><a href="#MacBritish_System_Lexicon-3314"><span class="linenos">3314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;text is the text you want to speak (so that any</span>
</span><span id="MacBritish_System_Lexicon-3315"><a href="#MacBritish_System_Lexicon-3315"><span class="linenos">3315</span></a><span class="sd">        words used in it that are not mentioned in your</span>
</span><span id="MacBritish_System_Lexicon-3316"><a href="#MacBritish_System_Lexicon-3316"><span class="linenos">3316</span></a><span class="sd">        lexicon are unchanged in the system lexicon);</span>
</span><span id="MacBritish_System_Lexicon-3317"><a href="#MacBritish_System_Lexicon-3317"><span class="linenos">3317</span></a><span class="sd">        text=&quot;&quot; means you just want to speak phonemes.</span>
</span><span id="MacBritish_System_Lexicon-3318"><a href="#MacBritish_System_Lexicon-3318"><span class="linenos">3318</span></a><span class="sd">        Special value of text=False means lexicon read only.</span>
</span><span id="MacBritish_System_Lexicon-3319"><a href="#MacBritish_System_Lexicon-3319"><span class="linenos">3319</span></a><span class="sd">        voice can be Daniel, Emily or Serena.&quot;&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon-3320"><a href="#MacBritish_System_Lexicon-3320"><span class="linenos">3320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MacBritish_System_Lexicon-3321"><a href="#MacBritish_System_Lexicon-3321"><span class="linenos">3321</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3322"><a href="#MacBritish_System_Lexicon-3322"><span class="linenos">3322</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span> <span class="s2">&quot;There is already another instance of MacBritish_System_Lexicon for the &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; voice&quot;</span>
</span><span id="MacBritish_System_Lexicon-3323"><a href="#MacBritish_System_Lexicon-3323"><span class="linenos">3323</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;lockfile -1 -r 10 /tmp/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span> <span class="c1"># in case some other process has it (note: if you run with python -O, this check won&#39;t happen!)</span>
</span><span id="MacBritish_System_Lexicon-3324"><a href="#MacBritish_System_Lexicon-3324"><span class="linenos">3324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="n">voice</span> <span class="c1"># (don&#39;t set this if text==False, since we won&#39;t need cleanup on __del__)</span>
</span><span id="MacBritish_System_Lexicon-3325"><a href="#MacBritish_System_Lexicon-3325"><span class="linenos">3325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.SpeechVoice/Contents/Resources/PCMWave&quot;</span>
</span><span id="MacBritish_System_Lexicon-3326"><a href="#MacBritish_System_Lexicon-3326"><span class="linenos">3326</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;Compact.SpeechVoice/Contents/Resources/PCMWave&quot;</span><span class="p">)),</span> <span class="s2">&quot;The only installation of &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; found on this system was the Compact one, which lexconvert does not yet support&quot;</span> <span class="c1"># TODO: could try self.wordIndexStart = findW(&quot;Abiquiu&quot;),self.phIndexStart = findW(&quot;&#39;@b.Ik.ju&quot;),self.wordIndexEnd = findW(&quot;www.youtube.com&quot;,1),self.phIndexEnd = findW(&quot;&#39;d^b.l.ju.&#39;d^b.l.ju.&#39;d^b.l.ju.dA+t.&#39;ju.&#39;tjub.dA+t.kA+m&quot;,1), but &quot;t&quot; in phones should be ignored, &quot;activesync&quot; and &quot;afterlife&quot; have no phones, &quot;aqua&quot; has TWO sets of phonemes (aquarium ok) and there are other synchronization issues.</span>
</span><span id="MacBritish_System_Lexicon-3327"><a href="#MacBritish_System_Lexicon-3327"><span class="linenos">3327</span></a>        <span class="c1"># TODO: some sync issues persist even on the NON-Compact version in newer versions of macOS (e.g. 10.12).  This currently leads to exceptions in findW on such systems (which do say it could be due to wrong version of the voice); fixing would need looking at more sync issues as above</span>
</span><span id="MacBritish_System_Lexicon-3328"><a href="#MacBritish_System_Lexicon-3328"><span class="linenos">3328</span></a>        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span><span class="s2">&quot;Cannot find an installation of &#39;&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;&#39; on this system&quot;</span>
</span><span id="MacBritish_System_Lexicon-3329"><a href="#MacBritish_System_Lexicon-3329"><span class="linenos">3329</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0&quot;</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3330"><a href="#MacBritish_System_Lexicon-3330"><span class="linenos">3330</span></a>            <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span> <span class="c1"># (use the backup file for read-only, if we created one before; this means we don&#39;t have to worry about locks)</span>
</span><span id="MacBritish_System_Lexicon-3331"><a href="#MacBritish_System_Lexicon-3331"><span class="linenos">3331</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># create a backup</span>
</span><span id="MacBritish_System_Lexicon-3332"><a href="#MacBritish_System_Lexicon-3332"><span class="linenos">3332</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Backing up &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (you&#39;ll need a password if you&#39;re not running as root)</span>
</span><span id="MacBritish_System_Lexicon-3333"><a href="#MacBritish_System_Lexicon-3333"><span class="linenos">3333</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo mv </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2">; sudo cp </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3334"><a href="#MacBritish_System_Lexicon-3334"><span class="linenos">3334</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating backup&quot;</span>
</span><span id="MacBritish_System_Lexicon-3335"><a href="#MacBritish_System_Lexicon-3335"><span class="linenos">3335</span></a>        <span class="n">lexFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;.lexdir&quot;</span>
</span><span id="MacBritish_System_Lexicon-3336"><a href="#MacBritish_System_Lexicon-3336"><span class="linenos">3336</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3337"><a href="#MacBritish_System_Lexicon-3337"><span class="linenos">3337</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Creating lexdir file...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3338"><a href="#MacBritish_System_Lexicon-3338"><span class="linenos">3338</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo touch </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> ; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3339"><a href="#MacBritish_System_Lexicon-3339"><span class="linenos">3339</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating lexdir&quot;</span>
</span><span id="MacBritish_System_Lexicon-3340"><a href="#MacBritish_System_Lexicon-3340"><span class="linenos">3340</span></a>        <span class="n">compat_err</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This probably means your Mac has a new version of the voice that is no longer compatible with this system-lexicon patch.&quot;</span>
</span><span id="MacBritish_System_Lexicon-3341"><a href="#MacBritish_System_Lexicon-3341"><span class="linenos">3341</span></a>        <span class="kn">import</span> <span class="nn">cPickle</span>
</span><span id="MacBritish_System_Lexicon-3342"><a href="#MacBritish_System_Lexicon-3342"><span class="linenos">3342</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3343"><a href="#MacBritish_System_Lexicon-3343"><span class="linenos">3343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3344"><a href="#MacBritish_System_Lexicon-3344"><span class="linenos">3344</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3345"><a href="#MacBritish_System_Lexicon-3345"><span class="linenos">3345</span></a>            <span class="n">dat</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3346"><a href="#MacBritish_System_Lexicon-3346"><span class="linenos">3346</span></a>            <span class="k">def</span> <span class="nf">findW</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">rtnPastEnd</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3347"><a href="#MacBritish_System_Lexicon-3347"><span class="linenos">3347</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="n">dat</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3348"><a href="#MacBritish_System_Lexicon-3348"><span class="linenos">3348</span></a>                <span class="k">try</span><span class="p">:</span> <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3349"><a href="#MacBritish_System_Lexicon-3349"><span class="linenos">3349</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="s2">&quot; not found in voice file&quot;</span><span class="o">+</span><span class="n">compat_err</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3350"><a href="#MacBritish_System_Lexicon-3350"><span class="linenos">3350</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3351"><a href="#MacBritish_System_Lexicon-3351"><span class="linenos">3351</span></a>                    <span class="n">n2</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3352"><a href="#MacBritish_System_Lexicon-3352"><span class="linenos">3352</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not uniquely identify a byte position (has at least </span><span class="si">%d</span><span class="s2"> and </span><span class="si">%d</span><span class="s2">)</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">n2</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">compat_err</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3353"><a href="#MacBritish_System_Lexicon-3353"><span class="linenos">3353</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="MacBritish_System_Lexicon-3354"><a href="#MacBritish_System_Lexicon-3354"><span class="linenos">3354</span></a>                <span class="k">if</span> <span class="n">rtnPastEnd</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3355"><a href="#MacBritish_System_Lexicon-3355"><span class="linenos">3355</span></a>                <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3356"><a href="#MacBritish_System_Lexicon-3356"><span class="linenos">3356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;808s&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3357"><a href="#MacBritish_System_Lexicon-3357"><span class="linenos">3357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;e&amp;It.o&amp;U.e&amp;Its&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3358"><a href="#MacBritish_System_Lexicon-3358"><span class="linenos">3358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;zombie&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3359"><a href="#MacBritish_System_Lexicon-3359"><span class="linenos">3359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;zA+m.bI&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3360"><a href="#MacBritish_System_Lexicon-3360"><span class="linenos">3360</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3361"><a href="#MacBritish_System_Lexicon-3361"><span class="linenos">3361</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3362"><a href="#MacBritish_System_Lexicon-3362"><span class="linenos">3362</span></a>        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3363"><a href="#MacBritish_System_Lexicon-3363"><span class="linenos">3363</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">())</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; words but &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; phonemes&quot;</span><span class="o">+</span><span class="n">compat_err</span>
</span><span id="MacBritish_System_Lexicon-3364"><a href="#MacBritish_System_Lexicon-3364"><span class="linenos">3364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon-3365"><a href="#MacBritish_System_Lexicon-3365"><span class="linenos">3365</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="k">return</span>
</span><span id="MacBritish_System_Lexicon-3366"><a href="#MacBritish_System_Lexicon-3366"><span class="linenos">3366</span></a>        <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">voice</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="MacBritish_System_Lexicon-3367"><a href="#MacBritish_System_Lexicon-3367"><span class="linenos">3367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="mi">160</span><span class="p">),</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MacBritish_System_Lexicon-3368"><a href="#MacBritish_System_Lexicon-3368"><span class="linenos">3368</span></a>        <span class="n">catchSignals</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3369"><a href="#MacBritish_System_Lexicon-3369"><span class="linenos">3369</span></a>    <span class="k">def</span> <span class="nf">allWords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3370"><a href="#MacBritish_System_Lexicon-3370"><span class="linenos">3370</span></a>        <span class="s2">&quot;Returns a list of words that are defined in the system lexicon (which won&#39;t be changed, but see allPh)&quot;</span>
</span><span id="MacBritish_System_Lexicon-3371"><a href="#MacBritish_System_Lexicon-3371"><span class="linenos">3371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3372"><a href="#MacBritish_System_Lexicon-3372"><span class="linenos">3372</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
</span><span id="MacBritish_System_Lexicon-3373"><a href="#MacBritish_System_Lexicon-3373"><span class="linenos">3373</span></a>    <span class="k">def</span> <span class="nf">allPh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3374"><a href="#MacBritish_System_Lexicon-3374"><span class="linenos">3374</span></a>        <span class="s2">&quot;Returns a list of (file position, phoneme string) for each of the primary phoneme entries from the system lexicon.  These entries can be changed in-place by writing to the said file position, and then spoken by giving the voice the corresponding word from allWords (but see also usable_words).&quot;</span>
</span><span id="MacBritish_System_Lexicon-3375"><a href="#MacBritish_System_Lexicon-3375"><span class="linenos">3375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3376"><a href="#MacBritish_System_Lexicon-3376"><span class="linenos">3376</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3377"><a href="#MacBritish_System_Lexicon-3377"><span class="linenos">3377</span></a>            <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span>
</span><span id="MacBritish_System_Lexicon-3378"><a href="#MacBritish_System_Lexicon-3378"><span class="linenos">3378</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3379"><a href="#MacBritish_System_Lexicon-3379"><span class="linenos">3379</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;a&amp;I.&#39;fo&amp;Un&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;lI.@n&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;so&amp;Un.j$&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">last</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;tR+e&amp;I.si&quot;</span><span class="p">]):</span> <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="c1"># (the listed pronunciations are secondary ones that for some reason are in the list)</span>
</span><span id="MacBritish_System_Lexicon-3380"><a href="#MacBritish_System_Lexicon-3380"><span class="linenos">3380</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="n">last</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="MacBritish_System_Lexicon-3381"><a href="#MacBritish_System_Lexicon-3381"><span class="linenos">3381</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># +1 for the \x00</span>
</span><span id="MacBritish_System_Lexicon-3382"><a href="#MacBritish_System_Lexicon-3382"><span class="linenos">3382</span></a>            <span class="k">assert</span> <span class="n">pos</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 because the last \00 will result in a &quot;&quot; item after; the above +1 will be incorrect for that item</span>
</span><span id="MacBritish_System_Lexicon-3383"><a href="#MacBritish_System_Lexicon-3383"><span class="linenos">3383</span></a>            <span class="k">return</span> <span class="n">r</span>
</span><span id="MacBritish_System_Lexicon-3384"><a href="#MacBritish_System_Lexicon-3384"><span class="linenos">3384</span></a>        <span class="k">return</span> <span class="n">f</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))])</span>
</span><span id="MacBritish_System_Lexicon-3385"><a href="#MacBritish_System_Lexicon-3385"><span class="linenos">3385</span></a>    <span class="k">def</span> <span class="nf">usable_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words_ok_to_redefine</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="MacBritish_System_Lexicon-3386"><a href="#MacBritish_System_Lexicon-3386"><span class="linenos">3386</span></a>        <span class="s2">&quot;Returns a list of (word,phoneme_file_position,original_phonemes) by combining allWords with allPh, but omitting any words that don&#39;t seem &#39;usable&#39; (for example words that contain spaces, since these lexicon entries don&#39;t seem to be actually used by the voice).  Words that occur in self.textToAvoid are also considered non-usable, unless they also occur in words_ok_to_redefine (user lexicon).&quot;</span>
</span><span id="MacBritish_System_Lexicon-3387"><a href="#MacBritish_System_Lexicon-3387"><span class="linenos">3387</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()):</span>
</span><span id="MacBritish_System_Lexicon-3388"><a href="#MacBritish_System_Lexicon-3388"><span class="linenos">3388</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># it seems words not matching this regexp are NOT used by the engine</span>
</span><span id="MacBritish_System_Lexicon-3389"><a href="#MacBritish_System_Lexicon-3389"><span class="linenos">3389</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">phonemes</span> <span class="ow">and</span> <span class="mi">32</span><span class="o">&lt;</span><span class="nb">ord</span><span class="p">(</span><span class="n">phonemes</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">127</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># better not touch those, just in case</span>
</span><span id="MacBritish_System_Lexicon-3390"><a href="#MacBritish_System_Lexicon-3390"><span class="linenos">3390</span></a>            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_ok_to_redefine</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon-3391"><a href="#MacBritish_System_Lexicon-3391"><span class="linenos">3391</span></a>            <span class="k">yield</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span>
</span><span id="MacBritish_System_Lexicon-3392"><a href="#MacBritish_System_Lexicon-3392"><span class="linenos">3392</span></a>    <span class="k">def</span> <span class="nf">check_redef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wordsAndPhonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3393"><a href="#MacBritish_System_Lexicon-3393"><span class="linenos">3393</span></a>        <span class="s2">&quot;Diagnostic function to list on standard error the &#39;redefinitions&#39; we want to make.  wordsAndPhonemes is a list of (original system-lexicon word, proposed new phonemes).  The old phonemes are also listed, fetched from allPh.&quot;</span>
</span><span id="MacBritish_System_Lexicon-3394"><a href="#MacBritish_System_Lexicon-3394"><span class="linenos">3394</span></a>        <span class="n">aw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()</span> <span class="p">;</span> <span class="n">ap</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MacBritish_System_Lexicon-3395"><a href="#MacBritish_System_Lexicon-3395"><span class="linenos">3395</span></a>        <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">wordsAndPhonemes</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3396"><a href="#MacBritish_System_Lexicon-3396"><span class="linenos">3396</span></a>          <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3397"><a href="#MacBritish_System_Lexicon-3397"><span class="linenos">3397</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon-3398"><a href="#MacBritish_System_Lexicon-3398"><span class="linenos">3398</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">aw</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon-3399"><a href="#MacBritish_System_Lexicon-3399"><span class="linenos">3399</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3400"><a href="#MacBritish_System_Lexicon-3400"><span class="linenos">3400</span></a>            <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3401"><a href="#MacBritish_System_Lexicon-3401"><span class="linenos">3401</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning: some words were already in system lexicon</span><span class="se">\n</span><span class="s2">word</span><span class="se">\t</span><span class="s2">old</span><span class="se">\t</span><span class="s2">new</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3402"><a href="#MacBritish_System_Lexicon-3402"><span class="linenos">3402</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">ap</span><span class="p">[</span><span class="n">aw</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3403"><a href="#MacBritish_System_Lexicon-3403"><span class="linenos">3403</span></a>    <span class="k">def</span> <span class="nf">speakPhones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phonesList</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3404"><a href="#MacBritish_System_Lexicon-3404"><span class="linenos">3404</span></a>        <span class="s2">&quot;Speaks every phonetic word in phonesList&quot;</span>
</span><span id="MacBritish_System_Lexicon-3405"><a href="#MacBritish_System_Lexicon-3405"><span class="linenos">3405</span></a>        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;s&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phonesList</span><span class="p">))]</span>
</span><span id="MacBritish_System_Lexicon-3406"><a href="#MacBritish_System_Lexicon-3406"><span class="linenos">3406</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonesList</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3407"><a href="#MacBritish_System_Lexicon-3407"><span class="linenos">3407</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3408"><a href="#MacBritish_System_Lexicon-3408"><span class="linenos">3408</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3409"><a href="#MacBritish_System_Lexicon-3409"><span class="linenos">3409</span></a>    <span class="k">def</span> <span class="nf">readWithLex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lex</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3410"><a href="#MacBritish_System_Lexicon-3410"><span class="linenos">3410</span></a>        <span class="s2">&quot;Reads the text given in the constructor after setting up the lexicon with the given (word,phoneme) list&quot;</span>
</span><span id="MacBritish_System_Lexicon-3411"><a href="#MacBritish_System_Lexicon-3411"><span class="linenos">3411</span></a>        <span class="c1"># self.check_redef(lex) # uncomment if you want to know about these</span>
</span><span id="MacBritish_System_Lexicon-3412"><a href="#MacBritish_System_Lexicon-3412"><span class="linenos">3412</span></a>        <span class="n">textToPrint</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39; &#39;</span>
</span><span id="MacBritish_System_Lexicon-3413"><a href="#MacBritish_System_Lexicon-3413"><span class="linenos">3413</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2019</span><span class="s1">&#39;</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span> <span class="c1"># (ignore pronunciation marks 2032 and b7 that might be in the text, but still print them in textToPrint; also normalise apostrophes but not in textToPrint, and be careful with dashes as lex&#39;ing the word after a hyphen or em-dash won&#39;t work BUT we still want to support hyphenated words IN the lexicon, so em-dashes are replaced here and hyphens are included in nonWordBefore below)</span>
</span><span id="MacBritish_System_Lexicon-3414"><a href="#MacBritish_System_Lexicon-3414"><span class="linenos">3414</span></a>        <span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c1"># keep only the ones actually used in the text (no point setting whole lexicon)</span>
</span><span id="MacBritish_System_Lexicon-3415"><a href="#MacBritish_System_Lexicon-3415"><span class="linenos">3415</span></a>        <span class="n">nonWordBefore</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?i)(?&lt;=[^A-Za-z&quot;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-])&quot;</span> <span class="c1"># see below for why chr(0) is included, and see comment above for why hyphen is at the end; (?i) = ignore case</span>
</span><span id="MacBritish_System_Lexicon-3416"><a href="#MacBritish_System_Lexicon-3416"><span class="linenos">3416</span></a>        <span class="n">nonWordAfter</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?=([^A-Za-z&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-]|[&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;-][^A-Za-z]))&quot;</span> <span class="c1"># followed by non-letter non-apostrophe, or followed by apostrophe non-letter (so not if followed by &quot;&#39;s&quot;, because the voice won&#39;t use our custom lex entry if &quot;&#39;s&quot; is added to the lex&#39;d word, TODO: automatically add &quot;&#39;s&quot; versions to the lexicon via +s or +iz?) (also not if followed by hyphen-letters; hyphen before start is handled above, although TODO preceded by non-letter + hyphen might be OK)</span>
</span><span id="MacBritish_System_Lexicon-3417"><a href="#MacBritish_System_Lexicon-3417"><span class="linenos">3417</span></a>        <span class="n">ttal</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3418"><a href="#MacBritish_System_Lexicon-3418"><span class="linenos">3418</span></a>        <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">pp</span> <span class="ow">in</span> <span class="n">lex</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3419"><a href="#MacBritish_System_Lexicon-3419"><span class="linenos">3419</span></a>          <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># so you can add words with accents etc (in utf-8) to the lexicon</span>
</span><span id="MacBritish_System_Lexicon-3420"><a href="#MacBritish_System_Lexicon-3420"><span class="linenos">3420</span></a>          <span class="k">if</span> <span class="n">ww</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ttal</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="n">tta</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3421"><a href="#MacBritish_System_Lexicon-3421"><span class="linenos">3421</span></a>            <span class="n">words2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span> <span class="p">;</span> <span class="n">phonemes2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3422"><a href="#MacBritish_System_Lexicon-3422"><span class="linenos">3422</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
</span><span id="MacBritish_System_Lexicon-3423"><a href="#MacBritish_System_Lexicon-3423"><span class="linenos">3423</span></a>           <span class="n">tta</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">,</span><span class="n">tta</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3424"><a href="#MacBritish_System_Lexicon-3424"><span class="linenos">3424</span></a>           <span class="n">textToPrint</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;[</span><span class="se">\u2032\u00b4\u02b9\u00b7</span><span class="s1">]*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">textToPrint</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3425"><a href="#MacBritish_System_Lexicon-3425"><span class="linenos">3425</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3426"><a href="#MacBritish_System_Lexicon-3426"><span class="linenos">3426</span></a>        <span class="n">term</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TERM&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3427"><a href="#MacBritish_System_Lexicon-3427"><span class="linenos">3427</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;xterm&quot;</span> <span class="ow">in</span> <span class="n">term</span> <span class="ow">or</span> <span class="n">term</span><span class="o">==</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span> <span class="c1"># we can probably underline words (inverse is more widely supported than underline, e.g. should work even on an old Linux console in case someone&#39;s using that to control an OS X server, but there might be a *lot* of words, which wouldn&#39;t be very good in inverse if user needs dark background and inverse is bright.  Unlike Annogen, we&#39;re dealing primarily with Latin letters.)</span>
</span><span id="MacBritish_System_Lexicon-3428"><a href="#MacBritish_System_Lexicon-3428"><span class="linenos">3428</span></a>           <span class="kn">import</span> <span class="nn">textwrap</span>
</span><span id="MacBritish_System_Lexicon-3429"><a href="#MacBritish_System_Lexicon-3429"><span class="linenos">3429</span></a>           <span class="n">textwrap</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="c1"># a &#39;hack&#39; to make (at least the 2.x implementations of) textwrap ignore our chr(0) and chr(1) markers in their calculations.  Relies on textwrap calling len().</span>
</span><span id="MacBritish_System_Lexicon-3430"><a href="#MacBritish_System_Lexicon-3430"><span class="linenos">3430</span></a>           <span class="nb">print</span> <span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">textToPrint</span><span class="p">,</span><span class="n">stdout_width_unix</span><span class="p">(),</span><span class="n">break_on_hyphens</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[4m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="c1"># break_on_hyphens=False because we don&#39;t really want hyphenated NAMES to be split across lines, and anyway textwrap in (at least) Python 2.7 has a bug that sometimes causes a line breaks to be inserted before a syllable marker symbol like &#39;prime&#39;</span>
</span><span id="MacBritish_System_Lexicon-3431"><a href="#MacBritish_System_Lexicon-3431"><span class="linenos">3431</span></a>        <span class="c1"># else don&#39;t print anything (saves confusion)</span>
</span><span id="MacBritish_System_Lexicon-3432"><a href="#MacBritish_System_Lexicon-3432"><span class="linenos">3432</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3433"><a href="#MacBritish_System_Lexicon-3433"><span class="linenos">3433</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tta</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3434"><a href="#MacBritish_System_Lexicon-3434"><span class="linenos">3434</span></a>    <span class="k">def</span> <span class="nf">setMultiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3435"><a href="#MacBritish_System_Lexicon-3435"><span class="linenos">3435</span></a>        <span class="s2">&quot;Sets phonemes for words, returning dict of word to substitute word.  Flushes file buffer before return.&quot;</span>
</span><span id="MacBritish_System_Lexicon-3436"><a href="#MacBritish_System_Lexicon-3436"><span class="linenos">3436</span></a>        <span class="n">avail</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">needed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MacBritish_System_Lexicon-3437"><a href="#MacBritish_System_Lexicon-3437"><span class="linenos">3437</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usable_words</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3438"><a href="#MacBritish_System_Lexicon-3438"><span class="linenos">3438</span></a>            <span class="n">avail</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3439"><a href="#MacBritish_System_Lexicon-3439"><span class="linenos">3439</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3440"><a href="#MacBritish_System_Lexicon-3440"><span class="linenos">3440</span></a>            <span class="n">needed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon-3441"><a href="#MacBritish_System_Lexicon-3441"><span class="linenos">3441</span></a>        <span class="n">avail</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="p">;</span> <span class="n">needed</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># shortest phon first</span>
</span><span id="MacBritish_System_Lexicon-3442"><a href="#MacBritish_System_Lexicon-3442"><span class="linenos">3442</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">wDic</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">iDone</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span> <span class="p">;</span> <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MacBritish_System_Lexicon-3443"><a href="#MacBritish_System_Lexicon-3443"><span class="linenos">3443</span></a>        <span class="c1"># mustBeAlpha: prefer alphabetical words, since</span>
</span><span id="MacBritish_System_Lexicon-3444"><a href="#MacBritish_System_Lexicon-3444"><span class="linenos">3444</span></a>        <span class="c1"># these can be capitalised at start of sentence</span>
</span><span id="MacBritish_System_Lexicon-3445"><a href="#MacBritish_System_Lexicon-3445"><span class="linenos">3445</span></a>        <span class="c1"># (the prosody doesn&#39;t always work if it isn&#39;t)</span>
</span><span id="MacBritish_System_Lexicon-3446"><a href="#MacBritish_System_Lexicon-3446"><span class="linenos">3446</span></a>        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="n">needed</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3447"><a href="#MacBritish_System_Lexicon-3447"><span class="linenos">3447</span></a>            <span class="k">while</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mustBeAlpha</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;[A-Za-z]&quot;</span><span class="p">),</span><span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iDone</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3448"><a href="#MacBritish_System_Lexicon-3448"><span class="linenos">3448</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MacBritish_System_Lexicon-3449"><a href="#MacBritish_System_Lexicon-3449"><span class="linenos">3449</span></a>                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">avail</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3450"><a href="#MacBritish_System_Lexicon-3450"><span class="linenos">3450</span></a>                    <span class="k">if</span> <span class="n">mustBeAlpha</span><span class="p">:</span> <span class="c1"># desperate situation: we HAVE to use the non-alphabetical slots now (ideally we should pick words that never occur at start of sentence for them, but this branch is hopefully a rare situation in practice)</span>
</span><span id="MacBritish_System_Lexicon-3451"><a href="#MacBritish_System_Lexicon-3451"><span class="linenos">3451</span></a>                       <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">False</span> <span class="p">;</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon-3452"><a href="#MacBritish_System_Lexicon-3452"><span class="linenos">3452</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Could not find enough lexicon slots!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># TODO: we passed &#39;words&#39; to usable_words&#39;s words_ok_to_redefine - this might not be the case if we didn&#39;t find enough slots</span>
</span><span id="MacBritish_System_Lexicon-3453"><a href="#MacBritish_System_Lexicon-3453"><span class="linenos">3453</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span><span id="MacBritish_System_Lexicon-3454"><a href="#MacBritish_System_Lexicon-3454"><span class="linenos">3454</span></a>            <span class="n">iDone</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3455"><a href="#MacBritish_System_Lexicon-3455"><span class="linenos">3455</span></a>            <span class="n">_</span><span class="p">,</span><span class="n">wSubst</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">oldPhon</span> <span class="o">=</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MacBritish_System_Lexicon-3456"><a href="#MacBritish_System_Lexicon-3456"><span class="linenos">3456</span></a>            <span class="k">if</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">:</span> <span class="n">oldPhon</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># shouldn&#39;t happen if setMultiple is called only once, but might be useful for small experiments in the Python interpreter etc</span>
</span><span id="MacBritish_System_Lexicon-3457"><a href="#MacBritish_System_Lexicon-3457"><span class="linenos">3457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">,</span><span class="n">oldPhon</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3458"><a href="#MacBritish_System_Lexicon-3458"><span class="linenos">3458</span></a>            <span class="n">wDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">wSubst</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">wSubst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># always capitalise it so it can be used at start of sentence too (TODO: copy original capitalisation of each instance instead, in case it happens to come directly after a dotted abbreviation? although if it&#39;s something that&#39;s always capitalised anyway, e.g. most names, then this won&#39;t make any difference)</span>
</span><span id="MacBritish_System_Lexicon-3459"><a href="#MacBritish_System_Lexicon-3459"><span class="linenos">3459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span><span id="MacBritish_System_Lexicon-3460"><a href="#MacBritish_System_Lexicon-3460"><span class="linenos">3460</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3461"><a href="#MacBritish_System_Lexicon-3461"><span class="linenos">3461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets phonemes at position phPos to new value.</span>
</span><span id="MacBritish_System_Lexicon-3462"><a href="#MacBritish_System_Lexicon-3462"><span class="linenos">3462</span></a><span class="sd">        Caller should flush the file buffer when done.&quot;&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon-3463"><a href="#MacBritish_System_Lexicon-3463"><span class="linenos">3463</span></a>        <span class="c1"># print &quot;Debugger: setting %x to %s&quot; % (phPos,val)</span>
</span><span id="MacBritish_System_Lexicon-3464"><a href="#MacBritish_System_Lexicon-3464"><span class="linenos">3464</span></a>        <span class="k">if</span> <span class="n">old</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon-3465"><a href="#MacBritish_System_Lexicon-3465"><span class="linenos">3465</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Cannot call set() twice on same phoneme while re-specifying &#39;old&#39;&quot;</span>
</span><span id="MacBritish_System_Lexicon-3466"><a href="#MacBritish_System_Lexicon-3466"><span class="linenos">3466</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">),</span> <span class="s2">&quot;New phoneme is too long!&quot;</span>
</span><span id="MacBritish_System_Lexicon-3467"><a href="#MacBritish_System_Lexicon-3467"><span class="linenos">3467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">[</span><span class="n">phPos</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span>
</span><span id="MacBritish_System_Lexicon-3468"><a href="#MacBritish_System_Lexicon-3468"><span class="linenos">3468</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">assert</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Must specify old values (for restore) when setting for first time&quot;</span>
</span><span id="MacBritish_System_Lexicon-3469"><a href="#MacBritish_System_Lexicon-3469"><span class="linenos">3469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">phPos</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3470"><a href="#MacBritish_System_Lexicon-3470"><span class="linenos">3470</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</span><span id="MacBritish_System_Lexicon-3471"><a href="#MacBritish_System_Lexicon-3471"><span class="linenos">3471</span></a>    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3472"><a href="#MacBritish_System_Lexicon-3472"><span class="linenos">3472</span></a>        <span class="s2">&quot;WARNING - this might not be called before exit - best to call close() manually&quot;</span>
</span><span id="MacBritish_System_Lexicon-3473"><a href="#MacBritish_System_Lexicon-3473"><span class="linenos">3473</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="p">:</span> <span class="k">return</span>
</span><span id="MacBritish_System_Lexicon-3474"><a href="#MacBritish_System_Lexicon-3474"><span class="linenos">3474</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3475"><a href="#MacBritish_System_Lexicon-3475"><span class="linenos">3475</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon-3476"><a href="#MacBritish_System_Lexicon-3476"><span class="linenos">3476</span></a>        <span class="k">for</span> <span class="n">phPos</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MacBritish_System_Lexicon-3477"><a href="#MacBritish_System_Lexicon-3477"><span class="linenos">3477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3478"><a href="#MacBritish_System_Lexicon-3478"><span class="linenos">3478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon-3479"><a href="#MacBritish_System_Lexicon-3479"><span class="linenos">3479</span></a>        <span class="k">del</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="p">]</span>
</span><span id="MacBritish_System_Lexicon-3480"><a href="#MacBritish_System_Lexicon-3480"><span class="linenos">3480</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -f /tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon-3481"><a href="#MacBritish_System_Lexicon-3481"><span class="linenos">3481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">=</span><span class="kc">None</span>
</span></pre></div>


            <div class="docstring"><p>Overwrites some of the pronunciations in the system
lexicon (after backing up the original).  Cannot
change the actual words in the system lexicon, so just
alters pronunciations of words you don't intend to use
so you can substitute these into your texts.
Restores the lexicon on close().</p>
</div>


                            <div id="MacBritish_System_Lexicon.__init__" class="classattr">
                                        <input id="MacBritish_System_Lexicon.__init__-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="name">MacBritish_System_Lexicon</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span>, </span><span class="param"><span class="n">voice</span><span class="o">=</span><span class="s1">&#39;Daniel&#39;</span></span>)</span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.__init__-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.__init__"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.__init__-3313"><a href="#MacBritish_System_Lexicon.__init__-3313"><span class="linenos">3313</span></a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">voice</span><span class="o">=</span><span class="s2">&quot;Daniel&quot;</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.__init__-3314"><a href="#MacBritish_System_Lexicon.__init__-3314"><span class="linenos">3314</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;text is the text you want to speak (so that any</span>
</span><span id="MacBritish_System_Lexicon.__init__-3315"><a href="#MacBritish_System_Lexicon.__init__-3315"><span class="linenos">3315</span></a><span class="sd">        words used in it that are not mentioned in your</span>
</span><span id="MacBritish_System_Lexicon.__init__-3316"><a href="#MacBritish_System_Lexicon.__init__-3316"><span class="linenos">3316</span></a><span class="sd">        lexicon are unchanged in the system lexicon);</span>
</span><span id="MacBritish_System_Lexicon.__init__-3317"><a href="#MacBritish_System_Lexicon.__init__-3317"><span class="linenos">3317</span></a><span class="sd">        text=&quot;&quot; means you just want to speak phonemes.</span>
</span><span id="MacBritish_System_Lexicon.__init__-3318"><a href="#MacBritish_System_Lexicon.__init__-3318"><span class="linenos">3318</span></a><span class="sd">        Special value of text=False means lexicon read only.</span>
</span><span id="MacBritish_System_Lexicon.__init__-3319"><a href="#MacBritish_System_Lexicon.__init__-3319"><span class="linenos">3319</span></a><span class="sd">        voice can be Daniel, Emily or Serena.&quot;&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3320"><a href="#MacBritish_System_Lexicon.__init__-3320"><span class="linenos">3320</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="MacBritish_System_Lexicon.__init__-3321"><a href="#MacBritish_System_Lexicon.__init__-3321"><span class="linenos">3321</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.__init__-3322"><a href="#MacBritish_System_Lexicon.__init__-3322"><span class="linenos">3322</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">voice</span> <span class="ow">in</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">,</span> <span class="s2">&quot;There is already another instance of MacBritish_System_Lexicon for the &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; voice&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3323"><a href="#MacBritish_System_Lexicon.__init__-3323"><span class="linenos">3323</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;lockfile -1 -r 10 /tmp/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span> <span class="c1"># in case some other process has it (note: if you run with python -O, this check won&#39;t happen!)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3324"><a href="#MacBritish_System_Lexicon.__init__-3324"><span class="linenos">3324</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">voice</span> <span class="o">=</span> <span class="n">voice</span> <span class="c1"># (don&#39;t set this if text==False, since we won&#39;t need cleanup on __del__)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3325"><a href="#MacBritish_System_Lexicon.__init__-3325"><span class="linenos">3325</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.SpeechVoice/Contents/Resources/PCMWave&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3326"><a href="#MacBritish_System_Lexicon.__init__-3326"><span class="linenos">3326</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="p">(</span><span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&quot;/System/Library/Speech/Voices/&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;Compact.SpeechVoice/Contents/Resources/PCMWave&quot;</span><span class="p">)),</span> <span class="s2">&quot;The only installation of &quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot; found on this system was the Compact one, which lexconvert does not yet support&quot;</span> <span class="c1"># TODO: could try self.wordIndexStart = findW(&quot;Abiquiu&quot;),self.phIndexStart = findW(&quot;&#39;@b.Ik.ju&quot;),self.wordIndexEnd = findW(&quot;www.youtube.com&quot;,1),self.phIndexEnd = findW(&quot;&#39;d^b.l.ju.&#39;d^b.l.ju.&#39;d^b.l.ju.dA+t.&#39;ju.&#39;tjub.dA+t.kA+m&quot;,1), but &quot;t&quot; in phones should be ignored, &quot;activesync&quot; and &quot;afterlife&quot; have no phones, &quot;aqua&quot; has TWO sets of phonemes (aquarium ok) and there are other synchronization issues.</span>
</span><span id="MacBritish_System_Lexicon.__init__-3327"><a href="#MacBritish_System_Lexicon.__init__-3327"><span class="linenos">3327</span></a>        <span class="c1"># TODO: some sync issues persist even on the NON-Compact version in newer versions of macOS (e.g. 10.12).  This currently leads to exceptions in findW on such systems (which do say it could be due to wrong version of the voice); fixing would need looking at more sync issues as above</span>
</span><span id="MacBritish_System_Lexicon.__init__-3328"><a href="#MacBritish_System_Lexicon.__init__-3328"><span class="linenos">3328</span></a>        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">),</span><span class="s2">&quot;Cannot find an installation of &#39;&quot;</span><span class="o">+</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;&#39; on this system&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3329"><a href="#MacBritish_System_Lexicon.__init__-3329"><span class="linenos">3329</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0&quot;</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.__init__-3330"><a href="#MacBritish_System_Lexicon.__init__-3330"><span class="linenos">3330</span></a>            <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span> <span class="c1"># (use the backup file for read-only, if we created one before; this means we don&#39;t have to worry about locks)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3331"><a href="#MacBritish_System_Lexicon.__init__-3331"><span class="linenos">3331</span></a>        <span class="k">elif</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="c1"># create a backup</span>
</span><span id="MacBritish_System_Lexicon.__init__-3332"><a href="#MacBritish_System_Lexicon.__init__-3332"><span class="linenos">3332</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Backing up &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot; to &quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># (you&#39;ll need a password if you&#39;re not running as root)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3333"><a href="#MacBritish_System_Lexicon.__init__-3333"><span class="linenos">3333</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo mv </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2">; sudo cp </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;0</span><span class="se">\&quot;</span><span class="s2"> </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3334"><a href="#MacBritish_System_Lexicon.__init__-3334"><span class="linenos">3334</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating backup&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3335"><a href="#MacBritish_System_Lexicon.__init__-3335"><span class="linenos">3335</span></a>        <span class="n">lexFile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="o">+</span><span class="s2">&quot;.lexdir&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3336"><a href="#MacBritish_System_Lexicon.__init__-3336"><span class="linenos">3336</span></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.__init__-3337"><a href="#MacBritish_System_Lexicon.__init__-3337"><span class="linenos">3337</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Creating lexdir file...</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3338"><a href="#MacBritish_System_Lexicon.__init__-3338"><span class="linenos">3338</span></a>            <span class="n">err</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;sudo touch </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2"> ; sudo chown &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getuid</span><span class="p">())</span><span class="o">+</span><span class="s2">&quot; </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">lexFile</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3339"><a href="#MacBritish_System_Lexicon.__init__-3339"><span class="linenos">3339</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">err</span><span class="p">,</span> <span class="s2">&quot;Error creating lexdir&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3340"><a href="#MacBritish_System_Lexicon.__init__-3340"><span class="linenos">3340</span></a>        <span class="n">compat_err</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">This probably means your Mac has a new version of the voice that is no longer compatible with this system-lexicon patch.&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3341"><a href="#MacBritish_System_Lexicon.__init__-3341"><span class="linenos">3341</span></a>        <span class="kn">import</span> <span class="nn">cPickle</span>
</span><span id="MacBritish_System_Lexicon.__init__-3342"><a href="#MacBritish_System_Lexicon.__init__-3342"><span class="linenos">3342</span></a>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">stat</span><span class="p">(</span><span class="n">lexFile</span><span class="p">)</span><span class="o">.</span><span class="n">st_size</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3343"><a href="#MacBritish_System_Lexicon.__init__-3343"><span class="linenos">3343</span></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.__init__-3344"><a href="#MacBritish_System_Lexicon.__init__-3344"><span class="linenos">3344</span></a>            <span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3345"><a href="#MacBritish_System_Lexicon.__init__-3345"><span class="linenos">3345</span></a>            <span class="n">dat</span> <span class="o">=</span> <span class="n">getBuf</span><span class="p">(</span><span class="n">f</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3346"><a href="#MacBritish_System_Lexicon.__init__-3346"><span class="linenos">3346</span></a>            <span class="k">def</span> <span class="nf">findW</span><span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">rtnPastEnd</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.__init__-3347"><a href="#MacBritish_System_Lexicon.__init__-3347"><span class="linenos">3347</span></a>                <span class="n">i</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">finditer</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)),</span><span class="n">dat</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3348"><a href="#MacBritish_System_Lexicon.__init__-3348"><span class="linenos">3348</span></a>                <span class="k">try</span><span class="p">:</span> <span class="n">n</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3349"><a href="#MacBritish_System_Lexicon.__init__-3349"><span class="linenos">3349</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">word</span><span class="o">+</span><span class="s2">&quot; not found in voice file&quot;</span><span class="o">+</span><span class="n">compat_err</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3350"><a href="#MacBritish_System_Lexicon.__init__-3350"><span class="linenos">3350</span></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.__init__-3351"><a href="#MacBritish_System_Lexicon.__init__-3351"><span class="linenos">3351</span></a>                    <span class="n">n2</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">next</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3352"><a href="#MacBritish_System_Lexicon.__init__-3352"><span class="linenos">3352</span></a>                    <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> does not uniquely identify a byte position (has at least </span><span class="si">%d</span><span class="s2"> and </span><span class="si">%d</span><span class="s2">)</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span><span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">n2</span><span class="o">.</span><span class="n">start</span><span class="p">(),</span><span class="n">compat_err</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon.__init__-3353"><a href="#MacBritish_System_Lexicon.__init__-3353"><span class="linenos">3353</span></a>                <span class="k">except</span> <span class="ne">StopIteration</span><span class="p">:</span> <span class="k">pass</span>
</span><span id="MacBritish_System_Lexicon.__init__-3354"><a href="#MacBritish_System_Lexicon.__init__-3354"><span class="linenos">3354</span></a>                <span class="k">if</span> <span class="n">rtnPastEnd</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">end</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3355"><a href="#MacBritish_System_Lexicon.__init__-3355"><span class="linenos">3355</span></a>                <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.__init__-3356"><a href="#MacBritish_System_Lexicon.__init__-3356"><span class="linenos">3356</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;808s&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3357"><a href="#MacBritish_System_Lexicon.__init__-3357"><span class="linenos">3357</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;e&amp;It.o&amp;U.e&amp;Its&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3358"><a href="#MacBritish_System_Lexicon.__init__-3358"><span class="linenos">3358</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;zombie&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3359"><a href="#MacBritish_System_Lexicon.__init__-3359"><span class="linenos">3359</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span> <span class="o">=</span> <span class="n">findW</span><span class="p">(</span><span class="s2">&quot;&#39;zA+m.bI&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3360"><a href="#MacBritish_System_Lexicon.__init__-3360"><span class="linenos">3360</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="n">lexFile</span><span class="p">,</span><span class="s2">&quot;w&quot;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">dump</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon.__init__-3361"><a href="#MacBritish_System_Lexicon.__init__-3361"><span class="linenos">3361</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3362"><a href="#MacBritish_System_Lexicon.__init__-3362"><span class="linenos">3362</span></a>        <span class="k">else</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">filename</span><span class="p">,</span><span class="s1">&#39;r+&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.__init__-3363"><a href="#MacBritish_System_Lexicon.__init__-3363"><span class="linenos">3363</span></a>        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">())</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()),</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; words but &quot;</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()))</span><span class="o">+</span><span class="s2">&quot; phonemes&quot;</span><span class="o">+</span><span class="n">compat_err</span>
</span><span id="MacBritish_System_Lexicon.__init__-3364"><a href="#MacBritish_System_Lexicon.__init__-3364"><span class="linenos">3364</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon.__init__-3365"><a href="#MacBritish_System_Lexicon.__init__-3365"><span class="linenos">3365</span></a>        <span class="k">if</span> <span class="n">text</span><span class="o">==</span><span class="kc">False</span><span class="p">:</span> <span class="k">return</span>
</span><span id="MacBritish_System_Lexicon.__init__-3366"><a href="#MacBritish_System_Lexicon.__init__-3366"><span class="linenos">3366</span></a>        <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="n">voice</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>
</span><span id="MacBritish_System_Lexicon.__init__-3367"><a href="#MacBritish_System_Lexicon.__init__-3367"><span class="linenos">3367</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="o">=</span> <span class="n">text</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">unichr</span><span class="p">(</span><span class="mi">160</span><span class="p">),</span><span class="s1">&#39; &#39;</span><span class="p">)</span> <span class="p">;</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="MacBritish_System_Lexicon.__init__-3368"><a href="#MacBritish_System_Lexicon.__init__-3368"><span class="linenos">3368</span></a>        <span class="n">catchSignals</span><span class="p">()</span>
</span></pre></div>


            <div class="docstring"><p>text is the text you want to speak (so that any
words used in it that are not mentioned in your
lexicon are unchanged in the system lexicon);
text="" means you just want to speak phonemes.
Special value of text=False means lexicon read only.
voice can be Daniel, Emily or Serena.</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.instances" class="classattr">
                                <div class="attr variable">
            <span class="name">instances</span>        =
<span class="default_value">{}</span>

        
    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.instances"></a>
    
    

                            </div>
                            <div id="MacBritish_System_Lexicon.voice" class="classattr">
                                <div class="attr variable">
            <span class="name">voice</span>

        
    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.voice"></a>
    
    

                            </div>
                            <div id="MacBritish_System_Lexicon.filename" class="classattr">
                                <div class="attr variable">
            <span class="name">filename</span>

        
    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.filename"></a>
    
    

                            </div>
                            <div id="MacBritish_System_Lexicon.textToAvoid" class="classattr">
                                <div class="attr variable">
            <span class="name">textToAvoid</span>

        
    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.textToAvoid"></a>
    
    

                            </div>
                            <div id="MacBritish_System_Lexicon.restoreDic" class="classattr">
                                <div class="attr variable">
            <span class="name">restoreDic</span>

        
    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.restoreDic"></a>
    
    

                            </div>
                            <div id="MacBritish_System_Lexicon.allWords" class="classattr">
                                        <input id="MacBritish_System_Lexicon.allWords-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">allWords</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.allWords-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.allWords"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.allWords-3369"><a href="#MacBritish_System_Lexicon.allWords-3369"><span class="linenos">3369</span></a>    <span class="k">def</span> <span class="nf">allWords</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.allWords-3370"><a href="#MacBritish_System_Lexicon.allWords-3370"><span class="linenos">3370</span></a>        <span class="s2">&quot;Returns a list of words that are defined in the system lexicon (which won&#39;t be changed, but see allPh)&quot;</span>
</span><span id="MacBritish_System_Lexicon.allWords-3371"><a href="#MacBritish_System_Lexicon.allWords-3371"><span class="linenos">3371</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.allWords-3372"><a href="#MacBritish_System_Lexicon.allWords-3372"><span class="linenos">3372</span></a>        <span class="k">return</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">wordIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span> <span class="k">if</span> <span class="n">x</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of words that are defined in the system lexicon (which won't be changed, but see allPh)</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.allPh" class="classattr">
                                        <input id="MacBritish_System_Lexicon.allPh-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">allPh</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.allPh-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.allPh"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.allPh-3373"><a href="#MacBritish_System_Lexicon.allPh-3373"><span class="linenos">3373</span></a>    <span class="k">def</span> <span class="nf">allPh</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.allPh-3374"><a href="#MacBritish_System_Lexicon.allPh-3374"><span class="linenos">3374</span></a>        <span class="s2">&quot;Returns a list of (file position, phoneme string) for each of the primary phoneme entries from the system lexicon.  These entries can be changed in-place by writing to the said file position, and then spoken by giving the voice the corresponding word from allWords (but see also usable_words).&quot;</span>
</span><span id="MacBritish_System_Lexicon.allPh-3375"><a href="#MacBritish_System_Lexicon.allPh-3375"><span class="linenos">3375</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.allPh-3376"><a href="#MacBritish_System_Lexicon.allPh-3376"><span class="linenos">3376</span></a>        <span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">l</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.allPh-3377"><a href="#MacBritish_System_Lexicon.allPh-3377"><span class="linenos">3377</span></a>            <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span> <span class="p">;</span> <span class="n">r</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span>
</span><span id="MacBritish_System_Lexicon.allPh-3378"><a href="#MacBritish_System_Lexicon.allPh-3378"><span class="linenos">3378</span></a>            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">l</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.allPh-3379"><a href="#MacBritish_System_Lexicon.allPh-3379"><span class="linenos">3379</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;a&amp;I.&#39;fo&amp;Un&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;lI.@n&quot;</span><span class="p">,</span><span class="s2">&quot;&#39;so&amp;Un.j$&quot;</span><span class="p">]</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span><span class="n">i</span><span class="o">==</span><span class="n">last</span> <span class="ow">and</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;&#39;tR+e&amp;I.si&quot;</span><span class="p">]):</span> <span class="n">r</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">pos</span><span class="p">,</span><span class="n">i</span><span class="p">))</span> <span class="c1"># (the listed pronunciations are secondary ones that for some reason are in the list)</span>
</span><span id="MacBritish_System_Lexicon.allPh-3380"><a href="#MacBritish_System_Lexicon.allPh-3380"><span class="linenos">3380</span></a>                <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;[ -~]&#39;</span><span class="p">,</span><span class="n">i</span><span class="p">):</span> <span class="n">last</span> <span class="o">=</span> <span class="n">i</span>
</span><span id="MacBritish_System_Lexicon.allPh-3381"><a href="#MacBritish_System_Lexicon.allPh-3381"><span class="linenos">3381</span></a>                <span class="n">pos</span> <span class="o">+=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="c1"># +1 for the \x00</span>
</span><span id="MacBritish_System_Lexicon.allPh-3382"><a href="#MacBritish_System_Lexicon.allPh-3382"><span class="linenos">3382</span></a>            <span class="k">assert</span> <span class="n">pos</span><span class="o">==</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">+</span><span class="mi">1</span> <span class="c1"># +1 because the last \00 will result in a &quot;&quot; item after; the above +1 will be incorrect for that item</span>
</span><span id="MacBritish_System_Lexicon.allPh-3383"><a href="#MacBritish_System_Lexicon.allPh-3383"><span class="linenos">3383</span></a>            <span class="k">return</span> <span class="n">r</span>
</span><span id="MacBritish_System_Lexicon.allPh-3384"><a href="#MacBritish_System_Lexicon.allPh-3384"><span class="linenos">3384</span></a>        <span class="k">return</span> <span class="n">f</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexEnd</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">phIndexStart</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">))])</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of (file position, phoneme string) for each of the primary phoneme entries from the system lexicon.  These entries can be changed in-place by writing to the said file position, and then spoken by giving the voice the corresponding word from allWords (but see also usable_words).</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.usable_words" class="classattr">
                                        <input id="MacBritish_System_Lexicon.usable_words-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">usable_words</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">words_ok_to_redefine</span><span class="o">=</span><span class="p">[]</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.usable_words-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.usable_words"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.usable_words-3385"><a href="#MacBritish_System_Lexicon.usable_words-3385"><span class="linenos">3385</span></a>    <span class="k">def</span> <span class="nf">usable_words</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words_ok_to_redefine</span><span class="o">=</span><span class="p">[]):</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3386"><a href="#MacBritish_System_Lexicon.usable_words-3386"><span class="linenos">3386</span></a>        <span class="s2">&quot;Returns a list of (word,phoneme_file_position,original_phonemes) by combining allWords with allPh, but omitting any words that don&#39;t seem &#39;usable&#39; (for example words that contain spaces, since these lexicon entries don&#39;t seem to be actually used by the voice).  Words that occur in self.textToAvoid are also considered non-usable, unless they also occur in words_ok_to_redefine (user lexicon).&quot;</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3387"><a href="#MacBritish_System_Lexicon.usable_words-3387"><span class="linenos">3387</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,(</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">(),</span><span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()):</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3388"><a href="#MacBritish_System_Lexicon.usable_words-3388"><span class="linenos">3388</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">word</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># it seems words not matching this regexp are NOT used by the engine</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3389"><a href="#MacBritish_System_Lexicon.usable_words-3389"><span class="linenos">3389</span></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">phonemes</span> <span class="ow">and</span> <span class="mi">32</span><span class="o">&lt;</span><span class="nb">ord</span><span class="p">(</span><span class="n">phonemes</span><span class="p">[:</span><span class="mi">1</span><span class="p">])</span><span class="o">&lt;</span><span class="mi">127</span><span class="p">):</span> <span class="k">continue</span> <span class="c1"># better not touch those, just in case</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3390"><a href="#MacBritish_System_Lexicon.usable_words-3390"><span class="linenos">3390</span></a>            <span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">words_ok_to_redefine</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon.usable_words-3391"><a href="#MacBritish_System_Lexicon.usable_words-3391"><span class="linenos">3391</span></a>            <span class="k">yield</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phonemes</span>
</span></pre></div>


            <div class="docstring"><p>Returns a list of (word,phoneme_file_position,original_phonemes) by combining allWords with allPh, but omitting any words that don't seem 'usable' (for example words that contain spaces, since these lexicon entries don't seem to be actually used by the voice).  Words that occur in self.textToAvoid are also considered non-usable, unless they also occur in words_ok_to_redefine (user lexicon).</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.check_redef" class="classattr">
                                        <input id="MacBritish_System_Lexicon.check_redef-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">check_redef</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">wordsAndPhonemes</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.check_redef-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.check_redef"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.check_redef-3392"><a href="#MacBritish_System_Lexicon.check_redef-3392"><span class="linenos">3392</span></a>    <span class="k">def</span> <span class="nf">check_redef</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wordsAndPhonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3393"><a href="#MacBritish_System_Lexicon.check_redef-3393"><span class="linenos">3393</span></a>        <span class="s2">&quot;Diagnostic function to list on standard error the &#39;redefinitions&#39; we want to make.  wordsAndPhonemes is a list of (original system-lexicon word, proposed new phonemes).  The old phonemes are also listed, fetched from allPh.&quot;</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3394"><a href="#MacBritish_System_Lexicon.check_redef-3394"><span class="linenos">3394</span></a>        <span class="n">aw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allWords</span><span class="p">()</span> <span class="p">;</span> <span class="n">ap</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3395"><a href="#MacBritish_System_Lexicon.check_redef-3395"><span class="linenos">3395</span></a>        <span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">p</span> <span class="ow">in</span> <span class="n">wordsAndPhonemes</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3396"><a href="#MacBritish_System_Lexicon.check_redef-3396"><span class="linenos">3396</span></a>          <span class="n">w</span> <span class="o">=</span> <span class="n">w</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3397"><a href="#MacBritish_System_Lexicon.check_redef-3397"><span class="linenos">3397</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^[a-z0-9]*$&quot;</span><span class="p">,</span><span class="n">w</span><span class="p">):</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3398"><a href="#MacBritish_System_Lexicon.check_redef-3398"><span class="linenos">3398</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">aw</span><span class="p">:</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3399"><a href="#MacBritish_System_Lexicon.check_redef-3399"><span class="linenos">3399</span></a>          <span class="k">if</span> <span class="ow">not</span> <span class="n">ap</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3400"><a href="#MacBritish_System_Lexicon.check_redef-3400"><span class="linenos">3400</span></a>            <span class="n">ap</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">allPh</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3401"><a href="#MacBritish_System_Lexicon.check_redef-3401"><span class="linenos">3401</span></a>            <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Warning: some words were already in system lexicon</span><span class="se">\n</span><span class="s2">word</span><span class="se">\t</span><span class="s2">old</span><span class="se">\t</span><span class="s2">new</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.check_redef-3402"><a href="#MacBritish_System_Lexicon.check_redef-3402"><span class="linenos">3402</span></a>          <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">w</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">ap</span><span class="p">[</span><span class="n">aw</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">w</span><span class="p">)][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="o">+</span><span class="n">p</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Diagnostic function to list on standard error the 'redefinitions' we want to make.  wordsAndPhonemes is a list of (original system-lexicon word, proposed new phonemes).  The old phonemes are also listed, fetched from allPh.</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.speakPhones" class="classattr">
                                        <input id="MacBritish_System_Lexicon.speakPhones-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">speakPhones</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">phonesList</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.speakPhones-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.speakPhones"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.speakPhones-3403"><a href="#MacBritish_System_Lexicon.speakPhones-3403"><span class="linenos">3403</span></a>    <span class="k">def</span> <span class="nf">speakPhones</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phonesList</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.speakPhones-3404"><a href="#MacBritish_System_Lexicon.speakPhones-3404"><span class="linenos">3404</span></a>        <span class="s2">&quot;Speaks every phonetic word in phonesList&quot;</span>
</span><span id="MacBritish_System_Lexicon.speakPhones-3405"><a href="#MacBritish_System_Lexicon.speakPhones-3405"><span class="linenos">3405</span></a>        <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;s&quot;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">phonesList</span><span class="p">))]</span>
</span><span id="MacBritish_System_Lexicon.speakPhones-3406"><a href="#MacBritish_System_Lexicon.speakPhones-3406"><span class="linenos">3406</span></a>        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonesList</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.speakPhones-3407"><a href="#MacBritish_System_Lexicon.speakPhones-3407"><span class="linenos">3407</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.speakPhones-3408"><a href="#MacBritish_System_Lexicon.speakPhones-3408"><span class="linenos">3408</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">w</span><span class="p">,</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Speaks every phonetic word in phonesList</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.readWithLex" class="classattr">
                                        <input id="MacBritish_System_Lexicon.readWithLex-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">readWithLex</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">lex</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.readWithLex-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.readWithLex"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.readWithLex-3409"><a href="#MacBritish_System_Lexicon.readWithLex-3409"><span class="linenos">3409</span></a>    <span class="k">def</span> <span class="nf">readWithLex</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">lex</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3410"><a href="#MacBritish_System_Lexicon.readWithLex-3410"><span class="linenos">3410</span></a>        <span class="s2">&quot;Reads the text given in the constructor after setting up the lexicon with the given (word,phoneme) list&quot;</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3411"><a href="#MacBritish_System_Lexicon.readWithLex-3411"><span class="linenos">3411</span></a>        <span class="c1"># self.check_redef(lex) # uncomment if you want to know about these</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3412"><a href="#MacBritish_System_Lexicon.readWithLex-3412"><span class="linenos">3412</span></a>        <span class="n">textToPrint</span> <span class="o">=</span> <span class="sa">u</span><span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39; &#39;</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3413"><a href="#MacBritish_System_Lexicon.readWithLex-3413"><span class="linenos">3413</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="s1">&#39; &#39;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">textToAvoid</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2019</span><span class="s1">&#39;</span><span class="p">,</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2032</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b4</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u02b9</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u00b7</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39;&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\u2014</span><span class="s1">&#39;</span><span class="p">,</span><span class="s1">&#39; &#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39; &#39;</span> <span class="c1"># (ignore pronunciation marks 2032 and b7 that might be in the text, but still print them in textToPrint; also normalise apostrophes but not in textToPrint, and be careful with dashes as lex&#39;ing the word after a hyphen or em-dash won&#39;t work BUT we still want to support hyphenated words IN the lexicon, so em-dashes are replaced here and hyphens are included in nonWordBefore below)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3414"><a href="#MacBritish_System_Lexicon.readWithLex-3414"><span class="linenos">3414</span></a>        <span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span> <span class="o">=</span> <span class="p">[],[]</span> <span class="c1"># keep only the ones actually used in the text (no point setting whole lexicon)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3415"><a href="#MacBritish_System_Lexicon.readWithLex-3415"><span class="linenos">3415</span></a>        <span class="n">nonWordBefore</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?i)(?&lt;=[^A-Za-z&quot;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-])&quot;</span> <span class="c1"># see below for why chr(0) is included, and see comment above for why hyphen is at the end; (?i) = ignore case</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3416"><a href="#MacBritish_System_Lexicon.readWithLex-3416"><span class="linenos">3416</span></a>        <span class="n">nonWordAfter</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;(?=([^A-Za-z&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="s2">&quot;-]|[&#39;&quot;</span><span class="o">+</span><span class="n">unichr</span><span class="p">(</span><span class="mh">0x2019</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s2">&quot;-][^A-Za-z]))&quot;</span> <span class="c1"># followed by non-letter non-apostrophe, or followed by apostrophe non-letter (so not if followed by &quot;&#39;s&quot;, because the voice won&#39;t use our custom lex entry if &quot;&#39;s&quot; is added to the lex&#39;d word, TODO: automatically add &quot;&#39;s&quot; versions to the lexicon via +s or +iz?) (also not if followed by hyphen-letters; hyphen before start is handled above, although TODO preceded by non-letter + hyphen might be OK)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3417"><a href="#MacBritish_System_Lexicon.readWithLex-3417"><span class="linenos">3417</span></a>        <span class="n">ttal</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3418"><a href="#MacBritish_System_Lexicon.readWithLex-3418"><span class="linenos">3418</span></a>        <span class="k">for</span> <span class="n">ww</span><span class="p">,</span><span class="n">pp</span> <span class="ow">in</span> <span class="n">lex</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3419"><a href="#MacBritish_System_Lexicon.readWithLex-3419"><span class="linenos">3419</span></a>          <span class="n">ww</span> <span class="o">=</span> <span class="n">ww</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span> <span class="c1"># so you can add words with accents etc (in utf-8) to the lexicon</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3420"><a href="#MacBritish_System_Lexicon.readWithLex-3420"><span class="linenos">3420</span></a>          <span class="k">if</span> <span class="n">ww</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="n">ttal</span> <span class="ow">and</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="n">tta</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3421"><a href="#MacBritish_System_Lexicon.readWithLex-3421"><span class="linenos">3421</span></a>            <span class="n">words2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ww</span><span class="p">)</span> <span class="p">;</span> <span class="n">phonemes2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pp</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3422"><a href="#MacBritish_System_Lexicon.readWithLex-3422"><span class="linenos">3422</span></a>        <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">setMultiple</span><span class="p">(</span><span class="n">words2</span><span class="p">,</span><span class="n">phonemes2</span><span class="p">)</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3423"><a href="#MacBritish_System_Lexicon.readWithLex-3423"><span class="linenos">3423</span></a>           <span class="n">tta</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="n">v</span><span class="p">,</span><span class="n">tta</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3424"><a href="#MacBritish_System_Lexicon.readWithLex-3424"><span class="linenos">3424</span></a>           <span class="n">textToPrint</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="n">nonWordBefore</span><span class="o">+</span><span class="s1">&#39;(&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;[</span><span class="se">\u2032\u00b4\u02b9\u00b7</span><span class="s1">]*&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">k</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;)&#39;</span><span class="o">+</span><span class="n">nonWordAfter</span><span class="p">,</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">+</span><span class="sa">r</span><span class="s1">&#39;\1&#39;</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">textToPrint</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3425"><a href="#MacBritish_System_Lexicon.readWithLex-3425"><span class="linenos">3425</span></a>        <span class="n">tta</span> <span class="o">=</span> <span class="n">tta</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3426"><a href="#MacBritish_System_Lexicon.readWithLex-3426"><span class="linenos">3426</span></a>        <span class="n">term</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;TERM&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3427"><a href="#MacBritish_System_Lexicon.readWithLex-3427"><span class="linenos">3427</span></a>        <span class="k">if</span> <span class="p">(</span><span class="s2">&quot;xterm&quot;</span> <span class="ow">in</span> <span class="n">term</span> <span class="ow">or</span> <span class="n">term</span><span class="o">==</span><span class="s2">&quot;screen&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">sys</span><span class="o">.</span><span class="n">stdout</span><span class="o">.</span><span class="n">isatty</span><span class="p">():</span> <span class="c1"># we can probably underline words (inverse is more widely supported than underline, e.g. should work even on an old Linux console in case someone&#39;s using that to control an OS X server, but there might be a *lot* of words, which wouldn&#39;t be very good in inverse if user needs dark background and inverse is bright.  Unlike Annogen, we&#39;re dealing primarily with Latin letters.)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3428"><a href="#MacBritish_System_Lexicon.readWithLex-3428"><span class="linenos">3428</span></a>           <span class="kn">import</span> <span class="nn">textwrap</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3429"><a href="#MacBritish_System_Lexicon.readWithLex-3429"><span class="linenos">3429</span></a>           <span class="n">textwrap</span><span class="o">.</span><span class="n">len</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">))</span> <span class="c1"># a &#39;hack&#39; to make (at least the 2.x implementations of) textwrap ignore our chr(0) and chr(1) markers in their calculations.  Relies on textwrap calling len().</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3430"><a href="#MacBritish_System_Lexicon.readWithLex-3430"><span class="linenos">3430</span></a>           <span class="nb">print</span> <span class="p">(</span><span class="n">textwrap</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="n">textToPrint</span><span class="p">,</span><span class="n">stdout_width_unix</span><span class="p">(),</span><span class="n">break_on_hyphens</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[4m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="s2">&quot;</span><span class="se">\x1b</span><span class="s2">[0m&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span> <span class="c1"># break_on_hyphens=False because we don&#39;t really want hyphenated NAMES to be split across lines, and anyway textwrap in (at least) Python 2.7 has a bug that sometimes causes a line breaks to be inserted before a syllable marker symbol like &#39;prime&#39;</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3431"><a href="#MacBritish_System_Lexicon.readWithLex-3431"><span class="linenos">3431</span></a>        <span class="c1"># else don&#39;t print anything (saves confusion)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3432"><a href="#MacBritish_System_Lexicon.readWithLex-3432"><span class="linenos">3432</span></a>        <span class="n">msc</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">popen</span><span class="p">(</span><span class="n">macSayCommand</span><span class="p">()</span><span class="o">+</span><span class="s2">&quot; -v </span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;</span><span class="se">\&quot;</span><span class="s2">&quot;</span><span class="p">,</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.readWithLex-3433"><a href="#MacBritish_System_Lexicon.readWithLex-3433"><span class="linenos">3433</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="n">msc</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">tta</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Reads the text given in the constructor after setting up the lexicon with the given (word,phoneme) list</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.setMultiple" class="classattr">
                                        <input id="MacBritish_System_Lexicon.setMultiple-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">setMultiple</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">words</span>, </span><span class="param"><span class="n">phonemes</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.setMultiple-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.setMultiple"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.setMultiple-3434"><a href="#MacBritish_System_Lexicon.setMultiple-3434"><span class="linenos">3434</span></a>    <span class="k">def</span> <span class="nf">setMultiple</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3435"><a href="#MacBritish_System_Lexicon.setMultiple-3435"><span class="linenos">3435</span></a>        <span class="s2">&quot;Sets phonemes for words, returning dict of word to substitute word.  Flushes file buffer before return.&quot;</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3436"><a href="#MacBritish_System_Lexicon.setMultiple-3436"><span class="linenos">3436</span></a>        <span class="n">avail</span> <span class="o">=</span> <span class="p">[]</span> <span class="p">;</span> <span class="n">needed</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3437"><a href="#MacBritish_System_Lexicon.setMultiple-3437"><span class="linenos">3437</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">usable_words</span><span class="p">(</span><span class="n">words</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3438"><a href="#MacBritish_System_Lexicon.setMultiple-3438"><span class="linenos">3438</span></a>            <span class="n">avail</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3439"><a href="#MacBritish_System_Lexicon.setMultiple-3439"><span class="linenos">3439</span></a>        <span class="k">for</span> <span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">words</span><span class="p">,</span><span class="n">phonemes</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3440"><a href="#MacBritish_System_Lexicon.setMultiple-3440"><span class="linenos">3440</span></a>            <span class="n">needed</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">phon</span><span class="p">),</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span><span class="p">))</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3441"><a href="#MacBritish_System_Lexicon.setMultiple-3441"><span class="linenos">3441</span></a>        <span class="n">avail</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="p">;</span> <span class="n">needed</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span> <span class="c1"># shortest phon first</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3442"><a href="#MacBritish_System_Lexicon.setMultiple-3442"><span class="linenos">3442</span></a>        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span> <span class="p">;</span> <span class="n">wDic</span> <span class="o">=</span> <span class="p">{}</span> <span class="p">;</span> <span class="n">iDone</span><span class="o">=</span><span class="nb">set</span><span class="p">()</span> <span class="p">;</span> <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">True</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3443"><a href="#MacBritish_System_Lexicon.setMultiple-3443"><span class="linenos">3443</span></a>        <span class="c1"># mustBeAlpha: prefer alphabetical words, since</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3444"><a href="#MacBritish_System_Lexicon.setMultiple-3444"><span class="linenos">3444</span></a>        <span class="c1"># these can be capitalised at start of sentence</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3445"><a href="#MacBritish_System_Lexicon.setMultiple-3445"><span class="linenos">3445</span></a>        <span class="c1"># (the prosody doesn&#39;t always work if it isn&#39;t)</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3446"><a href="#MacBritish_System_Lexicon.setMultiple-3446"><span class="linenos">3446</span></a>        <span class="k">for</span> <span class="n">l</span><span class="p">,</span><span class="n">word</span><span class="p">,</span><span class="n">phon</span> <span class="ow">in</span> <span class="n">needed</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3447"><a href="#MacBritish_System_Lexicon.setMultiple-3447"><span class="linenos">3447</span></a>            <span class="k">while</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">l</span> <span class="ow">or</span> <span class="p">(</span><span class="n">mustBeAlpha</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">as_utf8</span><span class="p">(</span><span class="s2">&quot;[A-Za-z]&quot;</span><span class="p">),</span><span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]))</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">iDone</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3448"><a href="#MacBritish_System_Lexicon.setMultiple-3448"><span class="linenos">3448</span></a>                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3449"><a href="#MacBritish_System_Lexicon.setMultiple-3449"><span class="linenos">3449</span></a>                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">avail</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3450"><a href="#MacBritish_System_Lexicon.setMultiple-3450"><span class="linenos">3450</span></a>                    <span class="k">if</span> <span class="n">mustBeAlpha</span><span class="p">:</span> <span class="c1"># desperate situation: we HAVE to use the non-alphabetical slots now (ideally we should pick words that never occur at start of sentence for them, but this branch is hopefully a rare situation in practice)</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3451"><a href="#MacBritish_System_Lexicon.setMultiple-3451"><span class="linenos">3451</span></a>                       <span class="n">mustBeAlpha</span><span class="o">=</span><span class="kc">False</span> <span class="p">;</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="k">continue</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3452"><a href="#MacBritish_System_Lexicon.setMultiple-3452"><span class="linenos">3452</span></a>                    <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Could not find enough lexicon slots!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="c1"># TODO: we passed &#39;words&#39; to usable_words&#39;s words_ok_to_redefine - this might not be the case if we didn&#39;t find enough slots</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3453"><a href="#MacBritish_System_Lexicon.setMultiple-3453"><span class="linenos">3453</span></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3454"><a href="#MacBritish_System_Lexicon.setMultiple-3454"><span class="linenos">3454</span></a>            <span class="n">iDone</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3455"><a href="#MacBritish_System_Lexicon.setMultiple-3455"><span class="linenos">3455</span></a>            <span class="n">_</span><span class="p">,</span><span class="n">wSubst</span><span class="p">,</span><span class="n">pos</span><span class="p">,</span><span class="n">oldPhon</span> <span class="o">=</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">;</span> <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3456"><a href="#MacBritish_System_Lexicon.setMultiple-3456"><span class="linenos">3456</span></a>            <span class="k">if</span> <span class="n">avail</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">:</span> <span class="n">oldPhon</span><span class="o">=</span><span class="kc">None</span> <span class="c1"># shouldn&#39;t happen if setMultiple is called only once, but might be useful for small experiments in the Python interpreter etc</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3457"><a href="#MacBritish_System_Lexicon.setMultiple-3457"><span class="linenos">3457</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span><span class="n">phon</span><span class="p">,</span><span class="n">oldPhon</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3458"><a href="#MacBritish_System_Lexicon.setMultiple-3458"><span class="linenos">3458</span></a>            <span class="n">wDic</span><span class="p">[</span><span class="n">word</span><span class="p">]</span> <span class="o">=</span> <span class="n">wSubst</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span><span class="o">+</span><span class="n">wSubst</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="c1"># always capitalise it so it can be used at start of sentence too (TODO: copy original capitalisation of each instance instead, in case it happens to come directly after a dotted abbreviation? although if it&#39;s something that&#39;s always capitalised anyway, e.g. most names, then this won&#39;t make any difference)</span>
</span><span id="MacBritish_System_Lexicon.setMultiple-3459"><a href="#MacBritish_System_Lexicon.setMultiple-3459"><span class="linenos">3459</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">flush</span><span class="p">()</span> <span class="p">;</span> <span class="k">return</span> <span class="n">wDic</span>
</span></pre></div>


            <div class="docstring"><p>Sets phonemes for words, returning dict of word to substitute word.  Flushes file buffer before return.</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.set" class="classattr">
                                        <input id="MacBritish_System_Lexicon.set-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">set</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span>, </span><span class="param"><span class="n">phPos</span>, </span><span class="param"><span class="n">val</span>, </span><span class="param"><span class="n">old</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.set-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.set"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.set-3460"><a href="#MacBritish_System_Lexicon.set-3460"><span class="linenos">3460</span></a>    <span class="k">def</span> <span class="nf">set</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="n">old</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.set-3461"><a href="#MacBritish_System_Lexicon.set-3461"><span class="linenos">3461</span></a><span class="w">        </span><span class="sd">&quot;&quot;&quot;Sets phonemes at position phPos to new value.</span>
</span><span id="MacBritish_System_Lexicon.set-3462"><a href="#MacBritish_System_Lexicon.set-3462"><span class="linenos">3462</span></a><span class="sd">        Caller should flush the file buffer when done.&quot;&quot;&quot;</span>
</span><span id="MacBritish_System_Lexicon.set-3463"><a href="#MacBritish_System_Lexicon.set-3463"><span class="linenos">3463</span></a>        <span class="c1"># print &quot;Debugger: setting %x to %s&quot; % (phPos,val)</span>
</span><span id="MacBritish_System_Lexicon.set-3464"><a href="#MacBritish_System_Lexicon.set-3464"><span class="linenos">3464</span></a>        <span class="k">if</span> <span class="n">old</span><span class="p">:</span>
</span><span id="MacBritish_System_Lexicon.set-3465"><a href="#MacBritish_System_Lexicon.set-3465"><span class="linenos">3465</span></a>            <span class="k">assert</span> <span class="ow">not</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Cannot call set() twice on same phoneme while re-specifying &#39;old&#39;&quot;</span>
</span><span id="MacBritish_System_Lexicon.set-3466"><a href="#MacBritish_System_Lexicon.set-3466"><span class="linenos">3466</span></a>            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">old</span><span class="p">),</span> <span class="s2">&quot;New phoneme is too long!&quot;</span>
</span><span id="MacBritish_System_Lexicon.set-3467"><a href="#MacBritish_System_Lexicon.set-3467"><span class="linenos">3467</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">[</span><span class="n">phPos</span><span class="p">]</span> <span class="o">=</span> <span class="n">old</span>
</span><span id="MacBritish_System_Lexicon.set-3468"><a href="#MacBritish_System_Lexicon.set-3468"><span class="linenos">3468</span></a>        <span class="k">else</span><span class="p">:</span> <span class="k">assert</span> <span class="n">phPos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="p">,</span> <span class="s2">&quot;Must specify old values (for restore) when setting for first time&quot;</span>
</span><span id="MacBritish_System_Lexicon.set-3469"><a href="#MacBritish_System_Lexicon.set-3469"><span class="linenos">3469</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">seek</span><span class="p">(</span><span class="n">phPos</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.set-3470"><a href="#MacBritish_System_Lexicon.set-3470"><span class="linenos">3470</span></a>        <span class="n">getBuf</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">val</span><span class="o">+</span><span class="n">as_utf8</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Sets phonemes at position phPos to new value.
Caller should flush the file buffer when done.</p>
</div>


                            </div>
                            <div id="MacBritish_System_Lexicon.close" class="classattr">
                                        <input id="MacBritish_System_Lexicon.close-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">close</span><span class="signature pdoc-code condensed">(<span class="param"><span class="bp">self</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="MacBritish_System_Lexicon.close-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#MacBritish_System_Lexicon.close"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="MacBritish_System_Lexicon.close-3475"><a href="#MacBritish_System_Lexicon.close-3475"><span class="linenos">3475</span></a>    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="MacBritish_System_Lexicon.close-3476"><a href="#MacBritish_System_Lexicon.close-3476"><span class="linenos">3476</span></a>        <span class="k">for</span> <span class="n">phPos</span><span class="p">,</span><span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">restoreDic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="MacBritish_System_Lexicon.close-3477"><a href="#MacBritish_System_Lexicon.close-3477"><span class="linenos">3477</span></a>            <span class="bp">self</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">phPos</span><span class="p">,</span><span class="n">val</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.close-3478"><a href="#MacBritish_System_Lexicon.close-3478"><span class="linenos">3478</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">dFile</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span id="MacBritish_System_Lexicon.close-3479"><a href="#MacBritish_System_Lexicon.close-3479"><span class="linenos">3479</span></a>        <span class="k">del</span> <span class="n">MacBritish_System_Lexicon</span><span class="o">.</span><span class="n">instances</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="p">]</span>
</span><span id="MacBritish_System_Lexicon.close-3480"><a href="#MacBritish_System_Lexicon.close-3480"><span class="linenos">3480</span></a>        <span class="k">assert</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">system</span><span class="p">(</span><span class="s2">&quot;rm -f /tmp/&quot;</span><span class="o">+</span><span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">+</span><span class="s2">&quot;.PCMWave.lock&quot;</span><span class="p">)</span>
</span><span id="MacBritish_System_Lexicon.close-3481"><a href="#MacBritish_System_Lexicon.close-3481"><span class="linenos">3481</span></a>        <span class="bp">self</span><span class="o">.</span><span class="n">voice</span><span class="o">=</span><span class="kc">None</span>
</span></pre></div>


    

                            </div>
                </section>
                <section id="stdout_width_unix">
                            <input id="stdout_width_unix-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">stdout_width_unix</span><span class="signature pdoc-code condensed">(<span class="return-annotation">):</span></span>

                <label class="view-source-button" for="stdout_width_unix-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#stdout_width_unix"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="stdout_width_unix-3482"><a href="#stdout_width_unix-3482"><span class="linenos">3482</span></a><span class="k">def</span> <span class="nf">stdout_width_unix</span><span class="p">():</span> <span class="c1"># assumes isatty</span>
</span><span id="stdout_width_unix-3483"><a href="#stdout_width_unix-3483"><span class="linenos">3483</span></a>   <span class="kn">import</span> <span class="nn">struct</span><span class="o">,</span><span class="nn">fcntl</span><span class="o">,</span><span class="nn">termios</span>
</span><span id="stdout_width_unix-3484"><a href="#stdout_width_unix-3484"><span class="linenos">3484</span></a>   <span class="k">return</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack</span><span class="p">(</span><span class="s1">&#39;hh&#39;</span><span class="p">,</span> <span class="n">fcntl</span><span class="o">.</span><span class="n">ioctl</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">termios</span><span class="o">.</span><span class="n">TIOCGWINSZ</span><span class="p">,</span><span class="s1">&#39;1234&#39;</span><span class="p">))[</span><span class="mi">1</span><span class="p">]</span>
</span></pre></div>


    

                </section>
                <section id="lexFormats">
                    <div class="attr variable">
            <span class="name">lexFormats</span>        =
<input id="lexFormats-view-value" class="view-value-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
            <label class="view-value-button pdoc-button" for="lexFormats-view-value"></label><span class="default_value">{&#39;festival&#39;: {&#39;0&#39;: 47, b&#39;0&#39;: 47, 47: &#39;0&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;aa&#39;: 1, b&#39;aa&#39;: 1, 1: &#39;aa&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, 2: &#39;a&#39;, &#39;uh&#39;: 3, b&#39;uh&#39;: 3, 3: &#39;uh&#39;, &#39;o&#39;: 4, b&#39;o&#39;: 4, 4: &#39;o&#39;, &#39;au&#39;: 5, b&#39;au&#39;: 5, 5: &#39;au&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;@@&#39;: 7, b&#39;@@&#39;: 7, 7: &#39;@@&#39;, &#39;ai&#39;: 8, b&#39;ai&#39;: 8, 8: &#39;ai&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13: &#39;e&#39;, 7.1: &#39;@@&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;e@&#39;, &#39;ei&#39;: 15, b&#39;ei&#39;: 15, 15: &#39;ei&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;i&#39;: 19, b&#39;i&#39;: 19, 19: &#39;i&#39;, &#39;i@&#39;: 20, b&#39;i@&#39;: 20, 20: &#39;i@&#39;, &#39;ii&#39;: 21, b&#39;ii&#39;: 21, 21: &#39;ii&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;ou&#39;: 28, b&#39;ou&#39;: 28, 28: &#39;ou&#39;, &#39;oi&#39;: 30, b&#39;oi&#39;: 30, 30: &#39;oi&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;u@&#39;: 37, b&#39;u@&#39;: 37, 37: &#39;u@&#39;, &#39;u&#39;: 37.2, b&#39;u&#39;: 37.2, 37.2: &#39;u&#39;, &#39;uu&#39;: 39, b&#39;uu&#39;: 39, 39: &#39;uu&#39;, &#39;oo&#39;: 40, b&#39;oo&#39;: 40, 40: &#39;oo&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;Festival&#39;s British voice&#34;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;/Users/ryan/.festivalrc&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;(lex.add.entry \&#39;( &#34;%s&#34; n %s))\n&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;;; -*- mode: lisp -*-\n(eval (list voice_default))\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_func&#39;): &lt;function festival_group_stress&gt;}, &#39;example&#39;: {&#39;0&#39;: 47, b&#39;0&#39;: 47, 47: &#39;0&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;aa&#39;: 1, b&#39;aa&#39;: 1, 1: &#39;aa&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, 2: &#39;a&#39;, &#39;uh&#39;: 3, b&#39;uh&#39;: 3, 3: &#39;uh&#39;, &#39;o&#39;: 4, b&#39;o&#39;: 4, 4: &#39;o&#39;, &#39;au&#39;: 5, b&#39;au&#39;: 5, 5: &#39;au&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;@@&#39;: 7, b&#39;@@&#39;: 7, 7: &#39;@@&#39;, &#39;ai&#39;: 8, b&#39;ai&#39;: 8, 8: &#39;ai&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13: &#39;e&#39;, 7.1: &#39;@@&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;e@&#39;, &#39;ei&#39;: 15, b&#39;ei&#39;: 15, 15: &#39;ei&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;i&#39;: 19, b&#39;i&#39;: 19, 19: &#39;i&#39;, &#39;i@&#39;: 20, b&#39;i@&#39;: 20, 20: &#39;i@&#39;, &#39;ii&#39;: 21, b&#39;ii&#39;: 21, 21: &#39;ii&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;ou&#39;: 28, b&#39;ou&#39;: 28, 28: &#39;ou&#39;, &#39;oi&#39;: 30, b&#39;oi&#39;: 30, 30: &#39;oi&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;u@&#39;: 37, b&#39;u@&#39;: 37, 37: &#39;u@&#39;, &#39;u&#39;: 37.2, b&#39;u&#39;: 37.2, 37.2: &#39;u&#39;, &#39;uu&#39;: 39, b&#39;uu&#39;: 39, 39: &#39;uu&#39;, &#39;oo&#39;: 40, b&#39;oo&#39;: 40, 40: &#39;oo&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;A small built-in example lexicon for testing when you don&#39;t have your full custom lexicon to hand.  Use --convert to write it in one of the other formats and see if a synth can import it.&#34;, (&#39;settings&#39;, &#39;lex_filename&#39;): None, (&#39;settings&#39;, &#39;lex_entry_format&#39;): None, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;;; -*- mode: lisp -*-\n(eval (list voice_default))\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_func&#39;): None}, &#39;festival-cmu&#39;: {&#39;0&#39;: 47, b&#39;0&#39;: 47, 47: &#39;0&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;aa&#39;: 1, b&#39;aa&#39;: 1, 1: &#39;aa&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, 2: &#39;ae&#39;, &#39;uh&#39;: 37, b&#39;uh&#39;: 37, 3: &#39;ah&#39;, &#39;o&#39;: 4, b&#39;o&#39;: 4, 4: &#39;aa&#39;, &#39;au&#39;: 5, b&#39;au&#39;: 5, 5: &#39;aw&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;ax&#39;, &#39;@@&#39;: 7, b&#39;@@&#39;: 7, 7: &#39;er&#39;, &#39;ai&#39;: 8, b&#39;ai&#39;: 8, 8: &#39;ay&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13: &#39;eh&#39;, 7.1: &#39;er&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;er&#39;, &#39;ei&#39;: 15, b&#39;ei&#39;: 15, 15: &#39;ey&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;hh&#39;, &#39;i&#39;: 19, b&#39;i&#39;: 19, 19: &#39;ih&#39;, &#39;i@&#39;: 20, b&#39;i@&#39;: 20, 20: &#39;ey ah&#39;, &#39;ii&#39;: 21, b&#39;ii&#39;: 21, 21: &#39;iy&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;ou&#39;: 28, b&#39;ou&#39;: 28, 28: &#39;ow&#39;, &#39;oi&#39;: 30, b&#39;oi&#39;: 30, 30: &#39;oy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;u@&#39;: 37, b&#39;u@&#39;: 37, 37: &#39;uh&#39;, &#39;u&#39;: 37.2, b&#39;u&#39;: 37.2, 37.2: &#39;u&#39;, &#39;uu&#39;: 39, b&#39;uu&#39;: 39, 39: &#39;uw&#39;, &#39;oo&#39;: 40, b&#39;oo&#39;: 40, 40: &#39;ao&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;American CMU version of Festival&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;/Users/ryan/.festivalrc&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;(lex.add.entry \&#39;( &#34;%s&#34; n %s))\n&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;;; -*- mode: lisp -*-\n(eval (list voice_default))\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_func&#39;): &lt;function festival_group_stress&gt;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, &#39;ah&#39;: 3, b&#39;ah&#39;: 3, &#39;ax&#39;: 6, b&#39;ax&#39;: 6, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, &#39;er&#39;: 7, b&#39;er&#39;: 7, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, &#39;eh&#39;: 13, b&#39;eh&#39;: 13, &#39;ey&#39;: 15, b&#39;ey&#39;: 15, &#39;hh&#39;: 18, b&#39;hh&#39;: 18, &#39;ih&#39;: 19, b&#39;ih&#39;: 19, &#39;ey ah&#39;: 20, b&#39;ey ah&#39;: 20, &#39;iy&#39;: 21, b&#39;iy&#39;: 21, &#39;ow&#39;: 28, b&#39;ow&#39;: 28, &#39;oy&#39;: 30, b&#39;oy&#39;: 30, &#39;uw&#39;: 39, b&#39;uw&#39;: 39, &#39;ao&#39;: 40, b&#39;ao&#39;: 40}, &#39;espeak&#39;: {&#39;%&#39;: 47, b&#39;%&#39;: 47, 47: &#39;%&#39;, &#34;&#39;&#34;: 47.1, b&#34;&#39;&#34;: 47.1, 47.1: &#34;&#39;&#34;, &#39;,&#39;: 47.2, b&#39;,&#39;: 47.2, 47.2: &#39;,&#39;, &#39;A:&#39;: 1, b&#39;A:&#39;: 1, 1: &#39;A:&#39;, &#39;A@&#39;: 1, b&#39;A@&#39;: 1, &#39;A&#39;: 1.1, b&#39;A&#39;: 1.1, 1.1: &#39;A&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, 2: &#39;a&#39;, &#39;aa&#39;: 2, b&#39;aa&#39;: 2, &#39;a2&#39;: 2, b&#39;a2&#39;: 2, &#39;&amp;&#39;: 2, b&#39;&amp;&#39;: 2, &#39;V&#39;: 3, b&#39;V&#39;: 3, 3: &#39;V&#39;, &#39;0&#39;: 4, b&#39;0&#39;: 4, 4: &#39;0&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;aU&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;a#&#39;: 6, b&#39;a#&#39;: 6, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;3:&#39;, &#39;3&#39;: 6.1, b&#39;3&#39;: 6.1, 6.1: &#39;3&#39;, &#39;@2&#39;: 6, b&#39;@2&#39;: 6, &#39;@-&#39;: 6, b&#39;@-&#39;: 6, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;aI2&#39;: 8, b&#39;aI2&#39;: 8, &#39;aI;&#39;: 8, b&#39;aI;&#39;: 8, &#39;aI2;&#39;: 8, b&#39;aI2;&#39;: 8, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, 7.1: &#39;3:&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;e@&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;I;&#39;: 19, b&#39;I;&#39;: 19, &#39;i&#39;: 19, b&#39;i&#39;: 19, &#39;I2&#39;: 19.2, b&#39;I2&#39;: 19.2, &#39;I2;&#39;: 19.2, b&#39;I2;&#39;: 19.2, &#39;i@&#39;: 20, b&#39;i@&#39;: 20, 20: &#39;i@&#39;, &#39;i@3&#39;: 20.2, b&#39;i@3&#39;: 20.2, 20.2: &#39;i@3&#39;, &#39;i:&#39;: 21, b&#39;i:&#39;: 21, 21: &#39;i:&#39;, &#39;i:;&#39;: 21, b&#39;i:;&#39;: 21, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;oU&#39;: 28, b&#39;oU&#39;: 28, 28: &#39;oU&#39;, &#39;oUl&#39;: 29, b&#39;oUl&#39;: 29, 29: &#39;oUl&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;r-&#39;: 32, b&#39;r-&#39;: 32, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;@5&#39;: 37.2, b&#39;@5&#39;: 37.2, &#39;Ul&#39;: 38, b&#39;Ul&#39;: 38, 38: &#39;Ul&#39;, &#39;u:&#39;: 39, b&#39;u:&#39;: 39, 39: &#39;u:&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, &#39;O@&#39;: 40.3, b&#39;O@&#39;: 40.3, 40.3: &#39;O@&#39;, &#39;o@&#39;: 40.3, b&#39;o@&#39;: 40.3, &#39;O&#39;: 40.3, b&#39;O&#39;: 40.3, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;eSpeak&#39;s default British voice&#34;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;en_extra&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s %s\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;lex_footer&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;[[%s]]&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): &#39;_: !&#39;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#34;k&#39;a2n&#34;, &#34;k&#39;@n&#34;), (&#39;ka2n&#39;, &#39;k@n&#39;), (&#39;gg&#39;, &#39;g&#39;), (&#39;@U&#39;, &#39;oU&#39;), (&#39;([iU]|([AO]:))@r$&#39;, &#39;\x01@&#39;), (&#39;([^e])@r&#39;, &#39;\\1_remove_3&#39;), (&#39;_remove_&#39;, &#39;&#39;), (&#39;rr$&#39;, &#39;r&#39;), (&#39;3:r$&#39;, &#39;3:&#39;), (&#39;%%+&#39;, &#39;%&#39;), (&#39;^%&#39;, &#39;&#39;), (&#39;%$&#39;, &#39;&#39;)], (&#39;settings&#39;, &#39;cvtOut_regexps&#39;): [(&#39;e@r$&#39;, &#39;e@&#39;), (&#39;e@r([bdDfghklmnNprsStTvwjzZ])&#39;, &#39;e@\\1&#39;)]}, &#39;sapi&#39;: {&#39;-&#39;: 47, b&#39;-&#39;: 47, 47: &#39;-&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;aa&#39;: 1, b&#39;aa&#39;: 1, 1: &#39;aa&#39;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, 2: &#39;ae&#39;, &#39;ah&#39;: 3, b&#39;ah&#39;: 3, 3: &#39;ah&#39;, &#39;ao&#39;: 4, b&#39;ao&#39;: 4, 4: &#39;ao&#39;, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, 5: &#39;aw&#39;, &#39;ax&#39;: 6, b&#39;ax&#39;: 6, 6: &#39;ax&#39;, &#39;er&#39;: 7, b&#39;er&#39;: 7, 7: &#39;er&#39;, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, 8: &#39;ay&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;eh&#39;: 13, b&#39;eh&#39;: 13, 13: &#39;eh&#39;, &#39;ey&#39;: 13.1, b&#39;ey&#39;: 13.1, 13.1: &#39;ey&#39;, 15: &#39;ey&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;ih&#39;: 19, b&#39;ih&#39;: 19, 19: &#39;ih&#39;, &#39;iy&#39;: 21, b&#39;iy&#39;: 21, 21: &#39;iy&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;ow&#39;: 28, b&#39;ow&#39;: 28, 28: &#39;ow&#39;, &#39;oy&#39;: 30, b&#39;oy&#39;: 30, 30: &#39;oy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;uh&#39;: 37, b&#39;uh&#39;: 37, 37: &#39;uh&#39;, &#39;uw&#39;: 39, b&#39;uw&#39;: 39, 39: &#39;uw&#39;, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, 14: &#39;eh r&#39;, 20: &#39;iy ah&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Microsoft Speech API (American English)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;run-ptts.bat&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;rem  You have to run this file\nrem  with ptts.exe in the same directory\nrem  to add these words to the SAPI lexicon\n\n&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;ptts -la %s &#34;%s&#34;\n&#39;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;&lt;pron sym=&#34;%s&#34;/&gt;&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;cepstral&#39;: {&#39;0&#39;: 47, b&#39;0&#39;: 47, 47: &#39;0&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;a&#39;: 1, b&#39;a&#39;: 1, 1: &#39;a&#39;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, 2: &#39;ae&#39;, &#39;ah&#39;: 3, b&#39;ah&#39;: 3, 3: &#39;ah&#39;, &#39;oa&#39;: 4, b&#39;oa&#39;: 4, 4: &#39;oa&#39;, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, 5: &#39;aw&#39;, &#39;er&#39;: 7, b&#39;er&#39;: 7, 7: &#39;er&#39;, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, 8: &#39;ay&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;eh&#39;: 13, b&#39;eh&#39;: 13, 13: &#39;eh&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;e@&#39;, &#39;ey&#39;: 15, b&#39;ey&#39;: 15, 15: &#39;ey&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;ih&#39;: 19, b&#39;ih&#39;: 19, 19: &#39;ih&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;ow&#39;: 28, b&#39;ow&#39;: 28, 28: &#39;ow&#39;, &#39;oy&#39;: 30, b&#39;oy&#39;: 30, 30: &#39;oy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;uh&#39;: 37, b&#39;uh&#39;: 37, 37: &#39;uh&#39;, &#39;uw&#39;: 39, b&#39;uw&#39;: 39, 39: &#39;uw&#39;, &#39;ao&#39;: 40, b&#39;ao&#39;: 40, 40: &#39;ao&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, 6: &#39;ah&#39;, 20: &#39;i ah&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;Cepstral&#39;s British English SSML phoneset&#34;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;lexicon.txt&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s 0 %s\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;lex_word_case&#39;): &#39;lower&#39;, (&#39;settings&#39;, &#39;inline_format&#39;): &#34;&lt;phoneme ph=&#39;%s&#39;&gt;p&lt;/phoneme&gt;&#34;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39; 1&#39;, &#39;1&#39;), (&#39; 0&#39;, &#39;0&#39;)]}, &#39;mac&#39;: {&#39;=&#39;: 47, b&#39;=&#39;: 47, 47: &#39;=&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;AA&#39;: 1, b&#39;AA&#39;: 1, 1: &#39;AA&#39;, &#39;aa&#39;: 1.4, b&#39;aa&#39;: 1.4, 1.4: &#39;aa&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;UX&#39;: 3, b&#39;UX&#39;: 3, 3: &#39;UX&#39;, 4: &#39;AA&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, &#39;AX&#39;: 6, b&#39;AX&#39;: 6, 6: &#39;AX&#39;, 7: &#39;AX&#39;, &#39;AY&#39;: 8, b&#39;AY&#39;: 8, 8: &#39;AY&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;C&#39;: 10, b&#39;C&#39;: 10, 10: &#39;C&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, &#39;EY&#39;: 15, b&#39;EY&#39;: 15, 15: &#39;EY&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;IX&#39;: 19.2, b&#39;IX&#39;: 19.2, 19.2: &#39;IX&#39;, &#39;IY&#39;: 21, b&#39;IY&#39;: 21, 21: &#39;IY&#39;, &#39;J&#39;: 22, b&#39;J&#39;: 22, 22: &#39;J&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, 28: &#39;OW&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;UH&#39;: 37, b&#39;UH&#39;: 37, 37: &#39;UH&#39;, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, 39: &#39;UW&#39;, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, 14: &#39;EHr&#39;, 20: &#39;IYUX&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;approximation in American English using the [[inpt PHON]] notation of Apple&#39;s US voices&#34;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;substitute.sh&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;substitution script&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#34;#!/bin/bash\n\n# I don&#39;t yet know how to add to the Apple US lexicon,\n# so here is a &#39;sed&#39; command you can run on your text\n# to put the pronunciation inline:\n\nsed -E -e :S \\\n&#34;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#34; -e &#39;s/(^|[^A-Za-z])%s($|[^A-Za-z[12=])/\\1[[inpt PHON]]%s[[inpt TEXT]]\\2/g&#39; \\\n&#34;, (&#39;settings&#39;, &#39;lex_footer&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;[[inpt PHON]]%s[[inpt TEXT]]&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;mac-uk&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;.&#39;, &#34;&#39;&#34;: 47.1, b&#34;&#39;&#34;: 47.1, 47.1: &#34;&#39;&#34;, 47.2: &#39;&#39;, &#39;A&#39;: 1, b&#39;A&#39;: 1, 1: &#39;A&#39;, &#39;@&#39;: 2, b&#39;@&#39;: 2, 2: &#39;@&#39;, &#39;$&#39;: 3, b&#39;$&#39;: 3, 3: &#39;$&#39;, 6: &#39;$&#39;, &#39;A+&#39;: 4, b&#39;A+&#39;: 4, 4: &#39;A+&#39;, &#39;a&amp;U&#39;: 5, b&#39;a&amp;U&#39;: 5, 5: &#39;a&amp;U&#39;, &#39;E0&#39;: 7, b&#39;E0&#39;: 7, 7: &#39;E0&#39;, &#39;a&amp;I&#39;: 8, b&#39;a&amp;I&#39;: 8, 8: &#39;a&amp;I&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t&amp;S&#39;: 10, b&#39;t&amp;S&#39;: 10, 10: &#39;t&amp;S&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;0&#39;: 7.1, b&#39;0&#39;: 7.1, 7.1: &#39;0&#39;, &#39;E&amp;$&#39;: 14, b&#39;E&amp;$&#39;: 14, 14: &#39;E&amp;$&#39;, &#39;e&amp;I&#39;: 15, b&#39;e&amp;I&#39;: 15, 15: &#39;e&amp;I&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;I&amp;$&#39;: 20, b&#39;I&amp;$&#39;: 20, 20: &#39;I&amp;$&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;d&amp;Z&#39;: 22, b&#39;d&amp;Z&#39;: 22, 22: &#39;d&amp;Z&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;nK&#39;: 27, b&#39;nK&#39;: 27, 27: &#39;nK&#39;, &#39;o&amp;U&#39;: 28, b&#39;o&amp;U&#39;: 28, 28: &#39;o&amp;U&#39;, &#39;O&amp;I&#39;: 30, b&#39;O&amp;I&#39;: 30, 30: &#39;O&amp;I&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;R+&#39;: 32, b&#39;R+&#39;: 32, 32: &#39;R+&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;O&#39;: 37, b&#39;O&#39;: 37, 37: &#39;O&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;u&#39;: 39, b&#39;u&#39;: 39, 39: &#39;u&#39;, 40: &#39;O&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Scansoft/Nuance British voices in Mac OS 10.7+ (system lexicon editing required, see --mac-uk option)&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;inline_oneoff_header&#39;): &#34;(mac-uk phonemes output is for information only; you&#39;ll need the --mac-uk or --trymac-uk options to use it)\n&#34;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;o\\&amp;U\\.Ol&#39;, &#39;o\\&amp;Ul&#39;)]}, &#39;x-sampa&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;.&#39;, &#39;&#34;&#39;: 47.1, b&#39;&#34;&#39;: 47.1, 47.1: &#39;&#34;&#39;, &#39;%&#39;: 47.2, b&#39;%&#39;: 47.2, 47.2: &#39;%&#39;, &#39;A&#39;: 1, b&#39;A&#39;: 1, 1: &#39;A&#39;, &#39;:&#39;: 53, b&#39;:&#39;: 53, 53: &#39;:&#39;, &#39;A:&#39;: 1.2, b&#39;A:&#39;: 1.2, 1.2: &#39;A:&#39;, &#39;Ar\\&#39;: 1.3, b&#39;Ar\\&#39;: 1.3, 1.3: &#39;Ar\\&#39;, &#39;a:&#39;: 1.4, b&#39;a:&#39;: 1.4, 1.4: &#39;a:&#39;, &#39;{&#39;: 2, b&#39;{&#39;: 2, 2: &#39;{&#39;, &#39;V&#39;: 3, b&#39;V&#39;: 3, 3: &#39;V&#39;, &#39;Q&#39;: 4, b&#39;Q&#39;: 4, 4: &#39;Q&#39;, 4.1: &#39;A&#39;, &#39;O&#39;: 4.2, b&#39;O&#39;: 4.2, 4.2: &#39;O&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;aU&#39;, &#39;{O&#39;: 5.1, b&#39;{O&#39;: 5.1, 5.1: &#39;{O&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;3:&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;Ae&#39;: 8.1, b&#39;Ae&#39;: 8.1, 8.1: &#39;Ae&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, 7.1: &#39;3:&#39;, &#39;E@&#39;: 14, b&#39;E@&#39;: 14, 14: &#39;E@&#39;, &#39;Er\\&#39;: 14.1, b&#39;Er\\&#39;: 14.1, 14.1: &#39;Er\\&#39;, &#39;e:&#39;: 14.2, b&#39;e:&#39;: 14.2, 14.2: &#39;e:&#39;, &#39;E:&#39;: 14.3, b&#39;E:&#39;: 14.3, 14.3: &#39;E:&#39;, &#39;e@&#39;: 14.4, b&#39;e@&#39;: 14.4, 14.4: &#39;e@&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;{I&#39;: 15.1, b&#39;{I&#39;: 15.1, 15.1: &#39;{I&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;1&#39;: 19.1, b&#39;1&#39;: 19.1, 19.1: &#39;1&#39;, &#39;I@&#39;: 20, b&#39;I@&#39;: 20, 20: &#39;I@&#39;, &#39;Ir\\&#39;: 20.1, b&#39;Ir\\&#39;: 20.1, 20.1: &#39;Ir\\&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i:&#39;: 21.1, b&#39;i:&#39;: 21.1, 21.1: &#39;i:&#39;, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;@U&#39;: 28, b&#39;@U&#39;: 28, 28: &#39;@U&#39;, &#39;oU&#39;: 28.2, b&#39;oU&#39;: 28.2, 28.2: &#39;oU&#39;, &#39;@}&#39;: 3.1, b&#39;@}&#39;: 3.1, 3.1: &#39;@}&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;oI&#39;: 30.1, b&#39;oI&#39;: 30.1, 30.1: &#39;oI&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r\\&#39;: 32, b&#39;r\\&#39;: 32, 32: &#39;r\\&#39;, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;Ur\\&#39;: 37.1, b&#39;Ur\\&#39;: 37.1, 37.1: &#39;Ur\\&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;}:&#39;: 39, b&#39;}:&#39;: 39, 39: &#39;}:&#39;, &#39;u:&#39;: 39.1, b&#39;u:&#39;: 39.1, 39.1: &#39;u:&#39;, 39.2: &#39;u:&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, 40.1: &#39;O&#39;, &#39;o:&#39;: 40.2, b&#39;o:&#39;: 40.2, 40.2: &#39;o:&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;W&#39;: 42.1, b&#39;W&#39;: 42.1, 42.1: &#39;W&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;General X-SAMPA notation, contributed by Jan Weiss&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;acapela.txt&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s\t#%s\tUNKNOWN\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;vocaloid&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;-&#39;, &#39;&#34;&#39;: 47.1, b&#39;&#34;&#39;: 47.1, 47.1: &#39;&#39;, &#39;%&#39;: 47.2, b&#39;%&#39;: 47.2, 47.2: &#39;&#39;, &#39;A&#39;: 1, b&#39;A&#39;: 1, 1: &#39;Q&#39;, &#39;:&#39;: 53, b&#39;:&#39;: 53, 53: &#39;:&#39;, &#39;A:&#39;: 1.2, b&#39;A:&#39;: 1.2, 1.2: &#39;Q&#39;, &#39;Ar\\&#39;: 1.3, b&#39;Ar\\&#39;: 1.3, 1.3: &#39;Q&#39;, &#39;a:&#39;: 1.4, b&#39;a:&#39;: 1.4, 1.4: &#39;Q&#39;, &#39;{&#39;: 2, b&#39;{&#39;: 2, 2: &#39;{&#39;, &#39;V&#39;: 3.1, b&#39;V&#39;: 3.1, 3: &#39;V&#39;, &#39;Q&#39;: 1, b&#39;Q&#39;: 1, 4: &#39;O@&#39;, 4.1: &#39;O@&#39;, &#39;O&#39;: 4.2, b&#39;O&#39;: 4.2, 4.2: &#39;O@&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;@U&#39;, &#39;{O&#39;: 5.1, b&#39;{O&#39;: 5.1, 5.1: &#39;{O&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;@r&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;Ae&#39;: 8.1, b&#39;Ae&#39;: 8.1, 8.1: &#39;aI&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;e&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13.1: &#39;e&#39;, 7.1: &#39;I@&#39;, &#39;E@&#39;: 14, b&#39;E@&#39;: 14, 14: &#39;e@&#39;, &#39;Er\\&#39;: 14.1, b&#39;Er\\&#39;: 14.1, 14.1: &#39;e@&#39;, &#39;e:&#39;: 14.2, b&#39;e:&#39;: 14.2, 14.2: &#39;e@&#39;, &#39;E:&#39;: 14.3, b&#39;E:&#39;: 14.3, 14.3: &#39;e@&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14.4: &#39;e@&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;{I&#39;: 15.1, b&#39;{I&#39;: 15.1, 15.1: &#39;eI&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;1&#39;: 19.1, b&#39;1&#39;: 19.1, 19.1: &#39;I&#39;, &#39;I@&#39;: 7.1, b&#39;I@&#39;: 7.1, 20: &#39;I@&#39;, &#39;Ir\\&#39;: 20.1, b&#39;Ir\\&#39;: 20.1, 20.1: &#39;I@&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i:&#39;, &#39;i:&#39;: 21, b&#39;i:&#39;: 21, 21.1: &#39;i:&#39;, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;@U&#39;: 5, b&#39;@U&#39;: 5, 28: &#39;@U&#39;, &#39;oU&#39;: 28.2, b&#39;oU&#39;: 28.2, 28.2: &#39;@U&#39;, &#39;@}&#39;: 3.1, b&#39;@}&#39;: 3.1, 3.1: &#39;V&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;oI&#39;: 30.1, b&#39;oI&#39;: 30.1, 30.1: &#39;OI&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r\\&#39;: 32, b&#39;r\\&#39;: 32, 32: &#39;r&#39;, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;th&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;Ur\\&#39;: 37.1, b&#39;Ur\\&#39;: 37.1, 37.1: &#39;@U&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;}:&#39;: 39, b&#39;}:&#39;: 39, 39: &#39;u:&#39;, &#39;u:&#39;: 39, b&#39;u:&#39;: 39, 39.1: &#39;u:&#39;, 39.2: &#39;u:&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, 40.1: &#39;O:&#39;, &#39;o:&#39;: 40.2, b&#39;o:&#39;: 40.2, 40.2: &#39;O:&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;W&#39;: 42.1, b&#39;W&#39;: 42.1, 42.1: &#39;w&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;X-SAMPA phonemes for Yamaha&#39;s Vocaloid singing synthesizer.  Contributed by Lorenzo Gatti, who tested in Vocaloid 4 using two American English voices.&#34;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;vocaloid.txt&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s\t#%s\tUNKNOWN\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, &#39;-&#39;: 47, b&#39;-&#39;: 47, &#39;O@&#39;: 4, b&#39;O@&#39;: 4, &#39;@r&#39;: 7, b&#39;@r&#39;: 7, &#39;r&#39;: 32, b&#39;r&#39;: 32, &#39;th&#39;: 35, b&#39;th&#39;: 35}, &#39;android-pico&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;.&#39;, &#39;&#34;&#39;: 47.1, b&#39;&#34;&#39;: 47.1, 47.1: &#39;&#34;&#39;, &#39;%&#39;: 47.2, b&#39;%&#39;: 47.2, 47.2: &#39;%&#39;, &#39;A&#39;: 1, b&#39;A&#39;: 1, 1: &#39;A:&#39;, &#39;:&#39;: 53, b&#39;:&#39;: 53, 53: &#39;:&#39;, &#39;A:&#39;: 1, b&#39;A:&#39;: 1, 1.2: &#39;A:&#39;, &#39;Ar\\&#39;: 1.3, b&#39;Ar\\&#39;: 1.3, 1.3: &#39;Ar\\&#39;, &#39;a:&#39;: 1.4, b&#39;a:&#39;: 1.4, 1.4: &#39;A:&#39;, &#39;{&#39;: 2, b&#39;{&#39;: 2, 2: &#39;{&#39;, &#39;V&#39;: 3, b&#39;V&#39;: 3, 3: &#39;V&#39;, &#39;Q&#39;: 4, b&#39;Q&#39;: 4, 4: &#39;Q&#39;, 4.1: &#39;A&#39;, &#39;O&#39;: 4.2, b&#39;O&#39;: 4.2, 4.2: &#39;O&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;a_U&#39;, &#39;{O&#39;: 5.1, b&#39;{O&#39;: 5.1, 5.1: &#39;{O&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;3:&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;a_I&#39;, &#39;Ae&#39;: 8.1, b&#39;Ae&#39;: 8.1, 8.1: &#39;Ae&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, 7.1: &#39;3:&#39;, &#39;E@&#39;: 14, b&#39;E@&#39;: 14, 14: &#39;E@&#39;, &#39;Er\\&#39;: 14.1, b&#39;Er\\&#39;: 14.1, 14.1: &#39;Er\\&#39;, &#39;e:&#39;: 14.2, b&#39;e:&#39;: 14.2, 14.2: &#39;e:&#39;, &#39;E:&#39;: 14.3, b&#39;E:&#39;: 14.3, 14.3: &#39;E:&#39;, &#39;e@&#39;: 14.4, b&#39;e@&#39;: 14.4, 14.4: &#39;e@&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;e_I&#39;, &#39;{I&#39;: 15.1, b&#39;{I&#39;: 15.1, 15.1: &#39;{I&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19.1, b&#39;I&#39;: 19.1, 19: &#39;I&#39;, &#39;1&#39;: 19.1, b&#39;1&#39;: 19.1, 19.1: &#39;I&#39;, &#39;I@&#39;: 20, b&#39;I@&#39;: 20, 20: &#39;I@&#39;, &#39;Ir\\&#39;: 20.1, b&#39;Ir\\&#39;: 20.1, 20.1: &#39;Ir\\&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i:&#39;, &#39;i:&#39;: 21, b&#39;i:&#39;: 21, 21.1: &#39;i:&#39;, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;@U&#39;: 28, b&#39;@U&#39;: 28, 28: &#39;@U:&#39;, &#39;oU&#39;: 28.2, b&#39;oU&#39;: 28.2, 28.2: &#39;o_U&#39;, &#39;@}&#39;: 3.1, b&#39;@}&#39;: 3.1, 3.1: &#39;@}&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;O_I&#39;, &#39;oI&#39;: 30.1, b&#39;oI&#39;: 30.1, 30.1: &#39;O_I&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r\\&#39;: 32, b&#39;r\\&#39;: 32, 32: &#39;r\\&#39;, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;Ur\\&#39;: 37.1, b&#39;Ur\\&#39;: 37.1, 37.1: &#39;Ur\\&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;}:&#39;: 39, b&#39;}:&#39;: 39, 39: &#39;u:&#39;, &#39;u:&#39;: 39, b&#39;u:&#39;: 39, 39.1: &#39;u:&#39;, 39.2: &#39;u:&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, 40.1: &#39;O&#39;, &#39;o:&#39;: 40.2, b&#39;o:&#39;: 40.2, 40.2: &#39;o:&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;W&#39;: 42.1, b&#39;W&#39;: 42.1, 42.1: &#39;W&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;X-SAMPA phonemes for the default &#34;Pico&#34; voice in Android (1.6+, American), wrapped in Java code&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): None, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, &#39;@U:&#39;: 28, b&#39;@U:&#39;: 28, &#39;a_I&#39;: 8, b&#39;a_I&#39;: 8, &#39;a_U&#39;: 5, b&#39;a_U&#39;: 5, &#39;e_I&#39;: 15, b&#39;e_I&#39;: 15, &#39;O_I&#39;: 30, b&#39;O_I&#39;: 30, &#39;o_U&#39;: 28.2, b&#39;o_U&#39;: 28.2, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;\\\\&#39;, &#39;\\\\\\\\&#39;), (&#39;&#34;&#39;, &#39;&amp;quot;&#39;), (&#39;::&#39;, &#39;:&#39;)], (&#39;settings&#39;, &#39;inline_oneoff_header&#39;): &#39;class Speak { public static void speak(android.app.Activity a,String s) { class OnInit implements android.speech.tts.TextToSpeech.OnInitListener { public OnInit(String s) { this.s = s; } public void onInit(int i) { mTts.speak(this.s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private String s; }; if(mTts==null) mTts=new android.speech.tts.TextToSpeech(a,new OnInit(s),&#34;com.svox.pico&#34;); else mTts.speak(s, android.speech.tts.TextToSpeech.QUEUE_ADD, null); } private static android.speech.tts.TextToSpeech mTts = null; };\n&#39;, (&#39;settings&#39;, &#39;inline_header&#39;): &#39;Speak.speak(this,&#34;&lt;speak xml:lang=\\&#34;en-US\\&#34;&gt;&#39;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;&lt;phoneme alphabet=\\&#34;xsampa\\&#34; ph=\\&#34;%s\\&#34;/&gt;&#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): &#39;.\\n&#39;, (&#39;settings&#39;, &#39;inline_footer&#39;): &#39;&lt;/speak&gt;&#34;);&#39;}, &#39;acapela-uk&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;.&#39;, &#39;&#34;&#39;: 47.1, b&#39;&#34;&#39;: 47.1, 47.1: &#39;&#34;&#39;, &#39;%&#39;: 47.2, b&#39;%&#39;: 47.2, 47.2: &#39;%&#39;, &#39;A:&#39;: 1, b&#39;A:&#39;: 1, 1: &#39;A:&#39;, &#39;{&#39;: 2, b&#39;{&#39;: 2, 2: &#39;{&#39;, &#39;V&#39;: 3, b&#39;V&#39;: 3, 3: &#39;V&#39;, &#39;Q&#39;: 4, b&#39;Q&#39;: 4, 4: &#39;Q&#39;, &#39;A&#39;: 4.1, b&#39;A&#39;: 4.1, 4.1: &#39;A&#39;, &#39;O&#39;: 4.2, b&#39;O&#39;: 4.2, 4.2: &#39;O&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;aU&#39;, &#39;{O&#39;: 5.1, b&#39;{O&#39;: 5.1, 5.1: &#39;{O&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;3:&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;A e&#39;: 8.1, b&#39;A e&#39;: 8.1, 8.1: &#39;A e&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t S&#39;: 10, b&#39;t S&#39;: 10, 10: &#39;t S&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13: &#39;e&#39;, 7.1: &#39;3:&#39;, &#39;e @&#39;: 14, b&#39;e @&#39;: 14, 14: &#39;e @&#39;, &#39;e r&#39;: 14.1, b&#39;e r&#39;: 14.1, 14.1: &#39;e r&#39;, &#39;e :&#39;: 14.2, b&#39;e :&#39;: 14.2, 14.2: &#39;e :&#39;, 14.3: &#39;e :&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;{I&#39;: 15.1, b&#39;{I&#39;: 15.1, 15.1: &#39;{I&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;1&#39;: 19.1, b&#39;1&#39;: 19.1, 19.1: &#39;1&#39;, &#39;I@&#39;: 20, b&#39;I@&#39;: 20, 20: &#39;I@&#39;, &#39;I r&#39;: 20.1, b&#39;I r&#39;: 20.1, 20.1: &#39;I r&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i:&#39;: 21.1, b&#39;i:&#39;: 21.1, 21.1: &#39;i:&#39;, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;@U&#39;: 28, b&#39;@U&#39;: 28, 28: &#39;@U&#39;, &#39;o U&#39;: 28.2, b&#39;o U&#39;: 28.2, 28.2: &#39;o U&#39;, &#39;@ }&#39;: 3.1, b&#39;@ }&#39;: 3.1, 3.1: &#39;@ }&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;o I&#39;: 30.1, b&#39;o I&#39;: 30.1, 30.1: &#39;o I&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;U r&#39;: 37.1, b&#39;U r&#39;: 37.1, 37.1: &#39;U r&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;u:&#39;: 39, b&#39;u:&#39;: 39, 39: &#39;u:&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, 40.1: &#39;O&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Acapela-optimised X-SAMPA for UK English voices (e.g. &#34;Peter&#34;), contributed by Jan Weiss&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;acapela.txt&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s\t#%s\tUNKNOWN\n&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;\\Prn=%s\\&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;cmu&#39;: {&#39;0&#39;: 47, b&#39;0&#39;: 47, 47: &#39;0&#39;, &#39;1&#39;: 47.1, b&#39;1&#39;: 47.1, 47.1: &#39;1&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;AA&#39;: 1, b&#39;AA&#39;: 1, 1: &#39;AA&#39;, 1.1: &#39;2&#39;, 53: &#39;1&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;AH&#39;: 3, b&#39;AH&#39;: 3, 3: &#39;AH&#39;, 4: &#39;AA&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, 6: &#39;AH&#39;, &#39;ER&#39;: 7, b&#39;ER&#39;: 7, 7: &#39;ER&#39;, &#39;AY&#39;: 8, b&#39;AY&#39;: 8, 8: &#39;AY&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, 7.1: &#39;ER&#39;, 14: &#39;ER&#39;, &#39;EY&#39;: 15, b&#39;EY&#39;: 15, 15: &#39;EY&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;HH&#39;: 18, b&#39;HH&#39;: 18, 18: &#39;HH&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;EY AH&#39;: 20, b&#39;EY AH&#39;: 20, 20: &#39;EY AH&#39;, &#39;IY&#39;: 21, b&#39;IY&#39;: 21, 21: &#39;IY&#39;, &#39;JH&#39;: 22, b&#39;JH&#39;: 22, 22: &#39;JH&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NG&#39;: 27, b&#39;NG&#39;: 27, 27: &#39;NG&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, 28: &#39;OW&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;UH&#39;: 37, b&#39;UH&#39;: 37, 37: &#39;UH&#39;, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, 39: &#39;UW&#39;, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, 43: &#39;Y&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;ZH&#39;: 45, b&#39;ZH&#39;: 45, 45: &#39;ZH&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;format of the US-English Carnegie Mellon University Pronouncing Dictionary, contributed by Jan Weiss&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;apollo&#39;: {47: &#39;&#39;, &#39;_QQ&#39;: 47, b&#39;_QQ&#39;: 47, &#39;_AA&#39;: 2, b&#39;_AA&#39;: 2, 2: &#39;_AA&#39;, &#39;_AI&#39;: 15, b&#39;_AI&#39;: 15, 15: &#39;_AI&#39;, &#39;_AR&#39;: 1, b&#39;_AR&#39;: 1, 1: &#39;_AR&#39;, &#39;_AW&#39;: 40, b&#39;_AW&#39;: 40, 40: &#39;_AW&#39;, &#39;_A&#39;: 6, b&#39;_A&#39;: 6, 6: &#39;_A&#39;, &#39;_B&#39;: 9, b&#39;_B&#39;: 9, 9: &#39;_B&#39;, &#39;_CH&#39;: 10, b&#39;_CH&#39;: 10, 10: &#39;_CH&#39;, &#39;_D&#39;: 11, b&#39;_D&#39;: 11, 11: &#39;_D&#39;, &#39;_DH&#39;: 12, b&#39;_DH&#39;: 12, 12: &#39;_DH&#39;, &#39;_EE&#39;: 21, b&#39;_EE&#39;: 21, 21: &#39;_EE&#39;, &#39;_EI&#39;: 14, b&#39;_EI&#39;: 14, 14: &#39;_EI&#39;, &#39;_ER&#39;: 7, b&#39;_ER&#39;: 7, 7: &#39;_ER&#39;, &#39;_E&#39;: 13, b&#39;_E&#39;: 13, 13: &#39;_E&#39;, &#39;_F&#39;: 16, b&#39;_F&#39;: 16, 16: &#39;_F&#39;, &#39;_G&#39;: 17, b&#39;_G&#39;: 17, 17: &#39;_G&#39;, &#39;_H&#39;: 18, b&#39;_H&#39;: 18, 18: &#39;_H&#39;, &#39;_IA&#39;: 20, b&#39;_IA&#39;: 20, 20: &#39;_IA&#39;, &#39;_IE&#39;: 8, b&#39;_IE&#39;: 8, 8: &#39;_IE&#39;, &#39;_I&#39;: 19, b&#39;_I&#39;: 19, 19: &#39;_I&#39;, &#39;_J&#39;: 22, b&#39;_J&#39;: 22, 22: &#39;_J&#39;, &#39;_K&#39;: 23, b&#39;_K&#39;: 23, 23: &#39;_K&#39;, &#39;_KK&#39;: 23, b&#39;_KK&#39;: 23, &#39;_L&#39;: 24, b&#39;_L&#39;: 24, 24: &#39;_L&#39;, &#39;_M&#39;: 25, b&#39;_M&#39;: 25, 25: &#39;_M&#39;, &#39;_NG&#39;: 27, b&#39;_NG&#39;: 27, 27: &#39;_NG&#39;, &#39;_N&#39;: 26, b&#39;_N&#39;: 26, 26: &#39;_N&#39;, &#39;_OA&#39;: 28, b&#39;_OA&#39;: 28, 28: &#39;_OA&#39;, &#39;_OO&#39;: 37.2, b&#39;_OO&#39;: 37.2, 37.2: &#39;_OO&#39;, &#39;_OR&#39;: 40.3, b&#39;_OR&#39;: 40.3, 40.3: &#39;_OR&#39;, &#39;_OW&#39;: 5, b&#39;_OW&#39;: 5, 5: &#39;_OW&#39;, &#39;_OY&#39;: 30, b&#39;_OY&#39;: 30, 30: &#39;_OY&#39;, &#39;_O&#39;: 4, b&#39;_O&#39;: 4, 4: &#39;_O&#39;, &#39;_P&#39;: 31, b&#39;_P&#39;: 31, 31: &#39;_P&#39;, &#39;_PP&#39;: 31, b&#39;_PP&#39;: 31, &#39;_R&#39;: 32, b&#39;_R&#39;: 32, 32: &#39;_R&#39;, &#39;_SH&#39;: 34, b&#39;_SH&#39;: 34, 34: &#39;_SH&#39;, &#39;_S&#39;: 33, b&#39;_S&#39;: 33, 33: &#39;_S&#39;, &#39;_TH&#39;: 36, b&#39;_TH&#39;: 36, 36: &#39;_TH&#39;, &#39;_T&#39;: 35, b&#39;_T&#39;: 35, 35: &#39;_T&#39;, &#39;_TT&#39;: 35, b&#39;_TT&#39;: 35, &#39;_UU&#39;: 39, b&#39;_UU&#39;: 39, 39: &#39;_UU&#39;, &#39;_U&#39;: 3, b&#39;_U&#39;: 3, 3: &#39;_U&#39;, &#39;_V&#39;: 41, b&#39;_V&#39;: 41, 41: &#39;_V&#39;, &#39;_W&#39;: 42, b&#39;_W&#39;: 42, 42: &#39;_W&#39;, &#39;_Y&#39;: 43, b&#39;_Y&#39;: 43, 43: &#39;_Y&#39;, &#39;_ZH&#39;: 45, b&#39;_ZH&#39;: 45, 45: &#39;_ZH&#39;, &#39;_Z&#39;: 44, b&#39;_Z&#39;: 44, 44: &#39;_Z&#39;, 37: &#39;_AW&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Dolphin Apollo 2 serial-port and parallel-port hardware synthesizers (in case anybody still uses those)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;_K_W&#39;, &#39;_Q&#39;), (&#39;_K_S&#39;, &#39;_X&#39;)], (&#39;settings&#39;, &#39;cvtOut_regexps&#39;): [(&#39;_Q&#39;, &#39;_K_W&#39;), (&#39;_X&#39;, &#39;_K_S&#39;)]}, &#39;dectalk&#39;: {47: &#39;&#39;, &#34;&#39;&#34;: 47.1, b&#34;&#39;&#34;: 47.1, 47.1: &#34;&#39;&#34;, &#39;aa&#39;: 4, b&#39;aa&#39;: 4, 4: &#39;aa&#39;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, 2: &#39;ae&#39;, &#39;ah&#39;: 3, b&#39;ah&#39;: 3, 3: &#39;ah&#39;, &#39;ao&#39;: 40, b&#39;ao&#39;: 40, 40: &#39;ao&#39;, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, 5: &#39;aw&#39;, &#39;ax&#39;: 6, b&#39;ax&#39;: 6, 6: &#39;ax&#39;, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, 8: &#39;ay&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;dx&#39;: 11, b&#39;dx&#39;: 11, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;eh&#39;: 13, b&#39;eh&#39;: 13, 13: &#39;eh&#39;, &#39;el&#39;: 24, b&#39;el&#39;: 24, &#39;ey&#39;: 15, b&#39;ey&#39;: 15, 15: &#39;ey&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;hx&#39;: 18, b&#39;hx&#39;: 18, 18: &#39;hx&#39;, &#39;ih&#39;: 19, b&#39;ih&#39;: 19, 19: &#39;ih&#39;, &#39;ix&#39;: 19, b&#39;ix&#39;: 19, &#39;iy&#39;: 21, b&#39;iy&#39;: 21, 21: &#39;iy&#39;, &#39;q&#39;: 21, b&#39;q&#39;: 21, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;lx&#39;: 24, b&#39;lx&#39;: 24, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;nx&#39;: 27, b&#39;nx&#39;: 27, 27: &#39;nx&#39;, &#39;ow&#39;: 28, b&#39;ow&#39;: 28, 28: &#39;ow&#39;, &#39;oy&#39;: 30, b&#39;oy&#39;: 30, 30: &#39;oy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;rx&#39;: 32, b&#39;rx&#39;: 32, &#39;rr&#39;: 7, b&#39;rr&#39;: 7, 7: &#39;rr&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;tx&#39;: 35, b&#39;tx&#39;: 35, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;uh&#39;: 37.2, b&#39;uh&#39;: 37.2, 37.2: &#39;uh&#39;, &#39;uw&#39;: 39, b&#39;uw&#39;: 39, 39: &#39;uw&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;yx&#39;: 43, b&#39;yx&#39;: 43, 43: &#39;yx&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, &#39;ihr&#39;: 20, b&#39;ihr&#39;: 20, 20: &#39;ihr&#39;, 14: &#39;ehr&#39;, 37: &#39;ao&#39;, 1: &#39;ae&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;DECtalk hardware synthesizers (American English)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;yxuw&#39;, &#39;yu&#39;)], (&#39;settings&#39;, &#39;cvtOut_regexps&#39;): [(&#39;yu&#39;, &#39;yxuw&#39;)], (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;inline_header&#39;): &#39;[:phoneme on]\n&#39;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;[%s]&#39;}, &#39;doubletalk&#39;: {47: &#39;&#39;, &#39;/&#39;: 47.1, b&#39;/&#39;: 47.1, 47.1: &#39;/&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NX&#39;: 27, b&#39;NX&#39;: 27, 27: &#39;NX&#39;, &#39;O&#39;: 28, b&#39;O&#39;: 28, 28: &#39;O&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, 4: &#39;O&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;ZH&#39;: 45, b&#39;ZH&#39;: 45, 45: &#39;ZH&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;PX&#39;: 31, b&#39;PX&#39;: 31, &#39;TX&#39;: 35, b&#39;TX&#39;: 35, &#39;WH&#39;: 42, b&#39;WH&#39;: 42, &#39;KX&#39;: 23, b&#39;KX&#39;: 23, &#39;YY&#39;: 43, b&#39;YY&#39;: 43, 43: &#39;YY&#39;, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, &#39;UH&#39;: 37.2, b&#39;UH&#39;: 37.2, 37.2: &#39;UH&#39;, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, 39: &#39;UW&#39;, &#39;AA&#39;: 1, b&#39;AA&#39;: 1, 1: &#39;AA&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;AH&#39;: 3, b&#39;AH&#39;: 3, 3: &#39;AH&#39;, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, &#39;AX&#39;: 6, b&#39;AX&#39;: 6, 6: &#39;AX&#39;, &#39;AY&#39;: 8, b&#39;AY&#39;: 8, 8: &#39;AY&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;DX&#39;: 35, b&#39;DX&#39;: 35, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, &#39;ER&#39;: 7, b&#39;ER&#39;: 7, 7: &#39;ER&#39;, &#39;EY&#39;: 15, b&#39;EY&#39;: 15, 15: &#39;EY&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;H&#39;: 18, b&#39;H&#39;: 18, 18: &#39;H&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;IX&#39;: 19, b&#39;IX&#39;: 19, &#39;IY&#39;: 21, b&#39;IY&#39;: 21, 21: &#39;IY&#39;, &#39;JH&#39;: 22, b&#39;JH&#39;: 22, 22: &#39;JH&#39;, 14: &#39;EH R&#39;, 20: &#39;IY AH&#39;, 37: &#39;AO&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;DoubleTalk PC/LT serial-port hardware synthesizers (American English; assumes DOS driver by default, otherwise set DTALK_COMMAND_CODE to your current command-code binary value, e.g. export DTALK_COMMAND_CODE=1)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;inline_format&#39;): &lt;function markup_doubleTalk_word&gt;, (&#39;settings&#39;, &#39;format_is_binary&#39;): &#39;&#39;}, &#39;keynote&#39;: {47: &#39;&#39;, 47.1: &#34;&#39;&#34;, &#34;&#39;&#34;: 47.1, 47.2: &#39;&#34;&#39;, &#39;&#34;&#39;: 47.2, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;e&#39;: 15, b&#39;e&#39;: 15, 15: &#39;e&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, 2: &#39;ae&#39;, &#39;u&#39;: 39, b&#39;u&#39;: 39, 39: &#39;u&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;o&#39;: 28, b&#39;o&#39;: 28, 28: &#39;o&#39;, &#39;O&#39;: 40, b&#39;O&#39;: 40, 40: &#39;O&#39;, &#39;a&#39;: 4, b&#39;a&#39;: 4, 4: &#39;a&#39;, &#39;^&#39;: 3, b&#39;^&#39;: 3, 3: &#39;^&#39;, &#39;R&#39;: 7, b&#39;R&#39;: 7, 7: &#39;R&#39;, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, 8: &#39;ay&#39;, &#39;Oy&#39;: 30, b&#39;Oy&#39;: 30, 30: &#39;Oy&#39;, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, 5: &#39;aw&#39;, &#39;=&#39;: 6, b&#39;=&#39;: 6, 6: &#39;=&#39;, 14: &#39;E r&#39;, 20: &#39;i ^&#39;, 37: &#39;O&#39;, 1: &#39;ae&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Phoneme-read and lexicon-add codes for Keynote Gold hardware synthesizers (American English)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;[p]%s[t]&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;keynote.dat&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;[x]%s %s&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;[t]\n&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): False}, &#39;audapter&#39;: {47: &#39;&#39;, 47.1: &#34;&#39;&#34;, &#34;&#39;&#34;: 47.1, 47.2: &#39;&#34;&#39;, &#39;&#34;&#39;: 47.2, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;th&#39;: 36, b&#39;th&#39;: 36, 36: &#39;th&#39;, &#39;dh&#39;: 12, b&#39;dh&#39;: 12, 12: &#39;dh&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;zh&#39;: 45, b&#39;zh&#39;: 45, 45: &#39;zh&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;jh&#39;: 22, b&#39;jh&#39;: 22, 22: &#39;jh&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;e&#39;: 15, b&#39;e&#39;: 15, 15: &#39;e&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;ae&#39;: 2, b&#39;ae&#39;: 2, 2: &#39;ae&#39;, &#39;u&#39;: 39, b&#39;u&#39;: 39, 39: &#39;u&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;o&#39;: 28, b&#39;o&#39;: 28, 28: &#39;o&#39;, &#39;O&#39;: 40, b&#39;O&#39;: 40, 40: &#39;O&#39;, &#39;a&#39;: 4, b&#39;a&#39;: 4, 4: &#39;a&#39;, &#39;^&#39;: 3, b&#39;^&#39;: 3, 3: &#39;^&#39;, &#39;R&#39;: 7, b&#39;R&#39;: 7, 7: &#39;R&#39;, &#39;ay&#39;: 8, b&#39;ay&#39;: 8, 8: &#39;ay&#39;, &#39;Oy&#39;: 30, b&#39;Oy&#39;: 30, 30: &#39;Oy&#39;, &#39;aw&#39;: 5, b&#39;aw&#39;: 5, 5: &#39;aw&#39;, &#39;=&#39;: 6, b&#39;=&#39;: 6, 6: &#39;=&#39;, 14: &#39;E r&#39;, 20: &#39;i ^&#39;, 37: &#39;O&#39;, 1: &#39;ae&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Audapter Speech System, an old hardware serial/parallel-port synthesizer (American English)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;\x05[p] %s\x05[t]&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;audapter.dat&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;\x05[x]%s %s\x05[t]\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): False, (&#39;settings&#39;, &#39;format_is_binary&#39;): True}, &#39;bbcmicro&#39;: {47: &#39;&#39;, &#39;4&#39;: 47.1, b&#39;4&#39;: 47.1, 47.1: &#39;4&#39;, &#39;5&#39;: 47.2, b&#39;5&#39;: 47.2, 47.2: &#39;5&#39;, &#39;AA&#39;: 1, b&#39;AA&#39;: 1, 1: &#39;AA&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;AH&#39;: 3, b&#39;AH&#39;: 3, 3: &#39;AH&#39;, &#39;O&#39;: 4, b&#39;O&#39;: 4, 4: &#39;O&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, 6: &#39;AH&#39;, &#39;ER&#39;: 7, b&#39;ER&#39;: 7, 7: &#39;ER&#39;, &#39;IY&#39;: 8, b&#39;IY&#39;: 8, 8: &#39;IY&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, 7.1: &#39;ER&#39;, &#39;AI&#39;: 14, b&#39;AI&#39;: 14, 14: &#39;AI&#39;, &#39;AY&#39;: 15, b&#39;AY&#39;: 15, 15: &#39;AY&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;/H&#39;: 18, b&#39;/H&#39;: 18, 18: &#39;/H&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;IX&#39;: 19.2, b&#39;IX&#39;: 19.2, 19.2: &#39;IX&#39;, &#39;IXAH&#39;: 20, b&#39;IXAH&#39;: 20, 20: &#39;IXAH&#39;, &#39;EER&#39;: 20.2, b&#39;EER&#39;: 20.2, 20.2: &#39;EER&#39;, &#39;EE&#39;: 21, b&#39;EE&#39;: 21, 21: &#39;EE&#39;, &#39;J&#39;: 22, b&#39;J&#39;: 22, 22: &#39;J&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;C&#39;: 23, b&#39;C&#39;: 23, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NX&#39;: 27, b&#39;NX&#39;: 27, 27: &#39;NX&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, 28: &#39;OW&#39;, &#39;OL&#39;: 29, b&#39;OL&#39;: 29, 29: &#39;OL&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;AOR&#39;: 37, b&#39;AOR&#39;: 37, 37: &#39;AOR&#39;, &#39;UH&#39;: 37, b&#39;UH&#39;: 37, 37.2: &#39;UH&#39;, &#39;/U&#39;: 37.2, b&#39;/U&#39;: 37.2, &#39;/UL&#39;: 38, b&#39;/UL&#39;: 38, 38: &#39;/UL&#39;, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, 39: &#39;UW&#39;, &#39;UX&#39;: 39, b&#39;UX&#39;: 39, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, 43: &#39;Y&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;ZH&#39;: 45, b&#39;ZH&#39;: 45, 45: &#39;ZH&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;BBC Micro Speech program from 1985 (see comments in lexconvert.py for more details)&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;BBCLEX&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): b&#39;&gt; %s_\x80%s&#39;, (&#39;settings&#39;, &#39;lex_read_function&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;lex_word_case&#39;): &#39;upper&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &lt;function bbc_prepDefaultLex&gt;, (&#39;settings&#39;, &#39;lex_footer&#39;): &lt;function bbc_appendDefaultLex&gt;, (&#39;settings&#39;, &#39;inline_format&#39;): &lt;function markup_bbcMicro_word&gt;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): &lt;function write_bbcmicro_phones&gt;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;KT&#39;, &#39;CT&#39;), (&#39;DYUW&#39;, &#39;DUX&#39;), (&#39;AHR$&#39;, &#39;AH&#39;)], (&#39;settings&#39;, &#39;cvtOut_regexps&#39;): [(&#39;DUX&#39;, &#39;DYUW&#39;)]}, &#39;bbcmicro-cc&#39;: {47: &#39;&#39;, &#39;*&#39;: 47.1, b&#39;*&#39;: 47.1, 47.1: &#39;*&#39;, &#39;+&#39;: 47.2, b&#39;+&#39;: 47.2, 47.2: &#39;+&#39;, &#39;E&#39;: 21, b&#39;E&#39;: 21, 21: &#39;E&#39;, &#39;i&#39;: 19, b&#39;i&#39;: 19, 19: &#39;i&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13: &#39;e&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, 2: &#39;a&#39;, &#39;u&#39;: 3, b&#39;u&#39;: 3, 3: &#39;u&#39;, &#39;AR&#39;: 1, b&#39;AR&#39;: 1, 1: &#39;AR&#39;, &#39;o&#39;: 4, b&#39;o&#39;: 4, 4: &#39;o&#39;, &#39;OR&#39;: 40, b&#39;OR&#39;: 40, 40: &#39;OR&#39;, &#39;oo&#39;: 37.2, b&#39;oo&#39;: 37.2, 37.2: &#39;oo&#39;, &#39;OO&#39;: 39, b&#39;OO&#39;: 39, 39: &#39;OO&#39;, &#39;ER&#39;: 7, b&#39;ER&#39;: 7, 7: &#39;ER&#39;, &#39;A&#39;: 15, b&#39;A&#39;: 15, 15: &#39;A&#39;, &#39;I&#39;: 8, b&#39;I&#39;: 8, 8: &#39;I&#39;, &#39;O&#39;: 28, b&#39;O&#39;: 28, 28: &#39;O&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, &#39;EA&#39;: 20, b&#39;EA&#39;: 20, 20: &#39;EA&#39;, &#39;ea&#39;: 14, b&#39;ea&#39;: 14, 14: &#39;ea&#39;, &#39;UR&#39;: 37, b&#39;UR&#39;: 37, 37: &#39;UR&#39;, &#39;UH&#39;: 6, b&#39;UH&#39;: 6, 6: &#39;UH&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;J&#39;: 22, b&#39;J&#39;: 22, 22: &#39;J&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;ZH&#39;: 45, b&#39;ZH&#39;: 45, 45: &#39;ZH&#39;, &#39;H&#39;: 18, b&#39;H&#39;: 18, 18: &#39;H&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NG&#39;: 27, b&#39;NG&#39;: 27, 27: &#39;NG&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, 43: &#39;Y&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Computer Concepts Speech ROM which provided phonemes for the BBC Micro\&#39;s TMS5220 &#34;speech chip&#34; add-on (less widely sold than the software-only product)&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;inline_header&#39;): &#39;*UTTER &lt;1&gt; &#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): &#39;\n*UTTER &lt;1&gt; &#39;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;[*] &#39;, &#39;*&#39;), (&#39;[+] &#39;, &#39;+&#39;)], (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): &#39; &#39;}, &#39;amiga&#39;: {47: &#39;&#39;, &#39;4&#39;: 47.1, b&#39;4&#39;: 47.1, 47.1: &#39;4&#39;, &#39;3&#39;: 47.2, b&#39;3&#39;: 47.2, 47.2: &#39;3&#39;, &#39;/H&#39;: 18, b&#39;/H&#39;: 18, 18: &#39;/H&#39;, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, 28: &#39;OW&#39;, &#39;AY&#39;: 8, b&#39;AY&#39;: 8, 8: &#39;AY&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;IY&#39;: 21, b&#39;IY&#39;: 21, 21: &#39;IY&#39;, &#39;AH&#39;: 6, b&#39;AH&#39;: 6, 6: &#39;AH&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;U&#39;: 3, b&#39;U&#39;: 3, 3: &#39;U&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, 43: &#39;Y&#39;, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, 39: &#39;UW&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;ER&#39;: 6.1, b&#39;ER&#39;: 6.1, 6.1: &#39;ER&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, &#39;AA&#39;: 1, b&#39;AA&#39;: 1, 1: &#39;AA&#39;, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NX&#39;: 27, b&#39;NX&#39;: 27, 27: &#39;NX&#39;, &#39;J&#39;: 22, b&#39;J&#39;: 22, 22: &#39;J&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;OH&#39;: 40, b&#39;OH&#39;: 40, 40: &#39;OH&#39;, &#39;EY&#39;: 15, b&#39;EY&#39;: 15, 15: &#39;EY&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;O&#39;: 4, b&#39;O&#39;: 4, 4: &#39;O&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, 14: &#39;EH&#39;, 7: &#39;ER&#39;, 7.1: &#39;ER&#39;, 20: &#39;IYAH&#39;, 45: &#39;J&#39;, 37: &#39;OH&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;AmigaOS speech synthesizer (American English)&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;}, &#39;sam&#39;: {47: &#39;&#39;, 47.1: &#39;4&#39;, &#39;4&#39;: 47.1, 47.2: &#39;5&#39;, &#39;5&#39;: 47.2, &#39;IY&#39;: 21, b&#39;IY&#39;: 21, 21: &#39;IY&#39;, &#39;IH&#39;: 19, b&#39;IH&#39;: 19, 19: &#39;IH&#39;, &#39;EH&#39;: 13, b&#39;EH&#39;: 13, 13: &#39;EH&#39;, &#39;AE&#39;: 2, b&#39;AE&#39;: 2, 2: &#39;AE&#39;, &#39;AA&#39;: 4, b&#39;AA&#39;: 4, 4: &#39;AA&#39;, &#39;AH&#39;: 3, b&#39;AH&#39;: 3, 3: &#39;AH&#39;, &#39;AO&#39;: 40, b&#39;AO&#39;: 40, 40: &#39;AO&#39;, &#39;OH&#39;: 28, b&#39;OH&#39;: 28, 28: &#39;OH&#39;, &#39;UH&#39;: 37.2, b&#39;UH&#39;: 37.2, 37.2: &#39;UH&#39;, &#39;UX&#39;: 39, b&#39;UX&#39;: 39, 39: &#39;UX&#39;, &#39;ER&#39;: 7, b&#39;ER&#39;: 7, 7: &#39;ER&#39;, &#39;AX&#39;: 2, b&#39;AX&#39;: 2, &#39;IX&#39;: 19, b&#39;IX&#39;: 19, &#39;EY&#39;: 15, b&#39;EY&#39;: 15, 15: &#39;EY&#39;, &#39;AY&#39;: 8, b&#39;AY&#39;: 8, 8: &#39;AY&#39;, &#39;OY&#39;: 30, b&#39;OY&#39;: 30, 30: &#39;OY&#39;, &#39;AW&#39;: 5, b&#39;AW&#39;: 5, 5: &#39;AW&#39;, &#39;OW&#39;: 28, b&#39;OW&#39;: 28, &#39;UW&#39;: 39, b&#39;UW&#39;: 39, &#39;R&#39;: 32, b&#39;R&#39;: 32, 32: &#39;R&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;WH&#39;: 42, b&#39;WH&#39;: 42, &#39;Y&#39;: 43, b&#39;Y&#39;: 43, 43: &#39;Y&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;NX&#39;: 27, b&#39;NX&#39;: 27, 27: &#39;NX&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;J&#39;: 22, b&#39;J&#39;: 22, 22: &#39;J&#39;, &#39;ZH&#39;: 45, b&#39;ZH&#39;: 45, 45: &#39;ZH&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;DH&#39;: 12, b&#39;DH&#39;: 12, 12: &#39;DH&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;SH&#39;: 34, b&#39;SH&#39;: 34, 34: &#39;SH&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;TH&#39;: 36, b&#39;TH&#39;: 36, 36: &#39;TH&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;CH&#39;: 10, b&#39;CH&#39;: 10, 10: &#39;CH&#39;, &#39;/H&#39;: 18, b&#39;/H&#39;: 18, 18: &#39;/H&#39;, &#39;Q&#39;: 46, b&#39;Q&#39;: 46, 46: &#39;Q&#39;, 6: &#39;AH&#39;, 14: &#39;EHR&#39;, 20: &#39;IYAH&#39;, 37: &#39;AO&#39;, 1: &#39;AE&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Software Automatic Mouth (1982 American English synth that ran on C64, Atari 400/800/etc and Apple II/etc)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;}, &#39;speakjet&#39;: {47: &#39;&#39;, &#39;128&#39;: 21, b&#39;128&#39;: 21, 21: &#39;128&#39;, &#39;129&#39;: 19, b&#39;129&#39;: 19, 19: &#39;129&#39;, &#39;130&#39;: 15, b&#39;130&#39;: 15, 15: &#39;130&#39;, &#39;131&#39;: 13, b&#39;131&#39;: 13, 13: &#39;131&#39;, &#39;132&#39;: 2, b&#39;132&#39;: 2, 2: &#39;132&#39;, &#39;133&#39;: 6, b&#39;133&#39;: 6, 6: &#39;133&#39;, &#39;134&#39;: 3, b&#39;134&#39;: 3, 3: &#39;134&#39;, &#39;135&#39;: 4, b&#39;135&#39;: 4, 4: &#39;135&#39;, &#39;136&#39;: 1, b&#39;136&#39;: 1, 1: &#39;136&#39;, &#39;137&#39;: 28, b&#39;137&#39;: 28, 28: &#39;137&#39;, &#39;138&#39;: 37.2, b&#39;138&#39;: 37.2, 37.2: &#39;138&#39;, &#39;139&#39;: 39, b&#39;139&#39;: 39, 39: &#39;139&#39;, &#39;140&#39;: 25, b&#39;140&#39;: 25, 25: &#39;140&#39;, &#39;141&#39;: 26, b&#39;141&#39;: 26, &#39;142&#39;: 26, b&#39;142&#39;: 26, 26: &#39;142&#39;, &#39;143&#39;: 27, b&#39;143&#39;: 27, &#39;144&#39;: 27, b&#39;144&#39;: 27, 27: &#39;144&#39;, &#39;145&#39;: 24, b&#39;145&#39;: 24, &#39;146&#39;: 24, b&#39;146&#39;: 24, 24: &#39;146&#39;, &#39;147&#39;: 42, b&#39;147&#39;: 42, 42: &#39;147&#39;, &#39;148&#39;: 32, b&#39;148&#39;: 32, 32: &#39;148&#39;, &#39;149&#39;: 20, b&#39;149&#39;: 20, 20: &#39;149&#39;, &#39;150&#39;: 14, b&#39;150&#39;: 14, 14: &#39;150&#39;, &#39;151&#39;: 7, b&#39;151&#39;: 7, 7: &#39;151&#39;, &#39;152&#39;: 1, b&#39;152&#39;: 1, &#39;153&#39;: 40, b&#39;153&#39;: 40, 40: &#39;153&#39;, &#39;154&#39;: 15, b&#39;154&#39;: 15, &#39;155&#39;: 8, b&#39;155&#39;: 8, 8: &#39;155&#39;, &#39;156&#39;: 30, b&#39;156&#39;: 30, 30: &#39;156&#39;, &#39;157&#39;: 8, b&#39;157&#39;: 8, &#39;158&#39;: 43, b&#39;158&#39;: 43, 43: &#39;158&#39;, &#39;159&#39;: 24, b&#39;159&#39;: 24, &#39;160&#39;: 39, b&#39;160&#39;: 39, &#39;161&#39;: 5, b&#39;161&#39;: 5, 5: &#39;161&#39;, &#39;162&#39;: 39, b&#39;162&#39;: 39, &#39;164&#39;: 28, b&#39;164&#39;: 28, &#39;165&#39;: 22, b&#39;165&#39;: 22, 22: &#39;165&#39;, &#39;166&#39;: 41, b&#39;166&#39;: 41, 41: &#39;166&#39;, &#39;167&#39;: 44, b&#39;167&#39;: 44, 44: &#39;167&#39;, &#39;168&#39;: 45, b&#39;168&#39;: 45, 45: &#39;168&#39;, &#39;169&#39;: 12, b&#39;169&#39;: 12, 12: &#39;169&#39;, &#39;170&#39;: 9, b&#39;170&#39;: 9, &#39;171&#39;: 9, b&#39;171&#39;: 9, 9: &#39;171&#39;, &#39;172&#39;: 9, b&#39;172&#39;: 9, &#39;173&#39;: 9, b&#39;173&#39;: 9, &#39;174&#39;: 11, b&#39;174&#39;: 11, &#39;175&#39;: 11, b&#39;175&#39;: 11, 11: &#39;175&#39;, &#39;176&#39;: 11, b&#39;176&#39;: 11, &#39;177&#39;: 11, b&#39;177&#39;: 11, &#39;178&#39;: 17, b&#39;178&#39;: 17, &#39;179&#39;: 17, b&#39;179&#39;: 17, 17: &#39;179&#39;, &#39;180&#39;: 17, b&#39;180&#39;: 17, &#39;181&#39;: 17, b&#39;181&#39;: 17, &#39;182&#39;: 10, b&#39;182&#39;: 10, 10: &#39;182&#39;, &#39;183&#39;: 18, b&#39;183&#39;: 18, &#39;184&#39;: 18, b&#39;184&#39;: 18, 18: &#39;184&#39;, &#39;185&#39;: 42, b&#39;185&#39;: 42, &#39;186&#39;: 16, b&#39;186&#39;: 16, 16: &#39;186&#39;, &#39;187&#39;: 33, b&#39;187&#39;: 33, &#39;188&#39;: 33, b&#39;188&#39;: 33, 33: &#39;188&#39;, &#39;189&#39;: 34, b&#39;189&#39;: 34, 34: &#39;189&#39;, &#39;190&#39;: 36, b&#39;190&#39;: 36, 36: &#39;190&#39;, &#39;191&#39;: 35, b&#39;191&#39;: 35, 35: &#39;191&#39;, &#39;192&#39;: 35, b&#39;192&#39;: 35, &#39;194&#39;: 23, b&#39;194&#39;: 23, &#39;195&#39;: 23, b&#39;195&#39;: 23, 23: &#39;195&#39;, &#39;196&#39;: 23, b&#39;196&#39;: 23, &#39;197&#39;: 23, b&#39;197&#39;: 23, &#39;198&#39;: 31, b&#39;198&#39;: 31, &#39;199&#39;: 31, b&#39;199&#39;: 31, 31: &#39;199&#39;, 37: &#39;153&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Allophone codes for the American English &#34;SpeakJet&#34; speech synthesis chip (the conversion from phonemes to allophones might need tweaking).  Set the SPEAKJET_SYM environment variable to use mnemonics, otherwise numbers are used (set SPEAKJET_BINARY for binary output).&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): &#39;\n&#39;, (&#39;settings&#39;, &#39;output_is_binary&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;rsynth&#39;: {47: &#39;&#39;, &#39;i:&#39;: 21, b&#39;i:&#39;: 21, 21: &#39;i:&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;{&#39;: 2, b&#39;{&#39;: 2, 2: &#39;{&#39;, &#39;V&#39;: 3, b&#39;V&#39;: 3, 3: &#39;V&#39;, &#39;Q&#39;: 4, b&#39;Q&#39;: 4, 4: &#39;Q&#39;, &#39;A:&#39;: 1, b&#39;A:&#39;: 1, 1: &#39;A:&#39;, &#39;oU&#39;: 28, b&#39;oU&#39;: 28, 28: &#39;oU&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;u:&#39;: 39, b&#39;u:&#39;: 39, 39: &#39;u:&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;I@&#39;: 20, b&#39;I@&#39;: 20, 20: &#39;I@&#39;, &#39;e@&#39;: 14, b&#39;e@&#39;: 14, 14: &#39;e@&#39;, &#39;3:&#39;: 7, b&#39;3:&#39;: 7, 7: &#39;3:&#39;, &#39;Qr&#39;: 40, b&#39;Qr&#39;: 40, 40: &#39;Qr&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;U@&#39;: 39, b&#39;U@&#39;: 39, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;aU&#39;, &#39;@U&#39;: 28, b&#39;@U&#39;: 28, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, 6: &#39;V&#39;, 37: &#39;Qr&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;rsynth text-to-speech C library (American English)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;}, &#39;unicode-ipa&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;&#39;, &#39;&#39;: 47.1, b&#39;\xcb\x88&#39;: 47.1, 47.1: &#39;&#39;, &#39;&#39;: 47.2, b&#39;\xcb\x8c&#39;: 47.2, 47.2: &#39;&#39;, &#39;#&#39;: 48, b&#39;#&#39;: 48, 48: &#39;#&#39;, &#39;_&#39;: 49, b&#39;_&#39;: 49, 49: &#39;_&#39;, &#39;?&#39;: 50, b&#39;?&#39;: 50, 50: &#39;?&#39;, &#39;!&#39;: 51, b&#39;!&#39;: 51, 51: &#39;!&#39;, &#39;,&#39;: 52, b&#39;,&#39;: 52, 52: &#39;,&#39;, &#39;&#39;: 1, b&#39;\xc9\x91&#39;: 1, 1: &#39;&#39;, &#39;&#39;: 53, b&#39;\xcb\x90&#39;: 53, 53: &#39;&#39;, &#39;&#39;: 1.2, b&#39;\xc9\x91\xcb\x90&#39;: 1.2, 1.2: &#39;&#39;, &#39;&#39;: 1.3, b&#39;\xc9\x91\xc9\xb9&#39;: 1.3, 1.3: &#39;&#39;, &#39;a&#39;: 1.4, b&#39;a\xcb\x90&#39;: 1.4, 1.4: &#39;a&#39;, &#39;&#39;: 2, b&#39;\xc3\xa6&#39;: 2, 2: &#39;&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, &#39;&#39;: 3, b&#39;\xca\x8c&#39;: 3, 3: &#39;&#39;, &#39;&#39;: 3, b&#39;\xe1\xb4\xa7&#39;: 3, &#39;&#39;: 4, b&#39;\xc9\x92&#39;: 4, 4: &#39;&#39;, 4.1: &#39;&#39;, &#39;&#39;: 4.2, b&#39;\xc9\x94&#39;: 4.2, 4.2: &#39;&#39;, &#39;a&#39;: 5, b&#39;a\xca\x8a&#39;: 5, 5: &#39;a&#39;, &#39;&#39;: 5.1, b&#39;\xc3\xa6\xc9\x94&#39;: 5.1, 5.1: &#39;&#39;, &#39;&#39;: 6, b&#39;\xc9\x99&#39;: 6, 6: &#39;&#39;, &#39;&#39;: 7, b&#39;\xc9\x99\xcb\x90&#39;: 7, 7: &#39;&#39;, &#39;&#39;: 6.1, b&#39;\xc9\x9a&#39;: 6.1, 6.1: &#39;&#39;, &#39;a&#39;: 8, b&#39;a\xc9\xaa&#39;: 8, 8: &#39;a&#39;, &#39;&#39;: 8, b&#39;\xca\x8c\xc9\xaa&#39;: 8, &#39;e&#39;: 8.1, b&#39;\xc9\x91e&#39;: 8.1, 8.1: &#39;e&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t&#39;: 10, b&#39;t\xca\x83&#39;: 10, 10: &#39;t&#39;, &#39;&#39;: 10, b&#39;\xca\xa7&#39;: 10, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;&#39;: 12, b&#39;\xc3\xb0&#39;: 12, 12: &#39;&#39;, &#39;&#39;: 13, b&#39;\xc9\x9b&#39;: 13, 13: &#39;&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9d&#39;: 7.1, 7.1: &#39;&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9c\xcb\x90&#39;: 7.1, &#39;&#39;: 14, b&#39;\xc9\x9b\xc9\x99&#39;: 14, 14: &#39;&#39;, &#39;&#39;: 14.1, b&#39;\xc9\x9b\xc9\xb9&#39;: 14.1, 14.1: &#39;&#39;, &#39;e&#39;: 14.2, b&#39;e\xcb\x90&#39;: 14.2, 14.2: &#39;e&#39;, &#39;&#39;: 14.3, b&#39;\xc9\x9b\xcb\x90&#39;: 14.3, 14.3: &#39;&#39;, &#39;e&#39;: 14.4, b&#39;e\xc9\x99&#39;: 14.4, 14.4: &#39;e&#39;, &#39;e&#39;: 15, b&#39;e\xc9\xaa&#39;: 15, 15: &#39;e&#39;, &#39;&#39;: 15.1, b&#39;\xc3\xa6\xc9\xaa&#39;: 15.1, 15.1: &#39;&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;&#39;: 17, b&#39;\xc9\xa1&#39;: 17, 17: &#39;&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;&#39;: 19, b&#39;\xc9\xaa&#39;: 19, 19: &#39;&#39;, &#39;&#39;: 19.1, b&#39;\xc9\xa8&#39;: 19.1, 19.1: &#39;&#39;, &#39;&#39;: 20, b&#39;\xc9\xaa\xc9\x99&#39;: 20, 20: &#39;&#39;, &#39;&#39;: 20.1, b&#39;\xc9\xaa\xc9\xb9&#39;: 20.1, 20.1: &#39;&#39;, &#39;&#39;: 20.2, b&#39;\xc9\xaa\xc9\xb9\xc9\x99&#39;: 20.2, 20.2: &#39;&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i&#39;: 21.1, b&#39;i\xcb\x90&#39;: 21.1, 21.1: &#39;i&#39;, &#39;d&#39;: 22, b&#39;d\xca\x92&#39;: 22, 22: &#39;d&#39;, &#39;&#39;: 22, b&#39;\xca\xa4&#39;: 22, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;d&#39;: 24.1, b&#39;d\xc9\xab&#39;: 24.1, 24.1: &#39;d&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;&#39;: 27, b&#39;\xc5\x8b&#39;: 27, 27: &#39;&#39;, &#39;&#39;: 28, b&#39;\xc9\x99\xca\x8a&#39;: 28, 28: &#39;&#39;, &#39;o&#39;: 28.1, b&#39;o&#39;: 28.1, 28.1: &#39;o&#39;, &#39;o&#39;: 28.2, b&#39;o\xca\x8a&#39;: 28.2, 28.2: &#39;o&#39;, &#39;&#39;: 3.1, b&#39;\xc9\x99\xca\x89&#39;: 3.1, 3.1: &#39;&#39;, &#39;&#39;: 30, b&#39;\xc9\x94\xc9\xaa&#39;: 30, 30: &#39;&#39;, &#39;o&#39;: 30.1, b&#39;o\xc9\xaa&#39;: 30.1, 30.1: &#39;o&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;&#39;: 32, b&#39;\xc9\xb9&#39;: 32, 32: &#39;&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;&#39;: 34, b&#39;\xca\x83&#39;: 34, 34: &#39;&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;&#39;: 35.1, b&#39;\xc9\xbe&#39;: 35.1, 35.1: &#39;&#39;, &#39;&#39;: 36, b&#39;\xce\xb8&#39;: 36, 36: &#39;&#39;, &#39;&#39;: 37, b&#39;\xca\x8a\xc9\x99&#39;: 37, 37: &#39;&#39;, &#39;&#39;: 37.1, b&#39;\xca\x8a\xc9\xb9&#39;: 37.1, 37.1: &#39;&#39;, &#39;&#39;: 37.2, b&#39;\xca\x8a&#39;: 37.2, 37.2: &#39;&#39;, &#39;&#39;: 39, b&#39;\xca\x89\xcb\x90&#39;: 39, 39: &#39;&#39;, &#39;u&#39;: 39.1, b&#39;u\xcb\x90&#39;: 39.1, 39.1: &#39;u&#39;, &#39;u&#39;: 39.2, b&#39;u&#39;: 39.2, 39.2: &#39;u&#39;, &#39;&#39;: 40, b&#39;\xc9\x94\xcb\x90&#39;: 40, 40: &#39;&#39;, 40.1: &#39;&#39;, &#39;o&#39;: 40.2, b&#39;o\xcb\x90&#39;: 40.2, 40.2: &#39;o&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;&#39;: 42.1, b&#39;\xca\x8d&#39;: 42.1, 42.1: &#39;&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;&#39;: 45, b&#39;\xca\x92&#39;: 45, 45: &#39;&#39;, &#39;&#39;: 46, b&#39;\xca\x94&#39;: 46, 46: &#39;&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;IPA symbols in Unicode, as used by an increasing number of dictionary programs, websites etc&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-ipa.html&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;HTML&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;&lt;html&gt;&lt;head&gt;&lt;meta name=&#34;mobileoptimized&#34; content=&#34;0&#34;&gt;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34;&gt;&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34;&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cvtOut_func&#39;): &lt;function unicode_preprocess&gt;}, &#39;unicode-ipa-syls&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;.&#39;, &#39;&#39;: 47.1, b&#39;\xcb\x88&#39;: 47.1, 47.1: &#39;&#39;, &#39;&#39;: 47.2, b&#39;\xcb\x8c&#39;: 47.2, 47.2: &#39;&#39;, &#39;#&#39;: 48, b&#39;#&#39;: 48, 48: &#39;#&#39;, &#39;_&#39;: 49, b&#39;_&#39;: 49, 49: &#39;_&#39;, &#39;?&#39;: 50, b&#39;?&#39;: 50, 50: &#39;?&#39;, &#39;!&#39;: 51, b&#39;!&#39;: 51, 51: &#39;!&#39;, &#39;,&#39;: 52, b&#39;,&#39;: 52, 52: &#39;,&#39;, &#39;&#39;: 1, b&#39;\xc9\x91&#39;: 1, 1: &#39;&#39;, &#39;&#39;: 53, b&#39;\xcb\x90&#39;: 53, 53: &#39;&#39;, &#39;&#39;: 1.2, b&#39;\xc9\x91\xcb\x90&#39;: 1.2, 1.2: &#39;&#39;, &#39;&#39;: 1.3, b&#39;\xc9\x91\xc9\xb9&#39;: 1.3, 1.3: &#39;&#39;, &#39;a&#39;: 1.4, b&#39;a\xcb\x90&#39;: 1.4, 1.4: &#39;a&#39;, &#39;&#39;: 2, b&#39;\xc3\xa6&#39;: 2, 2: &#39;&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, &#39;&#39;: 3, b&#39;\xca\x8c&#39;: 3, 3: &#39;&#39;, &#39;&#39;: 3, b&#39;\xe1\xb4\xa7&#39;: 3, &#39;&#39;: 4, b&#39;\xc9\x92&#39;: 4, 4: &#39;&#39;, 4.1: &#39;&#39;, &#39;&#39;: 4.2, b&#39;\xc9\x94&#39;: 4.2, 4.2: &#39;&#39;, &#39;a&#39;: 5, b&#39;a\xca\x8a&#39;: 5, 5: &#39;a&#39;, &#39;&#39;: 5.1, b&#39;\xc3\xa6\xc9\x94&#39;: 5.1, 5.1: &#39;&#39;, &#39;&#39;: 6, b&#39;\xc9\x99&#39;: 6, 6: &#39;&#39;, &#39;&#39;: 7, b&#39;\xc9\x99\xcb\x90&#39;: 7, 7: &#39;&#39;, &#39;&#39;: 6.1, b&#39;\xc9\x9a&#39;: 6.1, 6.1: &#39;&#39;, &#39;a&#39;: 8, b&#39;a\xc9\xaa&#39;: 8, 8: &#39;a&#39;, &#39;&#39;: 8, b&#39;\xca\x8c\xc9\xaa&#39;: 8, &#39;e&#39;: 8.1, b&#39;\xc9\x91e&#39;: 8.1, 8.1: &#39;e&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t&#39;: 10, b&#39;t\xca\x83&#39;: 10, 10: &#39;t&#39;, &#39;&#39;: 10, b&#39;\xca\xa7&#39;: 10, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;&#39;: 12, b&#39;\xc3\xb0&#39;: 12, 12: &#39;&#39;, &#39;&#39;: 13, b&#39;\xc9\x9b&#39;: 13, 13: &#39;&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9d&#39;: 7.1, 7.1: &#39;&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9c\xcb\x90&#39;: 7.1, &#39;&#39;: 14, b&#39;\xc9\x9b\xc9\x99&#39;: 14, 14: &#39;&#39;, &#39;&#39;: 14.1, b&#39;\xc9\x9b\xc9\xb9&#39;: 14.1, 14.1: &#39;&#39;, &#39;e&#39;: 14.2, b&#39;e\xcb\x90&#39;: 14.2, 14.2: &#39;e&#39;, &#39;&#39;: 14.3, b&#39;\xc9\x9b\xcb\x90&#39;: 14.3, 14.3: &#39;&#39;, &#39;e&#39;: 14.4, b&#39;e\xc9\x99&#39;: 14.4, 14.4: &#39;e&#39;, &#39;e&#39;: 15, b&#39;e\xc9\xaa&#39;: 15, 15: &#39;e&#39;, &#39;&#39;: 15.1, b&#39;\xc3\xa6\xc9\xaa&#39;: 15.1, 15.1: &#39;&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;&#39;: 17, b&#39;\xc9\xa1&#39;: 17, 17: &#39;&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;&#39;: 19, b&#39;\xc9\xaa&#39;: 19, 19: &#39;&#39;, &#39;&#39;: 19.1, b&#39;\xc9\xa8&#39;: 19.1, 19.1: &#39;&#39;, &#39;&#39;: 20, b&#39;\xc9\xaa\xc9\x99&#39;: 20, 20: &#39;&#39;, &#39;&#39;: 20.1, b&#39;\xc9\xaa\xc9\xb9&#39;: 20.1, 20.1: &#39;&#39;, &#39;&#39;: 20.2, b&#39;\xc9\xaa\xc9\xb9\xc9\x99&#39;: 20.2, 20.2: &#39;&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i&#39;: 21.1, b&#39;i\xcb\x90&#39;: 21.1, 21.1: &#39;i&#39;, &#39;d&#39;: 22, b&#39;d\xca\x92&#39;: 22, 22: &#39;d&#39;, &#39;&#39;: 22, b&#39;\xca\xa4&#39;: 22, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;d&#39;: 24.1, b&#39;d\xc9\xab&#39;: 24.1, 24.1: &#39;d&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;&#39;: 27, b&#39;\xc5\x8b&#39;: 27, 27: &#39;&#39;, &#39;&#39;: 28, b&#39;\xc9\x99\xca\x8a&#39;: 28, 28: &#39;&#39;, &#39;o&#39;: 28.1, b&#39;o&#39;: 28.1, 28.1: &#39;o&#39;, &#39;o&#39;: 28.2, b&#39;o\xca\x8a&#39;: 28.2, 28.2: &#39;o&#39;, &#39;&#39;: 3.1, b&#39;\xc9\x99\xca\x89&#39;: 3.1, 3.1: &#39;&#39;, &#39;&#39;: 30, b&#39;\xc9\x94\xc9\xaa&#39;: 30, 30: &#39;&#39;, &#39;o&#39;: 30.1, b&#39;o\xc9\xaa&#39;: 30.1, 30.1: &#39;o&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;&#39;: 32, b&#39;\xc9\xb9&#39;: 32, 32: &#39;&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;&#39;: 34, b&#39;\xca\x83&#39;: 34, 34: &#39;&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;&#39;: 35.1, b&#39;\xc9\xbe&#39;: 35.1, 35.1: &#39;&#39;, &#39;&#39;: 36, b&#39;\xce\xb8&#39;: 36, 36: &#39;&#39;, &#39;&#39;: 37, b&#39;\xca\x8a\xc9\x99&#39;: 37, 37: &#39;&#39;, &#39;&#39;: 37.1, b&#39;\xca\x8a\xc9\xb9&#39;: 37.1, 37.1: &#39;&#39;, &#39;&#39;: 37.2, b&#39;\xca\x8a&#39;: 37.2, 37.2: &#39;&#39;, &#39;&#39;: 39, b&#39;\xca\x89\xcb\x90&#39;: 39, 39: &#39;&#39;, &#39;u&#39;: 39.1, b&#39;u\xcb\x90&#39;: 39.1, 39.1: &#39;u&#39;, &#39;u&#39;: 39.2, b&#39;u&#39;: 39.2, 39.2: &#39;u&#39;, &#39;&#39;: 40, b&#39;\xc9\x94\xcb\x90&#39;: 40, 40: &#39;&#39;, 40.1: &#39;&#39;, &#39;o&#39;: 40.2, b&#39;o\xcb\x90&#39;: 40.2, 40.2: &#39;o&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;&#39;: 42.1, b&#39;\xca\x8d&#39;: 42.1, 42.1: &#39;&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;&#39;: 45, b&#39;\xca\x92&#39;: 45, 45: &#39;&#39;, &#39;&#39;: 46, b&#39;\xca\x94&#39;: 46, 46: &#39;&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Like unicode-ipa but with syllable separators preserved&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-ipa.html&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;HTML&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;&lt;html&gt;&lt;head&gt;&lt;meta name=&#34;mobileoptimized&#34; content=&#34;0&#34;&gt;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34;&gt;&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34;&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cvtOut_func&#39;): &lt;function unicode_preprocess&gt;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;\\.+&#39;, &#39;.&#39;)]}, &#39;yinghan&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;&#39;, &#39;&#39;: 47.1, b&#39;\xcb\x88&#39;: 47.1, 47.1: &#39;&#39;, &#39;&#39;: 47.2, b&#39;\xcb\x8c&#39;: 47.2, 47.2: &#39;&#39;, &#39;#&#39;: 48, b&#39;#&#39;: 48, 48: &#39;#&#39;, &#39;_&#39;: 49, b&#39;_&#39;: 49, 49: &#39;_&#39;, &#39;?&#39;: 50, b&#39;?&#39;: 50, 50: &#39;?&#39;, &#39;!&#39;: 51, b&#39;!&#39;: 51, 51: &#39;!&#39;, &#39;,&#39;: 52, b&#39;,&#39;: 52, 52: &#39;,&#39;, &#39;&#39;: 1, b&#39;\xc9\x91&#39;: 1, 1: &#39;&#39;, &#39;&#39;: 53, b&#39;\xcb\x90&#39;: 53, 53: &#39;&#39;, &#39;&#39;: 1.2, b&#39;\xc9\x91\xcb\x90&#39;: 1.2, 1.2: &#39;&#39;, &#39;&#39;: 1.3, b&#39;\xc9\x91\xc9\xb9&#39;: 1.3, 1.3: &#39;&#39;, &#39;a&#39;: 1.4, b&#39;a\xcb\x90&#39;: 1.4, 1.4: &#39;a&#39;, &#39;&#39;: 2, b&#39;\xc3\xa6&#39;: 2, 2: &#39;&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, &#39;&#39;: 3, b&#39;\xca\x8c&#39;: 3, 3: &#39;&#39;, &#39;&#39;: 3, b&#39;\xe1\xb4\xa7&#39;: 3, &#39;&#39;: 4, b&#39;\xc9\x92&#39;: 4, 4: &#39;&#39;, 4.1: &#39;&#39;, &#39;&#39;: 4.2, b&#39;\xc9\x94&#39;: 4.2, 4.2: &#39;&#39;, &#39;a&#39;: 5, b&#39;a\xca\x8a&#39;: 5, 5: &#39;a&#39;, &#39;&#39;: 5.1, b&#39;\xc3\xa6\xc9\x94&#39;: 5.1, 5.1: &#39;&#39;, &#39;&#39;: 6, b&#39;\xc9\x99&#39;: 6, 6: &#39;&#39;, &#39;&#39;: 7, b&#39;\xc9\x99\xcb\x90&#39;: 7, 7: &#39;&#39;, &#39;&#39;: 6.1, b&#39;\xc9\x9a&#39;: 6.1, 6.1: &#39;&#39;, &#39;a&#39;: 8, b&#39;a\xc9\xaa&#39;: 8, 8: &#39;a&#39;, &#39;&#39;: 8, b&#39;\xca\x8c\xc9\xaa&#39;: 8, &#39;e&#39;: 8.1, b&#39;\xc9\x91e&#39;: 8.1, 8.1: &#39;e&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t&#39;: 10, b&#39;t\xca\x83&#39;: 10, 10: &#39;t&#39;, &#39;&#39;: 10, b&#39;\xca\xa7&#39;: 10, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;&#39;: 12, b&#39;\xc3\xb0&#39;: 12, 12: &#39;&#39;, &#39;&#39;: 13, b&#39;\xc9\x9b&#39;: 13, 13: &#39;&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9d&#39;: 7.1, 7.1: &#39;&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9c\xcb\x90&#39;: 7.1, &#39;&#39;: 14, b&#39;\xc9\x9b\xc9\x99&#39;: 14, 14: &#39;&#39;, &#39;&#39;: 14.1, b&#39;\xc9\x9b\xc9\xb9&#39;: 14.1, 14.1: &#39;&#39;, &#39;e&#39;: 14.2, b&#39;e\xcb\x90&#39;: 14.2, 14.2: &#39;e&#39;, &#39;&#39;: 14.3, b&#39;\xc9\x9b\xcb\x90&#39;: 14.3, 14.3: &#39;&#39;, &#39;e&#39;: 14.4, b&#39;e\xc9\x99&#39;: 14.4, 14.4: &#39;e&#39;, &#39;e&#39;: 15, b&#39;e\xc9\xaa&#39;: 15, 15: &#39;e&#39;, &#39;&#39;: 15.1, b&#39;\xc3\xa6\xc9\xaa&#39;: 15.1, 15.1: &#39;&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;&#39;: 17, b&#39;\xc9\xa1&#39;: 17, 17: &#39;&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;&#39;: 19, b&#39;\xc9\xaa&#39;: 19, 19: &#39;&#39;, &#39;&#39;: 19.1, b&#39;\xc9\xa8&#39;: 19.1, 19.1: &#39;&#39;, &#39;&#39;: 20, b&#39;\xc9\xaa\xc9\x99&#39;: 20, 20: &#39;&#39;, &#39;&#39;: 20.1, b&#39;\xc9\xaa\xc9\xb9&#39;: 20.1, 20.1: &#39;&#39;, &#39;&#39;: 20.2, b&#39;\xc9\xaa\xc9\xb9\xc9\x99&#39;: 20.2, 20.2: &#39;&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i&#39;: 21.1, b&#39;i\xcb\x90&#39;: 21.1, 21.1: &#39;i&#39;, &#39;d&#39;: 22, b&#39;d\xca\x92&#39;: 22, 22: &#39;d&#39;, &#39;&#39;: 22, b&#39;\xca\xa4&#39;: 22, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;d&#39;: 24.1, b&#39;d\xc9\xab&#39;: 24.1, 24.1: &#39;d&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;&#39;: 27, b&#39;\xc5\x8b&#39;: 27, 27: &#39;&#39;, &#39;&#39;: 28, b&#39;\xc9\x99\xca\x8a&#39;: 28, 28: &#39;&#39;, &#39;o&#39;: 28.1, b&#39;o&#39;: 28.1, 28.1: &#39;o&#39;, &#39;o&#39;: 28.2, b&#39;o\xca\x8a&#39;: 28.2, 28.2: &#39;o&#39;, &#39;&#39;: 3.1, b&#39;\xc9\x99\xca\x89&#39;: 3.1, 3.1: &#39;&#39;, &#39;&#39;: 30, b&#39;\xc9\x94\xc9\xaa&#39;: 30, 30: &#39;&#39;, &#39;o&#39;: 30.1, b&#39;o\xc9\xaa&#39;: 30.1, 30.1: &#39;o&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;&#39;: 32, b&#39;\xc9\xb9&#39;: 32, 32: &#39;&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;&#39;: 34, b&#39;\xca\x83&#39;: 34, 34: &#39;&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;&#39;: 35.1, b&#39;\xc9\xbe&#39;: 35.1, 35.1: &#39;&#39;, &#39;&#39;: 36, b&#39;\xce\xb8&#39;: 36, 36: &#39;&#39;, &#39;&#39;: 37, b&#39;\xca\x8a\xc9\x99&#39;: 37, 37: &#39;&#39;, &#39;&#39;: 37.1, b&#39;\xca\x8a\xc9\xb9&#39;: 37.1, 37.1: &#39;&#39;, &#39;&#39;: 37.2, b&#39;\xca\x8a&#39;: 37.2, 37.2: &#39;&#39;, &#39;&#39;: 39, b&#39;\xca\x89\xcb\x90&#39;: 39, 39: &#39;&#39;, &#39;u&#39;: 39.1, b&#39;u\xcb\x90&#39;: 39.1, 39.1: &#39;u&#39;, &#39;u&#39;: 39.2, b&#39;u&#39;: 39.2, 39.2: &#39;u&#39;, &#39;&#39;: 40, b&#39;\xc9\x94\xcb\x90&#39;: 40, 40: &#39;&#39;, 40.1: &#39;&#39;, &#39;o&#39;: 40.2, b&#39;o\xcb\x90&#39;: 40.2, 40.2: &#39;o&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;&#39;: 42.1, b&#39;\xca\x8d&#39;: 42.1, 42.1: &#39;&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;&#39;: 45, b&#39;\xca\x92&#39;: 45, 45: &#39;&#39;, &#39;&#39;: 46, b&#39;\xca\x94&#39;: 46, 46: &#39;&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;As unicode-ipa but, when converting a user lexicon, generates Python code that reads Wenlin Yinghan dictionary entries and adds IPA bands to matching words&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;yinghan-ipa.py&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;Python script&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;#!/usr/bin/env python\n# -*- coding: utf-8 -*-\n# Works in both Python 2 and Python 3\n\nimport sys; d={&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;u&#34;%s&#34;:u&#34;%s&#34;,\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#34;}\nimport re\ntry: i,o=sys.stdin.buffer,sys.stdout.buffer # Python 3\nexcept AttributeError: i,o=sys.stdin,sys.stdout # Python 2\nfor k in list(d.keys()): d[k.lower().encode(&#39;utf-8&#39;)]=d[k]\nnextIsHead=False\nfor l in i:\n o.write(l)\n if nextIsHead and l.strip():\n  w=l.split()\n  if w[0]==u&#39;ehw&#39;.encode(&#39;utf-8&#39;): l=u&#39; &#39;.encode(&#39;utf-8&#39;).join(w[1:])\n  k = re.sub(u&#39;\\\\([^)]*\\\\)$&#39;.encode(&#39;utf-8&#39;),u&#39;&#39;.encode(&#39;utf-8&#39;),l.strip()).strip().lower()\n  if k in d: o.write(u&#39;ipa &#39;.encode(&#39;utf-8&#39;)+d[k].encode(&#39;utf-8&#39;)+u&#39;\\n&#39;.encode(&#39;utf-8&#39;))\n if l.startswith(u&#39;*** &#39;.encode(&#39;utf-8&#39;)): nextIsHead=True\n&#34;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cvtOut_func&#39;): &lt;function unicode_preprocess&gt;}, &#39;unicode-rough&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, 47: &#39;&#39;, &#39;&#39;: 47.1, b&#39;\xcb\x88&#39;: 47.1, 47.1: &#34;&#39;&#34;, &#39;&#39;: 47.2, b&#39;\xcb\x8c&#39;: 47.2, 47.2: &#39;,&#39;, &#39;#&#39;: 48, b&#39;#&#39;: 48, 48: &#39;#&#39;, &#39;_&#39;: 49, b&#39;_&#39;: 49, 49: &#39;_&#39;, &#39;?&#39;: 50, b&#39;?&#39;: 50, 50: &#39;?&#39;, &#39;!&#39;: 51, b&#39;!&#39;: 51, 51: &#39;!&#39;, &#39;,&#39;: 47.2, b&#39;,&#39;: 47.2, 52: &#39;,&#39;, &#39;&#39;: 1, b&#39;\xc9\x91&#39;: 1, 1: &#39;ar-&#39;, &#39;&#39;: 53, b&#39;\xcb\x90&#39;: 53, 53: &#39;:&#39;, &#39;&#39;: 1.2, b&#39;\xc9\x91\xcb\x90&#39;: 1.2, 1.2: &#39;ar-&#39;, &#39;&#39;: 1.3, b&#39;\xc9\x91\xc9\xb9&#39;: 1.3, 1.3: &#39;ar-&#39;, &#39;a&#39;: 1.4, b&#39;a\xcb\x90&#39;: 1.4, 1.4: &#39;a&#39;, &#39;&#39;: 2, b&#39;\xc3\xa6&#39;: 2, 2: &#39;&#39;, &#39;a&#39;: 2, b&#39;a&#39;: 2, &#39;&#39;: 3, b&#39;\xca\x8c&#39;: 3, 3: &#39;uh&#39;, &#39;&#39;: 3, b&#39;\xe1\xb4\xa7&#39;: 3, &#39;&#39;: 4, b&#39;\xc9\x92&#39;: 4, 4: &#39;&#39;, 4.1: &#39;&#39;, &#39;&#39;: 4.2, b&#39;\xc9\x94&#39;: 4.2, 4.2: &#39;&#39;, &#39;a&#39;: 5, b&#39;a\xca\x8a&#39;: 5, 5: &#39;a&#39;, &#39;&#39;: 5.1, b&#39;\xc3\xa6\xc9\x94&#39;: 5.1, 5.1: &#39;&#39;, &#39;&#39;: 6, b&#39;\xc9\x99&#39;: 6, 6: &#39;&#39;, &#39;&#39;: 7, b&#39;\xc9\x99\xcb\x90&#39;: 7, 7: &#39;:&#39;, &#39;&#39;: 6.1, b&#39;\xc9\x9a&#39;: 6.1, 6.1: &#39;&#39;, &#39;a&#39;: 8, b&#39;a\xc9\xaa&#39;: 8, 8: &#39;ai&#39;, &#39;&#39;: 8, b&#39;\xca\x8c\xc9\xaa&#39;: 8, &#39;e&#39;: 8.1, b&#39;\xc9\x91e&#39;: 8.1, 8.1: &#39;e&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;t&#39;: 10, b&#39;t\xca\x83&#39;: 10, 10: &#39;ch&#39;, &#39;&#39;: 10, b&#39;\xca\xa7&#39;: 10, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;&#39;: 12, b&#39;\xc3\xb0&#39;: 12, 12: &#39;&#39;, &#39;&#39;: 13, b&#39;\xc9\x9b&#39;: 13, 13: &#39;e&#39;, &#39;e&#39;: 13, b&#39;e&#39;: 13, 13.1: &#39;e&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9d&#39;: 7.1, 7.1: &#39;3:&#39;, &#39;&#39;: 7.1, b&#39;\xc9\x9c\xcb\x90&#39;: 7.1, &#39;&#39;: 14, b&#39;\xc9\x9b\xc9\x99&#39;: 14, 14: &#39;e:&#39;, &#39;&#39;: 14.1, b&#39;\xc9\x9b\xc9\xb9&#39;: 14.1, 14.1: &#39;e:&#39;, &#39;e&#39;: 14.2, b&#39;e\xcb\x90&#39;: 14.2, 14.2: &#39;e:&#39;, &#39;&#39;: 14.3, b&#39;\xc9\x9b\xcb\x90&#39;: 14.3, 14.3: &#39;e:&#39;, &#39;e&#39;: 14.4, b&#39;e\xc9\x99&#39;: 14.4, 14.4: &#39;e:&#39;, &#39;e&#39;: 15, b&#39;e\xc9\xaa&#39;: 15, 15: &#39;ei&#39;, &#39;&#39;: 15.1, b&#39;\xc3\xa6\xc9\xaa&#39;: 15.1, 15.1: &#39;i&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;&#39;: 17, b&#39;\xc9\xa1&#39;: 17, 17: &#39;g&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;&#39;: 19, b&#39;\xc9\xaa&#39;: 19, 19: &#39;i&#39;, &#39;&#39;: 19.1, b&#39;\xc9\xa8&#39;: 19.1, 19.1: &#39;i&#39;, &#39;&#39;: 20, b&#39;\xc9\xaa\xc9\x99&#39;: 20, 20: &#39;eeuh-&#39;, &#39;&#39;: 20.1, b&#39;\xc9\xaa\xc9\xb9&#39;: 20.1, 20.1: &#39;&#39;, &#39;&#39;: 20.2, b&#39;\xc9\xaa\xc9\xb9\xc9\x99&#39;: 20.2, 20.2: &#39;eeuh-&#39;, &#39;i&#39;: 19, b&#39;i&#39;: 19, 21: &#39;ee&#39;, &#39;i&#39;: 21.1, b&#39;i\xcb\x90&#39;: 21.1, 21.1: &#39;ee&#39;, &#39;d&#39;: 22, b&#39;d\xca\x92&#39;: 22, 22: &#39;j&#39;, &#39;&#39;: 22, b&#39;\xca\xa4&#39;: 22, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;d&#39;: 24.1, b&#39;d\xc9\xab&#39;: 24.1, 24.1: &#39;d&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;&#39;: 27, b&#39;\xc5\x8b&#39;: 27, 27: &#39;ng&#39;, &#39;&#39;: 28, b&#39;\xc9\x99\xca\x8a&#39;: 28, 28: &#39;o&#39;, &#39;o&#39;: 28, b&#39;o&#39;: 28, 28.1: &#39;o&#39;, &#39;o&#39;: 28.2, b&#39;o\xca\x8a&#39;: 28.2, 28.2: &#39;o&#39;, &#39;&#39;: 3.1, b&#39;\xc9\x99\xca\x89&#39;: 3.1, 3.1: &#39;o&#39;, &#39;&#39;: 30, b&#39;\xc9\x94\xc9\xaa&#39;: 30, 30: &#39;oy&#39;, &#39;o&#39;: 30.1, b&#39;o\xc9\xaa&#39;: 30.1, 30.1: &#39;oy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;&#39;: 32, b&#39;\xc9\xb9&#39;: 32, 32: &#39;r&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;&#39;: 34, b&#39;\xca\x83&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;&#39;: 35.1, b&#39;\xc9\xbe&#39;: 35.1, 35.1: &#39;t&#39;, &#39;&#39;: 36, b&#39;\xce\xb8&#39;: 36, 36: &#39;th&#39;, &#39;&#39;: 37, b&#39;\xca\x8a\xc9\x99&#39;: 37, 37: &#39;or&#39;, &#39;&#39;: 37.1, b&#39;\xca\x8a\xc9\xb9&#39;: 37.1, 37.1: &#39;or&#39;, &#39;&#39;: 37.2, b&#39;\xca\x8a&#39;: 37.2, 37.2: &#39;u&#39;, &#39;&#39;: 39, b&#39;\xca\x89\xcb\x90&#39;: 39, 39: &#39;oo&#39;, &#39;u&#39;: 39.1, b&#39;u\xcb\x90&#39;: 39.1, 39.1: &#39;oo&#39;, &#39;u&#39;: 37.2, b&#39;u&#39;: 37.2, 39.2: &#39;oo&#39;, &#39;&#39;: 40, b&#39;\xc9\x94\xcb\x90&#39;: 40, 40: &#39;or&#39;, 40.1: &#39;or&#39;, &#39;o&#39;: 40.2, b&#39;o\xcb\x90&#39;: 40.2, 40.2: &#39;or&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;&#39;: 42.1, b&#39;\xca\x8d&#39;: 42.1, 42.1: &#39;w&#39;, &#39;j&#39;: 22, b&#39;j&#39;: 22, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;&#39;: 45, b&#39;\xca\x92&#39;: 45, 45: &#39;3&#39;, &#39;&#39;: 46, b&#39;\xca\x94&#39;: 46, 46: &#39;&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#34;A non-standard notation that&#39;s reminiscent of unicode-ipa but changed so that more of the characters show in old browsers with incomplete fonts&#34;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-ipa.html&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;HTML&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;&lt;html&gt;&lt;head&gt;&lt;meta name=&#34;mobileoptimized&#34; content=&#34;0&#34;&gt;&lt;meta name=&#34;viewport&#34; content=&#34;width=device-width&#34;&gt;&lt;meta http-equiv=&#34;Content-Type&#34; content=&#34;text/html; charset=utf-8&#34;&gt;&lt;/head&gt;&lt;body&gt;&lt;table&gt;&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;&lt;tr&gt;&lt;td&gt;%s&lt;/td&gt;&lt;td&gt;%s&lt;/td&gt;&lt;/tr&gt;\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;&lt;/table&gt;&lt;/body&gt;&lt;/html&gt;\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cvtOut_func&#39;): None, &#34;&#39;&#34;: 47.1, b&#34;&#39;&#34;: 47.1, &#39;ar-&#39;: 1, b&#39;ar-&#39;: 1, &#39;:&#39;: 53, b&#39;:&#39;: 53, &#39;uh&#39;: 3, b&#39;uh&#39;: 3, &#39;:&#39;: 7, b&#39;\xc9\x99:&#39;: 7, &#39;ai&#39;: 8, b&#39;ai&#39;: 8, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, &#39;3:&#39;: 7.1, b&#39;3:&#39;: 7.1, &#39;ei&#39;: 15, b&#39;ei&#39;: 15, &#39;i&#39;: 15.1, b&#39;\xc3\xa6i&#39;: 15.1, &#39;eeuh-&#39;: 20, b&#39;eeuh-&#39;: 20, &#39;ee&#39;: 21, b&#39;ee&#39;: 21, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, &#39;oy&#39;: 30, b&#39;oy&#39;: 30, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, &#39;th&#39;: 36, b&#39;th&#39;: 36, &#39;or&#39;: 37, b&#39;or&#39;: 37, &#39;oo&#39;: 39, b&#39;oo&#39;: 39, &#39;y&#39;: 43, b&#39;y&#39;: 43, &#39;3&#39;: 45, b&#39;3&#39;: 45, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;-$&#39;, &#39;&#39;)]}, &#39;braille-ipa&#39;: {&#39;_B&#39;: 47.1, b&#39;_B&#39;: 47.1, 47.1: &#39;_B&#39;, &#39;_2&#39;: 47.2, b&#39;_2&#39;: 47.2, 47.2: &#39;_2&#39;, &#39;*&#39;: 1, b&#39;*&#39;: 1, 1: &#39;*&#39;, &#39;3&#39;: 53, b&#39;3&#39;: 53, 53: &#39;3&#39;, &#39;*3&#39;: 1.2, b&#39;*3&#39;: 1.2, 1.2: &#39;*3&#39;, &#39;*#&#39;: 1.3, b&#39;*#&#39;: 1.3, 1.3: &#39;*#&#39;, &#39;A3&#39;: 1.4, b&#39;A3&#39;: 1.4, 1.4: &#39;A3&#39;, &#39;%&#39;: 2, b&#39;%&#39;: 2, 2: &#39;%&#39;, &#39;A&#39;: 2, b&#39;A&#39;: 2, &#39;+&#39;: 3, b&#39;+&#39;: 3, 3: &#39;+&#39;, &#39;4*&#39;: 4, b&#39;4*&#39;: 4, 4: &#39;4*&#39;, 4.1: &#39;*&#39;, &#39;&lt;&#39;: 4.2, b&#39;&lt;&#39;: 4.2, 4.2: &#39;&lt;&#39;, &#39;A(&#39;: 5, b&#39;A(&#39;: 5, 5: &#39;A(&#39;, &#39;%&lt;&#39;: 5.1, b&#39;%&lt;&#39;: 5.1, 5.1: &#39;%&lt;&#39;, &#39;5&#39;: 6, b&#39;5&#39;: 6, 6: &#39;5&#39;, &#39;53&#39;: 7, b&#39;53&#39;: 7, 7: &#39;53&#39;, &#39;5&#34;R.&#39;: 6.1, b&#39;5&#34;R.&#39;: 6.1, 6.1: &#39;5&#34;R.&#39;, &#39;A/&#39;: 8, b&#39;A/&#39;: 8, 8: &#39;A/&#39;, &#39;*E&#39;: 8.1, b&#39;*E&#39;: 8.1, 8.1: &#39;*E&#39;, &#39;B&#39;: 9, b&#39;B&#39;: 9, 9: &#39;B&#39;, &#39;T:&#39;: 10, b&#39;T:&#39;: 10, 10: &#39;T:&#39;, &#39;T&#34;:.&#39;: 10, b&#39;T&#34;:.&#39;: 10, &#39;D&#39;: 11, b&#39;D&#39;: 11, 11: &#39;D&#39;, &#39;]&#39;: 12, b&#39;]&#39;: 12, 12: &#39;]&#39;, &#39;&gt;&#39;: 13, b&#39;&gt;&#39;: 13, 13: &#39;&gt;&#39;, &#39;E&#39;: 13.1, b&#39;E&#39;: 13.1, 13.1: &#39;E&#39;, &#39;4&gt;3&#39;: 7.1, b&#39;4&gt;3&#39;: 7.1, 7.1: &#39;4&gt;3&#39;, &#39;&gt;5&#39;: 14, b&#39;&gt;5&#39;: 14, 14: &#39;&gt;5&#39;, &#39;&gt;#&#39;: 14.1, b&#39;&gt;#&#39;: 14.1, 14.1: &#39;&gt;#&#39;, &#39;E3&#39;: 14.2, b&#39;E3&#39;: 14.2, 14.2: &#39;E3&#39;, &#39;&gt;3&#39;: 14.3, b&#39;&gt;3&#39;: 14.3, 14.3: &#39;&gt;3&#39;, &#39;E5&#39;: 14.4, b&#39;E5&#39;: 14.4, 14.4: &#39;E5&#39;, &#39;E/&#39;: 15, b&#39;E/&#39;: 15, 15: &#39;E/&#39;, &#39;%/&#39;: 15.1, b&#39;%/&#39;: 15.1, 15.1: &#39;%/&#39;, &#39;F&#39;: 16, b&#39;F&#39;: 16, 16: &#39;F&#39;, &#39;G&#39;: 17, b&#39;G&#39;: 17, 17: &#39;G&#39;, &#39;H&#39;: 18, b&#39;H&#39;: 18, 18: &#39;H&#39;, &#39;/&#39;: 19, b&#39;/&#39;: 19, 19: &#39;/&#39;, &#39;0I&#39;: 19.1, b&#39;0I&#39;: 19.1, 19.1: &#39;0I&#39;, &#39;/5&#39;: 20, b&#39;/5&#39;: 20, 20: &#39;/5&#39;, &#39;/#&#39;: 20.1, b&#39;/#&#39;: 20.1, 20.1: &#39;/#&#39;, &#39;/#5&#39;: 20.2, b&#39;/#5&#39;: 20.2, 20.2: &#39;/#5&#39;, &#39;I&#39;: 21, b&#39;I&#39;: 21, 21: &#39;I&#39;, &#39;I3&#39;: 21.1, b&#39;I3&#39;: 21.1, 21.1: &#39;I3&#39;, &#39;D!&#39;: 22, b&#39;D!&#39;: 22, 22: &#39;D!&#39;, &#39;K&#39;: 23, b&#39;K&#39;: 23, 23: &#39;K&#39;, &#39;X&#39;: 23.1, b&#39;X&#39;: 23.1, 23.1: &#39;X&#39;, &#39;L&#39;: 24, b&#39;L&#39;: 24, 24: &#39;L&#39;, &#39;D6L&#39;: 24.1, b&#39;D6L&#39;: 24.1, 24.1: &#39;D6L&#39;, &#39;M&#39;: 25, b&#39;M&#39;: 25, 25: &#39;M&#39;, &#39;N&#39;: 26, b&#39;N&#39;: 26, 26: &#39;N&#39;, &#39;$&#39;: 27, b&#39;$&#39;: 27, 27: &#39;$&#39;, &#39;5(&#39;: 28, b&#39;5(&#39;: 28, 28: &#39;5(&#39;, &#39;O&#39;: 28.1, b&#39;O&#39;: 28.1, 28.1: &#39;O&#39;, &#39;O(&#39;: 28.2, b&#39;O(&#39;: 28.2, 28.2: &#39;O(&#39;, &#39;50U&#39;: 3.1, b&#39;50U&#39;: 3.1, 3.1: &#39;50U&#39;, &#39;&lt;/&#39;: 30, b&#39;&lt;/&#39;: 30, 30: &#39;&lt;/&#39;, &#39;O/&#39;: 30.1, b&#39;O/&#39;: 30.1, 30.1: &#39;O/&#39;, &#39;P&#39;: 31, b&#39;P&#39;: 31, 31: &#39;P&#39;, &#39;#&#39;: 32, b&#39;#&#39;: 32, 32: &#39;#&#39;, 32.1: &#39;R&#39;, &#39;S&#39;: 33, b&#39;S&#39;: 33, 33: &#39;S&#39;, &#39;:&#39;: 34, b&#39;:&#39;: 34, 34: &#39;:&#39;, &#39;T&#39;: 35, b&#39;T&#39;: 35, 35: &#39;T&#39;, &#39;6R&#39;: 35.1, b&#39;6R&#39;: 35.1, 35.1: &#39;6R&#39;, &#39;.?&#39;: 36, b&#39;.?&#39;: 36, 36: &#39;.?&#39;, &#39;(5&#39;: 37, b&#39;(5&#39;: 37, 37: &#39;(5&#39;, &#39;(#&#39;: 37.1, b&#39;(#&#39;: 37.1, 37.1: &#39;(#&#39;, &#39;(&#39;: 37.2, b&#39;(&#39;: 37.2, 37.2: &#39;(&#39;, &#39;0U3&#39;: 39, b&#39;0U3&#39;: 39, 39: &#39;0U3&#39;, &#39;U3&#39;: 39.1, b&#39;U3&#39;: 39.1, 39.1: &#39;U3&#39;, &#39;U&#39;: 39.2, b&#39;U&#39;: 39.2, 39.2: &#39;U&#39;, &#39;&lt;3&#39;: 40, b&#39;&lt;3&#39;: 40, 40: &#39;&lt;3&#39;, 40.1: &#39;&lt;&#39;, &#39;O3&#39;: 40.2, b&#39;O3&#39;: 40.2, 40.2: &#39;O3&#39;, &#39;V&#39;: 41, b&#39;V&#39;: 41, 41: &#39;V&#39;, &#39;W&#39;: 42, b&#39;W&#39;: 42, 42: &#39;W&#39;, &#39;6W&#39;: 42.1, b&#39;6W&#39;: 42.1, 42.1: &#39;6W&#39;, &#39;J&#39;: 43, b&#39;J&#39;: 43, 43: &#39;J&#39;, &#39;Z&#39;: 44, b&#39;Z&#39;: 44, 44: &#39;Z&#39;, &#39;!&#39;: 45, b&#39;!&#39;: 45, 45: &#39;!&#39;, &#39;2&#39;: 46, b&#39;2&#39;: 46, 46: &#39;2&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;IPA symbols in Braille (2008 BANA standard).  By default Braille ASCII is output; if you prefer to see the Braille dots via Unicode, set the BRAILLE_UNICODE environment variable.&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-ipa.brl&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;document&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s = %s\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True, (&#39;settings&#39;, &#39;cleanup_func&#39;): &lt;function LexFormats.&lt;locals&gt;.&lt;lambda&gt;&gt;, (&#39;settings&#39;, &#39;cvtOut_func&#39;): &lt;function unicode_to_ascii_braille&gt;}, &#39;latex-ipa&#39;: {&#39;.&#39;: 47, b&#39;.&#39;: 47, &#39;&#34;&#39;: 47.1, b&#39;&#34;&#39;: 47.1, 47.1: &#39;&#34;&#39;, &#39;\\textsecstress{}&#39;: 47.2, b&#39;\\textsecstress{}&#39;: 47.2, 47.2: &#39;\\textsecstress{}&#39;, &#39;\\#&#39;: 48, b&#39;\\#&#39;: 48, 48: &#39;\\#&#39;, &#39;\\_&#39;: 49, b&#39;\\_&#39;: 49, 49: &#39;\\_&#39;, &#39;?&#39;: 50, b&#39;?&#39;: 50, 50: &#39;?&#39;, &#39;!&#39;: 51, b&#39;!&#39;: 51, 51: &#39;!&#39;, &#39;,&#39;: 52, b&#39;,&#39;: 52, 52: &#39;,&#39;, &#39;A&#39;: 1, b&#39;A&#39;: 1, 1: &#39;A&#39;, &#39;:&#39;: 53, b&#39;:&#39;: 53, 53: &#39;:&#39;, &#39;A:&#39;: 1.2, b&#39;A:&#39;: 1.2, 1.2: &#39;A:&#39;, &#39;A\\textturnr{}&#39;: 1.3, b&#39;A\\textturnr{}&#39;: 1.3, 1.3: &#39;A\\textturnr{}&#39;, &#39;a:&#39;: 1.4, b&#39;a:&#39;: 1.4, 1.4: &#39;a:&#39;, &#39;\\ae{}&#39;: 2, b&#39;\\ae{}&#39;: 2, 2: &#39;\\ae{}&#39;, &#39;2&#39;: 3, b&#39;2&#39;: 3, 3: &#39;2&#39;, &#39;6&#39;: 4, b&#39;6&#39;: 4, 4: &#39;6&#39;, 4.1: &#39;A&#39;, &#39;O&#39;: 4.2, b&#39;O&#39;: 4.2, 4.2: &#39;O&#39;, &#39;aU&#39;: 5, b&#39;aU&#39;: 5, 5: &#39;aU&#39;, &#39;\\ae{}O&#39;: 5.1, b&#39;\\ae{}O&#39;: 5.1, 5.1: &#39;\\ae{}O&#39;, &#39;@&#39;: 6, b&#39;@&#39;: 6, 6: &#39;@&#39;, &#39;@:&#39;: 7, b&#39;@:&#39;: 7, 7: &#39;@:&#39;, &#39;\\textrhookschwa{}&#39;: 6.1, b&#39;\\textrhookschwa{}&#39;: 6.1, 6.1: &#39;\\textrhookschwa{}&#39;, &#39;aI&#39;: 8, b&#39;aI&#39;: 8, 8: &#39;aI&#39;, &#39;Ae&#39;: 8.1, b&#39;Ae&#39;: 8.1, 8.1: &#39;Ae&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;tS&#39;: 10, b&#39;tS&#39;: 10, 10: &#39;tS&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;D&#39;: 12, b&#39;D&#39;: 12, 12: &#39;D&#39;, &#39;E&#39;: 13, b&#39;E&#39;: 13, 13: &#39;E&#39;, &#39;e&#39;: 13.1, b&#39;e&#39;: 13.1, 13.1: &#39;e&#39;, &#39;3:&#39;: 7.1, b&#39;3:&#39;: 7.1, 7.1: &#39;3:&#39;, &#39;E@&#39;: 14, b&#39;E@&#39;: 14, 14: &#39;E@&#39;, &#39;E\\textturnr{}&#39;: 14.1, b&#39;E\\textturnr{}&#39;: 14.1, 14.1: &#39;E\\textturnr{}&#39;, &#39;e:&#39;: 14.2, b&#39;e:&#39;: 14.2, 14.2: &#39;e:&#39;, &#39;E:&#39;: 14.3, b&#39;E:&#39;: 14.3, 14.3: &#39;E:&#39;, &#39;e@&#39;: 14.4, b&#39;e@&#39;: 14.4, 14.4: &#39;e@&#39;, &#39;eI&#39;: 15, b&#39;eI&#39;: 15, 15: &#39;eI&#39;, &#39;\\ae{}I&#39;: 15.1, b&#39;\\ae{}I&#39;: 15.1, 15.1: &#39;\\ae{}I&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;I&#39;: 19, b&#39;I&#39;: 19, 19: &#39;I&#39;, &#39;1&#39;: 19.1, b&#39;1&#39;: 19.1, 19.1: &#39;1&#39;, &#39;I@&#39;: 20, b&#39;I@&#39;: 20, 20: &#39;I@&#39;, &#39;I\\textturnr{}&#39;: 20.1, b&#39;I\\textturnr{}&#39;: 20.1, 20.1: &#39;I\\textturnr{}&#39;, &#39;I@\\textturnr{}&#39;: 20.2, b&#39;I@\\textturnr{}&#39;: 20.2, 20.2: &#39;I@\\textturnr{}&#39;, &#39;i&#39;: 21, b&#39;i&#39;: 21, 21: &#39;i&#39;, &#39;i:&#39;: 21.1, b&#39;i:&#39;: 21.1, 21.1: &#39;i:&#39;, &#39;dZ&#39;: 22, b&#39;dZ&#39;: 22, 22: &#39;dZ&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;x&#39;: 23.1, b&#39;x&#39;: 23.1, 23.1: &#39;x&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;d\\textltilde{}&#39;: 24.1, b&#39;d\\textltilde{}&#39;: 24.1, 24.1: &#39;d\\textltilde{}&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;N&#39;: 27, b&#39;N&#39;: 27, 27: &#39;N&#39;, &#39;@U&#39;: 28, b&#39;@U&#39;: 28, 28: &#39;@U&#39;, &#39;o&#39;: 28.1, b&#39;o&#39;: 28.1, 28.1: &#39;o&#39;, &#39;oU&#39;: 28.2, b&#39;oU&#39;: 28.2, 28.2: &#39;oU&#39;, &#39;@0&#39;: 3.1, b&#39;@0&#39;: 3.1, 3.1: &#39;@0&#39;, &#39;OI&#39;: 30, b&#39;OI&#39;: 30, 30: &#39;OI&#39;, &#39;oI&#39;: 30.1, b&#39;oI&#39;: 30.1, 30.1: &#39;oI&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;\\textturnr{}&#39;: 32, b&#39;\\textturnr{}&#39;: 32, 32: &#39;\\textturnr{}&#39;, 32.1: &#39;r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;S&#39;: 34, b&#39;S&#39;: 34, 34: &#39;S&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;R&#39;: 35.1, b&#39;R&#39;: 35.1, 35.1: &#39;R&#39;, &#39;T&#39;: 36, b&#39;T&#39;: 36, 36: &#39;T&#39;, &#39;U@&#39;: 37, b&#39;U@&#39;: 37, 37: &#39;U@&#39;, &#39;U\\textturnr{}&#39;: 37.1, b&#39;U\\textturnr{}&#39;: 37.1, 37.1: &#39;U\\textturnr{}&#39;, &#39;U&#39;: 37.2, b&#39;U&#39;: 37.2, 37.2: &#39;U&#39;, &#39;0:&#39;: 39, b&#39;0:&#39;: 39, 39: &#39;0:&#39;, &#39;u:&#39;: 39.1, b&#39;u:&#39;: 39.1, 39.1: &#39;u:&#39;, &#39;u&#39;: 39.2, b&#39;u&#39;: 39.2, 39.2: &#39;u&#39;, &#39;O:&#39;: 40, b&#39;O:&#39;: 40, 40: &#39;O:&#39;, 40.1: &#39;O&#39;, &#39;o:&#39;: 40.2, b&#39;o:&#39;: 40.2, 40.2: &#39;o:&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;\\textturnw{}&#39;: 42.1, b&#39;\\textturnw{}&#39;: 42.1, 42.1: &#39;\\textturnw{}&#39;, &#39;j&#39;: 43, b&#39;j&#39;: 43, 43: &#39;j&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;Z&#39;: 45, b&#39;Z&#39;: 45, 45: &#39;Z&#39;, &#39;P&#39;: 46, b&#39;P&#39;: 46, 46: &#39;P&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;IPA symbols for typesetting in LaTeX using the &#34;tipa&#34; package&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-ipa.tex&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;document&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;\\documentclass[12pt,a4paper]{article} \\usepackage[safe]{tipa} \\usepackage{longtable} \\begin{document} \\begin{longtable}{ll}&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s &amp; \\textipa{%s}\\\\\n&#39;, (&#39;settings&#39;, &#39;lex_footer&#39;): &#39;\\end{longtable}\\end{document}\n&#39;, (&#39;settings&#39;, &#39;inline_format&#39;): &#39;\\textipa{%s}&#39;, (&#39;settings&#39;, &#39;inline_oneoff_header&#39;): &#39;% In preamble, put \\usepackage[safe]{tipa}\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): &#39;\\\\\n&#39;, (&#39;settings&#39;, &#39;stress_comes_before_vowel&#39;): True, (&#39;settings&#39;, &#39;safe_to_drop_characters&#39;): True}, &#39;pinyin-approx&#39;: {&#39;4&#39;: 47.1, b&#39;4&#39;: 47.1, 47.1: &#39;4&#39;, &#39;2&#39;: 47.2, b&#39;2&#39;: 47.2, 47.2: &#39;2&#39;, &#39;a5&#39;: 1, b&#39;a5&#39;: 1, 1: &#39;a5&#39;, &#39;ya5&#39;: 2, b&#39;ya5&#39;: 2, 2: &#39;ya5&#39;, &#39;e5&#39;: 3, b&#39;e5&#39;: 3, 3: &#39;e5&#39;, &#39;yo5&#39;: 4, b&#39;yo5&#39;: 4, 4: &#39;yo5&#39;, &#39;ao5&#39;: 5, b&#39;ao5&#39;: 5, 5: &#39;ao5&#39;, 7: &#39;e5&#39;, &#39;ai5&#39;: 8, b&#39;ai5&#39;: 8, 8: &#39;ai5&#39;, &#39;bu0&#39;: 9, b&#39;bu0&#39;: 9, 9: &#39;bu0&#39;, &#39;che0&#39;: 10, b&#39;che0&#39;: 10, 10: &#39;che0&#39;, &#39;de0&#39;: 11, b&#39;de0&#39;: 11, 11: &#39;de0&#39;, &#39;ze0&#39;: 12, b&#39;ze0&#39;: 12, 12: &#39;ze0&#39;, &#39;ye5&#39;: 13, b&#39;ye5&#39;: 13, 13: &#39;ye5&#39;, 14: &#39;ye5&#39;, &#39;ei5&#39;: 15, b&#39;ei5&#39;: 15, 15: &#39;ei5&#39;, &#39;fu0&#39;: 16, b&#39;fu0&#39;: 16, 16: &#39;fu0&#39;, &#39;ge0&#39;: 17, b&#39;ge0&#39;: 17, 17: &#39;ge0&#39;, &#39;he0&#39;: 18, b&#39;he0&#39;: 18, 18: &#39;he0&#39;, &#39;yi5&#39;: 19, b&#39;yi5&#39;: 19, 19: &#39;yi5&#39;, &#39;yi3re5&#39;: 20, b&#39;yi3re5&#39;: 20, 20: &#39;yi3re5&#39;, 21: &#39;yi5&#39;, &#39;zhe0&#39;: 22, b&#39;zhe0&#39;: 22, 22: &#39;zhe0&#39;, &#39;ke0&#39;: 23, b&#39;ke0&#39;: 23, 23: &#39;ke0&#39;, &#39;le0&#39;: 24, b&#39;le0&#39;: 24, 24: &#39;le0&#39;, &#39;me0&#39;: 25, b&#39;me0&#39;: 25, 25: &#39;me0&#39;, &#39;ne0&#39;: 26, b&#39;ne0&#39;: 26, 26: &#39;ne0&#39;, &#39;eng0&#39;: 27, b&#39;eng0&#39;: 27, 27: &#39;eng0&#39;, &#39;ou5&#39;: 28, b&#39;ou5&#39;: 28, 28: &#39;ou5&#39;, &#39;ruo2yi5&#39;: 30, b&#39;ruo2yi5&#39;: 30, 30: &#39;ruo2yi5&#39;, &#39;pu0&#39;: 31, b&#39;pu0&#39;: 31, 31: &#39;pu0&#39;, &#39;re0&#39;: 32, b&#39;re0&#39;: 32, 32: &#39;re0&#39;, &#39;se0&#39;: 33, b&#39;se0&#39;: 33, 33: &#39;se0&#39;, &#39;she0&#39;: 34, b&#39;she0&#39;: 34, 34: &#39;she0&#39;, &#39;te0&#39;: 35, b&#39;te0&#39;: 35, 35: &#39;te0&#39;, 36: &#39;zhe0&#39;, 37: &#39;wu5&#39;, &#39;yu5&#39;: 39, b&#39;yu5&#39;: 39, 39: &#39;yu5&#39;, &#39;huo5&#39;: 40, b&#39;huo5&#39;: 40, 40: &#39;huo5&#39;, 41: &#39;fu0&#39;, &#39;wu0&#39;: 42, b&#39;wu0&#39;: 42, 42: &#39;wu0&#39;, &#39;yu0&#39;: 43, b&#39;yu0&#39;: 43, 43: &#39;yu0&#39;, 44: &#39;ze0&#39;, 45: &#39;zhe0&#39;, 6: &#39;e5&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Rough approximation using roughly the spelling rules of Chinese Pinyin (for getting Chinese-only voices to speak some English words - works with some words better than others)&#39;, (&#39;settings&#39;, &#39;approximate_missing&#39;): True, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-pinyin-approx.txt&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;text&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;Pinyin approxmations (very approximate!)\n----------------------------------------\n&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s ~= %s\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;te0ye&#39;, &#39;tie&#39;), (&#39;e0e5&#39;, &#39;e5&#39;), (&#39;([^aeiou][uo])0e(5)&#39;, &#39;\\1\\2&#39;), (&#39;yu0y&#39;, &#39;y&#39;), (&#39;wu0yo5&#39;, &#39;wo5&#39;), (&#39;([bdfghklmnpwz])[euo]0ei&#39;, &#39;\\1ei&#39;), (&#39;([bdghklmnpstwz])[euo]0ai&#39;, &#39;\\1ai&#39;), (&#39;([ghklmnpstyz])[euo]0ya&#39;, &#39;\\1a&#39;), (&#39;([ghklmnpstz])a([0-5]*)ne0&#39;, &#39;\\1an\\2&#39;), (&#39;([bdfghklmnpstwyz])[euo]0a([1-5])&#39;, &#39;\\1a\\2&#39;), (&#39;([bdjlmnpt])[euo]0yi&#39;, &#39;\\1i&#39;), (&#39;([bjlmnp])i([1-5]*)ne0&#39;, &#39;\\1in\\2&#39;), (&#39;([zs])he0ei&#39;, &#39;\\1hei&#39;), (&#39;([dfghklmnprstyz])[euo]0ou&#39;, &#39;\\1ou&#39;), (&#39;([dghklnrst])[euo]0huo&#39;, &#39;\\1uo&#39;), (&#39;([bfpm])[euo]0huo&#39;, &#39;\\1o&#39;), (&#39;([bdghklmnprstyz])[euo]0ao&#39;, &#39;\\1ao&#39;), (&#39;([zcs])h[eu]0ao&#39;, &#39;\\1hao&#39;), (&#39;re0r&#39;, &#39;r&#39;), (&#39;zhe0ne0&#39;, &#39;zhun5&#39;), (&#39;54&#39;, &#39;4&#39;), (&#39;52&#39;, &#39;2&#39;), (&#39;([bdjlmnpty])i([1-9])eng0&#39;, &#39;\\1ing\\2&#39;), (&#39;ya([1-9])eng0&#39;, &#39;yang\\1&#39;), (&#39;ya([1-9])ne0&#39;, &#39;an\\1&#39;), (&#39;ye([1-9])ne0&#39;, &#39;yan\\1&#39;), (&#39;([wr])[eu]0yan&#39;, &#39;\\1en&#39;), (&#39;yi([1-9])ne0&#39;, &#39;yin\\1&#39;), (&#39;yu0&#39;, &#39;yu5&#39;), (&#39;eng0&#39;, &#39;eng5&#39;), (&#39;0&#39;, &#39;5&#39;)]}, &#39;kana-approx&#39;: {&#39;&#39;: 47.1, b&#39;\xe3\x83\xbc&#39;: 47.1, 47.1: &#39;&#39;, 47.2: &#39;&#39;, &#39;&#39;: 2, b&#39;\xe3\x81\x82&#39;: 2, 2: &#39;&#39;, &#39;&#39;: 21, b&#39;\xe3\x81\x84&#39;: 21, 21: &#39;&#39;, &#39;&#39;: 39, b&#39;\xe3\x81\x86&#39;: 39, 39: &#39;&#39;, &#39;&#39;: 13, b&#39;\xe3\x81\x88&#39;: 13, 13: &#39;&#39;, &#39;&#39;: 4, b&#39;\xe3\x81\x8a&#39;: 4, 4: &#39;&#39;, &#39;&#39;: 8, b&#39;\xe3\x81\x82\xe3\x81\x84&#39;: 8, 8: &#39;&#39;, &#39;&#39;: 5, b&#39;\xe3\x81\x82\xe3\x81\x8a&#39;: 5, 5: &#39;&#39;, &#39;&#39;: 15, b&#39;\xe3\x81\x88\xe3\x81\x84&#39;: 15, 15: &#39;&#39;, &#39;&#39;: 30, b&#39;\xe3\x81\x8a\xe3\x81\x84&#39;: 30, 30: &#39;&#39;, &#39;&#39;: 28, b&#39;\xe3\x81\x8a\xe3\x81\x86&#39;: 28, 28: &#39;&#39;, 1: &#39;&#39;, 6: &#39;&#39;, 7: &#39;&#39;, 19: &#39;&#39;, 3: &#39;&#39;, 7.1: &#39;&#39;, 20: &#39;&#39;, 14: &#39;&#39;, 37: &#39;&#39;, 40: &#39;&#39;, &#39;&#39;: 40, &#39;&#39;: 9, b&#39;\xe3\x81\xb6&#39;: 9, 9: &#39;&#39;, &#39;&#39;: 10, b&#39;\xe3\x81\xa1\xe3\x81\x87&#39;: 10, 10: &#39;&#39;, &#39;&#39;: 11, b&#39;\xe3\x81\xa5&#39;: 11, 11: &#39;&#39;, &#39;&#39;: 36, b&#39;\xe3\x81\xa6\xe3\x82\x85&#39;: 36, 36: &#39;&#39;, 12: &#39;&#39;, &#39;&#39;: 16, b&#39;\xe3\x81\xb5&#39;: 16, 16: &#39;&#39;, &#39;&#39;: 17, b&#39;\xe3\x81\x90&#39;: 17, 17: &#39;&#39;, &#39;&#39;: 18, b&#39;\xe3\x81\xaf&#39;: 18, 18: &#39;&#39;, &#39;&#39;: 22, b&#39;\xe3\x81\x98\xe3\x82\x85&#39;: 22, 22: &#39;&#39;, 45: &#39;&#39;, &#39;&#39;: 23, b&#39;\xe3\x81\x8f&#39;: 23, 23: &#39;&#39;, &#39;&#39;: 24, b&#39;\xe3\x82\x8b&#39;: 24, 24: &#39;&#39;, 32: &#39;&#39;, &#39;&#39;: 25, b&#39;\xe3\x82\x80&#39;: 25, 25: &#39;&#39;, &#39;&#39;: 26, b&#39;\xe3\x81\xac&#39;: 26, 26: &#39;&#39;, &#39;&#39;: 27, b&#39;\xe3\x82\x93\xe3\x81\x90&#39;: 27, 27: &#39;&#39;, &#39;&#39;: 31, b&#39;\xe3\x81\xb7&#39;: 31, 31: &#39;&#39;, &#39;&#39;: 33, b&#39;\xe3\x81\x99&#39;: 33, 33: &#39;&#39;, &#39;&#39;: 34, b&#39;\xe3\x81\x97\xe3\x82\x85&#39;: 34, 34: &#39;&#39;, &#39;&#39;: 35, b&#39;\xe3\x81\xa4&#39;: 35, 35: &#39;&#39;, &#39;&#39;: 42, b&#39;\xe3\x82\x8f&#39;: 42, 42: &#39;&#39;, 41: &#39;&#39;, &#39;&#39;: 43, b&#39;\xe3\x82\x86&#39;: 43, 43: &#39;&#39;, &#39;&#39;: 44, b&#39;\xe3\x81\x9a&#39;: 44, 44: &#39;&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Rough approximation using kana (for getting Japanese computer voices to speak some English words - works with some words better than others).  Set KANA_TYPE environment variable to hiragana or katakana (which can affect the sounds of some voices); default is hiragana&#39;, (&#39;settings&#39;, &#39;lex_filename&#39;): &#39;words-kana-approx.txt&#39;, (&#39;settings&#39;, &#39;lex_type&#39;): &#39;text&#39;, (&#39;settings&#39;, &#39;lex_header&#39;): &#39;Kana approxmations (very approximate!)\n--------------------------------------\n&#39;, (&#39;settings&#39;, &#39;lex_entry_format&#39;): &#39;%s ~= %s\n&#39;, (&#39;settings&#39;, &#39;word_separator&#39;): &#39; &#39;, (&#39;settings&#39;, &#39;phoneme_separator&#39;): &#39;&#39;, (&#39;settings&#39;, &#39;clause_separator&#39;): b&#39;\xe3\x80\x82\n&#39;, (&#39;settings&#39;, &#39;cleanup_regexps&#39;): [(&#39;$&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;&#39;, &#39;&#39;), (&#39;+&#39;, &#39;&#39;), (&#39;^(.)$&#39;, &#39;\\1&#39;), (&#39;^([])$&#39;, &#39;\\1&#39;)], (&#39;settings&#39;, &#39;cleanup_func&#39;): &lt;function hiragana_to_katakana&gt;}, &#39;names&#39;: {&#39;a_as_in_ah&#39;: 1, b&#39;a_as_in_ah&#39;: 1, 1: &#39;a_as_in_ah&#39;, &#39;var1_a_as_in_ah&#39;: 1.1, b&#39;var1_a_as_in_ah&#39;: 1.1, 1.1: &#39;var1_a_as_in_ah&#39;, &#39;var3_a_as_in_ah&#39;: 1.2, b&#39;var3_a_as_in_ah&#39;: 1.2, 1.2: &#39;var3_a_as_in_ah&#39;, &#39;var4_a_as_in_ah&#39;: 1.3, b&#39;var4_a_as_in_ah&#39;: 1.3, 1.3: &#39;var4_a_as_in_ah&#39;, &#39;var5_a_as_in_ah&#39;: 1.4, b&#39;var5_a_as_in_ah&#39;: 1.4, 1.4: &#39;var5_a_as_in_ah&#39;, &#39;a_as_in_apple&#39;: 2, b&#39;a_as_in_apple&#39;: 2, 2: &#39;a_as_in_apple&#39;, &#39;u_as_in_but&#39;: 3, b&#39;u_as_in_but&#39;: 3, 3: &#39;u_as_in_but&#39;, &#39;var1_u_as_in_but&#39;: 3.1, b&#39;var1_u_as_in_but&#39;: 3.1, 3.1: &#39;var1_u_as_in_but&#39;, &#39;o_as_in_orange&#39;: 4, b&#39;o_as_in_orange&#39;: 4, 4: &#39;o_as_in_orange&#39;, &#39;var1_o_as_in_orange&#39;: 4.1, b&#39;var1_o_as_in_orange&#39;: 4.1, 4.1: &#39;var1_o_as_in_orange&#39;, &#39;var2_o_as_in_orange&#39;: 4.2, b&#39;var2_o_as_in_orange&#39;: 4.2, 4.2: &#39;var2_o_as_in_orange&#39;, &#39;o_as_in_now&#39;: 5, b&#39;o_as_in_now&#39;: 5, 5: &#39;o_as_in_now&#39;, &#39;var1_o_as_in_now&#39;: 5.1, b&#39;var1_o_as_in_now&#39;: 5.1, 5.1: &#39;var1_o_as_in_now&#39;, &#39;a_as_in_ago&#39;: 6, b&#39;a_as_in_ago&#39;: 6, 6: &#39;a_as_in_ago&#39;, &#39;var1_a_as_in_ago&#39;: 6.1, b&#39;var1_a_as_in_ago&#39;: 6.1, 6.1: &#39;var1_a_as_in_ago&#39;, &#39;e_as_in_herd&#39;: 7, b&#39;e_as_in_herd&#39;: 7, 7: &#39;e_as_in_herd&#39;, &#39;ar_as_in_year&#39;: 7.1, b&#39;ar_as_in_year&#39;: 7.1, 7.1: &#39;ar_as_in_year&#39;, &#39;eye&#39;: 8, b&#39;eye&#39;: 8, 8: &#39;eye&#39;, &#39;var1_eye&#39;: 8.1, b&#39;var1_eye&#39;: 8.1, 8.1: &#39;var1_eye&#39;, &#39;b&#39;: 9, b&#39;b&#39;: 9, 9: &#39;b&#39;, &#39;ch&#39;: 10, b&#39;ch&#39;: 10, 10: &#39;ch&#39;, &#39;d&#39;: 11, b&#39;d&#39;: 11, 11: &#39;d&#39;, &#39;th_as_in_them&#39;: 12, b&#39;th_as_in_them&#39;: 12, 12: &#39;th_as_in_them&#39;, &#39;e_as_in_them&#39;: 13, b&#39;e_as_in_them&#39;: 13, 13: &#39;e_as_in_them&#39;, &#39;var1_e_as_in_them&#39;: 13.1, b&#39;var1_e_as_in_them&#39;: 13.1, 13.1: &#39;var1_e_as_in_them&#39;, &#39;a_as_in_air&#39;: 14, b&#39;a_as_in_air&#39;: 14, 14: &#39;a_as_in_air&#39;, &#39;var1_a_as_in_air&#39;: 14.1, b&#39;var1_a_as_in_air&#39;: 14.1, 14.1: &#39;var1_a_as_in_air&#39;, &#39;var2_a_as_in_air&#39;: 14.2, b&#39;var2_a_as_in_air&#39;: 14.2, 14.2: &#39;var2_a_as_in_air&#39;, &#39;var3_a_as_in_air&#39;: 14.3, b&#39;var3_a_as_in_air&#39;: 14.3, 14.3: &#39;var3_a_as_in_air&#39;, &#39;var4_a_as_in_air&#39;: 14.4, b&#39;var4_a_as_in_air&#39;: 14.4, 14.4: &#39;var4_a_as_in_air&#39;, &#39;a_as_in_ate&#39;: 15, b&#39;a_as_in_ate&#39;: 15, 15: &#39;a_as_in_ate&#39;, &#39;var1_a_as_in_ate&#39;: 15.1, b&#39;var1_a_as_in_ate&#39;: 15.1, 15.1: &#39;var1_a_as_in_ate&#39;, &#39;f&#39;: 16, b&#39;f&#39;: 16, 16: &#39;f&#39;, &#39;g&#39;: 17, b&#39;g&#39;: 17, 17: &#39;g&#39;, &#39;h&#39;: 18, b&#39;h&#39;: 18, 18: &#39;h&#39;, &#39;i_as_in_it&#39;: 19, b&#39;i_as_in_it&#39;: 19, 19: &#39;i_as_in_it&#39;, &#39;var1_i_as_in_it&#39;: 19.1, b&#39;var1_i_as_in_it&#39;: 19.1, 19.1: &#39;var1_i_as_in_it&#39;, &#39;var2_i_as_in_it&#39;: 19.2, b&#39;var2_i_as_in_it&#39;: 19.2, 19.2: &#39;var2_i_as_in_it&#39;, &#39;ear&#39;: 20, b&#39;ear&#39;: 20, 20: &#39;ear&#39;, &#39;var1_ear&#39;: 20.1, b&#39;var1_ear&#39;: 20.1, 20.1: &#39;var1_ear&#39;, &#39;var2_ear&#39;: 20.2, b&#39;var2_ear&#39;: 20.2, 20.2: &#39;var2_ear&#39;, &#39;e_as_in_eat&#39;: 21, b&#39;e_as_in_eat&#39;: 21, 21: &#39;e_as_in_eat&#39;, &#39;var1_e_as_in_eat&#39;: 21.1, b&#39;var1_e_as_in_eat&#39;: 21.1, 21.1: &#39;var1_e_as_in_eat&#39;, &#39;j_as_in_jump&#39;: 22, b&#39;j_as_in_jump&#39;: 22, 22: &#39;j_as_in_jump&#39;, &#39;k&#39;: 23, b&#39;k&#39;: 23, 23: &#39;k&#39;, &#39;opt_scottish_loch&#39;: 23.1, b&#39;opt_scottish_loch&#39;: 23.1, 23.1: &#39;opt_scottish_loch&#39;, &#39;l&#39;: 24, b&#39;l&#39;: 24, 24: &#39;l&#39;, &#39;var1_l&#39;: 24.1, b&#39;var1_l&#39;: 24.1, 24.1: &#39;var1_l&#39;, &#39;m&#39;: 25, b&#39;m&#39;: 25, 25: &#39;m&#39;, &#39;n&#39;: 26, b&#39;n&#39;: 26, 26: &#39;n&#39;, &#39;ng&#39;: 27, b&#39;ng&#39;: 27, 27: &#39;ng&#39;, &#39;o_as_in_go&#39;: 28, b&#39;o_as_in_go&#39;: 28, 28: &#39;o_as_in_go&#39;, &#39;var1_o_as_in_go&#39;: 28.1, b&#39;var1_o_as_in_go&#39;: 28.1, 28.1: &#39;var1_o_as_in_go&#39;, &#39;var2_o_as_in_go&#39;: 28.2, b&#39;var2_o_as_in_go&#39;: 28.2, 28.2: &#39;var2_o_as_in_go&#39;, &#39;opt_ol_as_in_gold&#39;: 29, b&#39;opt_ol_as_in_gold&#39;: 29, 29: &#39;opt_ol_as_in_gold&#39;, &#39;oy_as_in_toy&#39;: 30, b&#39;oy_as_in_toy&#39;: 30, 30: &#39;oy_as_in_toy&#39;, &#39;var1_oy_as_in_toy&#39;: 30.1, b&#39;var1_oy_as_in_toy&#39;: 30.1, 30.1: &#39;var1_oy_as_in_toy&#39;, &#39;p&#39;: 31, b&#39;p&#39;: 31, 31: &#39;p&#39;, &#39;r&#39;: 32, b&#39;r&#39;: 32, 32: &#39;r&#39;, &#39;var1_r&#39;: 32.1, b&#39;var1_r&#39;: 32.1, 32.1: &#39;var1_r&#39;, &#39;s&#39;: 33, b&#39;s&#39;: 33, 33: &#39;s&#39;, &#39;sh&#39;: 34, b&#39;sh&#39;: 34, 34: &#39;sh&#39;, &#39;t&#39;: 35, b&#39;t&#39;: 35, 35: &#39;t&#39;, &#39;var1_t&#39;: 35.1, b&#39;var1_t&#39;: 35.1, 35.1: &#39;var1_t&#39;, &#39;th_as_in_think&#39;: 36, b&#39;th_as_in_think&#39;: 36, 36: &#39;th_as_in_think&#39;, &#39;oor_as_in_poor&#39;: 37, b&#39;oor_as_in_poor&#39;: 37, 37: &#39;oor_as_in_poor&#39;, &#39;var1_oor_as_in_poor&#39;: 37.1, b&#39;var1_oor_as_in_poor&#39;: 37.1, 37.1: &#39;var1_oor_as_in_poor&#39;, &#39;opt_u_as_in_pull&#39;: 37.2, b&#39;opt_u_as_in_pull&#39;: 37.2, 37.2: &#39;opt_u_as_in_pull&#39;, &#39;opt_ul_as_in_pull&#39;: 38, b&#39;opt_ul_as_in_pull&#39;: 38, 38: &#39;opt_ul_as_in_pull&#39;, &#39;oo_as_in_food&#39;: 39, b&#39;oo_as_in_food&#39;: 39, 39: &#39;oo_as_in_food&#39;, &#39;var1_oo_as_in_food&#39;: 39.1, b&#39;var1_oo_as_in_food&#39;: 39.1, 39.1: &#39;var1_oo_as_in_food&#39;, &#39;var2_oo_as_in_food&#39;: 39.2, b&#39;var2_oo_as_in_food&#39;: 39.2, 39.2: &#39;var2_oo_as_in_food&#39;, &#39;close_to_or&#39;: 40, b&#39;close_to_or&#39;: 40, 40: &#39;close_to_or&#39;, &#39;var1_close_to_or&#39;: 40.1, b&#39;var1_close_to_or&#39;: 40.1, 40.1: &#39;var1_close_to_or&#39;, &#39;var2_close_to_or&#39;: 40.2, b&#39;var2_close_to_or&#39;: 40.2, 40.2: &#39;var2_close_to_or&#39;, &#39;var3_close_to_or&#39;: 40.3, b&#39;var3_close_to_or&#39;: 40.3, 40.3: &#39;var3_close_to_or&#39;, &#39;v&#39;: 41, b&#39;v&#39;: 41, 41: &#39;v&#39;, &#39;w&#39;: 42, b&#39;w&#39;: 42, 42: &#39;w&#39;, &#39;var1_w&#39;: 42.1, b&#39;var1_w&#39;: 42.1, 42.1: &#39;var1_w&#39;, &#39;y&#39;: 43, b&#39;y&#39;: 43, 43: &#39;y&#39;, &#39;z&#39;: 44, b&#39;z&#39;: 44, 44: &#39;z&#39;, &#39;ge_of_blige_etc&#39;: 45, b&#39;ge_of_blige_etc&#39;: 45, 45: &#39;ge_of_blige_etc&#39;, &#39;glottal_stop&#39;: 46, b&#39;glottal_stop&#39;: 46, 46: &#39;glottal_stop&#39;, &#39;syllable_separator&#39;: 47, b&#39;syllable_separator&#39;: 47, 47: &#39;syllable_separator&#39;, &#39;primary_stress&#39;: 47.1, b&#39;primary_stress&#39;: 47.1, 47.1: &#39;primary_stress&#39;, &#39;secondary_stress&#39;: 47.2, b&#39;secondary_stress&#39;: 47.2, 47.2: &#39;secondary_stress&#39;, &#39;text_sharp&#39;: 48, b&#39;text_sharp&#39;: 48, 48: &#39;text_sharp&#39;, &#39;text_underline&#39;: 49, b&#39;text_underline&#39;: 49, 49: &#39;text_underline&#39;, &#39;text_question&#39;: 50, b&#39;text_question&#39;: 50, 50: &#39;text_question&#39;, &#39;text_exclamation&#39;: 51, b&#39;text_exclamation&#39;: 51, 51: &#39;text_exclamation&#39;, &#39;text_comma&#39;: 52, b&#39;text_comma&#39;: 52, 52: &#39;text_comma&#39;, &#39;ipa_colon&#39;: 53, b&#39;ipa_colon&#39;: 53, 53: &#39;ipa_colon&#39;, (&#39;settings&#39;, &#39;doc&#39;): &#39;Lexconvert internal phoneme names (sometimes useful with the --phones option while developing new formats)&#39;}}</span>

        
    </div>
    <a class="headerlink" href="#lexFormats"></a>
    
    

                </section>
                <section id="chr">
                            <input id="chr-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">chr</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">x</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="chr-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#chr"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="chr-2560"><a href="#chr-2560"><span class="linenos">2560</span></a>   <span class="k">def</span> <span class="nf">chr</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span><span class="p">])</span>
</span></pre></div>


    

                </section>
                <section id="sorted">
                            <input id="sorted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sorted</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">l</span>, </span><span class="param"><span class="n">theCmp</span><span class="o">=</span><span class="kc">None</span></span><span class="return-annotation">):</span></span>

                <label class="view-source-button" for="sorted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#sorted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="sorted-2563"><a href="#sorted-2563"><span class="linenos">2563</span></a>   <span class="k">def</span> <span class="nf">sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">theCmp</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
</span><span id="sorted-2564"><a href="#sorted-2564"><span class="linenos">2564</span></a>      <span class="k">if</span> <span class="n">theCmp</span><span class="p">:</span>
</span><span id="sorted-2565"><a href="#sorted-2565"><span class="linenos">2565</span></a>         <span class="k">return</span> <span class="n">_builtin_sorted</span><span class="p">(</span><span class="n">l</span><span class="p">,</span><span class="n">key</span><span class="o">=</span><span class="n">cmp_to_key</span><span class="p">(</span><span class="n">theCmp</span><span class="p">))</span>
</span><span id="sorted-2566"><a href="#sorted-2566"><span class="linenos">2566</span></a>      <span class="k">else</span><span class="p">:</span> <span class="k">return</span> <span class="n">_builtin_sorted</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
</span></pre></div>


    

                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>